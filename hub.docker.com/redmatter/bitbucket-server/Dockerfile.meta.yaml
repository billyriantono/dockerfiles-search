MetaArgs: null
Stages:
- BaseName: java:openjdk-8-jre
  Commands:
  - Maintainer: Atlassian Bitbucket Server Team
    Name: maintainer
  - CmdLine:
    - apt-get update -qq     && apt-get install -y --no-install-recommends git libtcnative-1
      ssh     && apt-get clean autoclean     && apt-get autoremove --yes     && rm
      -rf /var/lib/{apt,dpkg,cache,log}/
    Name: run
    PrependShell: true
  - Env:
    - Key: RUN_USER
      Value: daemon
    Name: env
  - Env:
    - Key: RUN_GROUP
      Value: daemon
    Name: env
  - Env:
    - Key: BITBUCKET_HOME
      Value: /var/atlassian/application-data/bitbucket
    Name: env
  - Env:
    - Key: BITBUCKET_INSTALL_DIR
      Value: /opt/atlassian/bitbucket
    Name: env
  - Env:
    - Key: BITBUCKET_VERSION
      Value: 4.13.0
    Name: env
  - Env:
    - Key: DOWNLOAD_URL
      Value: https://downloads.atlassian.com/software/stash/downloads/atlassian-bitbucket-${BITBUCKET_VERSION}.tar.gz
    Name: env
  - CmdLine:
    - mkdir -p                             ${BITBUCKET_INSTALL_DIR}     && curl -L
      --silent                  ${DOWNLOAD_URL} | tar -xz --strip=1 -C "$BITBUCKET_INSTALL_DIR"     &&
      mkdir -p                          ${BITBUCKET_INSTALL_DIR}/conf/Catalina          &&
      chmod -R 700                      ${BITBUCKET_INSTALL_DIR}/conf/Catalina          &&
      chmod -R 700                      ${BITBUCKET_INSTALL_DIR}/logs                   &&
      chmod -R 700                      ${BITBUCKET_INSTALL_DIR}/temp                   &&
      chmod -R 700                      ${BITBUCKET_INSTALL_DIR}/work                   &&
      chown -R ${RUN_USER}:${RUN_GROUP} ${BITBUCKET_INSTALL_DIR}/                       &&
      ln --symbolic                     "/usr/lib/x86_64-linux-gnu/libtcnative-1.so"
      "${BITBUCKET_INSTALL_DIR}/lib/native/libtcnative-1.so"     && sed -i -e 's@^export
      CATALINA_OPTS$@. $PRGDIR/catalina-connector-opts.sh\nexport CATALINA_OPTS@'
      ${BITBUCKET_INSTALL_DIR}/bin/setenv.sh     && sed -i -e 's@$PRGDIR/catalina.sh@CATALINA_OPTS="$CATALINA_OPTS"
      $PRGDIR/catalina.sh@' -e 's@$PRGDIR/startup.sh@CATALINA_OPTS="$CATALINA_OPTS"
      $PRGDIR/startup.sh@' ${BITBUCKET_INSTALL_DIR}/bin/start-webapp.sh     && sed
      -i -e 's/port="7990"/port="7990" secure="${catalinaConnectorSecure}" scheme="${catalinaConnectorScheme}"
      proxyName="${catalinaConnectorProxyName}" proxyPort="${catalinaConnectorProxyPort}"/'
      ${BITBUCKET_INSTALL_DIR}/conf/server.xml
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - /entrypoint.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - catalina-connector-opts.sh
    - ${BITBUCKET_INSTALL_DIR}/bin/
  - Name: volume
    Volumes:
    - ${BITBUCKET_HOME}
  - Name: expose
    Ports:
    - "7990"
  - Name: expose
    Ports:
    - "7999"
  - Name: workdir
    Path: $BITBUCKET_INSTALL_DIR
  - CmdLine:
    - /entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - -fg
    Name: cmd
    PrependShell: false
  From:
    Image: java:openjdk-8-jre
  Name: ""
  Platform: ""
  SourceCode: FROM java:openjdk-8-jre
