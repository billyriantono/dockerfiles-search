MetaArgs: null
Stages:
- As: build
  BaseName: maven:3.6-alpine
  Commands:
  - Key: http_proxy
    Name: arg
    Value: '""'
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./
    - /workingdir/
  - Name: workdir
    Path: /workingdir
  - CmdLine:
    - cp docker/maven_proxy_parser.sh /usr/local/bin/ &&     chmod +x /usr/local/bin/maven_proxy_parser.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - if [ "$http_proxy" != "" ]; then         apk add --no-cache xmlstarlet &&         maven_proxy_parser.sh
      parse &&         apk del xmlstarlet     ;fi
    Name: run
    PrependShell: true
  - CmdLine:
    - mvn clean &&     mvn install &&     mkdir -p extracted &&     cd extracted &&     unzip
      /workingdir/target/mainzelliste-*.war
    Name: run
    PrependShell: true
  From:
    Image: maven:3.6-alpine
  Name: build
  Platform: ""
  SourceCode: FROM maven:3.6-alpine AS build
- BaseName: tomcat:8-jre8-alpine
  Commands:
  - Env:
    - Key: ML_CONFIG_FILE
      Value: '""'
    Name: env
  - CmdLine:
    - set -x ;     addgroup -g 82 -S www-data &&     adduser -u 82 -D -S -G www-data
      mainzelliste
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -r /usr/local/tomcat/webapps/*
    Name: run
    PrependShell: true
  - Chown: mainzelliste:www-data
    From: build
    Name: copy
    SourcesAndDest:
    - /workingdir/extracted/
    - /usr/local/tomcat/webapps/ROOT/
  - Chown: mainzelliste:www-data
    From: ""
    Name: copy
    SourcesAndDest:
    - ./docker/ml_entrypoint.sh
    - ./config/mainzelliste.conf.default
    - /
  - CmdLine:
    - mkdir /etc/mainzelliste && touch /etc/mainzelliste/mainzelliste.conf && chown
      -R mainzelliste /etc/mainzelliste/mainzelliste.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod u+x /ml_entrypoint.sh && chmod u+r /mainzelliste.conf.default && chmod
      u+rw /etc/mainzelliste/mainzelliste.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./docker/tomcat.*.patch
    - /usr/local/tomcat/conf
  - CmdLine:
    - "cd /usr/local/tomcat/conf && \tpatch -i *.patch && \trm *.patch && \tmv server.xml
      server.xml.ori"
    Name: run
    PrependShell: true
  - CmdLine:
    - /ml_entrypoint.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: tomcat:8-jre8-alpine
  Name: ""
  Platform: ""
  SourceCode: FROM tomcat:8-jre8-alpine
