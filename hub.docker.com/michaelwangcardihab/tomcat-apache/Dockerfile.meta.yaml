MetaArgs: null
Stages:
- BaseName: tomcat:7-jre8
  Commands:
  - Labels:
    - Key: version
      Value: '"1.0.0"'
    Name: label
  - Labels:
    - Key: maintainer
      Value: '"michael.wang@cardihab.com"'
    Name: label
  - CmdLine:
    - apt-get update &&     apt-get install -yq         apache2         libapache2-mod-jk
      &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod rewrite
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - Name: expose
    Ports:
    - "443"
  - CmdLine:
    - rm -rf /usr/local/tomcat/webapps/ROOT
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /usr/local/tomcat/webapps/docs
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /usr/local/tomcat/webapps/examples
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /usr/local/tomcat/webapps/host-manager
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /usr/local/tomcat/webapps/manager
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i "s/workers.tomcat_home.*/workers.tomcat_home=\/usr\/local\/tomcat/g"
      /etc/libapache2-mod-jk/workers.properties
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i "s/workers.java_home.*/workers.java_home=\/usr\/lib\/jvm\/java-8-openjdk-amd64/g"
      /etc/libapache2-mod-jk/workers.properties
    Name: run
    PrependShell: true
  - CmdLine:
    - truncate --size 0 /etc/apache2/sites-available/default-ssl.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "<IfModule mod_ssl.c>\n\t<VirtualHost _default_:443>\n\t\tJkMount /* ajp13_worker\n\n\t\tServerAdmin
      \${APACHE_SERVER_ADMIN}\n\n\t\tDocumentRoot /usr/local/tomcat/webapps\n\n\t\tErrorLog
      \${APACHE_LOG_DIR}/error.log\n\t\tCustomLog \${APACHE_LOG_DIR}/access.log combined\n\n\t\tSSLEngine
      on\n\t\tSSLCertificateFile /etc/apache2/ssl.crt/server-certificate.crt\n\t\tSSLCertificateKeyFile
      /etc/apache2/ssl.crt/server-certificate.key\n\t\tSSLCertificateChainFile /etc/apache2/ssl.crt/server-chain-certificate.crt\n\n\t</VirtualHost>\n</IfModule>"
      > /etc/apache2/sites-available/default-ssl.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - truncate --size 0 /etc/apache2/sites-available/000-default.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "<VirtualHost *:80>\n\tRewriteEngine On\n\tRewriteCond %{HTTPS} !=on\n\tRewriteRule
      ^/?(.*) https://%{SERVER_NAME}/\$1 [R,L]\n</VirtualHost>" > /etc/apache2/sites-available/000-default.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "ServerName \${APACHE_SERVER_NAME}" > /etc/apache2/conf-available/servername.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /etc/apache2/conf-available/servername.conf /etc/apache2/conf-enabled/servername.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/default-ssl.conf
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - run.sh
    - /run.sh
  - CmdLine:
    - chmod +x /*.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /run.sh
    Name: cmd
    PrependShell: false
  From:
    Image: tomcat:7-jre8
  Name: ""
  Platform: ""
  SourceCode: FROM tomcat:7-jre8
