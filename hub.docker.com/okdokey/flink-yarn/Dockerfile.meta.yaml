MetaArgs: null
Stages:
- BaseName: okdokey/hadoop:2.9.2-HA
  Commands:
  - Env:
    - Key: FLINK_VERSION
      Value: 1.8.0
    - Key: HADOOP_SCALA_VARIANT
      Value: scala_2.12
    - Key: GPG_KEY
      Value: F2A67A8047499BBB3908D17AA8F4FD97121D7293
    Name: env
  - Env:
    - Key: FLINK_HOME
      Value: /opt/flink
    Name: env
  - Env:
    - Key: PATH
      Value: $FLINK_HOME/bin:$PATH
    Name: env
  - CmdLine:
    - useradd --system --home-dir $FLINK_HOME --uid=9999 --gid=hadoop -s /bin/bash
      -c "Flink Account" flink
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - flink-profile.sh
    - /etc/profile.d/
  - Name: workdir
    Path: $FLINK_HOME
  - Key: FLINK_FILE_NAME
    Name: arg
    Value: flink-${FLINK_VERSION}-bin-${HADOOP_SCALA_VARIANT}.tgz
  - Key: FLINK_FILE_URL_DEFAULT
    Name: arg
    Value: https://www.apache.org/dist/flink/flink-${FLINK_VERSION}/${FLINK_FILE_NAME}
  - Key: FLINK_FILE_URL_TSINGHUA
    Name: arg
    Value: http://mirrors.tuna.tsinghua.edu.cn/apache/flink/flink-${FLINK_VERSION}/${FLINK_FILE_NAME}
  - Key: FLINK_FILE_URL_BIT
    Name: arg
    Value: http://mirror.bit.edu.cn/apache/flink/flink-${FLINK_VERSION}/${FLINK_FILE_NAME}
  - Key: FLINK_FILE_URL_EU
    Name: arg
    Value: https://www-eu.apache.org/dist/flink/flink-${FLINK_VERSION}/${FLINK_FILE_NAME}
  - Key: FLINK_FILE_URL_US
    Name: arg
    Value: https://www-us.apache.org/dist/flink/flink-${FLINK_VERSION}/${FLINK_FILE_NAME}
  - Key: FLINK_ASC_URL
    Name: arg
    Value: https://www.apache.org/dist/flink/flink-${FLINK_VERSION}/${FLINK_FILE_NAME}.asc
  - Key: SHADED_HADOOP_URL
    Name: arg
    Value: https://repo.maven.apache.org/maven2/org/apache/flink/flink-shaded-hadoop2-uber/2.8.3-${FLINK_VERSION}/flink-shaded-hadoop2-uber-2.8.3-${FLINK_VERSION}.jar
  - CmdLine:
    - set -ex;   axel -qkn 20 -o flink.tgz "${FLINK_FILE_URL_TSINGHUA}" "${FLINK_FILE_URL_BIT}"
      "${FLINK_FILE_URL_DEFAULT}" "${FLINK_FILE_URL_EU}" "${FLINK_FILE_URL_US}";
    Name: run
    PrependShell: true
  - CmdLine:
    - 'axel -qkn 4 -o flink.tgz.asc "$FLINK_ASC_URL";   export GNUPGHOME="$(mktemp
      -d)";   for server in ha.pool.sks-keyservers.net $(shuf -e                           hkp://p80.pool.sks-keyservers.net:80                           keyserver.ubuntu.com                           hkp://keyserver.ubuntu.com:80                           pgp.mit.edu)
      ; do       gpg --batch --keyserver "$server" --recv-keys "$GPG_KEY" && break
      || : ;   done &&   gpg --batch --verify flink.tgz.asc flink.tgz;   gpgconf --kill
      all;   rm -rf "$GNUPGHOME" flink.tgz.asc;   tar -xf flink.tgz --strip-components=1;   rm
      flink.tgz;'
    Name: run
    PrependShell: true
  - CmdLine:
    - axel -qkn 10 -o lib ${SHADED_HADOOP_URL};   chown -R flink:hadoop .;
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s $JAVA_HOME/bin/java /bin/java;     rm -f ./lib/slf4j-log4j12-1.7.15.jar;     ln
      -s /opt/hadoop/share/hadoop/common/lib/slf4j-log4j12-1.7.25.jar ./lib/slf4j-log4j12-1.7.25.jar;
    Name: run
    PrependShell: true
  - CmdLine:
    - cp -r /home/hadoop/.ssh ./;
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - flink-conf.yaml
    - conf/
  - CmdLine:
    - chown -R flink:hadoop .;
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker-entrypoint.sh
    - /
  - CmdLine:
    - chmod +x /docker-entrypoint.sh
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "6123"
    - "8081"
    - "8082"
  - CmdLine:
    - /docker-entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /bin/bash
    Name: cmd
    PrependShell: false
  From:
    Image: okdokey/hadoop:2.9.2-HA
  Name: ""
  Platform: ""
  SourceCode: FROM okdokey/hadoop:2.9.2-HA
