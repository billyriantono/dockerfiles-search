MetaArgs: null
Stages:
- BaseName: ubuntu:latest
  Commands:
  - CmdLine:
    - mkdir -p /opt &&     groupadd -g 999 mid &&     useradd -r -u 999 -g mid mid
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -q update && apt-get install -qy unzip     wget vim &&     apt-get clean
      &&     rm -rf /var/lib/apt/lists/* &&     rm -rf /tmp/*
    Name: run
    PrependShell: true
  - Env:
    - Key: HOST
      Value: '"default-host"'
    Name: env
  - Env:
    - Key: USER_NAME
      Value: '"default-user"'
    Name: env
  - Env:
    - Key: PASSWORD
      Value: '"default-password"'
    Name: env
  - Env:
    - Key: PROXY
      Value: '""'
    Name: env
  - Env:
    - Key: PROXY_PORT
      Value: '""'
    Name: env
  - Key: URL
    Name: arg
    Value: null
  - CmdLine:
    - 'echo "mid binary url: ${URL}"'
    Name: run
    PrependShell: true
  - CmdLine:
    - test -n "$URL"
    Name: run
    PrependShell: true
  - Key: VERSION
    Name: arg
    Value: null
  - Env:
    - Key: PIN
      Value: ${VERSION}
    Name: env
  - CmdLine:
    - 'echo "pinned to version: ${VERSION}"'
    Name: run
    PrependShell: true
  - CmdLine:
    - wget --progress=bar:force --no-check-certificate     ${URL} -O /tmp/mid.zip
      &&     unzip -d /opt /tmp/mid.zip &&     chmod -R 755 /opt/agent &&     chown
      -R mid:mid /opt/* &&     mv /opt/agent/config.xml /opt/. &&     rm -rf /tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - /bin/bash -c 'if [[ ! -d "/opt/agent/jre" ]] ; then apt-get update &&     apt-get
      upgrade -y &&     apt-get install -y --no-install-recommends software-properties-common
      &&     add-apt-repository -y ppa:openjdk-r/ppa &&     apt-get update &&     apt-get
      install -y openjdk-8-jre &&     update-alternatives --config java &&     apt-get
      clean &&     rm -rf /var/lib/apt/lists/* &&     rm -rf /tmp/* &&     ln -s /usr/lib/jvm/java-8-openjdk-amd64/jre
      /opt/agent/.     ; fi'
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./start.sh
    - /opt
  - CmdLine:
    - chmod +x /opt/start.sh
    Name: run
    PrependShell: true
  - Name: user
    User: mid
  - CmdLine:
    - /opt/start.sh
    Name: cmd
    PrependShell: false
  From:
    Image: ubuntu:latest
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:latest
