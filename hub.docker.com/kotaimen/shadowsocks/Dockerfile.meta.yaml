MetaArgs: null
Stages:
- BaseName: alpine:3.8
  Commands:
  - Maintainer: KOTAIMEN <kotaimen.c@gmail.com>
    Name: maintainer
  - Key: SS_VER
    Name: arg
    Value: 3.2.3
  - Key: SS_URL
    Name: arg
    Value: https://github.com/shadowsocks/shadowsocks-libev/releases/download/v${SS_VER}/shadowsocks-libev-${SS_VER}.tar.gz
  - Key: OBFS_URL
    Name: arg
    Value: https://github.com/shadowsocks/simple-obfs.git
  - Env:
    - Key: SS_PORT
      Value: "8388"
    Name: env
  - CmdLine:
    - set -ex             && apk add --no-cache                 --virtual .build-deps                 autoconf                 automake                 build-base                 curl                 libev-dev                 libtool                 linux-headers                 c-ares-dev                 libsodium-dev                 mbedtls-dev                 pcre-dev                 tar                 git                         &&
      mkdir -p /tmp/ss             && cd /tmp/ss             && curl -sSL $SS_URL
      | tar xz --strip 1             && ./configure --prefix=/usr --disable-documentation             &&
      make install                         && cd /tmp/             && git clone $OBFS_URL
      simple-obfs             && cd simple-obfs             && git submodule update
      --init --recursive             && ./autogen.sh             && ./configure --prefix=/usr
      --disable-documentation             && make install                         &&
      runDeps="$(                 scanelf --needed --nobanner /usr/bin/ss-* /usr/bin/obfs-*                     |
      awk '{ gsub(/,/, "\nso:", $2); print "so:" $2 }'                     | xargs
      -r apk info --installed                     | sort -u             )"             &&
      apk add --no-cache --virtual .run-deps $runDeps                         && apk
      del .build-deps             && cd / && rm -rf /tmp/*
    Name: run
    PrependShell: true
  - Name: user
    User: nobody
  - Name: expose
    Ports:
    - ${SS_PORT}/tcp
    - ${SS_PORT}/udp
  - Chown: ""
    Name: add
    SourcesAndDest:
    - docker_run.sh
    - ./
  - CmdLine:
    - ./docker_run.sh
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:3.8
  Name: ""
  Platform: ""
  SourceCode: FROM        alpine:3.8
