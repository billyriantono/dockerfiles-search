MetaArgs: null
Stages:
- BaseName: starchy/baseimage-docker
  Commands:
  - Maintainer: starchy grant <starchy@gmail.com>
    Name: maintainer
  - CmdLine:
    - apt-get update && apt-get install -y --no-install-recommends     apache2     libapache2-mod-php     build-essential     php     php-dev     php-mysqlnd     php-imap     php-cli     php-pear     php-apcu     php-gd     php-memcached     python-pip     mysql-client     ssmtp     memcached     drush     git
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/openatrium.cron.sh
    - /etc/cron.hourly/openatrium
  - CmdLine:
    - chmod +x /etc/cron.hourly/openatrium
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - assets/apache.security.conf
    - /etc/apache2/conf.d/
  - CmdLine:
    - rm -f /etc/apache2/sites-enabled/*
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - assets/apache.openatrium.conf
    - /etc/apache2/sites-available/
  - CmdLine:
    - ln -s /etc/apache2/sites-available/apache.openatrium.conf /etc/apache2/sites-enabled/openatrium.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod rewrite
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /usr/local/drush
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/bin/drush /usr/local/drush/drush
    Name: run
    PrependShell: true
  - Env:
    - Key: PHP_MEMORY_LIMIT
      Value: 1024M
    Name: env
  - Env:
    - Key: PHP_MAX_EXECUTION_TIME
      Value: "900"
    Name: env
  - Env:
    - Key: PHP_SESSION_SAVE_CACHE
      Value: memcached
    Name: env
  - Env:
    - Key: PHP_SENDMAIL_PATH
      Value: /usr/sbin/ssmtp -t
    Name: env
  - CmdLine:
    - sed -i     -e 's/^;session.save_path/session.save_path/g'     -e "s!^;sendmail_path
      =.*\$!sendmail_path = $PHP_SENDMAIL_PATH!g"     /etc/php/7.0/apache2/php.ini
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/update_php_vars.sh
    - /usr/bin/
  - CmdLine:
    - chmod +x /usr/bin/update_php_vars.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - update_php_vars.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - phpenmod imap
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /root     && git clone https://github.com/Jan-E/uploadprogress.git     &&
      cd uploadprogress     && phpize     && ./configure     && make     && make install     &&
      echo 'extension=uploadprogress.so' >/etc/php/7.0/mods-available/uploadprogress.ini     &&
      phpenmod uploadprogress     && cd     && rm -rf /root/uploadprogress
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "www-data" >/etc/container_environment/APACHE_RUN_GROUP &&     echo "www-data"
      >/etc/container_environment/APACHE_RUN_USER &&     echo "/var/run/apache2/apache2.pid"
      >/etc/container_environment/APACHE_PID_FILE &&     echo "/var/run/apache2" >/etc/container_environment/APACHE_RUN_DIR
      &&     echo "/var/lock/apache2" >/etc/container_environment/APACHE_LOCK_DIR
      &&     echo "/var/log/apache2" >/etc/container_environment/APACHE_LOG_DIR
    Name: run
    PrependShell: true
  - Env:
    - Key: MEMCACHED_MEM
      Value: "1024"
    Name: env
  - Env:
    - Key: NO_FILE_PERMISSION_RESTORE
      Value: "false"
    Name: env
  - Env:
    - Key: MIGRATE_SITES_TO
      Value: "false"
    Name: env
  - Env:
    - Key: ACCOUNT_NAME
      Value: admin
    Name: env
  - Env:
    - Key: ACCOUNT_PASS
      Value: insecurepass
    Name: env
  - Env:
    - Key: ACCOUNT_MAIL
      Value: admin@example.com
    Name: env
  - Env:
    - Key: SITE_NAME
      Value: Open Atrium
    Name: env
  - Env:
    - Key: SITE_MAIL
      Value: admin@example.com
    Name: env
  - Env:
    - Key: INSTALL_SITE
      Value: "true"
    Name: env
  - Env:
    - Key: AUTO_DB_SETTINGS
      Value: "true"
    Name: env
  - Env:
    - Key: SSMTP_ROOT
      Value: example.address@gmail.com
    Name: env
  - Env:
    - Key: SSMTP_MAILHUB
      Value: smtp.gmail.com:587
    Name: env
  - Env:
    - Key: SSMTP_HOSTNAME
      Value: example.address@gmail.com
    Name: env
  - Env:
    - Key: SSMTP_USE_STARTTLS
      Value: "YES"
    Name: env
  - Env:
    - Key: SSMTP_AUTH_USER
      Value: example.address
    Name: env
  - Env:
    - Key: SSMTP_AUTH_PASS
      Value: emailpassword
    Name: env
  - Env:
    - Key: SSMTP_FROMLINE_OVERRIDE
      Value: "YES"
    Name: env
  - Env:
    - Key: SSMTP_AUTH_METHOD
      Value: LOGIN
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/update_ssmtp.sh
    - /usr/bin/update_ssmtp.sh
  - CmdLine:
    - rm -f /etc/ssmtp/ssmtp.conf
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/ssmtp.conf
    - /etc/ssmtp/ssmtp.conf
  - CmdLine:
    - chmod +x /usr/bin/update_ssmtp.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /usr/bin/update_ssmtp.sh
    Name: run
    PrependShell: true
  - Env:
    - Key: OATRIUM_DOWNLOAD_URL
      Value: https://ftp.drupal.org/files/projects/openatrium-7.x-2.644-core.tar.gz
    Name: env
  - Env:
    - Key: OATRIUM_DOWNLOAD_SHA256
      Value: 8373f6f186445705974f3fe00929d409f246d9f1ab6e101bfd22df03231fade6
    Name: env
  - CmdLine:
    - rm -f /var/www/html/*
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -fsS "$OATRIUM_DOWNLOAD_URL" -o oatrium.tar.gz   && echo "$OATRIUM_DOWNLOAD_SHA256
      oatrium.tar.gz" | sha256sum -c -   && tar -C /var/www/html -xzf oatrium.tar.gz
      --strip-components=1   && rm -f oatrium.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /etc/service/memcached /etc/service/apache
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/services/memcached.sh
    - /etc/service/memcached/run
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/services/apache.sh
    - /etc/service/apache/run
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/services/apache-log-forwarder.sh
    - /etc/service/apache-log-forwarder/run
  - CmdLine:
    - chmod -R +x /etc/service/
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./assets/init.sh
    - /etc/my_init.d/10_init.sh
  - CmdLine:
    - chmod -R +x /etc/my_init.d/
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "443"
    - "80"
  - Name: volume
    Volumes:
    - /data
  - Name: volume
    Volumes:
    - /var/www/html/sites
  - CmdLine:
    - /sbin/my_init
    Name: cmd
    PrependShell: false
  - CmdLine:
    - apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  From:
    Image: starchy/baseimage-docker
  Name: ""
  Platform: ""
  SourceCode: FROM starchy/baseimage-docker
