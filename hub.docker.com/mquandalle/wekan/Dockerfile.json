{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "ubuntu:rolling",
      "SourceCode": "FROM ubuntu:rolling",
      "Platform": "",
      "From": {
        "Image": "ubuntu:rolling"
      },
      "Commands": [
        {
          "Labels": [
            {
              "Key": "maintainer",
              "Value": "\"wekan\""
            }
          ],
          "Name": "label"
        },
        {
          "Env": [
            {
              "Key": "BUILD_DEPS",
              "Value": "\"apt-utils libarchive-tools gnupg gosu wget curl bzip2 g++ build-essential git ca-certificates python3\""
            },
            {
              "Key": "DEBUG",
              "Value": "false"
            },
            {
              "Key": "NODE_VERSION",
              "Value": "v8.17.0"
            },
            {
              "Key": "METEOR_RELEASE",
              "Value": "1.8.1"
            },
            {
              "Key": "USE_EDGE",
              "Value": "false"
            },
            {
              "Key": "METEOR_EDGE",
              "Value": "1.5-beta.17"
            },
            {
              "Key": "NPM_VERSION",
              "Value": "latest"
            },
            {
              "Key": "FIBERS_VERSION",
              "Value": "4.0.1"
            },
            {
              "Key": "ARCHITECTURE",
              "Value": "linux-x64"
            },
            {
              "Key": "SRC_PATH",
              "Value": "./"
            },
            {
              "Key": "WITH_API",
              "Value": "true"
            },
            {
              "Key": "ACCOUNTS_LOCKOUT_KNOWN_USERS_FAILURES_BEFORE",
              "Value": "3"
            },
            {
              "Key": "ACCOUNTS_LOCKOUT_KNOWN_USERS_PERIOD",
              "Value": "60"
            },
            {
              "Key": "ACCOUNTS_LOCKOUT_KNOWN_USERS_FAILURE_WINDOW",
              "Value": "15"
            },
            {
              "Key": "ACCOUNTS_LOCKOUT_UNKNOWN_USERS_FAILURES_BERORE",
              "Value": "3"
            },
            {
              "Key": "ACCOUNTS_LOCKOUT_UNKNOWN_USERS_LOCKOUT_PERIOD",
              "Value": "60"
            },
            {
              "Key": "ACCOUNTS_LOCKOUT_UNKNOWN_USERS_FAILURE_WINDOW",
              "Value": "15"
            },
            {
              "Key": "RICHER_CARD_COMMENT_EDITOR",
              "Value": "true"
            },
            {
              "Key": "CARD_OPENED_WEBHOOK_ENABLED",
              "Value": "false"
            },
            {
              "Key": "ATTACHMENTS_STORE_PATH",
              "Value": "\"\""
            },
            {
              "Key": "MAX_IMAGE_PIXEL",
              "Value": "\"\""
            },
            {
              "Key": "IMAGE_COMPRESS_RATIO",
              "Value": "\"\""
            },
            {
              "Key": "BIGEVENTS_PATTERN",
              "Value": "NONE"
            },
            {
              "Key": "NOTIFY_DUE_DAYS_BEFORE_AND_AFTER",
              "Value": "\"\""
            },
            {
              "Key": "NOTIFY_DUE_AT_HOUR_OF_DAY",
              "Value": "\"\""
            },
            {
              "Key": "EMAIL_NOTIFICATION_TIMEOUT",
              "Value": "30000"
            },
            {
              "Key": "MATOMO_ADDRESS",
              "Value": "\"\""
            },
            {
              "Key": "MATOMO_SITE_ID",
              "Value": "\"\""
            },
            {
              "Key": "MATOMO_DO_NOT_TRACK",
              "Value": "true"
            },
            {
              "Key": "MATOMO_WITH_USERNAME",
              "Value": "false"
            },
            {
              "Key": "BROWSER_POLICY_ENABLED",
              "Value": "true"
            },
            {
              "Key": "TRUSTED_URL",
              "Value": "\"\""
            },
            {
              "Key": "WEBHOOKS_ATTRIBUTES",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_ENABLED",
              "Value": "false"
            },
            {
              "Key": "OAUTH2_LOGIN_STYLE",
              "Value": "redirect"
            },
            {
              "Key": "OAUTH2_CLIENT_ID",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_SECRET",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_SERVER_URL",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_AUTH_ENDPOINT",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_USERINFO_ENDPOINT",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_TOKEN_ENDPOINT",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_ID_MAP",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_USERNAME_MAP",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_FULLNAME_MAP",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_ID_TOKEN_WHITELIST_FIELDS",
              "Value": "\"\""
            },
            {
              "Key": "OAUTH2_REQUEST_PERMISSIONS",
              "Value": "'openid profile email'"
            },
            {
              "Key": "OAUTH2_EMAIL_MAP",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_ENABLE",
              "Value": "false"
            },
            {
              "Key": "LDAP_PORT",
              "Value": "389"
            },
            {
              "Key": "LDAP_HOST",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_BASEDN",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_LOGIN_FALLBACK",
              "Value": "false"
            },
            {
              "Key": "LDAP_RECONNECT",
              "Value": "true"
            },
            {
              "Key": "LDAP_TIMEOUT",
              "Value": "10000"
            },
            {
              "Key": "LDAP_IDLE_TIMEOUT",
              "Value": "10000"
            },
            {
              "Key": "LDAP_CONNECT_TIMEOUT",
              "Value": "10000"
            },
            {
              "Key": "LDAP_AUTHENTIFICATION",
              "Value": "false"
            },
            {
              "Key": "LDAP_AUTHENTIFICATION_USERDN",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_AUTHENTIFICATION_PASSWORD",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_LOG_ENABLED",
              "Value": "false"
            },
            {
              "Key": "LDAP_BACKGROUND_SYNC",
              "Value": "false"
            },
            {
              "Key": "LDAP_BACKGROUND_SYNC_INTERVAL",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_BACKGROUND_SYNC_KEEP_EXISTANT_USERS_UPDATED",
              "Value": "false"
            },
            {
              "Key": "LDAP_BACKGROUND_SYNC_IMPORT_NEW_USERS",
              "Value": "false"
            },
            {
              "Key": "LDAP_ENCRYPTION",
              "Value": "false"
            },
            {
              "Key": "LDAP_CA_CERT",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_REJECT_UNAUTHORIZED",
              "Value": "false"
            },
            {
              "Key": "LDAP_USER_AUTHENTICATION",
              "Value": "false"
            },
            {
              "Key": "LDAP_USER_AUTHENTICATION_FIELD",
              "Value": "uid"
            },
            {
              "Key": "LDAP_USER_SEARCH_FILTER",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_USER_SEARCH_SCOPE",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_USER_SEARCH_FIELD",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_SEARCH_PAGE_SIZE",
              "Value": "0"
            },
            {
              "Key": "LDAP_SEARCH_SIZE_LIMIT",
              "Value": "0"
            },
            {
              "Key": "LDAP_GROUP_FILTER_ENABLE",
              "Value": "false"
            },
            {
              "Key": "LDAP_GROUP_FILTER_OBJECTCLASS",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_GROUP_FILTER_GROUP_ID_ATTRIBUTE",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_GROUP_FILTER_GROUP_MEMBER_ATTRIBUTE",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_GROUP_FILTER_GROUP_MEMBER_FORMAT",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_GROUP_FILTER_GROUP_NAME",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_UNIQUE_IDENTIFIER_FIELD",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_UTF8_NAMES_SLUGIFY",
              "Value": "true"
            },
            {
              "Key": "LDAP_USERNAME_FIELD",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_FULLNAME_FIELD",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_MERGE_EXISTING_USERS",
              "Value": "false"
            },
            {
              "Key": "LDAP_EMAIL_FIELD",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_EMAIL_MATCH_ENABLE",
              "Value": "false"
            },
            {
              "Key": "LDAP_EMAIL_MATCH_REQUIRE",
              "Value": "false"
            },
            {
              "Key": "LDAP_EMAIL_MATCH_VERIFIED",
              "Value": "false"
            },
            {
              "Key": "LDAP_SYNC_USER_DATA",
              "Value": "false"
            },
            {
              "Key": "LDAP_SYNC_USER_DATA_FIELDMAP",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_SYNC_GROUP_ROLES",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_DEFAULT_DOMAIN",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_SYNC_ADMIN_STATUS",
              "Value": "\"\""
            },
            {
              "Key": "LDAP_SYNC_ADMIN_GROUPS",
              "Value": "\"\""
            },
            {
              "Key": "HEADER_LOGIN_ID",
              "Value": "\"\""
            },
            {
              "Key": "HEADER_LOGIN_FIRSTNAME",
              "Value": "\"\""
            },
            {
              "Key": "HEADER_LOGIN_LASTNAME",
              "Value": "\"\""
            },
            {
              "Key": "HEADER_LOGIN_EMAIL",
              "Value": "\"\""
            },
            {
              "Key": "LOGOUT_WITH_TIMER",
              "Value": "false"
            },
            {
              "Key": "LOGOUT_IN",
              "Value": "\"\""
            },
            {
              "Key": "LOGOUT_ON_HOURS",
              "Value": "\"\""
            },
            {
              "Key": "LOGOUT_ON_MINUTES",
              "Value": "\"\""
            },
            {
              "Key": "CORS",
              "Value": "\"\""
            },
            {
              "Key": "CORS_ALLOW_HEADERS",
              "Value": "\"\""
            },
            {
              "Key": "CORS_EXPOSE_HEADERS",
              "Value": "\"\""
            },
            {
              "Key": "DEFAULT_AUTHENTICATION_METHOD",
              "Value": "\"\""
            }
          ],
          "Name": "env"
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "${SRC_PATH}",
            "/home/wekan/app"
          ]
        },
        {
          "CmdLine": [
            "set -o xtrace \u0026\u0026     useradd --user-group --system --home-dir /home/wekan wekan \u0026\u0026         apt-get update -y \u0026\u0026 apt-get install -y --no-install-recommends ${BUILD_DEPS} \u0026\u0026         cp $(which tar) $(which tar)~ \u0026\u0026     ln -sf $(which bsdtar) $(which tar) \u0026\u0026         wget https://nodejs.org/dist/${NODE_VERSION}/node-${NODE_VERSION}-${ARCHITECTURE}.tar.gz \u0026\u0026     wget https://nodejs.org/dist/${NODE_VERSION}/SHASUMS256.txt.asc \u0026\u0026         grep ${NODE_VERSION}-${ARCHITECTURE}.tar.gz SHASUMS256.txt.asc | shasum -a 256 -c - \u0026\u0026     rm -f SHASUMS256.txt.asc \u0026\u0026         tar xvzf node-${NODE_VERSION}-${ARCHITECTURE}.tar.gz \u0026\u0026     rm node-${NODE_VERSION}-${ARCHITECTURE}.tar.gz \u0026\u0026     mv node-${NODE_VERSION}-${ARCHITECTURE} /opt/nodejs \u0026\u0026     ln -s /opt/nodejs/bin/node /usr/bin/node \u0026\u0026     ln -s /opt/nodejs/bin/npm /usr/bin/npm \u0026\u0026     mkdir -p /opt/nodejs/lib/node_modules/fibers/.node-gyp /root/.node-gyp/8.16.1 /home/wekan/.config \u0026\u0026     chown wekan --recursive /home/wekan/.config \u0026\u0026             npm install -g npm@${NPM_VERSION} \u0026\u0026         cd /home/wekan/ \u0026\u0026     chown wekan --recursive /home/wekan \u0026\u0026     echo \"Starting meteor ${METEOR_RELEASE} installation...   \\n\" \u0026\u0026     gosu wekan:wekan curl https://install.meteor.com/ | /bin/sh \u0026\u0026     mv /root/.meteor /home/wekan/ \u0026\u0026     chown wekan --recursive /home/wekan/.meteor \u0026\u0026         sed -i 's/api\\.versionsFrom/\\/\\/api.versionsFrom/' /home/wekan/app/packages/meteor-useraccounts-core/package.js \u0026\u0026     cd /home/wekan/.meteor \u0026\u0026     gosu wekan:wekan /home/wekan/.meteor/meteor -- help;         cd /home/wekan/app \u0026\u0026     mkdir -p /home/wekan/.npm \u0026\u0026     chown wekan --recursive /home/wekan/.npm /home/wekan/.config /home/wekan/.meteor \u0026\u0026     gosu wekan:wekan npm install \u0026\u0026     gosu wekan:wekan /home/wekan/.meteor/meteor build --directory /home/wekan/app_build \u0026\u0026     cp /home/wekan/app/fix-download-unicode/cfs_access-point.txt /home/wekan/app_build/bundle/programs/server/packages/cfs_access-point.js \u0026\u0026     chown wekan /home/wekan/app_build/bundle/programs/server/packages/cfs_access-point.js \u0026\u0026     cd /home/wekan/app_build/bundle/programs/server/ \u0026\u0026     gosu wekan:wekan npm install \u0026\u0026     mv /home/wekan/app_build/bundle /build \u0026\u0026         mv $(which tar)~ $(which tar) \u0026\u0026         apt-get remove --purge -y ${BUILD_DEPS} \u0026\u0026     apt-get autoremove -y \u0026\u0026     npm uninstall -g api2html \u0026\u0026    rm -R /var/lib/apt/lists/* \u0026\u0026     rm -R /home/wekan/.meteor \u0026\u0026     rm -R /home/wekan/app \u0026\u0026     rm -R /home/wekan/app_build"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "PORT",
              "Value": "8080"
            }
          ],
          "Name": "env"
        },
        {
          "Name": "expose",
          "Ports": [
            "$PORT"
          ]
        },
        {
          "Name": "user",
          "User": "wekan"
        },
        {
          "CmdLine": [
            "node",
            "/build/main.js"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}