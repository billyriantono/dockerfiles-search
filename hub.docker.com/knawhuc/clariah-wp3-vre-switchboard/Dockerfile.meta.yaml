MetaArgs: null
Stages:
- As: builder
  BaseName: knawhuc/clariah-wp3-vre-builder
  Commands:
  - Key: DEPLOYMENT_VOLUME
    Name: arg
    Value: null
  - Key: USER_TO_LOCK_WITH
    Name: arg
    Value: null
  - Key: USER_TO_UNLOCK_WITH
    Name: arg
    Value: null
  - Key: TEST_USER
    Name: arg
    Value: null
  - Env:
    - Key: TEST_PASSWORD
      Value: '"test-val"'
    Name: env
  - Env:
    - Key: KAFKA_HOST_NAME
      Value: '"test-val"'
    Name: env
  - Env:
    - Key: SWITCHBOARD_TOPIC_NAME
      Value: '"test-val"'
    Name: env
  - Env:
    - Key: NEXTCLOUD_TOPIC_NAME
      Value: '"test-val"'
    Name: env
  - Env:
    - Key: NEXTCLOUD_VOLUME
      Value: '"test-val"'
    Name: env
  - Env:
    - Key: SERVICES_DB_KEY
      Value: '"test-val"'
    Name: env
  - Env:
    - Key: OBJECTS_DB_KEY
      Value: '"test-val"'
    Name: env
  - CmdLine:
    - rm -rf /user/local/switchboard
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./
    - /usr/local/switchboard
  - Name: workdir
    Path: /usr/local/switchboard
  - CmdLine:
    - echo "build switchboard..." &&     export USER=$(whoami) &&     mvn clean install
    Name: run
    PrependShell: true
  From:
    Image: knawhuc/clariah-wp3-vre-builder
  Name: builder
  Platform: ""
  SourceCode: FROM knawhuc/clariah-wp3-vre-builder as builder
- BaseName: tomcat:9-jre11-slim
  Commands:
  - Key: TEST_USER
    Name: arg
    Value: null
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/local/switchboard/target/switchboard-1.0-SNAPSHOT.war
    - /usr/local/tomcat/webapps/switchboard.war
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./docker/web.xml
    - /usr/local/tomcat/conf/web.xml
  - CmdLine:
    - useradd --create-home --shell /bin/bash locker
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./set-test-user.sh
    - /usr/local/switchboard/set-test-user.sh
  - CmdLine:
    - /usr/local/switchboard/set-test-user.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /usr/local/switchboard
    Name: run
    PrependShell: true
  - CmdLine:
    - export CATALINA_OPTS="-Xmx700m --add-exports java.base/jdk.internal.ref=ALL-UNNAMED"
      &&     /usr/local/tomcat/bin/catalina.sh run
    Name: cmd
    PrependShell: true
  From:
    Image: tomcat:9-jre11-slim
  Name: ""
  Platform: ""
  SourceCode: FROM tomcat:9-jre11-slim
