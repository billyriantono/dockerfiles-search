MetaArgs: null
Stages:
- BaseName: debian
  Commands:
  - Labels:
    - Key: Description
      Value: '"This image is used to run Tox network node"'
    - Key: Vendor
      Value: '"n/a"'
    - Key: Version
      Value: '"0.0.0"'
    Name: label
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://github.com/irungentoo/toxcore/archive/master.zip
    - https://tox.0x10k.com/bootstrapd-conf-ipv64.txt
    - /tmp/tox/
  - Name: workdir
    Path: /tmp/tox
  - CmdLine:
    - "export BUILD_PACKAGES=\"automake \t\tautotools-dev \t\tbuild-essential \t\tcheck
      \t\tcheckinstall \t\tgit \t\tlibtool \t\tlibsodium-dev \t\tunzip \t\tyasm\"
      && \texport RUNTIME_PACKAGES=\"libsodium18 \t\tlibconfig-dev\" && \tapt-get
      update && apt-get install -y $BUILD_PACKAGES $RUNTIME_PACKAGES && \tunzip -tq
      master.zip && \tunzip -aq master.zip && \tcd toxcore-master && \t./autogen.sh
      && \t./configure --prefix=/usr --enable-daemon && \tmake && \tcheckinstall --default
      --pkgversion=0.0.0 && \techo \"====== Installation completed ======\" && \tuseradd
      --home-dir /var/lib/tox-bootstrapd \t\t--create-home --system \t\t--shell /usr/sbin/nologin
      \t\t--comment \"TOX DHT bootstrap daemon\" \t\t--user-group tox-bootstrapd &&
      \tchmod 700 /var/lib/tox-bootstrapd && \tinstall -o tox-bootstrapd -g tox-bootstrapd
      -d /var/run/tox-bootstrapd && \tinstall -m 755 -p other/bootstrap_daemon/tox-bootstrapd.sh
      /etc/init.d/tox-bootstrapd && \tsed -i 's|DAEMON=/usr/local/bin/$NAME|DAEMON=/usr/bin/$NAME|'
      /etc/init.d/tox-bootstrapd && \tupdate-rc.d tox-bootstrapd defaults && \tinstall
      other/bootstrap_daemon/tox-bootstrapd.conf /etc/tox-bootstrapd.conf && \tsed
      -i 's/enable_lan_discovery = true/enable_lan_discovery = false/' /etc/tox-bootstrapd.conf
      && \tsed -i 's/tcp_relay_ports = \\[443, 3389, 33445\\]/tcp_relay_ports = \\[8080,
      33445\\]/' /etc/tox-bootstrapd.conf && \tsed -i 's/motd = \"tox-bootstrapd\"/motd
      = \"tox-bootstrapd docker\"/' /etc/tox-bootstrapd.conf && \tsed -i '/^bootstrap_nodes
      = /,$d' /etc/tox-bootstrapd.conf && \tcat /tmp/tox/bootstrapd-conf-ipv64.txt
      >> /etc/tox-bootstrapd.conf && \tcd / && \tapt-get remove --purge -y $BUILD_PACKAGES
      && \tapt autoremove -y && \tapt-get install -y $RUNTIME_PACKAGES && \tapt-get
      clean && \trm -rf /var/lib/apt/lists/* && \trm -rf /tmp/*"
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /
  - Name: expose
    Ports:
    - 33445/tcp
    - 33445/udp
    - 8080/tcp
    - 8080/udp
  - Name: user
    User: tox-bootstrapd
  - CmdLine:
    - /usr/bin/tox-bootstrapd
    - --config=/etc/tox-bootstrapd.conf
    - --foreground
    - --log-backend=stdout
    Name: cmd
    PrependShell: false
  From:
    Image: debian
  Name: ""
  Platform: ""
  SourceCode: FROM debian
