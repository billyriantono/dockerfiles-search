MetaArgs: null
Stages:
- BaseName: node:8
  Commands:
  - Labels:
    - Key: Author
      Value: '"josh208"'
    Name: label
  - Env:
    - Key: ADMIN_USER
      Value: admin@shinobi.video
    - Key: ADMIN_PASSWORD
      Value: administrator
    - Key: CRON_KEY
      Value: $(uuidgen)
    - Key: PLUGINKEY_MOTION
      Value: $(uuidgen)
    - Key: PLUGINKEY_OPENCV
      Value: $(uuidgen)
    - Key: PLUGINKEY_OPENALPR
      Value: $(uuidgen)
    - Key: MOTION_HOST
      Value: localhost
    - Key: MOTION_PORT
      Value: "8080"
    Name: env
  - CmdLine:
    - mkdir -p /config
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /opt/shinobi
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt/shinobi
  - CmdLine:
    - echo "deb http://ftp.debian.org/debian jessie-backports main" >> /etc/apt/sources.list     &&
      apt-get update     && apt-get install -y ffmpeg python pkg-config libcairo-dev
      make g++ libjpeg-dev git mysql-client     && apt-get clean
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir master_temp
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://gitlab.com/Shinobi-Systems/Shinobi.git master_temp
    Name: run
    PrependShell: true
  - CmdLine:
    - cp -R -f master_temp/* .
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf $distro master_temp
    Name: run
    PrependShell: true
  - CmdLine:
    - npm install pm2 -g
    Name: run
    PrependShell: true
  - CmdLine:
    - npm install &&     npm install canvas@1.6.5 moment --unsafe-perm
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker-entrypoint.sh
    - .
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - pm2Shinobi.yml
    - .
  - CmdLine:
    - chmod -f +x ./*.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./config/conf.sample.json
    - /opt/shinobi/conf.sample.json
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./config/super.sample.json
    - /opt/shinobi/super.sample.json
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./config/motion.conf.sample.json
    - /opt/shinobi/plugins/motion/conf.sample.json
  - Name: volume
    Volumes:
    - /opt/shinobi/videos
  - Name: volume
    Volumes:
    - /config
  - Name: expose
    Ports:
    - "8080"
  - CmdLine:
    - /opt/shinobi/docker-entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - pm2-docker
    - pm2Shinobi.yml
    Name: cmd
    PrependShell: false
  From:
    Image: node:8
  Name: ""
  Platform: ""
  SourceCode: FROM node:8
