MetaArgs: null
Stages:
- BaseName: debian:buster-slim
  Commands:
  - Name: workdir
    Path: /opt/iotloragateway/controller
  - CmdLine:
    - apt-get update && apt-get upgrade -y
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y nginx php7.3-fpm  php7.3-json php7.3-curl git curl  php7.3-zip
      unzip libyaml-dev php-pear php7.3-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install yaml-2.0.4
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "extension=yaml.so" > /etc/php/7.3/fpm/conf.d/20-yaml.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - "ln -sf /dev/stdout /var/log/nginx/access.log \t&& ln -sf /dev/stderr /var/log/nginx/error.log"
    Name: run
    PrependShell: true
  - Key: moo
    Name: arg
    Value: "107"
  - CmdLine:
    - git clone -b yamlConversion --single-branch https://github.com/PiSupply/iot-lora-controller.git
    Name: run
    PrependShell: true
  - CmdLine:
    - rm /etc/nginx/sites-enabled/default & rm /etc/nginx/sites-available/default
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /etc/nginx/sites-available
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/iotloragateway
    - .
  - CmdLine:
    - ln -s /etc/nginx/sites-available/iotloragateway /etc/nginx/sites-enabled/
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "443"
    - "80"
  - Name: workdir
    Path: /opt/iotloragateway/controller
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/gateway_configuration.yml
    - .
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/run.sh
    - .
  - CmdLine:
    - chmod +x run.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - sh
    - /opt/iotloragateway/controller/run.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: debian:buster-slim
  Name: ""
  Platform: ""
  SourceCode: FROM debian:buster-slim
