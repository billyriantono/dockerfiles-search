MetaArgs: null
Stages:
- BaseName: centos:7
  Commands:
  - Maintainer: Pietrangelo Masala <p.masala@entando.com>
    Name: maintainer
  - Labels:
    - Key: name
      Value: '"entando/entando-builder-s2i"'
    - Key: maintainer
      Value: '"Pietrangelo Masala <p.masala@entando.com>"'
    - Key: vendor
      Value: '"Entando Srl"'
    - Key: version
      Value: '"1"'
    - Key: release
      Value: '"1"'
    - Key: summary
      Value: '"Entando base image for running on OpenShift environments"'
    - Key: description
      Value: '"This base image let you deploy your entando project on OpenShift"'
    - Key: url
      Value: '"https://www.entando.com"'
    - Key: run
      Value: '''docker run -ti --rm --name ${NAME}       -u 123456       ${IMAGE}'''
    - Key: io.k8s.description
      Value: '"Entando base image for running on OpenShift environments"'
    - Key: io.k8s.display-name
      Value: '"Entando base image 1.1"'
    - Key: io.openshift.expose-services
      Value: '"8080:http"'
    - Key: io.openshift.tags
      Value: '"entando,ux,openshift,docker"'
    - Key: io.openshift.s2i.scripts-url
      Value: image:///usr/local/s2i
    Name: label
  - Env:
    - Key: JAVA_HOME
      Value: /usr/lib/jvm/java-1.8.0
    Name: env
  - Env:
    - Key: JRE_HOME
      Value: /usr/lib/jvm/jre-1.8.0
    Name: env
  - Env:
    - Key: MAVEN_HOME
      Value: /usr/share/maven
    Name: env
  - Env:
    - Key: MAVEN_LOCAL_REPO
      Value: /opt/entando/.m2/repository
    Name: env
  - Env:
    - Key: MAVEN_RELEASE
      Value: 3.5.3
    Name: env
  - Env:
    - Key: APP_ROOT
      Value: /opt/entando
    Name: env
  - Env:
    - Key: PATH
      Value: ${APP_ROOT}/bin:${PATH}
    Name: env
  - Env:
    - Key: HOME
      Value: ${APP_ROOT}
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - settings.xml
    - /tmp/settings.xml
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./s2i/bin/
    - /usr/local/s2i
  - CmdLine:
    - adduser --system -u 10001 10001 && yum -y install git java-1.8.0-openjdk-devel
      ImageMagick git wget && mkdir -p ${APP_ROOT} && mkdir -p ${MAVEN_LOCAL_REPO}
      && chown 10001:0 /etc/passwd && chmod ug+w /etc/passwd && cd /tmp && wget http://www.eu.apache.org/dist/maven/maven-3/${MAVEN_RELEASE}/binaries/apache-maven-${MAVEN_RELEASE}-bin.tar.gz
      && tar xzf apache-maven-${MAVEN_RELEASE}-bin.tar.gz && mkdir ${MAVEN_HOME} &&
      cd apache-maven-${MAVEN_RELEASE}/ && cp -R * ${MAVEN_HOME} && cd .. && rm -rf
      /tmp/apache-maven* && alternatives --install /usr/bin/mvn mvn ${MAVEN_HOME}/bin/mvn
      1 && alternatives --auto mvn && rm -f ${MAVEN_HOME}/conf/settings.xml && cp
      /tmp/settings.xml ${MAVEN_HOME}/conf/settings.xml && cd ${APP_ROOT} && git clone
      https://github.com/entando/entando-archetypes.git && cd entando-archetypes &&
      mvn -Dmaven.repo.local=${MVN_LOCAL_REPO} install && cd .. && rm -rf entando-*
      && chgrp -R 0 ${APP_ROOT}/ && chown -R 10001:0 ${APP_ROOT}/ && chmod -R ug+w
      ${APP_ROOT}/ && yum -y clean all
    Name: run
    PrependShell: true
  - Name: user
    User: "10001"
  - Name: workdir
    Path: ${APP_ROOT}
  - Name: expose
    Ports:
    - "8080"
  - CmdLine:
    - /usr/local/s2i/usage
    Name: cmd
    PrependShell: false
  From:
    Image: centos:7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:7
