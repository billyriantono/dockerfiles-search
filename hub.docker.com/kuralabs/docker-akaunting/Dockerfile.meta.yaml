MetaArgs: null
Stages:
- BaseName: ubuntu:16.04
  Commands:
  - Labels:
    - Key: mantainer
      Value: '"info@kuralabs.io"'
    Name: label
  - Name: user
    User: root
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - echo "locales locales/locales_to_be_generated multiselect en_US.UTF-8 UTF-8"
      | debconf-set-selections     && echo "locales locales/default_environment_locale
      select en_US.UTF-8" | debconf-set-selections     && apt-get update     && apt-get
      --yes --no-install-recommends install         locales tzdata sudo         ca-certificates
      apt-transport-https software-properties-common         bash-completion iproute2
      curl unzip nano tree     && rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - Env:
    - Key: LANG
      Value: en_US.UTF-8
    Name: env
  - CmdLine:
    - apt-get update     && apt-get --yes --no-install-recommends install         supervisor
      dirmngr     && rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - Env:
    - Key: MYSQL_DEFAULT_PASSWORD
      Value: uYqBu/41C4Iog4vq9eShKg==
    Name: env
  - CmdLine:
    - echo "mysql-server-5.7 mysql-server/root_password_again password ${MYSQL_DEFAULT_PASSWORD}"
      | debconf-set-selections     && echo "mysql-server-5.7 mysql-server/root_password
      password ${MYSQL_DEFAULT_PASSWORD}" | debconf-set-selections     && apt-get
      update && apt-get install --yes         mysql-server-5.7     && rm -rf /var/lib/apt/lists/*     &&
      mkdir -p /var/lib/mysql /var/run/mysqld /var/mysqld/     && chown mysql:mysql
      /var/lib/mysql /var/run/mysqld /var/mysqld/
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update     && apt-get install --yes --no-install-recommends         nginx         php7.0-fpm         php7.0-mbstring
      php7.0-xml php7.0-curl php7.0-zip php7.0-gd php7.0-mysql         composer     &&
      rm -rf /var/lib/apt/lists/*     && rm /etc/nginx/sites-enabled/default     &&
      sed -i 's/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/' /etc/php/7.0/fpm/php.ini     &&
      mkdir /run/php
    Name: run
    PrependShell: true
  - Env:
    - Key: AKAUNTING_VERSION
      Value: 1.1.13
    Name: env
  - Name: workdir
    Path: /tmp/
  - CmdLine:
    - mkdir -p /var/www/akaunting/root     && curl         --location         -o akaunting.zip         https://github.com/akaunting/akaunting/archive/${AKAUNTING_VERSION}.zip     &&
      unzip akaunting.zip     && rm akaunting.zip     && find akaunting-*/ -mindepth
      1 -maxdepth 1 -exec mv -t /var/www/akaunting/ -- {} +     && rmdir akaunting-*     &&
      chown -R www-data:www-data /var/www/akaunting
    Name: run
    PrependShell: true
  - Name: user
    User: www-data
  - Name: workdir
    Path: /var/www/akaunting
  - CmdLine:
    - composer install     && php artisan vendor:publish --provider="Fideloper\Proxy\TrustedProxyServiceProvider"     &&
      cp -R /var/www/akaunting/config /var/www/akaunting/config.package
    Name: run
    PrependShell: true
  - Name: user
    User: root
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord/*.conf
    - /etc/supervisor/conf.d/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - nginx/akaunting
    - /etc/nginx/sites-available/akaunting
  - CmdLine:
    - chown www-data:www-data /etc/nginx/sites-available/akaunting     && ln -s /etc/nginx/sites-available/akaunting
      /etc/nginx/sites-enabled
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - 8080/TCP
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - /usr/local/bin/
  - CmdLine:
    - /usr/local/bin/entrypoint.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: ubuntu:16.04
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:16.04
