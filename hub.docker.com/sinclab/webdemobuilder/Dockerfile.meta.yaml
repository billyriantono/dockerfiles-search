MetaArgs: null
Stages:
- BaseName: php:5.5-apache
  Commands:
  - Maintainer: Milton Pividori <mpividori@sinc.unl.edu.ar>
    Name: maintainer
  - Env:
    - Key: webdemo_branch
      Value: '"default"'
    Name: env
  - Env:
    - Key: WDB_HG_REPO
      Value: '"/app"'
    Name: env
  - Env:
    - Key: WDB_PHP_DIR
      Value: '"${WDB_HG_REPO}/webdemobuilder"'
    Name: env
  - Env:
    - Key: WDB_AUTH_FILE
      Value: '"${WDB_HG_REPO}/webdemo.pwd"'
    Name: env
  - Env:
    - Key: WDB_USER_PASSWORD
      Value: '""'
    Name: env
  - CmdLine:
    - DEBIAN_FRONTEND=noninteractive   apt-get update && apt-get install -y --no-install-recommends     apt-transport-https   &&
      apt-get clean   && rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-key adv   --keyserver hkp://p80.pool.sks-keyservers.net:80   --recv-keys
      58118E89F3A912897C070ADBF76221572C52609D   && echo deb https://apt.dockerproject.org/repo
      debian-jessie main > /etc/apt/sources.list.d/docker.list
    Name: run
    PrependShell: true
  - CmdLine:
    - DEBIAN_FRONTEND=noninteractive   apt-get update && apt-get install -y --no-install-recommends     docker-engine     mercurial     sudo     zlib1g-dev   &&
      apt-get clean   && rm -rf /var/lib/apt/lists/*   && docker-php-ext-install zip
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - hgrc
    - /root/.hgrc
  - CmdLine:
    - hg clone https://bitbucket.org/sinc-lab/webdemobuilder ${WDB_HG_REPO}   && hg
      update ${webdemo_branch} -R ${WDB_HG_REPO}
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "ServerSignature Off" >> /etc/apache2/apache2.conf   && echo "ServerTokens
      Prod" >> /etc/apache2/apache2.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - htaccess
    - ${WDB_PHP_DIR}/.htaccess
  - CmdLine:
    - rm -rf /var/www/html && ln -s ${WDB_PHP_DIR} /var/www/html
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - php.ini
    - /usr/local/etc/php/
  - CmdLine:
    - 'echo "www-data ALL=(ALL) NOPASSWD: /usr/bin/docker" >> /etc/sudoers.d/www-data'
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - start.sh
    - /
  - CmdLine:
    - /start.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - ""
    Name: cmd
    PrependShell: false
  From:
    Image: php:5.5-apache
  Name: ""
  Platform: ""
  SourceCode: FROM php:5.5-apache
