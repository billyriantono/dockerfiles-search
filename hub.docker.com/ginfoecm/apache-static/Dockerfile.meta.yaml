MetaArgs: null
Stages:
- BaseName: debian:stretch
  Commands:
  - Maintainer: pnahoum@ec-m.fr
    Name: maintainer
  - CmdLine:
    - apt-get update  && apt-get install -y apache2  && apt-get install -y wget  &&
      apt-get install -y nano  && apt-get install -y iputils-ping  && apt-get install
      -y net-tools  && apt-get install -y traceroute  && apt-get install -y zip
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /var/www/.ssh
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /var/www/.ssh /root/.ssh
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y install gnupg && apt-get -y install gnupg1 && apt-get -y install
      gnupg2
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y install curl software-properties-common
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sL https://deb.nodesource.com/setup_10.x | bash -
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y nodejs
    Name: run
    PrependShell: true
  - Env:
    - Key: APACHE_DOCUMENT_ROOT
      Value: /var/www/html
    Name: env
  - Env:
    - Key: APACHE_LOG_DIR
      Value: /var/www/logs
    Name: env
  - CmdLine:
    - sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf
      /etc/apache2/conf-available/*.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - 000-default.conf
    - /etc/apache2/sites-available/000-default.conf
  - CmdLine:
    - echo "ServerName localhost" >> /etc/apache2/conf-available/servername.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enconf servername.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - remoteip.conf
    - /etc/apache2/conf-available/remoteip.conf
  - CmdLine:
    - a2enconf remoteip.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod remoteip
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/%h/%a/g' /etc/apache2/apache2.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y libapache2-modsecurity  && mv /etc/modsecurity/modsecurity.conf-recommended  /var/www/modsecurity.conf  &&
      ln -s /var/www/modsecurity.conf /etc/modsecurity/modsecurity.conf  && sed -i
      's/DetectionOnly/On/g' /var/www/modsecurity.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - touch /var/www/additional_vhost_conf.conf
    Name: run
    PrependShell: true
  - Env:
    - Key: TZ
      Value: Europe/Paris
    Name: env
  - CmdLine:
    - ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - timezone.ini
    - /usr/local/etc/php/conf.d/timezone.ini
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - startup.sh
    - /var/www/startup.sh
  - CmdLine:
    - chmod +x /var/www/startup.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - /entrypoint.sh
  - CmdLine:
    - chmod +x /entrypoint.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p ${APACHE_LOG_DIR}/
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p ${APACHE_DOCUMENT_ROOT}/
    Name: run
    PrependShell: true
  - CmdLine:
    - touch ${APACHE_LOG_DIR}/access.log
    Name: run
    PrependShell: true
  - CmdLine:
    - touch ${APACHE_LOG_DIR}/error.log
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R www-data:www-data ${APACHE_LOG_DIR}/
    Name: run
    PrependShell: true
  - CmdLine:
    - echo ". /etc/environment" >> /etc/apache2/envvars
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - apache2-foreground
    - /usr/bin/
  - CmdLine:
    - chmod +x /usr/bin/apache2-foreground
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R www-data:www-data /var/www/
    Name: run
    PrependShell: true
  - CmdLine:
    - /entrypoint.sh
    Name: cmd
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  From:
    Image: debian:stretch
  Name: ""
  Platform: ""
  SourceCode: FROM debian:stretch
