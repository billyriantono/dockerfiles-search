{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "oddoson/basephp:base",
      "SourceCode": "FROM oddoson/basephp:base",
      "Platform": "",
      "From": {
        "Image": "oddoson/basephp:base"
      },
      "Commands": [
        {
          "Maintainer": "\"odd\"",
          "Name": "maintainer"
        },
        {
          "Labels": [
            {
              "Key": "author",
              "Value": "\"odd\""
            },
            {
              "Key": "description",
              "Value": "\"nginx\""
            }
          ],
          "Name": "label"
        },
        {
          "CmdLine": [
            "cd /home \u0026\u0026 wget http://cn2.php.net/distributions/php-7.2.18.tar.gz \u0026\u0026 tar -xf php-7.2.18.tar.gz \u0026\u0026 cd php-7.2.18 \u0026\u0026 ./configure --prefix=/usr/local/php --bindir=/usr/local/php/bin --with-config-file-path=/etc --with-config-file-scan-dir=/etc/php.d --enable-fpm --with-fpm-user=www --with-fpm-group=www --enable-inline-optimization --disable-debug --disable-rpath --enable-shared --enable-soap --with-libxml-dir --with-xmlrpc --with-openssl --with-mcrypt --with-mhash --with-pcre-regex --with-sqlite3 --with-zlib --enable-bcmath --with-iconv --with-bz2 --enable-calendar --with-curl --with-cdb --enable-dom --enable-exif --enable-fileinfo --enable-filter --with-pcre-dir --enable-ftp --with-gd --with-openssl-dir --with-jpeg-dir --with-png-dir --with-webp-dir --with-zlib-dir --with-freetype-dir --enable-gd-native-ttf --enable-gd-jis-conv --with-gettext --with-gmp --with-mhash --enable-json --enable-mbstring --enable-mbregex --enable-mbregex-backtrack --with-libmbfl --with-onig --enable-pdo --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-zlib-dir --with-pdo-sqlite --with-readline --enable-session --enable-shmop --enable-simplexml --enable-sockets --enable-sysvmsg --enable-sysvsem --enable-sysvshm --enable-wddx --with-libxml-dir --with-xsl --enable-zip --enable-mysqlnd-compression-support --with-pear --enable-opcache --enable-pcntl --enable-posix \u0026\u0026 make \u0026\u0026 make install \u0026\u0026 \\cp -f /usr/local/php/bin/pear /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/peardev /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/pecl /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/phar /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/phar.phar /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/php /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/php-cgi /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/php-config /usr/bin \u0026\u0026 \\cp -f /usr/local/php/bin/phpize /usr/bin \u0026\u0026 \\cp -f /usr/local/php/sbin/php-fpm /usr/bin \u0026\u0026 ln -s -f /usr/local/php/ /usr/include/php \u0026\u0026 chmod +x /etc/rc.d/rc.local \u0026\u0026 echo \"/usr/local/php/sbin/php-fpm start\" \u003e\u003e/etc/rc.d/rc.local \u0026\u0026 echo -e '\\n export PATH=/usr/local/php/bin:/usr/local/php/sbin:$PATH\\n' \u003e\u003e /etc/profile \u0026\u0026 source /etc/profile \u0026\u0026 /home/php-7.2.18/build/shtool install -c ext/phar/phar.phar /usr/local/php/bin \u0026\u0026 cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf \u0026\u0026 sed -i 's/;pid = run\\/php-fpm.pid/pid = run\\/php-fpm.pid/g' /usr/local/php/etc/php-fpm.conf \u0026\u0026 sed -i 's/listen = 127.0.0.1:9000/listen = 0.0.0.0:9000/g' /usr/local/php/etc/php-fpm.conf \u0026\u0026 /usr/local/php/bin/pecl channel-update pecl.php.net  \u0026\u0026 /usr/local/php/bin/pecl config-set php_bin /usr/local/php/bin/php \u0026\u0026 /usr/local/php/bin/pecl config-set php_dir /usr/local/php \u0026\u0026 /usr/local/php/bin/pecl config-set ext_dir /usr/local/php/lib/php/extensions/no-debug-non-zts-20170718 \u0026\u0026 pecl install mongodb-1.5.3  \u0026\u0026 pecl install redis-4.2.0 \u0026\u0026 echo no | pecl install  event \u0026\u0026  wget https://pecl.php.net/get/swoole-4.2.9.tgz \u0026\u0026 tar zxvf swoole-4.2.9.tgz \u0026\u0026 cd swoole-4.2.9 \u0026\u0026 phpize \u0026\u0026 yum install -y nghttp2 \u0026\u0026 ./configure --enable-coroutine --enable-openssl   --enable-sockets --enable-mysqlnd  \u0026\u0026 make clean \u0026\u0026 make \u0026\u0026  make install \u0026\u0026 wget https://dl.laravel-china.org/composer.phar -O /usr/local/bin/composer \u0026\u0026 chmod a+x /usr/local/bin/composer \u0026\u0026 mkdir -p /etc/php.d/ \u0026\u0026 echo 'extension=redis.so' \u003e /etc/php.d/redis.ini \u0026\u0026 echo 'extension=mongodb.so' \u003e /etc/php.d/mongo.ini \u0026\u0026 echo 'extension=event.so' \u003e /etc/php.d/30-event.ini \u0026\u0026 echo 'extension=swoole.so' \u003e /etc/php.d/swoole.ini \u0026\u0026 mkdir /data \u0026\u0026 chmod -R 777 /data \u0026\u0026 yum -y remove wget \u0026\u0026 rm -rf /home/* \u0026\u0026 pecl clear-cache \u0026\u0026 yum clean all \u0026\u0026 rm -rf /var/cache/yum"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "./www.fpm.conf",
            "/usr/local/php/etc/php-fpm.d/www.conf"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "./php.ini",
            "/etc/php.ini"
          ]
        },
        {
          "Name": "volume",
          "Volumes": [
            "/usr/share/nginx/html/",
            "/usr/local/php/etc/php-fpm.d/"
          ]
        },
        {
          "Name": "expose",
          "Ports": [
            "9000"
          ]
        },
        {
          "CmdLine": [
            "php-fpm",
            "-c /etc/php.ini",
            "-F"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}