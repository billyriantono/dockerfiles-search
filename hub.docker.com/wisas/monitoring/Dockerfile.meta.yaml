MetaArgs: null
Stages:
- BaseName: ubuntu:18.04
  Commands:
  - Env:
    - Key: GRAFANA_VERSION
      Value: 5.1.3
    Name: env
  - Env:
    - Key: INFLUXDB_VERSION
      Value: 1.5.3
    Name: env
  - Env:
    - Key: CHRONOGRAF_VERSION
      Value: 1.5.0.1
    Name: env
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - "apt-get -y update && apt-get -y upgrade && \t\t\tapt-get -y install wget nginx-light
      supervisor curl adduser libfontconfig"
    Name: run
    PrependShell: true
  - CmdLine:
    - "wget -nv https://s3-us-west-2.amazonaws.com/grafana-releases/release/grafana_${GRAFANA_VERSION}_amd64.deb
      && \t\t\tdpkg -i grafana_${GRAFANA_VERSION}_amd64.deb && rm grafana_${GRAFANA_VERSION}_amd64.deb"
    Name: run
    PrependShell: true
  - CmdLine:
    - "wget -nv https://dl.influxdata.com/influxdb/releases/influxdb_${INFLUXDB_VERSION}_amd64.deb
      && \t\t\tdpkg -i influxdb_${INFLUXDB_VERSION}_amd64.deb && rm influxdb_${INFLUXDB_VERSION}_amd64.deb"
    Name: run
    PrependShell: true
  - CmdLine:
    - "wget -nv https://dl.influxdata.com/chronograf/releases/chronograf_${CHRONOGRAF_VERSION}_amd64.deb
      && \t\t\tdpkg -i chronograf_${CHRONOGRAF_VERSION}_amd64.deb && rm chronograf_${CHRONOGRAF_VERSION}_amd64.deb"
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - influxdb/config.toml
    - /etc/influxdb/config.toml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - influxdb/run.sh
    - /usr/local/bin/run_influxdb
  - Env:
    - Key: PRE_CREATE_DB
      Value: data grafana
    Name: env
  - Env:
    - Key: INFLUXDB_HOST
      Value: localhost:8086
    Name: env
  - Env:
    - Key: INFLUXDB_DATA_USER
      Value: data
    Name: env
  - Env:
    - Key: INFLUXDB_DATA_PW
      Value: data
    Name: env
  - Env:
    - Key: INFLUXDB_GRAFANA_USER
      Value: grafana
    Name: env
  - Env:
    - Key: INFLUXDB_GRAFANA_PW
      Value: grafana
    Name: env
  - Env:
    - Key: ROOT_PW
      Value: root
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./grafana/config.ini
    - /etc/grafana/config.ini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - grafana/run.sh
    - /usr/local/bin/run_grafana
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./configure.sh
    - /configure.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./set_grafana.sh
    - /set_grafana.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./set_influxdb.sh
    - /set_influxdb.sh
  - CmdLine:
    - /configure.sh
    Name: run
    PrependShell: true
  - Env:
    - Key: INFLUXDB_URL
      Value: http://${INFLUXDB_HOST}
    Name: env
  - Env:
    - Key: INFLUXDB_USERNAME
      Value: ${INFLUXDB_DATA_USER}
    Name: env
  - Env:
    - Key: INFLUXDB_PASSWORD
      Value: ${INFLUXDB_DATA_PW}
    Name: env
  - Env:
    - Key: PUBLIC_URL
      Value: http://localhost:8888
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./nginx/nginx.conf
    - /etc/nginx/nginx.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - CmdLine:
    - "apt-get autoremove -y wget curl && \t\t\tapt-get -y clean && \t\t\trm -rf /var/lib/apt/lists/*
      && rm /*.sh"
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "3000"
  - Name: expose
    Ports:
    - "8888"
  - Name: expose
    Ports:
    - "8086"
  - Name: expose
    Ports:
    - "8084"
  - CmdLine:
    - /usr/bin/supervisord
    Name: cmd
    PrependShell: false
  From:
    Image: ubuntu:18.04
  Name: ""
  Platform: ""
  SourceCode: "FROM\tubuntu:18.04"
