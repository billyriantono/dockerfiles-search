MetaArgs: null
Stages:
- BaseName: dynamind/oracle-jdk:8
  Commands:
  - Env:
    - Key: TOMCAT_VERSION
      Value: 8.0.33
    Name: env
  - Env:
    - Key: APR_VERSION
      Value: 1.2.6
    Name: env
  - Env:
    - Key: TOMCAT_XMS
      Value: 512m
    Name: env
  - Env:
    - Key: TOMCAT_XMX
      Value: 512m
    Name: env
  - Env:
    - Key: CATALINA_HOME
      Value: /usr/tomcat
    Name: env
  - Env:
    - Key: PATH
      Value: $CATALINA_HOME/bin:$PATH
    Name: env
  - Env:
    - Key: JAVA_OPTS
      Value: -Dfile.encoding=UTF-8 -Djava.security.egd=file:/dev/urandom -Dnet.sf.ehcache.skipUpdateCheck=true
        -XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:+UseParNewGC -Xms$TOMCAT_XMS
        -Xmx$TOMCAT_XMX
    Name: env
  - CmdLine:
    - 'useradd -r tomcat --shell /bin/false &&     yum -y install wget tar &&     curl
      -s "http://www.apache.org/dyn/closer.cgi/tomcat/?as_json=1" | grep -Po ''\"preferred\":
      \"\K[^\"]+'' > /tmp/mirror &&     APACHE_MIRROR=$(cat /tmp/mirror) && wget ${APACHE_MIRROR}tomcat/tomcat-8/v$TOMCAT_VERSION/bin/apache-tomcat-$TOMCAT_VERSION.tar.gz
      -P/tmp &&     tar -xvzf /tmp/apache-tomcat-$TOMCAT_VERSION.tar.gz -C /tmp &&     mv
      /tmp/apache-tomcat-$TOMCAT_VERSION $CATALINA_HOME &&     rm /tmp/apache-tomcat-$TOMCAT_VERSION.tar.gz
      &&     rm -rf $CATALINA_HOME/webapps/docs &&     rm -rf $CATALINA_HOME/webapps/examples
      &&     chown -hR tomcat: $CATALINA_HOME &&     chmod +x $CATALINA_HOME/bin/*.sh'
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - conf/
    - $CATALINA_HOME/conf/
  - CmdLine:
    - 'echo "Building APR Native Library" &&     yum -y install gcc make apr-devel
      openssl-devel &&     curl -s "http://www.apache.org/dyn/closer.cgi/tomcat/?as_json=1"
      | grep -Po ''\"preferred\": \"\K[^\"]+'' > /tmp/mirror &&     APACHE_MIRROR=$(cat
      /tmp/mirror) && wget ${APACHE_MIRROR}tomcat/tomcat-connectors/native/$APR_VERSION/source/tomcat-native-$APR_VERSION-src.tar.gz
      -P/tmp &&     tar -xvzf /tmp/tomcat-native-$APR_VERSION-src.tar.gz -C /tmp &&     cd
      /tmp/tomcat-native-$APR_VERSION-src/native &&     ./configure --with-apr=/usr/bin/apr-1-config
      && make && make install &&     yum -y remove gcc make apr-devel openssl-devel'
    Name: run
    PrependShell: true
  - Env:
    - Key: LD_LIBRARY_PATH
      Value: /usr/local/apr/lib:$LD_LIBRARY_PATH
    Name: env
  - Name: workdir
    Path: $CATALINA_HOME
  - Name: user
    User: tomcat
  - Name: expose
    Ports:
    - "8080"
  - CmdLine:
    - catalina.sh
    - run
    Name: cmd
    PrependShell: false
  From:
    Image: dynamind/oracle-jdk:8
  Name: ""
  Platform: ""
  SourceCode: FROM dynamind/oracle-jdk:8
