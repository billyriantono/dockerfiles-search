MetaArgs: null
Stages:
- As: builder
  BaseName: microsoft/dotnet:2.1-sdk
  Commands:
  - Labels:
    - Key: version
      Value: '"1.0"'
    Name: label
  - Labels:
    - Key: owner
      Value: '"DAC Software pl"'
    Name: label
  - Labels:
    - Key: maintainer
      Value: '"pawel.kasperek@dacsoftware.pl"'
    Name: label
  - Labels:
    - Key: organization
      Value: '"dacsoftwarepl"'
    Name: label
  - Labels:
    - Key: description
      Value: '"Image with .NET SDK to build and test "'
    Name: label
  - Name: workdir
    Path: /app
  - Expression: ARG BUILD_CONFIGURATION
    Name: onbuild
  - Expression: ARG CONFIGURATION=${BUILD_CONFIGURATION:-Release}
    Name: onbuild
  - Expression: ARG BUILD_FEED
    Name: onbuild
  - Expression: ARG FEED=${BUILD_FEED:-'--source "https://api.nuget.org/v3/index.json"'}
    Name: onbuild
  - Expression: COPY ./*.sln ./NuGet.config ./*.props-server ./*.props ./*.targets  ./
    Name: onbuild
  - Expression: COPY src/*/*.csproj ./
    Name: onbuild
  - Expression: RUN for file in $(ls *.csproj); do mkdir -p src/${file%.*}/ && mv
      $file src/${file%.*}/; done
    Name: onbuild
  - Expression: COPY tests/*/*.csproj ./
    Name: onbuild
  - Expression: RUN for file in $(ls *.csproj); do mkdir -p tests/${file%.*}/ && mv
      $file tests/${file%.*}/; done
    Name: onbuild
  - Expression: RUN dotnet restore /p:Configuration=${CONFIGURATION} ${FEED}
    Name: onbuild
  - Expression: COPY ./tests ./tests
    Name: onbuild
  - Expression: COPY ./src ./src
    Name: onbuild
  - Expression: ARG BUILD_VERSION
    Name: onbuild
  - Expression: ARG VERSION=${BUILD_VERSION:-1.0.0}
    Name: onbuild
  - Expression: RUN dotnet build /p:Version=$VERSION /p:Configuration=$CONFIGURATION
    Name: onbuild
  - Expression: RUN find ./tests -name '*.csproj' -print0 | xargs -L1 -0 dotnet test
      --no-build --no-restore /p:Version=$VERSION /p:Configuration=${CONFIGURATION}
    Name: onbuild
  From:
    Image: microsoft/dotnet:2.1-sdk
  Name: builder
  Platform: ""
  SourceCode: FROM microsoft/dotnet:2.1-sdk AS builder
