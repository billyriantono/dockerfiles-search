MetaArgs: null
Stages:
- BaseName: debian:latest
  Commands:
  - Maintainer: John Huang <little78926@gmail.com>
    Name: maintainer
  - Env:
    - Key: container
      Value: docker
    Name: env
  - Env:
    - Key: LC_ALL
      Value: C
    Name: env
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - sed -i 's/main/main contrib non-free/g' /etc/apt/sources.list
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "deb http://deb.debian.org/debian stretch-backports main contrib non-free"
      >> /etc/apt/sources.list
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y systemd sudo curl gnupg gnupg2 gnupg1
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /tmp     && curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash
      -     && apt-get install -y nodejs
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /lib/systemd/system/sysinit.target.wants/; ls | grep -v systemd-tmpfiles-setup
      | xargs rm -f $1 rm -f /lib/systemd/system/multi-user.target.wants/*;rm -f /etc/systemd/system/*.wants/*;rm
      -f /lib/systemd/system/local-fs.target.wants/*; rm -f /lib/systemd/system/sockets.target.wants/*udev*;
      rm -f /lib/systemd/system/sockets.target.wants/*initctl*; rm -f /lib/systemd/system/basic.target.wants/*;rm
      -f /lib/systemd/system/anaconda.target.wants/*; rm -f /lib/systemd/system/plymouth*;
      rm -f /lib/systemd/system/systemd-update-utmp*;
    Name: run
    PrependShell: true
  - CmdLine:
    - systemctl set-default multi-user.target
    Name: run
    PrependShell: true
  - Env:
    - Key: init
      Value: /lib/systemd/systemd
    Name: env
  - Name: volume
    Volumes:
    - /sys/fs/cgroup
  - CmdLine:
    - mkdir -p /home
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /home
  - Key: local
    Name: arg
    Value: '"."'
  - CmdLine:
    - apt-get update -y
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y --fix-missing automake autotools-dev fuse g++ git     libcurl4-gnutls-dev
      libfuse-dev libssl-dev libxml2-dev make pkg-config
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://github.com/s3fs-fuse/s3fs-fuse.git;     cd s3fs-fuse;     ./autogen.sh;     ./configure
      --prefix=/usr;     make;     make install;
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - $local/config/fuse.conf
    - /etc/fuse.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - $local/config/supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - $local/run.sh
    - /home/run.sh
  - CmdLine:
    - chmod +x /home/run.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /lib/systemd/systemd
    Name: entrypoint
    PrependShell: false
  From:
    Image: debian:latest
  Name: ""
  Platform: ""
  SourceCode: FROM debian:latest
