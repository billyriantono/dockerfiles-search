MetaArgs: null
Stages:
- BaseName: alpine:latest
  Commands:
  - Maintainer: dev@jpillora.com
    Name: maintainer
  - Env:
    - Key: GOPATH
      Value: /go
    Name: env
  - Env:
    - Key: NAME
      Value: chisel
    Name: env
  - Env:
    - Key: PACKAGE
      Value: github.com/jpillora/$NAME
    Name: env
  - Env:
    - Key: PACKAGE_DIR
      Value: $GOPATH/src/$PACKAGE
    Name: env
  - Env:
    - Key: GOLANG_VERSION
      Value: "1.8"
    Name: env
  - Env:
    - Key: GOLANG_SRC_URL
      Value: https://golang.org/dl/go$GOLANG_VERSION.src.tar.gz
    Name: env
  - Env:
    - Key: GOLANG_SRC_SHA256
      Value: 406865f587b44be7092f206d73fc1de252600b79b3cacc587b74b5ef5c623596
    Name: env
  - Env:
    - Key: PATH
      Value: $GOPATH/bin:/usr/local/go/bin:$PATH
    Name: env
  - CmdLine:
    - "set -ex     && apk update \t&& apk add ca-certificates \t&& apk add --no-cache
      --virtual .build-deps \t\tbash \t\tgcc \t\tmusl-dev \t\topenssl \t\tgit \t\tgo
      \t\tcurl \t&& curl -s https://raw.githubusercontent.com/docker-library/golang/132cd70768e3bc269902e4c7b579203f66dc9f64/1.8/alpine/no-pic.patch
      -o /no-pic.patch \t&& cat /no-pic.patch \t&& export GOROOT_BOOTSTRAP=\"$(go
      env GOROOT)\" \t&& wget -q \"$GOLANG_SRC_URL\" -O golang.tar.gz \t&& echo \"$GOLANG_SRC_SHA256
      \ golang.tar.gz\" | sha256sum -c - \t&& tar -C /usr/local -xzf golang.tar.gz
      \t&& rm golang.tar.gz \t&& cd /usr/local/go/src \t&& patch -p2 -i /no-pic.patch
      \t&& ./make.bash \t&& mkdir -p $PACKAGE_DIR \t&& git clone https://$PACKAGE.git
      $PACKAGE_DIR \t&& cd $PACKAGE_DIR \t&& go build \t\t-ldflags \"-X github.com/jpillora/chisel/share.BuildVersion=$(git
      describe --abbrev=0 --tags)\" \t\t-o /usr/local/bin/$NAME \t&& apk del .build-deps
      \t&& rm -rf /no-pic.patch $GOPATH /usr/local/go"
    Name: run
    PrependShell: true
  - CmdLine:
    - apk --update add --no-cache openssh bash   && sed -i s/#PermitRootLogin.*/PermitRootLogin\
      yes/ /etc/ssh/sshd_config   && echo "root:root" | chpasswd   && rm -rf /var/cache/apk/*
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ie 's/#Port 22/Port 22/g' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/#HostKey \/etc\/ssh\/ssh_host_key/HostKey \/etc\/ssh\/ssh_host_key/g'
      /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ir 's/#HostKey \/etc\/ssh\/ssh_host_rsa_key/HostKey \/etc\/ssh\/ssh_host_rsa_key/g'
      /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ir 's/#HostKey \/etc\/ssh\/ssh_host_dsa_key/HostKey \/etc\/ssh\/ssh_host_dsa_key/g'
      /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ir 's/#HostKey \/etc\/ssh\/ssh_host_ecdsa_key/HostKey \/etc\/ssh\/ssh_host_ecdsa_key/g'
      /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ir 's/#HostKey \/etc\/ssh\/ssh_host_ed25519_key/HostKey \/etc\/ssh\/ssh_host_ed25519_key/g'
      /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - /usr/bin/ssh-keygen -A
    Name: run
    PrependShell: true
  - CmdLine:
    - ssh-keygen -t rsa -b 4096 -f  /etc/ssh/ssh_host_key
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
    - "8080"
  - CmdLine:
    - /usr/sbin/sshd  && /usr/local/bin/chisel server
    Name: cmd
    PrependShell: true
  From:
    Image: alpine:latest
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:latest
