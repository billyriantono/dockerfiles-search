MetaArgs: null
Stages:
- BaseName: php:7.3.6-fpm
  Commands:
  - CmdLine:
    - mkdir -p /var/www/html
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y libmcrypt-dev mysql-client libmagickwand-dev --no-install-recommends
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y wget git-all zip unzip vim
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install imagick     && pecl install mcrypt-1.0.2     && docker-php-ext-enable
      imagick     && docker-php-ext-enable mcrypt     && docker-php-ext-install pdo_mysql
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - /var/www/html
  - CmdLine:
    - chmod +x ./deploy/composer_install.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - ./deploy/composer_install.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - composer install
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sL https://deb.nodesource.com/setup_12.x | bash -
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y nodejs
    Name: run
    PrependShell: true
  - CmdLine:
    - npm install -g npm@5.1.0
    Name: run
    PrependShell: true
  - CmdLine:
    - npm install
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R www-data:www-data  /var/www/html
    Name: run
    PrependShell: true
  - CmdLine:
    - mv .env.prod .env
    Name: run
    PrependShell: true
  - CmdLine:
    - php artisan key:generate
    Name: run
    PrependShell: true
  - CmdLine:
    - npm run prod
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R www-data:www-data /var/www/html/storage /var/www/html/public
    Name: run
    PrependShell: true
  - CmdLine:
    - php artisan route:clear     && php artisan config:clear     && php artisan cache:clear
    Name: run
    PrependShell: true
  From:
    Image: php:7.3.6-fpm
  Name: ""
  Platform: ""
  SourceCode: FROM php:7.3.6-fpm
