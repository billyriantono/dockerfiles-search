MetaArgs: null
Stages:
- BaseName: mhart/alpine-node:8.17
  Commands:
  - Maintainer: Mehmet Arziman
    Name: maintainer
  - CmdLine:
    - "apk update && \tapk upgrade && \tapk add --no-cache build-base && \tapk add
      --no-cache python"
    Name: run
    PrependShell: true
  - CmdLine:
    - "addgroup -S openhabcloud && \tadduser -H -S -g openhabcloud openhabcloud"
    Name: run
    PrependShell: true
  - CmdLine:
    - "apk add --no-cache tzdata && \tcp /usr/share/zoneinfo/Europe/Berlin /etc/localtime
      && \techo \"Europe/Berlin\" >  /etc/timezone"
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf     /usr/share/man     /tmp/* /var/cache/apk/*     /root/.npm     /root/.node-gyp     /root/.gnupg     /usr/lib/node_modules/npm/man     /usr/lib/node_modules/npm/doc     /usr/lib/node_modules/npm/html     /usr/lib/node_modules/npm/scripts
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /opt/openhabcloud/logs
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /data
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./package.json
    - /opt/openhabcloud/
  - CmdLine:
    - ln -s /opt/openhabcloud/package.json /data
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /data
  - Env:
    - Key: NODE_ENV
      Value: production
    Name: env
  - CmdLine:
    - npm install --production=true && npm rebuild bcrypt --build-from-source
    Name: run
    PrependShell: true
  - Env:
    - Key: NODE_PATH
      Value: /data/node_modules
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - .
    - /opt/openhabcloud
  - CmdLine:
    - rm -Rf /opt/openhabcloud/deployment
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -Rf /opt/openhabcloud/docs
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -Rf /opt/openhabcloud/tests
    Name: run
    PrependShell: true
  - CmdLine:
    - rm /opt/openhabcloud/config-development.json
    Name: run
    PrependShell: true
  - CmdLine:
    - rm /opt/openhabcloud/config-production.json
    Name: run
    PrependShell: true
  - CmdLine:
    - 'chown openhabcloud: /opt/openhabcloud/logs'
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt/openhabcloud
  - Name: user
    User: openhabcloud
  - Name: expose
    Ports:
    - "3000"
  - CmdLine:
    - node
    - app.js
    Name: cmd
    PrependShell: false
  From:
    Image: mhart/alpine-node:8.17
  Name: ""
  Platform: ""
  SourceCode: FROM mhart/alpine-node:8.17
