MetaArgs: null
Stages:
- As: ricty-getter
  BaseName: ubuntu:18.04
  Commands:
  - CmdLine:
    - apt update && apt -y install --no-install-recommends fonts-ricty-diminished
    Name: run
    PrependShell: true
  From:
    Image: ubuntu:18.04
  Name: ricty-getter
  Platform: ""
  SourceCode: FROM ubuntu:18.04 AS ricty-getter
- As: wget-curl
  BaseName: alpine:3.10
  Commands:
  - CmdLine:
    - apk update && apk --no-cache add -U make curl gcc libc-dev libc6-compat
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -c https://github.com/logological/gpp/releases/download/2.25/gpp-2.25.tar.bz2
      &&     tar jxf gpp-2.25.tar.bz2 && cd gpp-2.25 && ./configure && make && cp
      src/gpp /usr/bin/
    Name: run
    PrependShell: true
  - Env:
    - Key: PLANTUML_VERSION
      Value: 1.2019.7
    Name: env
  - Env:
    - Key: PLANTUML_DOWNLOAD_URL
      Value: https://sourceforge.net/projects/plantuml/files/plantuml.$PLANTUML_VERSION.jar/download
    Name: env
  - CmdLine:
    - curl -fsSL "$PLANTUML_DOWNLOAD_URL" -o /usr/local/bin/plantuml.jar &&     echo
      "#!/bin/bash" > /usr/local/bin/plantuml &&     echo "java -jar /usr/local/bin/plantuml.jar
      -Djava.awt.headless=true \$@" >> /usr/local/bin/plantuml &&     chmod +x /usr/local/bin/plantuml
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -c https://github.com/adobe-fonts/source-han-sans/raw/release/OTF/SourceHanSansJ.zip
      &&       unzip SourceHanSansJ.zip
    Name: run
    PrependShell: true
  From:
    Image: alpine:3.10
  Name: wget-curl
  Platform: ""
  SourceCode: FROM alpine:3.10 AS wget-curl
- As: pandoc
  BaseName: pandoc/latex:2.8.1
  Commands: null
  From:
    Image: pandoc/latex:2.8.1
  Name: pandoc
  Platform: ""
  SourceCode: FROM pandoc/latex:2.8.1 as pandoc
- As: base
  BaseName: alpine:3.10
  Commands:
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - src/BXptool-0.4/
    - /opt/texlive/texdir/texmf-dist/tex/latex/BXptool/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - src/sourcecodepro/*.ttf
    - /usr/share/fonts/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - src/sourcesanspro/*.ttf
    - /usr/share/fonts/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - src/noto-jp/*.otf
    - /usr/share/fonts/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - bin/pandoc-crossref-alpine
    - /usr/local/bin/pandoc-crossref
  - Chown: ""
    From: wget-curl
    Name: copy
    SourcesAndDest:
    - /usr/bin/gpp
    - /usr/bin/gpp
  - Chown: ""
    From: wget-curl
    Name: copy
    SourcesAndDest:
    - /usr/local/bin/
    - /usr/local/bin/
  - Chown: ""
    From: wget-curl
    Name: copy
    SourcesAndDest:
    - /SourceHanSansJ/
    - /usr/share/fonts/SourceHanSansJ/
  - Chown: ""
    From: ricty-getter
    Name: copy
    SourcesAndDest:
    - /usr/share/fonts/truetype/ricty-diminished/
    - /usr/share/fonts/truetype/ricty-diminished/
  - Chown: ""
    From: pandoc
    Name: copy
    SourcesAndDest:
    - /
    - /
  - Env:
    - Key: PATH
      Value: /opt/texlive/texdir/bin/x86_64-linuxmusl:$PATH
    Name: env
  - CmdLine:
    - apk add --no-cache     gmp make     libffi     lua5.3 lua5.3-dev     lua5.3-lpeg     lua5.3-lyaml
      lua5.3-cjson     lua-penlight luarocks5.3
    Name: run
    PrependShell: true
  - CmdLine:
    - apk --no-cache add -U make librsvg curl openssl openjdk8 graphviz bash git
    Name: run
    PrependShell: true
  - CmdLine:
    - apk --no-cache add -U python3 py3-pillow py3-reportlab py3-lxml py3-lupa py3-setuptools_scm
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://github.com/geoffleyland/lua-csv.git && cd lua-csv && luarocks-5.3
      make rockspecs/csv-1-1.rockspec
    Name: run
    PrependShell: true
  - CmdLine:
    - apk add openjdk8-jre fontconfig ttf-dejavu && plantuml -version
    Name: run
    PrependShell: true
  - CmdLine:
    - tlmgr update --self && fc-cache -fv && tlmgr install     ascmac     bxjscls     environ     grffile     ifoddpage     lastpage     mdframed     needspace     tcolorbox     trimspaces     xhfill     zref     zxjafont     zxjatype
      && mktexlsr
    Name: run
    PrependShell: true
  - CmdLine:
    - pip3 install pantable csv2table six pandoc-imagine svgutils pyyaml
    Name: run
    PrependShell: true
  - CmdLine:
    - pip3 install pandoc-pandocker-filters     git+https://github.com/pandocker/pandoc-blockdiag-filter.git     git+https://github.com/pandocker/pandoc-docx-utils-py.git     git+https://github.com/pandocker/pandoc-svgbob-filter.git     git+https://github.com/pandocker/pandocker-lua-filters.git
    Name: run
    PrependShell: true
  - CmdLine:
    - pip3 install git+https://github.com/k4zuki/pandoc_misc.git@2.8       git+https://github.com/k4zuki/docx-core-property-writer.git
    Name: run
    PrependShell: true
  - CmdLine:
    - pip3 install git+https://github.com/pypa/pip.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /workdir
  - Name: volume
    Volumes:
    - /workdir
  - Env:
    - Key: TZ
      Value: JST-9
    Name: env
  - CmdLine:
    - bash
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:3.10
  Name: base
  Platform: ""
  SourceCode: FROM alpine:3.10 AS base
