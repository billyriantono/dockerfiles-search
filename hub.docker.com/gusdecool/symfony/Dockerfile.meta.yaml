MetaArgs: null
Stages:
- As: composer
  BaseName: composer:latest
  Commands: null
  From:
    Image: composer:latest
  Name: composer
  Platform: ""
  SourceCode: FROM composer:latest AS composer
- BaseName: php:7.2-apache-stretch
  Commands:
  - Chown: ""
    From: composer
    Name: copy
    SourcesAndDest:
    - /usr/bin/composer
    - /usr/local/bin/composer
  - Env:
    - Key: WORKDIR
      Value: /app
    Name: env
  - Name: workdir
    Path: ${WORKDIR}
  - CmdLine:
    - apt-get update -y
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y zlibc git zip unzip zlib1g-dev libicu-dev g++ ssl-cert
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-install intl pdo_mysql bcmath
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y libgd-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-install gd
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install xdebug-2.7.2
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-enable xdebug
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y libxml2-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-install soap
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod rewrite
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod deflate
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod headers
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - a2ensite default-ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "Set Apache root directory"
    Name: run
    PrependShell: true
  - Env:
    - Key: APACHE_DOCUMENT_ROOT
      Value: ${WORKDIR}/public
    Name: env
  - CmdLine:
    - sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf
      /etc/apache2/conf-available/*.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - config/xdebug/xdebug.ini
    - /usr/local/etc/php/conf.d/xdebug.ini
  - CmdLine:
    - apt-get clean -y
    Name: run
    PrependShell: true
  From:
    Image: php:7.2-apache-stretch
  Name: ""
  Platform: ""
  SourceCode: FROM php:7.2-apache-stretch
