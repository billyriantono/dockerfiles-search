MetaArgs: null
Stages:
- BaseName: ubuntu:trusty
  Commands:
  - Maintainer: Alexandre Viau <alexandre.viau@savoirfairelinux.com>
    Name: maintainer
  - CmdLine:
    - apt-get update && apt-get install -y vim python-pip python3-pip python-dev libffi-dev
      libssl-dev git python-pycurl python-virtualenv libcurl4-openssl-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - virtualenv /opt/surveil/env
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd shinken && /opt/surveil/env/bin/pip install pycurl https://github.com/Alignak-monitoring/alignak/archive/396d10105827f8c75686811991829548e6778e11.zip
    Name: run
    PrependShell: true
  - Env:
    - Key: MONITORING_TOOLS_VERSION
      Value: 0.3.2
    Name: env
  - CmdLine:
    - apt-get install -y subversion &&     svn checkout https://github.com/savoirfairelinux/monitoring-tools/tags/${MONITORING_TOOLS_VERSION}/packs/generic-host
      /packs/generic-host &&     svn checkout https://github.com/savoirfairelinux/monitoring-tools/tags/${MONITORING_TOOLS_VERSION}/packs/linux-glance
      /packs/linux-glance &&     svn checkout https://github.com/savoirfairelinux/monitoring-tools/tags/${MONITORING_TOOLS_VERSION}/packs/linux-cinder
      /packs/linux-cinder &&     svn checkout https://github.com/savoirfairelinux/monitoring-tools/tags/${MONITORING_TOOLS_VERSION}/packs/linux-keystone
      /packs/linux-keystone &&     svn checkout https://github.com/savoirfairelinux/monitoring-tools/tags/${MONITORING_TOOLS_VERSION}/packs/linux-nova
      /packs/linux-nova &&     svn checkout https://github.com/savoirfairelinux/monitoring-tools/tags/${MONITORING_TOOLS_VERSION}/packs/linux-openstackceilometer
      /packs/linux-openstackceilometer &&     apt-get remove -y subversion
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - requirements.txt
    - /opt/surveil/requirements.txt
  - CmdLine:
    - /opt/surveil/env/bin/pip install -U "pbr>=0.6,!=0.7,<1.0"
    Name: run
    PrependShell: true
  - CmdLine:
    - /opt/surveil/env/bin/pip install -r /opt/surveil/requirements.txt
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - tools/docker/surveil_container/setup.sh
    - /opt/surveil/setup.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - setup.py
    - /opt/surveil/setup.py
  - Chown: ""
    Name: add
    SourcesAndDest:
    - setup.cfg
    - /opt/surveil/setup.cfg
  - Chown: ""
    Name: add
    SourcesAndDest:
    - README.rst
    - /opt/surveil/README.rst
  - Chown: ""
    Name: add
    SourcesAndDest:
    - etc/surveil
    - /etc/surveil
  - Chown: ""
    Name: add
    SourcesAndDest:
    - surveil
    - /opt/surveil/surveil
  - Env:
    - Key: PBR_VERSION
      Value: PROD
    Name: env
  - CmdLine:
    - cd /opt/surveil && /opt/surveil/env/bin/python setup.py develop
    Name: run
    PrependShell: true
  - Env:
    - Key: PATH
      Value: $PATH:/opt/surveil/env/bin
    Name: env
  - Env:
    - Key: SURVEIL_AUTH_BACKEND
      Value: surveil
    Name: env
  - Env:
    - Key: SURVEIL_KEYSTONE_HOST
      Value: 198.72.123.131
    Name: env
  - Env:
    - Key: SURVEIL_KEYSTONE_AUTH_PROTOCOL
      Value: http
    Name: env
  - Env:
    - Key: SURVEIL_OS_USERNAME
      Value: admin
    Name: env
  - Env:
    - Key: SURVEIL_OS_PASSWORD
      Value: password
    Name: env
  - Env:
    - Key: SURVEIL_OS_TENANT_NAME
      Value: admin
    Name: env
  - CmdLine:
    - cd /opt/surveil &&     ./setup.sh &&     ((sleep 40 && surveil-init) &) &&     surveil-api
    Name: cmd
    PrependShell: true
  From:
    Image: ubuntu:trusty
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:trusty
