{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "centos/ruby-22-centos7",
      "SourceCode": "FROM centos/ruby-22-centos7",
      "Platform": "",
      "From": {
        "Image": "centos/ruby-22-centos7"
      },
      "Commands": [
        {
          "Labels": [
            {
              "Key": "io.k8s.description",
              "Value": "\"Base Image for Rails\""
            },
            {
              "Key": "io.k8s.display-name",
              "Value": "\"pitc-rails-bi\""
            },
            {
              "Key": "io.openshift.expose-services",
              "Value": "\"8080:http\""
            },
            {
              "Key": "io.openshift.tags",
              "Value": "\"builder,ruby,ruby22,httpd\""
            }
          ],
          "Name": "label"
        },
        {
          "Name": "user",
          "User": "root"
        },
        {
          "CmdLine": [
            "yum -y install epel-release \u0026\u0026     yum update -y \u0026\u0026     INSTALL_PKGS=\"httpd httpd-devel mod_xsendfile mod_ssl apr-devel apr-util-devel sqlite3 ImageMagick-devel\" \u0026\u0026     yum install -y --setopt=tsflags=nodocs $INSTALL_PKGS \u0026\u0026     yum clean all -y"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "/bin/bash -c \"gem install passenger -v '~\u003e 5.1.12' --no-ri --no-rdoc \u0026\u0026     export PATH=$PATH:/opt/rh/rh-ruby22/root/usr/local/bin \u0026\u0026     passenger-install-apache2-module --auto --languages ruby \u0026\u0026     passenger-config validate-install \""
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "sed -i \"s/LoadModule auth_digest_module/#LoadModule auth_digest_module/\" /etc/httpd/conf.modules.d/00-base.conf \u0026\u0026   mkdir -p /opt/app-root/httpd/pid \u0026\u0026   mkdir /etc/httpd/app_provided.d \u0026\u0026   chmod go+rwx /etc/httpd/app_provided.d \u0026\u0026   rm /etc/httpd/conf.d/ssl.conf"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "APACHE_RUN_USER",
              "Value": "1001"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "APACHE_PID_FILE",
              "Value": "/opt/app-root/httpd.pid"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "ln -s /opt/rh/rh-ruby22/root/usr/local/share/gems/gems/passenger-5.* /opt/passenger"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "PASSENGER_START_TIMEOUT",
              "Value": "90"
            },
            {
              "Key": "PASSENGER_MIN_INSTANCES",
              "Value": "2"
            },
            {
              "Key": "PASSENGER_MAX_POOL_SIZE",
              "Value": "6"
            },
            {
              "Key": "PASSENGER_PRE_START_PATH",
              "Value": "\"/\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "RAILS_ENV",
              "Value": "production"
            },
            {
              "Key": "RAILS_ROOT",
              "Value": "/opt/app-root/src"
            }
          ],
          "Name": "env"
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "/contrib/bin",
            "$STI_SCRIPTS_PATH"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "/contrib/etc/httpd",
            "/etc/httpd"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "/contrib/usr/local/lib",
            "/usr/local/lib"
          ]
        },
        {
          "CmdLine": [
            "chmod go+rwx /etc/httpd/features /etc/httpd/conf.d \u0026\u0026     chgrp -R 0 ./ \u0026\u0026     chmod -R g+rw ./ \u0026\u0026     find ./ -type d -exec chmod g+x {} + \u0026\u0026     chown -R 1001:0 ./  \u0026\u0026     chmod -R a+rwX /opt/app-root/httpd/pid \u0026\u0026     chmod +x $STI_SCRIPTS_PATH/run-httpd.sh"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "BUNDLE_WITHOUT",
              "Value": "development:test"
            }
          ],
          "Name": "env"
        },
        {
          "Name": "user",
          "User": "root"
        },
        {
          "CmdLine": [
            "mv $STI_SCRIPTS_PATH/assemble $STI_SCRIPTS_PATH/assemble_base"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mv $STI_SCRIPTS_PATH/run $STI_SCRIPTS_PATH/run_base"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "/s2i/*",
            "$STI_SCRIPTS_PATH/"
          ]
        },
        {
          "CmdLine": [
            "chmod ugo+x $STI_SCRIPTS_PATH/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "user",
          "User": "1001"
        },
        {
          "CmdLine": [
            "$STI_SCRIPTS_PATH/run-httpd.sh"
          ],
          "Name": "cmd",
          "PrependShell": true
        }
      ]
    }
  ]
}