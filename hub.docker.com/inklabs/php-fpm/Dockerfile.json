{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "alpine:3.4",
      "SourceCode": "FROM alpine:3.4",
      "Platform": "",
      "From": {
        "Image": "alpine:3.4"
      },
      "Commands": [
        {
          "Labels": [
            {
              "Key": "maintainer",
              "Value": "\"Jamie Isaacs \u003cpdt256@gmail.com\u003e\""
            }
          ],
          "Name": "label"
        },
        {
          "Name": "workdir",
          "Path": "/usr/local/src"
        },
        {
          "Env": [
            {
              "Key": "PHP_VERSION",
              "Value": "7.1.8"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "PHP_URL",
              "Value": "\"https://secure.php.net/get/php-$PHP_VERSION.tar.gz/from/this/mirror\""
            },
            {
              "Key": "PHP_MD5",
              "Value": "\"dc3fa0355ff74f61f110beb892ec6f5e\""
            },
            {
              "Key": "PHP_CFLAGS",
              "Value": "\"-fstack-protector-strong -fpic -fpie -O2\""
            },
            {
              "Key": "PHP_CPPFLAGS",
              "Value": "\"$PHP_CFLAGS\""
            },
            {
              "Key": "PHP_LDFLAGS",
              "Value": "\"-Wl,-O1 -Wl,--hash-style=both -pie\""
            },
            {
              "Key": "PHP_EXTRA_CONFIGURE_ARGS",
              "Value": "\"--enable-fpm --with-fpm-user=www-data --with-fpm-group=www-data\""
            },
            {
              "Key": "PHP_INI_DIR",
              "Value": "\"/usr/local/etc/php\""
            },
            {
              "Key": "BUILD_DEPENDENCIES",
              "Value": "\"        g++         libc-dev         re2c         gettext-dev         coreutils         gcc         make         wget         curl-dev         libxml2-dev         jpeg-dev         libpng-dev         libedit-dev         openssl-dev         freetype-dev\""
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "apk upgrade --no-cache     \u0026\u0026 apk add --no-cache --virtual .build-deps $BUILD_DEPENDENCIES     \u0026\u0026 apk --update add tar     \u0026\u0026 wget -q $PHP_URL -O php.tgz     \u0026\u0026 set -xe;         if [ -n \"$PHP_MD5\" ]; then         echo \"$PHP_MD5 *php.tgz\" | md5sum -c -;     fi;         export CFLAGS=\"$PHP_CFLAGS\"         CPPFLAGS=\"$PHP_CPPFLAGS\"         LDFLAGS=\"$PHP_LDFLAGS\"     \u0026\u0026 mkdir -p $PHP_INI_DIR/conf.d     \u0026\u0026 mkdir -p /usr/local/src/php     \u0026\u0026 tar zxf php.tgz -C /usr/local/src/php --strip-components=1     \u0026\u0026 (         cd /usr/local/src/php         \u0026\u0026 ./configure             --with-config-file-path=\"$PHP_INI_DIR\"             --with-config-file-scan-dir=\"$PHP_INI_DIR/conf.d\"             --disable-cgi             --disable-rpath             --enable-mbstring             --enable-mysqlnd             --enable-zip             --enable-exif             --with-curl             --with-gettext             --with-libedit             --with-openssl             --with-zlib             --with-gd             --with-jpeg-dir             --with-pdo-mysql=mysqlnd             --with-png-dir             --with-freetype-dir             $PHP_EXTRA_CONFIGURE_ARGS         \u0026\u0026 make -j \"$(nproc)\"         \u0026\u0026 make install     \t\u0026\u0026 { find /usr/local/bin /usr/local/sbin -type f -perm +0111 -exec strip --strip-all '{}' + || true; }         \u0026\u0026 make clean     )     \u0026\u0026 rm /usr/local/src/php.tgz     \u0026\u0026 rm -rf /usr/local/src/php     \u0026\u0026 runDeps=\"$( \t\tscanelf --needed --nobanner --format '%n#p' --recursive /usr/local \t\t\t| tr ',' '\\n' \t\t\t| sort -u \t\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \t)\" \t\u0026\u0026 apk add --no-cache --virtual .php-rundeps $runDeps     \u0026\u0026 apk del .build-deps \t\u0026\u0026 addgroup -g 82 -S www-data \t\u0026\u0026 adduser -u 82 -D -S -G www-data www-data     \u0026\u0026 mkdir -p /var/log/php-fpm     \u0026\u0026 chown www-data.www-data /var/log/php-fpm"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "./php-fpm.conf",
            "/usr/local/etc/php-fpm.conf"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "./php-fpm.d/",
            "/usr/local/etc/php-fpm.d"
          ]
        },
        {
          "Name": "expose",
          "Ports": [
            "9000"
          ]
        },
        {
          "CmdLine": [
            "php-fpm"
          ],
          "Name": "cmd",
          "PrependShell": false
        },
        {
          "Name": "user",
          "User": "www-data"
        }
      ]
    }
  ]
}