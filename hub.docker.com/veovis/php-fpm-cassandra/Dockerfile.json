{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "alpine:3.6",
      "SourceCode": "FROM alpine:3.6",
      "Platform": "",
      "From": {
        "Image": "alpine:3.6"
      },
      "Commands": [
        {
          "Key": "VERSION",
          "Name": "arg",
          "Value": "2.9"
        },
        {
          "Labels": [
            {
              "Key": "version",
              "Value": "\"${VERSION}\""
            },
            {
              "Key": "description",
              "Value": "\"php:5.6-alpine with cassandra and kafka support\""
            },
            {
              "Key": "maintainer",
              "Value": "\"SÃ©bastien RAULT \u003csebastien@kveer.fr\u003e\""
            }
          ],
          "Name": "label"
        },
        {
          "Name": "expose",
          "Ports": [
            "80"
          ]
        },
        {
          "CmdLine": [
            "/usr/sbin/runit-bootstrap"
          ],
          "Name": "cmd",
          "PrependShell": false
        },
        {
          "CmdLine": [
            "apk update --no-cache \u0026\u0026 \tapk upgrade --no-cache \u0026\u0026 \tapk add --no-cache \t\tnginx \t\tnginx-mod-http-headers-more \t\tsyslog-ng \t\tdcron \t\trunit \t\tphp5-cli \t\tphp5-fpm \t\tphp5-pdo \t\tphp5-pdo_mysql \t\tphp5-curl \t\tphp5-mcrypt \t\tphp5-intl \t\tphp5-zip \t\tphp5-xsl \t\tphp5-mysql \t\tphp5-openssl \u0026\u0026 \tapk add --no-cache --virtual .build-deps \t\talpine-sdk \t\tphp5-dev \t\tphp5-pear \t\tautoconf \t\tautomake \t\tre2c \t\tfile \u0026\u0026 \tln -s php5 /usr/bin/php \u0026\u0026 \tln -s phpize5 /usr/bin/phpize \u0026\u0026 \tln -s php-config5 /usr/bin/php-config \u0026\u0026 \tsed -i \"$ s|\\-n||g\" `which pecl` \u0026\u0026 \tpecl update-channels"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apk add libressl php5-json php5-phar php5-xml php5-zlib \u0026\u0026 \twget -O /tmp/composer-setup.php https://getcomposer.org/installer \u0026\u0026 \twget -O /tmp/composer-setup.sig https://composer.github.io/installer.sig \u0026\u0026 \tphp -r \"if (hash('SHA384', file_get_contents('/tmp/composer-setup.php')) !== trim(file_get_contents('/tmp/composer-setup.sig'))) { unlink('/tmp/composer-setup.php'); echo 'Invalid installer' . PHP_EOL; exit(1); }\" \u0026\u0026 \tphp /tmp/composer-setup.php --no-ansi --install-dir=/usr/local/bin --filename=composer --snapshot \u0026\u0026 \trm -f /tmp/composer-setup.*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apk add --no-cache nodejs-npm \u0026\u0026 \tnpm install -g bower \u0026\u0026 \tnpm install -g gulp \u0026\u0026 \tnpm install -g streamqueue \u0026\u0026 \tnpm install -g gulp-less gulp-concat gulp-uglify gulp-minify-css gulp-zip"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apk add --no-cache cassandra-cpp-driver libuv gmp \u0026\u0026 \tapk add --no-cache cassandra-cpp-driver-dev gmp-dev --virtual .build-sec \u0026\u0026 \tpecl install cassandra-1.3.0 \u0026\u0026 \tapk del .build-sec"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apk add --no-cache librdkafka \u0026\u0026 \tapk add --no-cache librdkafka-dev --virtual .build-sec \u0026\u0026 \tpecl install rdkafka \u0026\u0026 \techo \"extension=rdkafka.so\" \u003e /etc/php5/conf.d/rdkafka.ini \u0026\u0026 \tapk del .build-sec"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apk add --no-cache libsasl libmemcached-libs zlib \u0026\u0026 \tapk add --no-cache cyrus-sasl-dev libmemcached-dev zlib-dev --virtual .build-sec \u0026\u0026 \techo '/usr' \u003e /tmp/c \u0026\u0026 \tpecl install memcached-2.2.0 \u003c/tmp/c \u0026\u0026 \techo \"extension=memcached.so\" \u003e /etc/php5/conf.d/memcached.ini \u0026\u0026 \trm /tmp/c \u0026\u0026 \tapk del .build-sec"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apk add --no-cache libssh2 \u0026\u0026 \tapk add --no-cache libssh2-dev --virtual .build-sec \u0026\u0026 \tpecl install ssh2-0.13 \u0026\u0026 \techo \"extension=ssh2.so\" \u003e /etc/php5/conf.d/ssh2.ini \u0026\u0026 \tapk del .build-sec"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "adduser -D build \u0026\u0026 \taddgroup build abuild \u0026\u0026 \tsudo -H -u build mkdir /home/build/thrift \u0026\u0026 \tsudo -H -u build mkdir /home/build/php5-pdo_cassandra \u0026\u0026 \tsudo -H -u build abuild-keygen -an \u0026\u0026 \tsource /home/build/.abuild/abuild.conf \u0026\u0026 \tcp \"$PACKAGER_PRIVKEY\".pub /etc/apk/keys/"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "APKBUILD-thrift",
            "/home/build/thrift/APKBUILD"
          ]
        },
        {
          "CmdLine": [
            "cd /home/build/thrift \u0026\u0026 \tsudo -H -u build abuild -r \u0026\u0026 \tapk add --no-cache /home/build/packages/build/x86_64/thrift*.apk \u0026\u0026 \techo \"extension=thrift_protocol.so\" \u003e /etc/php5/conf.d/thrift_protocol.ini"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "APKBUILD-php5-pdo_cassandra",
            "/home/build/php5-pdo_cassandra/APKBUILD"
          ]
        },
        {
          "CmdLine": [
            "cd /home/build/php5-pdo_cassandra \u0026\u0026 \tsudo -H -u build abuild -r \u0026\u0026 \tapk add /home/build/packages/build/x86_64/php5-pdo_cassandra-0.6.0-r0.apk \u0026\u0026 \techo \"extension=pdo_cassandra.so\" \u003e /etc/php5/conf.d/pdo_cassandra.ini"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "deluser build \u0026\u0026 \trm -R /home/build \u0026\u0026 \tapk del .build-deps"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "services",
            "/etc/service"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "runit-bootstrap",
            "/usr/sbin/runit-bootstrap"
          ]
        },
        {
          "CmdLine": [
            "chmod 755 /usr/sbin/runit-bootstrap \u0026\u0026 \tchmod -R 755 /etc/service \u0026\u0026 \trm /etc/nginx/conf.d/default.conf \u0026\u0026 \tsed -i -e 's/^;pid/pid/' /etc/php5/php-fpm.conf \u0026\u0026 \tsed -i -e 's!^; \\?include_path.*!include_path=\".:/usr/share/php5\"!' /etc/php5/php.ini \u0026\u0026 \tsed -i '/^\\[www\\]/,$d' /etc/php5/php-fpm.conf \u0026\u0026 \tsed -i '/kmsg/d' /etc/syslog-ng/syslog-ng-source.std \u0026\u0026 \tsed -i '1,/^$/c#!/bin/sh' /etc/init.d/syslog-ng \u0026\u0026 \techo -e '\\nupdate' \u003e\u003e /etc/init.d/syslog-ng \u0026\u0026 \t/etc/init.d/syslog-ng"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    }
  ]
}