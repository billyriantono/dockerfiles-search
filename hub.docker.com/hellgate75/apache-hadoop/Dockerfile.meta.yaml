MetaArgs: null
Stages:
- BaseName: hellgate75/ubuntu-base:16.04
  Commands:
  - Maintainer: Fabrizio Torelli (hellgate75@gmail.com)
    Name: maintainer
  - Key: DEBIAN_FRONTEND
    Name: arg
    Value: noninteractive
  - Key: RUNLEVEL
    Name: arg
    Value: "1"
  - Env:
    - Key: APACHE_HADOOP_IS_CLUSTER
      Value: "no"
    - Key: APACHE_HADOOP_IS_MASTER
      Value: "no"
    - Key: APACHE_HADOOP_HDFS_REPLICATION
      Value: "1"
    - Key: APACHE_HADOOP_HDFS_BLOCKSIZE
      Value: "268435456"
    - Key: APACHE_HADOOP_HDFS_HANDLERCOUNT
      Value: "100"
    - Key: APACHE_HADOOP_SITE_HOSTNAME
      Value: localhost
    - Key: APACHE_HADOOP_SITE_BUFFER_SIZE
      Value: "131072"
    - Key: APACHE_HADOOP_YARN_RESOURCE_MANAGER_HOSTNAME
      Value: localhost
    - Key: APACHE_HADOOP_YARN_ACL_ENABLED
      Value: "false"
    - Key: APACHE_HADOOP_YARN_ADMIN_ACL
      Value: '*'
    - Key: APACHE_HADOOP_YARN_AGGREGATION_RETAIN_SECONDS
      Value: "60"
    - Key: APACHE_HADOOP_YARN_AGGREGATION_RETAIN_CHECK_SECONDS
      Value: "120"
    - Key: APACHE_HADOOP_YARN_LOG_AGGREGATION
      Value: "false"
    - Key: APACHE_HADOOP_MAPRED_JOB_HISTORY_HOSTNAME
      Value: localhost
    - Key: APACHE_HADOOP_MAPRED_JOB_HISTORY_PORT
      Value: "10020"
    - Key: APACHE_HADOOP_MAPRED_JOB_HISTORY_WEBUI_HOSTNAME
      Value: localhost
    - Key: APACHE_HADOOP_MAPRED_JOB_HISTORY_WEBUI_PORT
      Value: "19888"
    - Key: APACHE_HADOOP_MAPRED_MAP_MEMORY_MBS
      Value: "1536"
    - Key: APACHE_HADOOP_MAPRED_MAP_JAVA_OPTS
      Value: '"-Xmx1024M"'
    - Key: APACHE_HADOOP_MAPRED_RED_MEMORY_MBS
      Value: "3072"
    - Key: APACHE_HADOOP_MAPRED_RED_JAVA_OPTS
      Value: '"-Xmx2560M"'
    - Key: APACHE_HADOOP_MAPRED_SORT_MEMORY_MBS
      Value: "512"
    - Key: APACHE_HADOOP_MAPRED_SORT_FACTOR
      Value: "100"
    - Key: APACHE_HADOOP_MAPRED_SHUFFLE_PARALLELCOPIES
      Value: "50"
    - Key: MACHINE_TIMEZONE
      Value: '"Europe/Dublin"'
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    - Key: HAHOOP_VERSION
      Value: 3.0.0-alpha3
    - Key: HADOOP_HOME
      Value: /usr/local/hadoop
    - Key: HADOOP_USER
      Value: root
    - Key: HADOOP_COMMON_HOME
      Value: /usr/local/hadoop
    - Key: HADOOP_HDFS_HOME
      Value: /usr/local/hadoop
    - Key: HADOOP_MAPRED_HOME
      Value: /usr/local/hadoop
    - Key: HADOOP_YARN_HOME
      Value: /usr/local/hadoop
    - Key: HADOOP_CONF_DIR
      Value: /usr/local/hadoop/etc/hadoop
    - Key: YARN_CONF_DIR
      Value: /usr/local/hadoop/etc/hadoop
    - Key: HDFS_NAMENODE_OPTS
      Value: '"-XX:+UseParallelGC -Xmx4g"'
    - Key: BOOTSTRAP
      Value: /etc/bootstrap.sh
    - Key: NOTVISIBLE
      Value: '"in users profile"'
    - Key: HADOOP_CONF_DIR
      Value: /usr/local/hadoop/etc/hadoop
    - Key: HDFS_NAMENODE_USER
      Value: root
    - Key: HDFS_DATANODE_USER
      Value: root
    - Key: YARN_RESOURCEMANAGER_USER
      Value: root
    - Key: YARN_NODEMANAGER_USER
      Value: root
    - Key: HDFS_SECONDARYNAMENODE_USER
      Value: root
    - Key: PATH
      Value: $PATH:/usr/local/hadoop/bin:/usr/local/hadoop/sbin:/usr/local/cmake/bin/
    - Key: BASH_ENV
      Value: /etc/profile
    Name: env
  - Name: user
    User: root
  - CmdLine:
    - curl -L https://dist.apache.org/repos/dist/release/hadoop/common/hadoop-$HAHOOP_VERSION/hadoop-$HAHOOP_VERSION.tar.gz
      | tar -xz -C /usr/local/ &&     cd /usr/local && ln -s ./hadoop-$HAHOOP_VERSION
      hadoop &&     sed -i '/^export JAVA_HOME/ s:.*:export JAVA_HOME=/usr/java/default\nexport
      HADOOP_HOME=/usr/local/hadoop\nexport HADOOP_HOME=/usr/local/hadoop\n:' $HADOOP_HOME/etc/hadoop/hadoop-env.sh
      &&     sed -i '/^export HADOOP_CONF_DIR/ s:.*:export HADOOP_CONF_DIR=/usr/local/hadoop/etc/hadoop/:'
      $HADOOP_HOME/etc/hadoop/hadoop-env.sh &&     mkdir $HADOOP_HOME/input && cp
      $HADOOP_HOME/etc/hadoop/*.xml $HADOOP_HOME/input
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - singlenode
    - $HADOOP_HOME/etc/hadoop/singlenode
  - Chown: ""
    Name: add
    SourcesAndDest:
    - clusternode
    - $HADOOP_HOME/etc/hadoop/clusternode
  - CmdLine:
    - mkdir -p /root/.ssh && touch /root/.ssh/config && cat /root/.ssh/config
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ssh_config
    - /root/.ssh/config
  - CmdLine:
    - chmod 600 /root/.ssh/config && chown root:root /root/.ssh/config && mkdir /var/run/sshd
      && echo 'root:root' | chpasswd &&     sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin
      yes/' /etc/ssh/sshd_config &&     sed 's@session\s*required\s*pam_loginuid.so@session
      optional pam_loginuid.so@g' -i /etc/pam.d/sshd &&     echo "export VISIBLE=now"
      >> /etc/profile
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - install-snappy.sh
    - /etc/install-snappy.sh
  - CmdLine:
    - chmod 777 /etc/install-snappy.sh && /etc/install-snappy.sh && rm -f /etc/install-snappy.sh
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - bootstrap.sh
    - /etc/bootstrap.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - docker-start-hadoop.sh
    - /usr/local/bin/docker-start-hadoop
  - CmdLine:
    - chown root:root /etc/bootstrap.sh && chmod 700 /etc/bootstrap.sh && chown root:root
      /usr/local/bin/docker-start-hadoop && chmod 700 /usr/local/bin/docker-start-hadoop
      &&     chmod +x /usr/local/hadoop/etc/hadoop/*-env.sh && sed  -i "/^[^#]*UsePAM/
      s/.*/#&/"  /etc/ssh/sshd_config && echo "UsePAM no" >> /etc/ssh/sshd_config
      &&     echo "Port 2122" >> /etc/ssh/sshd_config && mkdir -p /etc/config/hadoop
      && mkdir -p /etc/hadoop && ln -s /usr/local/hadoop-$HAHOOP_VERSION/etc/hadoop
      /etc/hadoop && rm -f $HADOOP_HOME/etc/hadoop/core-site.xml     $HADOOP_HOME/etc/hadoop/hdfs-site.xml
      $HADOOP_HOME/etc/hadoop/yarn-site.xml && touch $HADOOP_HOME/etc/hadoop/mapred-site.xml
      && touch $HADOOP_HOME/etc/hadoop/hdfs-site.xml &&     touch $HADOOP_HOME/etc/hadoop/yarn-site.xml
      && touch $HADOOP_HOME/etc/hadoop/core-site.xml
    Name: run
    PrependShell: true
  - Name: workdir
    Path: $HADOOP_HOME
  - CmdLine:
    - docker-start-hadoop
    - -daemon
    Name: cmd
    PrependShell: false
  - Name: volume
    Volumes:
    - /user/root/data/hadoop/hdfs/datanode
    - /user/root/data/hadoop/hdfs/namenode
    - /user/root/data/hadoop/hdfs/checkpoint
    - /etc/config/hadoop
  - Name: expose
    Ports:
    - "10020"
    - "19888"
    - "2122"
    - "49707"
    - "50010"
    - "50020"
    - "50070"
    - "50075"
    - "50090"
    - "8020"
    - "8030"
    - "8031"
    - "8032"
    - "8033"
    - "8040"
    - "8042"
    - "8088"
    - "9000"
  From:
    Image: hellgate75/ubuntu-base:16.04
  Name: ""
  Platform: ""
  SourceCode: FROM hellgate75/ubuntu-base:16.04
