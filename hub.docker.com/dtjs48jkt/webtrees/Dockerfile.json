{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "ubuntu:bionic",
      "SourceCode": "FROM ubuntu:bionic",
      "Platform": "",
      "From": {
        "Image": "ubuntu:bionic"
      },
      "Commands": [
        {
          "Env": [
            {
              "Key": "DEBIAN_FRONTEND",
              "Value": "\"noninteractive\""
            },
            {
              "Key": "HOME",
              "Value": "\"/root\""
            },
            {
              "Key": "LC_ALL",
              "Value": "\"C.UTF-8\""
            },
            {
              "Key": "LANG",
              "Value": "\"en_US.UTF-8\""
            },
            {
              "Key": "LANGUAGE",
              "Value": "\"en_US.UTF-8\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "supervisor_conf",
              "Value": "/etc/supervisor/supervisord.conf"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "security_conf",
              "Value": "/etc/apache2/conf-available/security.conf"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "start_scripts_path",
              "Value": "/bin"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "apt-get update -qq"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apt-get upgrade -qy \u0026\u0026 apt-get install -qy     apt-utils     cron     supervisor     apache2     apache2-utils     libexpat1     ssl-cert     vim-tiny     php     libapache2-mod-php     php-mysql     php-curl     php-gd     php-intl     php-pear     php-imagick     php-imap     php-memcache     php-pspell     php-recode     php-sqlite3     php-tidy     php-xmlrpc     php-xsl     php-mbstring     php-gettext     php-opcache     php-apcu     php-zip     wget     unzip     \u0026\u0026 a2enmod ssl     \u0026\u0026 a2enmod rewrite     \u0026\u0026 a2enmod headers     \u0026\u0026 a2dissite 000-default     \u0026\u0026 mkdir /crt     \u0026\u0026 chmod 750 /crt     \u0026\u0026 openssl req -x509 -nodes -days 3650 -newkey rsa:4096 -keyout /crt/webtrees.key -out /crt/webtrees.crt -subj \"/C=DE/ST=H/L=F/O=Webtrees/OU=www.webtrees.net/CN=webtrees\"     \u0026\u0026 chmod 640 /crt/*     \u0026\u0026 wget -q https://github.com/fisharebest/webtrees/releases/download/2.0.1/webtrees-2.0.1.zip -O /tmp/webtrees.zip     \u0026\u0026 unzip -d /tmp/ -o /tmp/webtrees.zip     \u0026\u0026 rm -Rf /var/www/html     \u0026\u0026 mv /tmp/webtrees /var/www/html     \u0026\u0026 chown -R www-data:www-data /var/www/html     \u0026\u0026 chmod -R 770 /var/www/html     \u0026\u0026 apt-get clean -y     \u0026\u0026 rm -rf /var/lib/apt/lists/* /var/cache/* /var/tmp/* /tmp/*     \u0026\u0026 groupadd docker-data     \u0026\u0026 usermod -a -G docker-data,adm www-data"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "supervisord.conf",
            "${supervisor_conf}"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "security.conf",
            "${security_conf}"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "01_user_config.sh",
            "${start_scripts_path}"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "02_auto_update.sh",
            "${start_scripts_path}"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "03_set_a2port.sh",
            "${start_scripts_path}"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "04_enable_REMOTE_USER.sh",
            "${start_scripts_path}"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "start.sh",
            "/start.sh"
          ]
        },
        {
          "CmdLine": [
            "chmod +x ${start_scripts_path}/01_user_config.sh     \u0026\u0026 chmod +x ${start_scripts_path}/02_auto_update.sh     \u0026\u0026 chmod +x ${start_scripts_path}/03_set_a2port.sh     \u0026\u0026 chmod +x ${start_scripts_path}/04_enable_REMOTE_USER.sh     \u0026\u0026 chmod +x /start.sh"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "./start.sh"
          ],
          "Name": "cmd",
          "PrependShell": false
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "Auth.php",
            "/Auth.php"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "php.ini",
            "/etc/php/7.2/apache2/"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "webtrees.conf",
            "/etc/apache2/sites-available/"
          ]
        },
        {
          "CmdLine": [
            "chmod 644 /etc/apache2/sites-available/webtrees.conf     \u0026\u0026 a2dissite 000-default     \u0026\u0026 a2enmod ssl     \u0026\u0026 a2ensite webtrees"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "volume",
          "Volumes": [
            "/var/www/html/data",
            "/var/www/html/media"
          ]
        },
        {
          "Name": "expose",
          "Ports": [
            "443/tcp"
          ]
        }
      ]
    }
  ]
}