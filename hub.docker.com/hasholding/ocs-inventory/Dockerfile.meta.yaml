MetaArgs: null
Stages:
- BaseName: alpine:edge
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Levent SAGIROGLU <LSagiroglu@gmail.com>"'
    Name: label
  - Key: VERSION
    Name: arg
    Value: "2.5"
  - Env:
    - Key: OCS_DBHOST
      Value: '""'
    Name: env
  - Env:
    - Key: OCS_DBNAME
      Value: '""'
    Name: env
  - Env:
    - Key: OCS_DBUSER
      Value: '""'
    Name: env
  - Env:
    - Key: OCS_DBPASS
      Value: '""'
    Name: env
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - echo 'http://dl-cdn.alpinelinux.org/alpine/edge/testing' >> /etc/apk/repositories
    Name: run
    PrependShell: true
  - CmdLine:
    - apk add --update --no-cache bash tar gzip wget make apache2             php7-apache2
      php7 php7-mysqli php7-pdo_mysql php7-gd php7-memcached             php7-snmp
      php7-xml php7-simplexml php7-json php7-pspell php7-mbstring php7-zip php7-soap
      php7-curl             py-pip libxml2 perl-xml-simple perl-digest-sha1 perl-compress-raw-zlib
      perl-dbi             perl-dbd-mysql perl-dbi perl-net-ip perl-soap-lite apache2-mod-perl
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /tmp/
  - CmdLine:
    - wget https://www.cpan.org/authors/id/P/PH/PHRED/Apache-DBI-1.12.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - tar -xvf Apache-DBI-1.12.tar.gz
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /tmp/Apache-DBI-1.12
  - CmdLine:
    - perl Makefile.PL ;    make ;    make install
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /tmp/ocs-setup/
  - CmdLine:
    - wget https://github.com/OCSInventory-NG/OCSInventory-ocsreports/releases/download/${VERSION}/OCSNG_UNIX_SERVER_${VERSION}.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - tar -xvf OCSNG_UNIX_SERVER_${VERSION}.tar.gz --strip 1
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /tmp/ocs-setup/Apache
  - CmdLine:
    - perl Makefile.PL ;    make ;    make install ;    cp -R blib/lib/Apache /usr/local/share/perl5/
      ;    cp /tmp/ocs-setup/etc/logrotate.d/ocsinventory-server /etc/logrotate.d/
      ;    bash -c 'mkdir -p /etc/ocsinventory-server/{plugins,perl}' ;    mkdir -p
      /usr/share/ocsinventory-reports
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /tmp/ocs-setup/
  - CmdLine:
    - cp -R ocsreports /usr/share/ocsinventory-reports/ ;    chown root:apache -R
      /usr/share/ocsinventory-reports/ocsreports ;    bash -c 'mkdir -p /var/lib/ocsinventory-reports/{download,ipd,logs,scripts,snmp}'
      ;    chmod -R +w /var/lib/ocsinventory-reports ;    chmod -R 777 /usr/share/ocsinventory-reports/ocsreports/plugins  ;    chmod
      -R 777 /usr/share/ocsinventory-reports/ocsreports/config  ;    chmod -R 777
      /usr/share/ocsinventory-reports/ocsreports/upload  ;    bash -c 'chown root:apache
      -R /var/lib/ocsinventory-reports/{download,ipd,logs,scripts,snmp}' ;    cp binutils/ipdiscover-util.pl
      /usr/share/ocsinventory-reports/ocsreports/ipdiscover-util.pl ;    chown root:apache
      /usr/share/ocsinventory-reports/ocsreports/ipdiscover-util.pl ;    chmod 755
      /usr/share/ocsinventory-reports/ocsreports/ipdiscover-util.pl
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's,LoadModule mpm_event_module find /mod_mpm_event.so,LoadModule mpm_prefork_module
      modules/mod_mpm_prefork.so,g' /etc/apache2/httpd.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/DirectoryIndex index\.html/DirectoryIndex index\.php/g' /etc/apache2/httpd.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's,post_max_size = 8M,post_max_size = 101M,g' /etc/php7/php.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's,upload_max_filesize = 2M,upload_max_filesize =101M,g' /etc/php7/php.ini
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - '*.conf'
    - /etc/apache2/conf.d/
  - Name: workdir
    Path: /usr/share/ocsinventory-reports/ocsreports/download
  - CmdLine:
    - wget https://github.com/PluginsOCSInventory-NG/uptime/releases/download/1.1/uptime.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://github.com/PluginsOCSInventory-NG/officepack/releases/download/2.0/officepack.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://github.com/PluginsOCSInventory-NG/vmware-vcenter/releases/download/1.0/vmware.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://github.com/PluginsOCSInventory-NG/winupdate/releases/download/1.1/winupdate.zip
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - '*.php'
    - /usr/share/ocsinventory-reports/ocsreports/
  - CmdLine:
    - chown root:apache /usr/share/ocsinventory-reports/ocsreports/dbconfig.inc.php
      ;    chmod 777 /usr/share/ocsinventory-reports/ocsreports/dbconfig.inc.php
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /run/apache2
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "ServerName localhost" >> /etc/apache2/httpd.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/log/ocsinventory-server/
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - httpd
    - -D
    - FOREGROUND
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:edge
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:edge
