MetaArgs: null
Stages:
- BaseName: secoresearch/apache-varnish:latest
  Commands:
  - Env:
    - Key: FILE_PHP_INI
      Value: '"/etc/php/7.0/apache2/php.ini"'
    Name: env
  - Env:
    - Key: FILE_WP_CONF
      Value: '"$PATH_HTML/wp-config.php"'
    Name: env
  - Env:
    - Key: PATH_WP_INSTALL
      Value: '"/wordpress"'
    Name: env
  - Env:
    - Key: SRC_WP_CONF
      Value: '"/wp-config.php.source"'
    Name: env
  - Env:
    - Key: BIN_SENDMAIL
      Value: '"/usr/sbin/sendmail"'
    Name: env
  - Env:
    - Key: PHP_MAX_EXECUTION_TIME
      Value: '"90"'
    Name: env
  - Env:
    - Key: WP_SALTS
      Value: '""'
    Name: env
  - Env:
    - Key: WP_DB_NAME
      Value: '"wp"'
    Name: env
  - Env:
    - Key: WP_DB_USER
      Value: '"root"'
    Name: env
  - Env:
    - Key: WP_DB_PASSWORD
      Value: '"dummypassword"'
    Name: env
  - Env:
    - Key: WP_DB_HOST
      Value: '"localhost"'
    Name: env
  - Env:
    - Key: WP_DB_CHARSET
      Value: '"utf8"'
    Name: env
  - Env:
    - Key: WP_SITEURL
      Value: '"http://localhost:8080"'
    Name: env
  - Env:
    - Key: WP_HOME
      Value: '"$WP_SITEURL"'
    Name: env
  - Env:
    - Key: APACHE_ALLOW_OVERRIDE
      Value: '"All"'
    Name: env
  - Env:
    - Key: VARIABLES_WP_CONF
      Value: '"\$WP_SALTS         \$WP_DB_NAME         \$WP_DB_USER         \$WP_DB_PASSWORD         \$WP_DB_HOST         \$WP_DB_CHARSET         \$WP_HOME         \$WP_SITEURL"'
    Name: env
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y php-mysql unzip gettext-base vsftpd
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /tmp/
  - CmdLine:
    - wget -O wordpress.zip https://wordpress.org/latest.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - unzip wordpress.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - mv -T wordpress "$PATH_WP_INSTALL"
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get purge -y unzip
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - '"wp-config.php.source"'
    - '"$SRC_WP_CONF"'
  - CmdLine:
    - touch "$FILE_WP_CONF" && chmod g=u "$FILE_WP_CONF"
    Name: run
    PrependShell: true
  - CmdLine:
    - touch "$FILE_PHP_INI" && chmod g=u "$FILE_PHP_INI"
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod g=u /etc/passwd
    Name: run
    PrependShell: true
  - Name: user
    User: "10001"
  - Env:
    - Key: RUN_WORDPRESS
      Value: '"/run-wordpress"'
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - '"run"'
    - '"/run-wordpress"'
  - CmdLine:
    - /run-wordpress
    Name: entrypoint
    PrependShell: false
  From:
    Image: secoresearch/apache-varnish:latest
  Name: ""
  Platform: ""
  SourceCode: FROM secoresearch/apache-varnish:latest
