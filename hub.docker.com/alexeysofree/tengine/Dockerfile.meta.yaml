MetaArgs: null
Stages:
- BaseName: alexeysofree/centos7-base
  Commands:
  - Key: TENGINE_VERSION
    Name: arg
    Value: 2.2.0
  - Key: OPENSSL_VERSION
    Name: arg
    Value: 1.0.2k
  - CmdLine:
    - echo "=> Install packages" &&         yum -y install             wget jemalloc-devel
      openssl-devel             jemalloc             certbot             cronie logrotate             supervisor
      &&         yum -y groupinstall "Development Tools" &&     echo "=> Create temp
      dir" &&         mkdir -p /root/temp &&     echo "=> Install Tengine from sources"
      &&         cd /root/temp &&         wget "http://tengine.taobao.org/download/tengine-${TENGINE_VERSION}.tar.gz"
      &&         tar zxvf "tengine-${TENGINE_VERSION}.tar.gz" &&         wget "https://www.openssl.org/source/openssl-${OPENSSL_VERSION}.tar.gz"
      &&         tar zxvf "openssl-${OPENSSL_VERSION}.tar.gz" &&         cd "tengine-${TENGINE_VERSION}"
      &&         ./configure --with-jemalloc --with-http_v2_module "--with-openssl=/root/temp/openssl-${OPENSSL_VERSION}"
      &&         make &&         make install &&         ln -s /usr/local/nginx/sbin/nginx
      /usr/sbin &&         mv /usr/local/nginx/conf /usr/local/nginx/conf.src &&         mkdir
      -p /etc/nginx &&         ln -s /etc/nginx /usr/local/nginx/conf &&         ln
      -s /usr/local/nginx/conf.src/mime.types /etc/nginx &&     echo "=> Remove temp,
      packages, clean" &&         cd &&         rm -rf /root/temp &&         yum -y
      groupremove "Development Tools" &&         yum -y remove --setopt=clean_requirements_on_remove=1
      wget jemalloc-devel openssl-devel &&         yum clean all
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "443"
    - "80"
  - Name: volume
    Volumes:
    - /var/log/nginx
    - /etc/letsencrypt
    - /var/log/letsencrypt
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - rootfs/
    - /
  - CmdLine:
    - chmod 755 /etc &&     chmod 644 /etc/logrotate.d/nginx &&     crontab /var/spool/cron/root
      &&     chmod +x /certbot.sh &&     mkdir -p -m 700 /var/log/letsencrypt
    Name: run
    PrependShell: true
  - CmdLine:
    - supervisord
    - -c
    - /etc/supervisord.conf
    Name: entrypoint
    PrependShell: false
  From:
    Image: alexeysofree/centos7-base
  Name: ""
  Platform: ""
  SourceCode: FROM alexeysofree/centos7-base
