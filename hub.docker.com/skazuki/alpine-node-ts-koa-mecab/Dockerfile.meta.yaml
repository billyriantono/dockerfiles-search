MetaArgs: null
Stages:
- BaseName: node:12.14-alpine
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"S-Kazuki<contact@revoneo.com>"'
    Name: label
  - Env:
    - Key: APP_ROOT
      Value: /node
    - Key: MECAB_VERSION
      Value: "0.996"
    - Key: IPADIC_VERSION
      Value: 2.7.0-20070801
    - Key: MECAB_URL
      Value: https://drive.google.com/uc?export=download&id=0B4y35FiV1wh7cENtOXlicTFaRUE
    - Key: IPADIC_URL
      Value: https://drive.google.com/uc?export=download&id=0B4y35FiV1wh7MWVlSDBCSXZMTXM
    - Key: MECAB_BUILD_DEPS
      Value: '"curl git bash file sudo openssh autoconf"'
    - Key: MECAB_RUN_DEPS
      Value: openssl
    Name: env
  - Name: workdir
    Path: ${APP_ROOT}
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - package*.json
    - ${APP_ROOT}/
  - CmdLine:
    - apk add --update --no-cache build-base && apk add --update --no-cache --virtual
      .mecab-build-deps ${MECAB_BUILD_DEPS} && apk add --update --no-cache --virtual
      .mecab-run-deps ${MECAB_RUN_DEPS} && curl -SL -o ${APP_ROOT}/mecab-${MECAB_VERSION}.tar.gz
      ${MECAB_URL} && cd ${APP_ROOT} && tar -zxf mecab-${MECAB_VERSION}.tar.gz &&
      cd ${APP_ROOT}/mecab-${MECAB_VERSION} && ./configure --enable-utf8-only --with-charset=utf8
      && make && make install && curl -SL -o ${APP_ROOT}/mecab-ipadic-${IPADIC_VERSION}.tar.gz
      ${IPADIC_URL} && cd ${APP_ROOT} && tar -zxf mecab-ipadic-${IPADIC_VERSION}.tar.gz
      && cd ${APP_ROOT}/mecab-ipadic-${IPADIC_VERSION} && ./configure --with-charset=utf8
      && make && make install && cd ${APP_ROOT} && git clone --depth 1 https://github.com/neologd/mecab-ipadic-neologd.git
      && ${APP_ROOT}/mecab-ipadic-neologd/bin/install-mecab-ipadic-neologd -n -a -y
      && mecab -d /usr/local/lib/mecab/dic/mecab-ipadic-neologd && rm -rf ${APP_ROOT}/mecab-*
      && cd ${APP_ROOT} && npm ci && npm cache clean --force && apk update && apk
      add tzdata && TZ=${TZ:-Asia/Tokyo} && cp /usr/share/zoneinfo/$TZ /etc/localtime
      && echo $TZ> /etc/timezone && apk del tzdata .mecab-build-deps && rm -rf /var/cache/apk/*
    Name: run
    PrependShell: true
  - CmdLine:
    - npm
    - start
    Name: cmd
    PrependShell: false
  From:
    Image: node:12.14-alpine
  Name: ""
  Platform: ""
  SourceCode: FROM node:12.14-alpine
