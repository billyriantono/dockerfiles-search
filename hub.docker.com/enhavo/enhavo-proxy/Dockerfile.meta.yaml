MetaArgs: null
Stages:
- BaseName: phusion/baseimage:0.11
  Commands:
  - CmdLine:
    - apt-get update -y &&     apt-get upgrade -y  &&     ln -fs /usr/share/zoneinfo/Europe/Berlin
      /etc/localtime  &&     apt-get install -y apache2 &&     a2enmod proxy_fcgi
      &&     apt-get install -y varnish &&     apt-get install -y nginx &&     apt-get
      install -y sudo &&     apt-get install -y logrotate &&     curl -sL https://deb.nodesource.com/setup_10.x
      | sudo -E bash - &&     apt-get install -y nodejs &&     curl -o- -L https://yarnpkg.com/install.sh
      | bash &&     mkdir /var/startup &&     apt-get install -y git &&     git clone
      https://github.com/vishnubob/wait-for-it.git /var/startup/wait-for-it &&     apt-get
      install -y php7.2-fpm &&     apt-get install -y php7.2-gd &&     apt-get install
      -y php7.2-curl &&     apt-get install -y php7.2-mbstring &&     apt-get install
      -y php7.2-dom &&     apt-get install -y php7.2-intl &&     apt-get install -y
      php7.2-mysql &&     apt-get install -y php7.2-zip &&     apt-get install -y
      mysql-client &&     apt-get install -y composer &&     rm -rf /var/www/html
      &&     cp /etc/varnish/default.vcl /var/startup/default.vcl  &&     git clone
      https://github.com/enhavo/enhavo-proxy.git /var/www/current
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/my_init.d/01_apache2.bash
    - /etc/my_init.d/01_apache2.bash
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/my_init.d/02_varnish.bash
    - /etc/my_init.d/02_varnish.bash
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/my_init.d/03_nginx.bash
    - /etc/my_init.d/03_nginx.bash
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/my_init.d/04_enhavo.bash
    - /etc/my_init.d/04_enhavo.bash
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/my_init.d/05_php-fpm.bash
    - /etc/my_init.d/05_php-fpm.bash
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/apache2/ports.conf
    - /etc/apache2/ports.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/apache2/sites-available/000-default.conf
    - /etc/apache2/sites-available/000-default.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/php/7.2/fpm/pool.d/www.conf
    - /etc/php/7.2/fpm/pool.d/www.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/sudo/sudoers
    - /etc/sudoers
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/default/varnish
    - /etc/default/varnish
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/logrotate.d/apache2
    - /etc/logrotate.d/apache2
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - etc/logrotate.d/nginx
    - /etc/logrotate.d/nginx
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - var/startup/install.bash
    - /var/startup/install.bash
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - cron/crontab
    - /var/spool/cron/crontabs/root
  - Name: workdir
    Path: /var/www/current
  - CmdLine:
    - rm -f /etc/nginx/sites-available/default &&     rm -f /etc/nginx/sites-enabled/default
      &&     cp -ra /etc/nginx /etc/nginx_default &&     chmod 440 /etc/sudoers &&     chmod
      755 /etc/my_init.d/01_apache2.bash &&     chmod 755 /etc/my_init.d/02_varnish.bash
      &&     chmod 755 /etc/my_init.d/03_nginx.bash &&     chmod 755 /etc/my_init.d/04_enhavo.bash
      &&     chmod 755 /etc/my_init.d/05_php-fpm.bash &&     a2enmod rewrite &&     composer
      install --no-scripts --no-dev --no-interaction &&     bin/console fos:js-routing:dump
      --format=json --target=public/js/fos_js_routes.json &&     bin/console cache:warmup
      &&     chown -R www-data:www-data /var/www/current/var &&     /root/.yarn/bin/yarn
      install &&     /root/.yarn/bin/yarn encore prod &&     chmod 0644 /var/spool/cron/crontabs/root
      &&     crontab -u root /var/spool/cron/crontabs/root
    Name: run
    PrependShell: true
  - Env:
    - Key: COMPOSER_HOME
      Value: /root/.composer/
    Name: env
  - Name: volume
    Volumes:
    - /etc/nginx
    - /etc/varnish
    - /var/www
    - /var/ssl
  - Name: expose
    Ports:
    - "8080"
  - Name: expose
    Ports:
    - "80"
  - Name: expose
    Ports:
    - "443"
  - Name: expose
    Ports:
    - "22"
  From:
    Image: phusion/baseimage:0.11
  Name: ""
  Platform: ""
  SourceCode: FROM phusion/baseimage:0.11
