MetaArgs: null
Stages:
- BaseName: nvidia/cuda:8.0-devel-ubuntu16.04
  Commands:
  - Maintainer: Michael Bacci <michael.bacci@inria.fr>
    Name: maintainer
  - Key: ITK_TAG
    Name: arg
    Value: v4.9.0
  - Key: VTK_TAG
    Name: arg
    Value: v7.1.0
  - Key: GITLAB_USER
    Name: arg
    Value: null
  - Key: GITLAB_PSWD
    Name: arg
    Value: null
  - Key: USE_CUDA
    Name: arg
    Value: "OFF"
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y       build-essential       wget       unzip       git       cmake       g++-4.8       libboost-all-dev       freeglut3-dev       libfftw3-dev       libopenblas-dev       liblapack-dev       xz-utils       vim
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/src/
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src/
  - CmdLine:
    - git clone https://github.com/Kitware/ITK.git &&     cd ITK &&     git checkout
      $ITK_TAG
    Name: run
    PrependShell: true
  - Env:
    - Key: ITK_HOME
      Value: /usr/src/ITK
    Name: env
  - CmdLine:
    - cd ITK && mkdir build && cd build $ITK_HOME &&     cmake   -D CMAKE_CXX_COMPILER=/usr/bin/g++-4.8             -D
      CMAKE_SHARED_LIBS=ON             -D CMAKE_CXX_FLAGS="-O3 -fPIC"             -D
      USE_FFTWD=ON             -D USE_FFTWF=ON             -D CMAKE_BUILD_TYPE=RELEASE             -D
      BUILD_EXAMPLES=OFF             -D BUILD_TESTING=OFF  ../ &&     make -j 4 &&     make
      install
    Name: run
    PrependShell: true
  - Env:
    - Key: VTK_HOME
      Value: /usr/src/VTK
    Name: env
  - CmdLine:
    - git clone https://github.com/Kitware/VTK.git $VTK_HOME &&     cd VTK &&     git
      checkout $VTK_TAG
    Name: run
    PrependShell: true
  - CmdLine:
    - cd VTK && mkdir build && cd build &&     cmake   -D CMAKE_CXX_COMPILER=/usr/bin/g++-4.8             -D
      CMAKE_SHARED_LIBS=ON             -D CMAKE_CXX_FLAGS="-O3 -fPIC"             -D
      CMAKE_BUILD_TYPE=RELEASE             -D BUILD_EXAMPLES=OFF             -D BUILD_TESTING=OFF  ../
      &&     make -j 4 &&     make install
    Name: run
    PrependShell: true
  - Env:
    - Key: DEFORMETRICA_HOME
      Value: /usr/src/deformetrica
    Name: env
  - CmdLine:
    - git clone https://gitlab.icm-institute.org/kitchell/deformetrica.git $DEFORMETRICA_HOME
    Name: run
    PrependShell: true
  - Name: workdir
    Path: $DEFORMETRICA_HOME
  - CmdLine:
    - git checkout stable
    Name: run
    PrependShell: true
  - CmdLine:
    - git submodule init
    Name: run
    PrependShell: true
  - CmdLine:
    - git submodule update
    Name: run
    PrependShell: true
  - CmdLine:
    - tar -xJf extra/armadillo-7.700.0.tar.xz -C /usr/src/
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /usr/src/armadillo-7.700.0 && mkdir build && cd build &&     cmake -D CMAKE_CXX_COMPILER=/usr/bin/g++-4.8
      ../ &&     make -j 4 &&     make install
    Name: run
    PrependShell: true
  - Env:
    - Key: LIBRARY_PATH
      Value: '/usr/local/cuda/lib64/stubs:'
    Name: env
  - Env:
    - Key: LD_LIBRARY_PATH
      Value: '/usr/local/nvidia/lib64:/usr/local/nvidia/lib:/usr/local/cuda/lib64/stubs:/usr/local/cuda/lib64:/usr/local/lib:/usr/lib:'
    Name: env
  - CmdLine:
    - mkdir build && cd build &&     cmake   -D CMAKE_CXX_COMPILER=/usr/bin/g++-4.8             -D
      USE_CUDA:BOOL=$USE_CUDA             -D CMAKE_BUILD_TYPE=RELEASE ../ &&     make
      -j 4
    Name: run
    PrependShell: true
  - CmdLine:
    - cd build &&     make install deformetrica
    Name: run
    PrependShell: true
  - CmdLine:
    - /bin/bash
    Name: cmd
    PrependShell: false
  From:
    Image: nvidia/cuda:8.0-devel-ubuntu16.04
  Name: ""
  Platform: ""
  SourceCode: FROM nvidia/cuda:8.0-devel-ubuntu16.04
