MetaArgs: null
Stages:
- As: build-env
  BaseName: amazonlinux:2.0.20190508
  Commands:
  - Key: JUMANPP_FILENAME
    Name: arg
    Value: jumanpp-2.0.0-rc2.tar.xz
  - Key: TARGET_DIR
    Name: arg
    Value: /var/task
  - CmdLine:
    - yum -y update && yum -y install     wget &&    yum groupinstall "Development
      Tools" -y &&    yum clean all &&    wget https://cmake.org/files/v3.10/cmake-3.10.0.tar.gz
      &&    tar -xvzf cmake-3.10.0.tar.gz &&    cd /cmake-3.10.0 &&    ./bootstrap
      &&    make install &&    cd /
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://github.com/ku-nlp/jumanpp/releases/download/v2.0.0-rc2/${JUMANPP_FILENAME}
      &&    tar xf /${JUMANPP_FILENAME}
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p ${TARGET_DIR} &&    cd ${TARGET_DIR} &&    cmake /jumanpp-2.0.0-rc2     -DCMAKE_BUILD_TYPE=Release     -DCMAKE_INSTALL_PREFIX=${TARGET_DIR}
      &&    make install -j4
    Name: run
    PrependShell: true
  From:
    Image: amazonlinux:2.0.20190508
  Name: build-env
  Platform: ""
  SourceCode: FROM amazonlinux:2.0.20190508 as build-env
- As: run-env
  BaseName: amazonlinux:2.0.20190508
  Commands:
  - Key: TARGET_DIR
    Name: arg
    Value: /var/task
  - Chown: ""
    From: build-env
    Name: copy
    SourcesAndDest:
    - ${TARGET_DIR}/bin/jumanpp
    - ${TARGET_DIR}/bin/jumanpp
  - Chown: ""
    From: build-env
    Name: copy
    SourcesAndDest:
    - ${TARGET_DIR}/libexec/jumanpp/jumandic.config
    - ${TARGET_DIR}/libexec/jumanpp/jumandic.config
  - Chown: ""
    From: build-env
    Name: copy
    SourcesAndDest:
    - ${TARGET_DIR}/libexec/jumanpp/jumandic.jppmdl
    - ${TARGET_DIR}/libexec/jumanpp/jumandic.jppmdl
  - CmdLine:
    - /bin/bash
    Name: entrypoint
    PrependShell: false
  From:
    Image: amazonlinux:2.0.20190508
  Name: run-env
  Platform: ""
  SourceCode: FROM amazonlinux:2.0.20190508 as run-env
