MetaArgs: null
Stages:
- BaseName: ubuntu:xenial
  Commands:
  - Maintainer: Marcin Matlag "marcin.matlag@gmail.com"
    Name: maintainer
  - Name: expose
    Ports:
    - "16669"
  - Name: user
    User: root
  - Env:
    - Key: IRC_HOME
      Value: /var/ircstack
    Name: env
  - CmdLine:
    - mkdir -p "$IRC_HOME"
    Name: run
    PrependShell: true
  - Key: user
    Name: arg
    Value: ircstack
  - Key: group
    Name: arg
    Value: ircstack
  - Key: uid
    Name: arg
    Value: "1000"
  - Key: gid
    Name: arg
    Value: "1000"
  - CmdLine:
    - groupadd -g ${gid} ${group}     && useradd -d "$IRC_HOME" -u ${uid} -g ${gid}
      -m -s /bin/bash ${user}
    Name: run
    PrependShell: true
  - CmdLine:
    - chown ${user}:${group} "$IRC_HOME"
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - '"$IRC_HOME"'
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y upgrade
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y software-properties-common python-software-properties wget
      curl
    Name: run
    PrependShell: true
  - CmdLine:
    - add-apt-repository ppa:teward/znc
    Name: run
    PrependShell: true
  - CmdLine:
    - echo 'deb http://code.bitlbee.org/debian/master/xenial/amd64 ./' > /etc/apt/sources.list.d/bitlbee.list
    Name: run
    PrependShell: true
  - CmdLine:
    - echo 'deb http://download.opensuse.org/repositories/home:/jgeboski/xUbuntu_16.04
      ./' > /etc/apt/sources.list.d/bitlbee-facebook.list
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -O- https://code.bitlbee.org/debian/release.key | apt-key add -
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -O- https://jgeboski.github.io/obs.key | apt-key add -
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y znc bitlbee  bitlbee-facebook znc-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y libssl-dev automake gettext g++ make git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root
  - CmdLine:
    - git clone https://github.com/cocodelabs/znc-palaver.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root/znc-palaver
  - CmdLine:
    - git checkout `git describe --abbrev=0 --tags`
    Name: run
    PrependShell: true
  - CmdLine:
    - make
    Name: run
    PrependShell: true
  - CmdLine:
    - cp palaver.so /usr/lib/znc/palaver.so
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /root/znc-palaver
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root
  - CmdLine:
    - git clone https://github.com/jpnurmi/znc-playback.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root/znc-playback
  - CmdLine:
    - znc-buildmod playback.cpp
    Name: run
    PrependShell: true
  - CmdLine:
    - cp playback.so /usr/lib/znc/playback.so
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /root/znc-playback
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root
  - CmdLine:
    - git clone https://github.com/jpnurmi/znc-clientbuffer.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root/znc-clientbuffer
  - CmdLine:
    - znc-buildmod clientbuffer.cpp
    Name: run
    PrependShell: true
  - CmdLine:
    - cp clientbuffer.so /usr/lib/znc/clientbuffer.so
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /root/znc-clientbuffer
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root
  - CmdLine:
    - git clone https://github.com/jpnurmi/znc-chanfilter
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root/znc-chanfilter
  - CmdLine:
    - znc-buildmod chanfilter.cpp
    Name: run
    PrependShell: true
  - CmdLine:
    - cp chanfilter.so /usr/lib/znc/chanfilter.so
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /root/znc-chanfilter
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get purge -y libssl-dev automake gettext g++ make git
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - run.sh
    - /usr/local/bin/run.sh
  - CmdLine:
    - chmod +x /usr/local/bin/run.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/local/ircstack
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 750 /usr/local/ircstack
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - znc.conf
    - /usr/local/ircstack
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - bitlbee.conf
    - /usr/local/ircstack
  - CmdLine:
    - chmod 640 /usr/local/ircstack/*
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R root:${group} /usr/local/ircstack/
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y supervisor
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord.conf
    - /etc/supervisor/supervisord.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - znc_supervisord.conf
    - /etc/supervisor/conf.d/znc.conf.disabled
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - bitlbee_supervisord.conf
    - /etc/supervisor/conf.d/bitlbee.conf.disabled
  - CmdLine:
    - chown -R ${user}:${group} /etc/supervisor/
    Name: run
    PrependShell: true
  - Env:
    - Key: TINI_VERSION
      Value: v0.14.0
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini
    - /tini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini.asc
    - /tini.asc
  - CmdLine:
    - gpg --keyserver ha.pool.sks-keyservers.net --recv-keys 595E85A6B1B4779EA4DAAEC70B588DFF0527A9B7  &&
      gpg --verify /tini.asc
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 500 /tini
    Name: run
    PrependShell: true
  - CmdLine:
    - chown ${user}:${group} /tini
    Name: run
    PrependShell: true
  - Name: workdir
    Path: '"$IRC_HOME"'
  - Name: user
    User: ${user}
  - CmdLine:
    - /tini
    - --
    - /usr/local/bin/run.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: ubuntu:xenial
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:xenial
