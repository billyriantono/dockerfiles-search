MetaArgs: null
Stages:
- BaseName: osmtw/modtile:v3.0.9
  Commands:
  - Maintainer: Rex Tsai <rex.cc.tsai@gmail.com>
    Name: maintainer
  - CmdLine:
    - apt-get update  && apt-get dist-upgrade -y
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y subversion unzip wget  && svn co http://svn.openstreetmap.org/applications/rendering/mapnik
      /usr/local/src/mapnik-style  && bash -e /usr/local/src/mapnik-style/get-coastlines.sh
      /usr/local/share  && cd -
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - settings.sed
    - /tmp/
  - Chown: ""
    Name: add
    SourcesAndDest:
    - fontset-settings.xml.inc
    - /usr/local/src/mapnik-style/inc/fontset-settings.xml.inc
  - Chown: ""
    Name: add
    SourcesAndDest:
    - datasource-settings.sh
    - /usr/local/bin/datasource-settings.sh
  - CmdLine:
    - cd /usr/local/src/mapnik-style/inc  && sed --file /tmp/settings.sed  settings.xml.inc.template
      > settings.xml.inc  && chmod 755 /usr/local/bin/datasource-settings.sh  && chown
      -R www-data /usr/local/src/mapnik-style/inc  && cd -
    Name: run
    PrependShell: true
  - Env:
    - Key: OSM_CARTO_VERSION
      Value: v2.39.0
    Name: env
  - CmdLine:
    - git clone --depth 1 --branch ${OSM_CARTO_VERSION} https://github.com/gravitystorm/openstreetmap-carto.git
      /usr/local/src/openstreetmap-carto  && cd /usr/local/src/openstreetmap-carto  &&
      ./get-shapefiles.sh  && cd -
    Name: run
    PrependShell: true
  - Env:
    - Key: OSM_BRIGHT_VERSION
      Value: master
    Name: env
  - CmdLine:
    - git clone --depth 1 --branch ${OSM_BRIGHT_VERSION} https://github.com/mapbox/osm-bright.git
      /usr/local/src/osm-bright  && sed -e s%unifont%Unifont% -i /usr/local/src/osm-bright/osm-bright/palette.mss  &&
      ln -s /usr/local/src/openstreetmap-carto/data /usr/local/src/osm-bright/shp
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R www-data.www-data /usr/local/src/
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /var/www/html
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - leafletjs-localmap
    - /var/www/html
  - Chown: ""
    Name: add
    SourcesAndDest:
    - renderd.conf
    - /usr/local/etc/renderd.conf
  - CmdLine:
    - install --owner=www-data --group=www-data -d /var/run/renderd
    Name: run
    PrependShell: true
  - Env:
    - Key: SUPERVISOR_VERSION
      Value: 3.2.0-2
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - supervisord.conf
    - /etc/supervisord.conf
  - CmdLine:
    - apt-get install -y supervisor=${SUPERVISOR_VERSION}
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get clean  && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - /usr/bin/supervisord
    - --nodaemon
    - --configuration=/etc/supervisord.conf
    Name: cmd
    PrependShell: false
  From:
    Image: osmtw/modtile:v3.0.9
  Name: ""
  Platform: ""
  SourceCode: FROM osmtw/modtile:v3.0.9
