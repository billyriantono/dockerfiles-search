MetaArgs: null
Stages:
- BaseName: centos:7
  Commands:
  - CmdLine:
    - yum update -y &&     yum install -y epel-release &&     yum groupinstall -y
      development
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y     git     libevent     openssl-devel     unzip     wget     httpie     net-tools
    Name: run
    PrependShell: true
  - CmdLine:
    - wget http://packages.couchbase.com/releases/couchbase-release/couchbase-release-1.0-2-x86_64.rpm;     rpm
      -iv couchbase-release-1.0-2-x86_64.rpm;     yum install -y         libcouchbase-devel         gcc         gcc-c++         python-devel         python-pip         sudo
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install --upgrade pip
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -fsSLO https://get.docker.com/builds/Linux/x86_64/docker-17.05.0-ce.tgz
      &&     tar --strip-components=1 -xvzf docker-17.05.0-ce.tgz -C /usr/local/bin
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt
  - CmdLine:
    - git clone https://github.com/couchbaselabs/mobile-testkit.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt/mobile-testkit
  - CmdLine:
    - pip install --ignore-installed -U ipaddress
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install --ignore-installed -U requests
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install -r requirements.txt
    Name: run
    PrependShell: true
  - CmdLine:
    - cp ansible.cfg.example ansible.cfg
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/remote_user = vagrant/remote_user = root/' ansible.cfg
    Name: run
    PrependShell: true
  - Env:
    - Key: PYTHONPATH
      Value: /opt/mobile-testkit/
    Name: env
  - Env:
    - Key: ANSIBLE_CONFIG
      Value: /opt/mobile-testkit/ansible.cfg
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./entrypoint.sh
    - /opt/mobile-testkit
  - CmdLine:
    - /bin/bash
    Name: cmd
    PrependShell: false
  From:
    Image: centos:7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:7
