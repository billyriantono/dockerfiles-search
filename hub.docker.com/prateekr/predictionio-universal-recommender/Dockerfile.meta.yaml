MetaArgs: null
Stages:
- BaseName: buildpack-deps:bionic
  Commands:
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - Env:
    - Key: PIO_VERSION
      Value: 0.13.0
    Name: env
  - Env:
    - Key: SPARK_VERSION
      Value: 2.1.1
    Name: env
  - Env:
    - Key: HADOOP_VERSION
      Value: "2.6"
    Name: env
  - Env:
    - Key: SCALA_VERSION
      Value: 2.11.12
    Name: env
  - Env:
    - Key: SCALA_MAJOR_VERSION
      Value: "2.11"
    Name: env
  - Env:
    - Key: SBT_VERSION
      Value: 1.2.0
    Name: env
  - Env:
    - Key: JDBC_PG_VERSION
      Value: 42.2.0
    Name: env
  - Env:
    - Key: UNIVERSAL_RECOMMENDER_VERSION
      Value: v0.7.3
    Name: env
  - Env:
    - Key: PIO_HOME
      Value: /home/pio
    Name: env
  - Env:
    - Key: PATH
      Value: ${PIO_HOME}/bin:$PATH
    Name: env
  - Env:
    - Key: UR_HOME
      Value: ${PIO_HOME}/universal-recommender
    Name: env
  - Env:
    - Key: APP_HOME
      Value: ${PIO_HOME}/app
    Name: env
  - Env:
    - Key: JAVA_HOME
      Value: /usr/lib/jvm/java-8-oracle
    Name: env
  - Name: shell
    Shell:
    - /bin/bash
    - -o
    - pipefail
    - -c
  - CmdLine:
    - useradd -d ${PIO_HOME} -ms /bin/bash pio &&  mkdir -p ${PIO_HOME}/vendors ${APP_HOME}/lib
      ${UR_HOME} &&  apt-get update -qq -y &&  apt-get install -qq -y --no-install-recommends
      software-properties-common vim-nox &&  add-apt-repository -y ppa:webupd8team/java
      &&  echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true
      | debconf-set-selections &&  apt-get update -qq -y &&  apt-get install -qq -y
      oracle-java8-installer oracle-java8-set-default oracle-java8-unlimited-jce-policy
      &&  curl -sSL https://downloads.lightbend.com/scala/${SCALA_VERSION}/scala-${SCALA_VERSION}.deb
      -o /tmp/scala-${SCALA_VERSION}.deb &&  dpkg -i /tmp/scala-${SCALA_VERSION}.deb
      &&  apt-get install -qq -y -f &&  rm -rf /var/cache/apt/archives/* /var/cache/oracle-jdk8-installer/*
      /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sSL https://archive.apache.org/dist/predictionio/${PIO_VERSION}/apache-predictionio-${PIO_VERSION}-bin.tar.gz
      | tar -xzpf - --strip-components=1 -C ${PIO_HOME} &&  curl -sSL https://archive.apache.org/dist/spark/spark-${SPARK_VERSION}/spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION}.tgz
      | tar -xzpf - -C ${PIO_HOME}/vendors &&  curl -sSL https://jdbc.postgresql.org/download/postgresql-${JDBC_PG_VERSION}.jar
      -o ${PIO_HOME}/lib/postgresql-${JDBC_PG_VERSION}.jar
    Name: run
    PrependShell: true
  - Name: workdir
    Path: ${UR_HOME}
  - CmdLine:
    - curl -sSL https://piccolo.link/sbt-${SBT_VERSION}.tgz | tar -xzpf - -C ${PIO_HOME}
      &&  curl -sSL https://github.com/actionml/universal-recommender/archive/${UNIVERSAL_RECOMMENDER_VERSION}.tar.gz
      | tar -xzpf - --strip-components=1 -C ${UR_HOME} &&  pio build &&  mv -vf ${UR_HOME}/target/scala-${SCALA_MAJOR_VERSION}/*.jar
      ${APP_HOME}/lib &&  cp -vf ${UR_HOME}/engine.json.template ${APP_HOME}/engine.json
      &&  cp -vf ${UR_HOME}/template.json ${APP_HOME}/template.json &&  rm -rf ${UR_HOME}
      ~/.sbt ~/.ivy2/
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - conf/
    - ${PIO_HOME}/conf/
  - CmdLine:
    - chown -R pio:pio ${PIO_HOME}
    Name: run
    PrependShell: true
  - Name: workdir
    Path: ${APP_HOME}
  - Name: user
    User: pio
  - CmdLine:
    - pio
    Name: cmd
    PrependShell: false
  From:
    Image: buildpack-deps:bionic
  Name: ""
  Platform: ""
  SourceCode: FROM buildpack-deps:bionic
