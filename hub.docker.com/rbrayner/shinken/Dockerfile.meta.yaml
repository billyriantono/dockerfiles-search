MetaArgs: null
Stages:
- BaseName: rbrayner/docker_shinken
  Commands:
  - CmdLine:
    - apt-get update && apt-get upgrade -y && apt-get install -y vim libreadline-dev
      libconfig-dev libssl-dev lua5.2 liblua5.2-dev libevent-dev libjansson-dev python-dev
      make libffi-dev libssl-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install passlib
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install alignak_backend_client
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install twx.botapi
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install requests[security]
    Name: run
    PrependShell: true
  - CmdLine:
    - shinken --init
    Name: run
    PrependShell: true
  - CmdLine:
    - shinken install pickle-retention-file-scheduler
    Name: run
    PrependShell: true
  - CmdLine:
    - shinken install pickle-retention-file-generic
    Name: run
    PrependShell: true
  - CmdLine:
    - touch /var/lib/shinken/retention.dat
    Name: run
    PrependShell: true
  - CmdLine:
    - chown shinken.shinken /var/lib/shinken/retention.dat
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 660 /var/lib/shinken/retention.dat
    Name: run
    PrependShell: true
  - CmdLine:
    - chown shinken.shinken /var/lib/shinken -R
    Name: run
    PrependShell: true
  - CmdLine:
    - chown shinken.shinken /var/log/shinken -R
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 777 /var/log/shinken -R
    Name: run
    PrependShell: true
  - Env:
    - Key: TZ
      Value: America/Recife
    Name: env
  - CmdLine:
    - ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - shinken_apache.conf
    - /etc/apache2/conf.d/
  - Name: expose
    Ports:
    - "7770"
    - "80"
  From:
    Image: rbrayner/docker_shinken
  Name: ""
  Platform: ""
  SourceCode: FROM rbrayner/docker_shinken
