MetaArgs: null
Stages:
- BaseName: centos:centos7
  Commands:
  - CmdLine:
    - yum update -y && yum install -y java-1.8.0-openjdk openssh-server     unzip.x86_64
      zip.x86_64 git jarsigner wget epel-release curl dpkg java-devel which
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat/jenkins.repo
    Name: run
    PrependShell: true
  - CmdLine:
    - rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y     lsof     python-simplejson     file     git     cpio     diffstat     gawk     make     sudo     ca-certificates     python-devel     python3-devel     locales     koji;
      yum clean all
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's|session required pam_loginuid.so|session optional pam_loginuid.so|g'
      /etc/pam.d/sshd
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/run/sshd
    Name: run
    PrependShell: true
  - Env:
    - Key: JENKINS_HOME
      Value: /var/jenkins_home
    Name: env
  - Env:
    - Key: JENKINS_SLAVE_AGENT_PORT
      Value: "50000"
    Name: env
  - Env:
    - Key: user
      Value: jenkins
    Name: env
  - Env:
    - Key: group
      Value: jenkins
    Name: env
  - Env:
    - Key: uid
      Value: "1000"
    Name: env
  - Env:
    - Key: gid
      Value: "1000"
    Name: env
  - CmdLine:
    - groupadd -g $gid $group   && useradd -d "$JENKINS_HOME" -u $uid -g $gid -m -s
      /bin/bash $user   && /usr/bin/ssh-keygen -A
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod +w /etc/sudoers; echo "jenkins        ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers;
      chmod -w /etc/sudoers
    Name: run
    PrependShell: true
  - CmdLine:
    - 'sed -i -e ''s/Defaults    requiretty.*/ #Defaults    requiretty/g'' /etc/sudoers'
    Name: run
    PrependShell: true
  - Env:
    - Key: TINI_SHA
      Value: 066ad710107dc7ee05d3aa6e4974f01dc98f3888
    Name: env
  - CmdLine:
    - curl -fL https://github.com/krallin/tini/releases/download/v0.5.0/tini-static
      -o /bin/tini && chmod +x /bin/tini   && echo "$TINI_SHA /bin/tini" | sha1sum
      -c -
    Name: run
    PrependShell: true
  - Env:
    - Key: JENKINS_VERSION
      Value: 2.190.2
    Name: env
  - Env:
    - Key: JENKINS_SHA
      Value: 47620a00004af5634e45904149897fe4a36b0463ec691bfabc2086779f90f127
    Name: env
  - CmdLine:
    - mkdir -p /usr/share/jenkins
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/share/jenkins/ref/init.groovy.d
    Name: run
    PrependShell: true
  - Env:
    - Key: JENKINS_URL
      Value: https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/$JENKINS_VERSION/jenkins-war-$JENKINS_VERSION.war
    Name: env
  - CmdLine:
    - curl -fsSL $JENKINS_URL -o /usr/share/jenkins/jenkins.war   && echo "$JENKINS_SHA  /usr/share/jenkins/jenkins.war"
      | sha256sum -c -
    Name: run
    PrependShell: true
  - Env:
    - Key: JENKINS_UC
      Value: https://updates.jenkins.io
    Name: env
  - Env:
    - Key: JENKINS_UC_EXPERIMENTAL
      Value: https://updates.jenkins.io/experimental
    Name: env
  - CmdLine:
    - chown -R jenkins "$JENKINS_HOME" /usr/share/jenkins/ref
    Name: run
    PrependShell: true
  - Env:
    - Key: JAVA_OPTS
      Value: '"-Dorg.apache.commons.jelly.tags.fmt.timeZone=America/Los_Angeles -Duser.timezone=America/Los_Angeles"'
    Name: env
  - Name: expose
    Ports:
    - "8080"
  - Name: expose
    Ports:
    - "50000"
  - Env:
    - Key: COPY_REFERENCE_FILE_LOG
      Value: $JENKINS_HOME/copy_reference_file.log
    Name: env
  - Env:
    - Key: LC_ALL
      Value: en_US.UTF-8
    Name: env
  - Env:
    - Key: LANG
      Value: en_US.UTF-8
    Name: env
  - Name: user
    User: jenkins
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - plugins.txt
    - /usr/share/jenkins/ref/plugins.txt
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - plugins.sh
    - /usr/local/bin/plugins.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - jenkins-support
    - /usr/local/bin/jenkins-support
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - jenkins.sh
    - /usr/local/bin/jenkins.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - install-plugins.sh
    - /usr/local/bin/install-plugins.sh
  - CmdLine:
    - /usr/local/bin/install-plugins.sh < /usr/share/jenkins/ref/plugins.txt
    Name: run
    PrependShell: true
  - Name: user
    User: root
  - CmdLine:
    - git clone https://github.com/jpuhlman/mvgit.git
    Name: run
    PrependShell: true
  - CmdLine:
    - cd mvgit; make prefix=/usr
    Name: run
    PrependShell: true
  - CmdLine:
    - cd mvgit; make prefix=/usr install
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf mvgit
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - init.sh
    - /
  - CmdLine:
    - chmod 755 /init.sh
    Name: run
    PrependShell: true
  - Env:
    - Key: INSTALL_PLUGINS
      Value: "1"
    Name: env
  - CmdLine:
    - ln -s /bin/tini /sbin/tini
    Name: run
    PrependShell: true
  - CmdLine:
    - /init.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: centos:centos7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:centos7
