MetaArgs: null
Stages:
- BaseName: php:7.0-apache
  Commands:
  - CmdLine:
    - a2enmod rewrite headers
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    Name: run
    PrependShell: true
  - CmdLine:
    - php composer-setup.php --install-dir=/bin
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "unlink('composer-setup.php');"
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y install git unzip nodejs-legacy vim mysql-client libgmp-dev build-essential
      libssl-dev gnupg2
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sL https://deb.nodesource.com/setup_10.x | bash -
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y install nodejs
    Name: run
    PrependShell: true
  - CmdLine:
    - npm install -g bower
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-install gmp mysqli pdo pdo_mysql
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - composer.json
    - composer.lock
    - ./
  - CmdLine:
    - composer.phar install --no-plugins --no-scripts
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - bower.json
    - ./
  - CmdLine:
    - bower install --allow-root
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - config/apache.conf
    - /etc/apache2/sites-available/algorea.conf
  - CmdLine:
    - a2dissite 000-default
    Name: run
    PrependShell: true
  - CmdLine:
    - a2ensite algorea
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /var/www/html/logs && ln -s /var/log/apache2 /var/www/html/logs/apache
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - ./
  - CmdLine:
    - chown -R www-data:www-data *
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  From:
    Image: php:7.0-apache
  Name: ""
  Platform: ""
  SourceCode: FROM php:7.0-apache
