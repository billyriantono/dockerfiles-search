{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "devgeniem/base:edge",
      "SourceCode": "FROM devgeniem/base:edge",
      "Platform": "",
      "From": {
        "Image": "devgeniem/base:edge"
      },
      "Commands": [
        {
          "Maintainer": "Ville Pietarinen - Geniem Oy \u003cville.pietarinen-nospam@geniem.com\u003e",
          "Name": "maintainer"
        },
        {
          "Key": "RESTY_VERSION",
          "Name": "arg",
          "Value": "\"1.15.8.2\""
        },
        {
          "Key": "RESTY_OPENSSL_VERSION",
          "Name": "arg",
          "Value": "\"1.1.1c\""
        },
        {
          "Key": "PAGESPEED_VERSION",
          "Name": "arg",
          "Value": "\"1.13.35.2\""
        },
        {
          "Key": "DEBIAN_FRONTEND",
          "Name": "arg",
          "Value": "noninteractive"
        },
        {
          "Key": "TERM",
          "Name": "arg",
          "Value": "xterm-color"
        },
        {
          "Key": "RESTY_CONFIG_OPTIONS",
          "Name": "arg",
          "Value": "\"    --with-http_addition_module     --with-http_auth_request_module     --with-http_flv_module     --with-http_gunzip_module     --with-http_gzip_static_module     --with-http_mp4_module     --with-http_random_index_module     --with-http_realip_module     --with-http_secure_link_module     --with-http_slice_module     --with-http_ssl_module     --with-http_stub_status_module     --with-http_sub_module     --with-http_v2_module     --with-http_geoip_module=dynamic     --with-file-aio     --with-ipv6     --with-pcre-jit     --with-stream     --with-stream_ssl_module     --with-threads     --without-http_autoindex_module     --without-http_browser_module     --without-http_userid_module     --without-mail_pop3_module     --without-mail_imap_module     --without-mail_smtp_module     --without-http_split_clients_module     --without-http_uwsgi_module     --without-http_scgi_module     --without-http_referer_module     --without-http_redis_module     --user=nginx     --group=nginx     --sbin-path=/usr/sbin     --modules-path=/usr/lib/nginx     --prefix=/etc/nginx     --conf-path=/etc/nginx/nginx.conf     --http-log-path=/var/log/nginx/access.log     --error-log-path=/var/log/nginx/error.log     --pid-path=/var/run/nginx.pid     --lock-path=/var/run/nginx/nginx.lock     --http-fastcgi-temp-path=/tmp/nginx/fastcgi     --http-proxy-temp-path=/tmp/nginx/proxy     --http-client-body-temp-path=/tmp/nginx/client_body     --add-module=/tmp/incubator-pagespeed-ngx-${PAGESPEED_VERSION}-stable     --add-module=/tmp/ngx_cache_purge-2.3     --with-openssl=/tmp/openssl-${RESTY_OPENSSL_VERSION}     \""
        },
        {
          "Key": "BUILD_DEPS",
          "Name": "arg",
          "Value": "'build-essential curl libreadline-dev libncurses5-dev libpcre3-dev libgeoip-dev zlib1g-dev ca-certificates uuid-dev'"
        },
        {
          "CmdLine": [
            "apt-get update \u0026\u0026     apt-get -y install $BUILD_DEPS --no-install-recommends \u0026\u0026     cd /tmp/ \u0026\u0026     echo \"Downloading PageSpeed...\" \u0026\u0026     curl -L https://github.com/pagespeed/ngx_pagespeed/archive/v${PAGESPEED_VERSION}-stable.tar.gz | tar -zx \u0026\u0026     ls -lah \u0026\u0026     cd /tmp/incubator-pagespeed-ngx-${PAGESPEED_VERSION}-stable/ \u0026\u0026     echo \"Downloading PSOL...\" \u0026\u0026     curl -L https://dl.google.com/dl/page-speed/psol/${PAGESPEED_VERSION}-x64.tar.gz | tar -zx \u0026\u0026     cd /tmp/ \u0026\u0026     echo \"Downloading Nginx cache purge module...\" \u0026\u0026     curl -L http://labs.frickle.com/files/ngx_cache_purge-2.3.tar.gz | tar -zx \u0026\u0026     echo \"Downloading OpenSSL...\" \u0026\u0026     curl -L https://www.openssl.org/source/openssl-${RESTY_OPENSSL_VERSION}.tar.gz | tar -zx \u0026\u0026     echo \"Downloading openresty...\" \u0026\u0026     curl -L https://openresty.org/download/openresty-${RESTY_VERSION}.tar.gz | tar -zx \u0026\u0026     echo \"Downloading ngx_http_redis...\" \u0026\u0026     curl -L https://github.com/onnimonni/ngx_http_redis-0.3.7/archive/master.tar.gz | tar -zx \u0026\u0026     readonly NPROC=$(grep -c ^processor /proc/cpuinfo 2\u003e/dev/null || 1)  \u0026\u0026     echo \"using up to $NPROC threads\" \u0026\u0026     cd openresty-${RESTY_VERSION} \u0026\u0026     ./configure -j${NPROC} ${_RESTY_CONFIG_DEPS} ${RESTY_CONFIG_OPTIONS} \u0026\u0026     make -j${NPROC} \u0026\u0026     make -j${NPROC} install \u0026\u0026     mkdir -p /var/lib/nginx /var/log/nginx \u0026\u0026     rm -rf /var/lib/apt/lists/* \u0026\u0026     apt-get remove --purge -y $BUILD_DEPS $(apt-mark showauto) \u0026\u0026     rm -rf /tmp/* /var/log/apt/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir /tmp/nginx/     mkdir -p /tmp/nginx/pagespeed/images/     \u0026\u0026 ln -sf /usr/lib/nginx /etc/nginx/modules     \u0026\u0026 groupadd -g 8888 nginx     \u0026\u0026 useradd -u 8888 -g nginx nginx     \u0026\u0026 ln -sf /dev/stdout /var/log/nginx/access.log     \u0026\u0026 ln -sf /dev/stderr /var/log/nginx/error.log"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    }
  ]
}