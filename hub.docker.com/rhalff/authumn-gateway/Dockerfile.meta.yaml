MetaArgs: null
Stages:
- BaseName: openresty/openresty:alpine-fat
  Commands:
  - Env:
    - Key: JWT_SECRET
      Value: change_me
    Name: env
  - Env:
    - Key: TOKEN_URL
      Value: http://localhost:2301/token
    Name: env
  - Env:
    - Key: USER_URL
      Value: http://localhost:2302/user
    Name: env
  - Env:
    - Key: API_URL
      Value: http://localhost:2303/
    Name: env
  - Env:
    - Key: SERVER_NAME
      Value: authumn-gateway
    Name: env
  - Env:
    - Key: REDIS_HOST
      Value: '"127.0.0.1";'
    Name: env
  - Env:
    - Key: REDIS_PORT
      Value: 6379;
    Name: env
  - Env:
    - Key: REDIS_DB
      Value: 1;
    Name: env
  - Env:
    - Key: RESOLVER
      Value: '"127.0.0.11 valid=30s"'
    Name: env
  - Env:
    - Key: MOUNT_POINT
      Value: '''/v1'''
    Name: env
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - apk update
    Name: run
    PrependShell: true
  - CmdLine:
    - apk add openssl-dev git
    Name: run
    PrependShell: true
  - CmdLine:
    - luarocks install lua-resty-http
    Name: run
    PrependShell: true
  - CmdLine:
    - luarocks install lua-resty-session
    Name: run
    PrependShell: true
  - CmdLine:
    - luarocks install lua-resty-jwt
    Name: run
    PrependShell: true
  - CmdLine:
    - luarocks install lua-resty-openidc
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./conf
    - /conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./certs
    - /certs
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./logs
    - /logs
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./start.sh
    - /start.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./www/*.html
    - /usr/local/openresty/nginx/html/
  - CmdLine:
    - chmod +x /start.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /start.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: openresty/openresty:alpine-fat
  Name: ""
  Platform: ""
  SourceCode: FROM openresty/openresty:alpine-fat
