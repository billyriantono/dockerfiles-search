MetaArgs: null
Stages:
- BaseName: alpine:latest
  Commands:
  - Env:
    - Key: HTTPD_PREFIX
      Value: /usr/local/apache2
    Name: env
  - Env:
    - Key: PATH
      Value: $PATH:$HTTPD_PREFIX/bin
    Name: env
  - Env:
    - Key: HTTPD_VERSION
      Value: 2.4.23
    Name: env
  - Env:
    - Key: HTTPD_BZ2_URL
      Value: https://www.apache.org/dist/httpd/httpd-$HTTPD_VERSION.tar.bz2
    Name: env
  - Env:
    - Key: HTTPD_USER
      Value: apache
    Name: env
  - Env:
    - Key: HTTPD_GROUP
      Value: apache
    Name: env
  - CmdLine:
    - mkdir -p "$HTTPD_PREFIX"
    Name: run
    PrependShell: true
  - CmdLine:
    - addgroup "$HTTPD_GROUP" && adduser -D -G "$HTTPD_GROUP" -s /bin/false "$HTTPD_USER"
    Name: run
    PrependShell: true
  - CmdLine:
    - "set -x \t&& apk add --no-cache --virtual .build-deps \t\tapr-dev \t\tapr-util-dev
      \t\tcurl \t\tgcc \t\tgnupg \t\tlibc-dev \t\tmake \t\topenssl-dev \t\tpcre-dev
      \t&& curl -fSL \"$HTTPD_BZ2_URL\" -o httpd.tar.bz2 \t&& curl -fSL \"$HTTPD_BZ2_URL.asc\"
      -o httpd.tar.bz2.asc \t&& export GNUPGHOME=\"$(mktemp -d)\" \t&& gpg --keyserver
      ha.pool.sks-keyservers.net --recv-keys A93D62ECC3C8EA12DB220EC934EA76E6791485A8
      \t&& gpg --batch --verify httpd.tar.bz2.asc httpd.tar.bz2 \t&& rm -r \"$GNUPGHOME\"
      httpd.tar.bz2.asc \t&& mkdir -p src \t&& tar -jxvf httpd.tar.bz2 -C src \t&&
      rm httpd.tar.bz2 \t&& cd src/httpd-$HTTPD_VERSION \t&& ./configure --prefix=$HTTPD_PREFIX
      --enable-mods-shared=reallyall \t&& make -j\"$(getconf _NPROCESSORS_ONLN)\"
      \t&& make install \t&& cd ../../ \t&& rm -r src/httpd-$HTTPD_VERSION \t&& sed
      -ri \" \t\ts!^(\\s*CustomLog)\\s+\\S+!\\1 /proc/self/fd/1!g; \t\ts!^(\\s*ErrorLog)\\s+\\S+!\\1
      /proc/self/fd/2!g; \t\ts!^(\\s*User)\\s+\\S+!\\1 $HTTPD_USER!g; \t\ts!^(\\s*Group)\\s+\\S+!\\1
      $HTTPD_GROUP!g; \t\t\" /usr/local/apache2/conf/httpd.conf \t&& runDeps=\"$(
      \t\tscanelf --needed --nobanner --recursive /usr/local \t\t\t| awk '{ gsub(/,/,
      \"\\nso:\", $2); print \"so:\" $2 }' \t\t\t| sort -u \t\t\t| xargs -r apk info
      --installed \t\t\t| sort -u \t)\" \t&& apk add --virtual .httpd-rundeps $runDeps
      \t\tapr-dev \t\tapr-util-dev \t&& apk del .build-deps"
    Name: run
    PrependShell: true
  - Name: workdir
    Path: $HTTPD_PREFIX
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - httpd-foreground
    - /usr/local/bin/
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - httpd-foreground
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:latest
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:latest
