MetaArgs: null
Stages:
- BaseName: picoded/glusterfs-client
  Commands:
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - echo "deb http://packages.cloud.google.com/apt cloud-sdk-$(lsb_release -c -s)
      main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list;
    Name: run
    PrependShell: true
  - CmdLine:
    - curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add
      -;
    Name: run
    PrependShell: true
  - CmdLine:
    - sudo apt-get update && sudo apt-get install -y google-cloud-sdk && apt-get clean;
    Name: run
    PrependShell: true
  - Env:
    - Key: GS_URL
      Value: '"gs://<bucket-name>/<sub-directory>/<somezipfile>.zip"'
    Name: env
  - Env:
    - Key: GS_CRED_FILE
      Value: '''/gs-cred.json'''
    Name: env
  - Env:
    - Key: GS_CRED_CONTENT
      Value: ''''''
    Name: env
  - Env:
    - Key: ZIP_FILE
      Value: '"master.zip"'
    Name: env
  - Env:
    - Key: ZIP_PRESCRIPT
      Value: '""'
    Name: env
  - Env:
    - Key: ZIP_POSTSCRIPT
      Value: '""'
    Name: env
  - Env:
    - Key: ZIP_FOLDER
      Value: '""'
    Name: env
  - Env:
    - Key: GFS_MOUNT
      Value: '''/storage'''
    Name: env
  - Env:
    - Key: GFS_VOLUME
      Value: ''''''
    Name: env
  - Env:
    - Key: GFS_STARTING_HOST
      Value: ''''''
    Name: env
  - CmdLine:
    - "echo '#!/bin/bash'                                                                >
      /entrypoint/zip-cloner.sh && \techo 'echo \"###\"'                                                                 >>
      /entrypoint/zip-cloner.sh && \techo 'echo \"### Start of picoded/zip-cloner
      : entrypoint/zip-cloner.sh\"'          >> /entrypoint/zip-cloner.sh && \techo
      'echo \"###\"'                                                                 >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo '# Enters the /workspace'                                                    >>
      /entrypoint/zip-cloner.sh && \techo 'cd /workspace;'                                                             >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo 'if [ -n \"$ZIP_PRESCRIPT\" ]; then '                                          >>
      /entrypoint/zip-cloner.sh && \techo '   echo \"###\"'                                                              >>
      /entrypoint/zip-cloner.sh && \techo '   echo \"### prescript of picoded/zip-cloner\"'
      \                             >> /entrypoint/zip-cloner.sh && \techo '   echo
      \"###\"'                                                              >> /entrypoint/zip-cloner.sh
      && \techo '   eval \"$ZIP_PRESCRIPT\";'                                                  >>
      /entrypoint/zip-cloner.sh && \techo 'fi '                                                                        >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo '# Enters the /workspace'                                                    >>
      /entrypoint/zip-cloner.sh && \techo 'cd /workspace;'                                                             >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo '# Ensures the old file is removed'                                          >>
      /entrypoint/zip-cloner.sh && \techo 'rm -f \"/tmp/$ZIP_FILE\";'                                                    >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo '# Setup the credential file'                                                >>
      /entrypoint/zip-cloner.sh && \techo 'if [ -n \"$GS_CRED_CONTENT\" ]; then '
      \                                       >> /entrypoint/zip-cloner.sh && \techo
      '   echo \"$GS_CRED_CONTENT\" > \"$GS_CRED_FILE\";'                              >>
      /entrypoint/zip-cloner.sh && \techo 'fi '                                                                        >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo '# Redownload the file'                                                      >>
      /entrypoint/zip-cloner.sh && \techo 'gsutil -o \"Credentials:gs_service_key_file=$GS_CRED_FILE\"
      cp \"$GS_URL\" /tmp/$ZIP_FILE;' >> /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo 'echo \"###\"'                                                                 >>
      /entrypoint/zip-cloner.sh && \techo 'echo \"### Unzipping of the file package\"'
      \                                  >> /entrypoint/zip-cloner.sh && \techo 'echo
      \"###\"'                                                                 >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo '# Unzip the file contents'                                                  >>
      /entrypoint/zip-cloner.sh && \techo 'unzip -o \"/tmp/$ZIP_FILE\" -d \"/workspace/$ZIP_FOLDER/\";'
      \                   >> /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo 'if [ -n \"$ZIP_POSTSCRIPT\" ]; then '                                         >>
      /entrypoint/zip-cloner.sh && \techo '   echo \"###\"'                                                              >>
      /entrypoint/zip-cloner.sh && \techo '   echo \"### postscript of picoded/zip-cloner\"'
      \                            >> /entrypoint/zip-cloner.sh && \techo '   echo
      \"###\"'                                                              >> /entrypoint/zip-cloner.sh
      && \techo '   cd \"/workspace/$ZIP_FOLDER/\"'                                            >>
      /entrypoint/zip-cloner.sh && \techo '   eval \"$ZIP_POSTSCRIPT\";'                                                 >>
      /entrypoint/zip-cloner.sh && \techo 'fi '                                                                        >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo 'echo \"###\"'                                                                 >>
      /entrypoint/zip-cloner.sh && \techo 'echo \"### Finished picoded/zip-cloner
      : entrypoint/zip-cloner.sh\"'          >> /entrypoint/zip-cloner.sh && \techo
      'echo \"###\"'                                                                 >>
      /entrypoint/zip-cloner.sh && \techo ''                                                                           >>
      /entrypoint/zip-cloner.sh && \techo 'cd \"/workspace/$ZIP_FOLDER/\"'                                               >>
      /entrypoint/zip-cloner.sh && \techo 'exec \"$@\"'                                                                  >>
      /entrypoint/zip-cloner.sh && \tchmod +x /entrypoint/zip-cloner.sh;"
    Name: run
    PrependShell: true
  - CmdLine:
    - /entrypoint/primer.sh
    - /entrypoint/glusterfs-client.sh
    - /entrypoint/zip-cloner.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - 'echo "hello world : run your actual command here"'
    Name: cmd
    PrependShell: true
  From:
    Image: picoded/glusterfs-client
  Name: ""
  Platform: ""
  SourceCode: FROM picoded/glusterfs-client
