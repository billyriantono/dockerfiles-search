MetaArgs: null
Stages:
- BaseName: debian:wheezy
  Commands:
  - Chown: ""
    Name: add
    SourcesAndDest:
    - pkcs11-proxy.diff
    - /pkcs11-proxy.diff
  - CmdLine:
    - "apt-get -y update \t&& DEBIAN_FRONTEND=noninteractive \t\tapt-get -y install
      git dpkg-dev cmake cdbs debhelper libssl-dev \t&& git config --global user.email
      \"darco@deepdarc.com\" && git config --global user.name \"Robert Quattlebaum\"
      \t&& git clone https://github.com/SUNET/pkcs11-proxy.git \t&& cd pkcs11-proxy
      \t&& git checkout 0caa567d78a6d88365946399b68e3327969f3bff \t&& git cherry-pick
      1c2954cde94a5d4ac87528bd90c29c6a24374f60 ae700e6e5201d5288c82c9834a708bc09e488afa
      \t&& git apply ../pkcs11-proxy.diff \t&& DEBIAN_FRONTEND=noninteractive dpkg-buildpackage
      \t&& cd / \t&& DEBIAN_FRONTEND=noninteractive dpkg -i pkcs11-daemon_0.4-1ubuntu3_amd64.deb
      pkcs11-proxy1_0.4-1ubuntu3_amd64.deb \t&& DEBIAN_FRONTEND=noninteractive apt-get
      -y purge git dpkg-dev cmake cdbs debhelper libssl-dev \t&& DEBIAN_FRONTEND=noninteractive
      apt-get -y autoremove \t&& DEBIAN_FRONTEND=noninteractive apt-get -y clean \t&&
      rm -fr pkcs11* \t&& mkdir /usr/lib/pkcs11-proxy \t&& cp /usr/lib/libpkcs11-proxy.*
      /usr/lib/pkcs11-proxy/ \t&& true"
    Name: run
    PrependShell: true
  - CmdLine:
    - "apt-get -y update \t&& DEBIAN_FRONTEND=noninteractive \t\tapt-get -y install
      softhsm"
    Name: run
    PrependShell: true
  - CmdLine:
    - echo 0:/var/lib/softhsm/slot0.db > /etc/softhsm/softhsm.conf && softhsm --init-token
      --pin 123456 --so-pin 12345678 --slot 0 --label SoftHSMToken
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "54435"
  - Env:
    - Key: PKCS11_DAEMON_SOCKET
      Value: '"tcp://0.0.0.0:54435"'
    Name: env
  - Name: volume
    Volumes:
    - /usr/lib/pkcs11-proxy
  - CmdLine:
    - /usr/bin/pkcs11-daemon
    - /usr/lib/softhsm/libsofthsm.so
    Name: cmd
    PrependShell: false
  From:
    Image: debian:wheezy
  Name: ""
  Platform: ""
  SourceCode: FROM debian:wheezy
