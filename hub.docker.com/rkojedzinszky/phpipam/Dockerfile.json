{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "php:7.1-apache",
      "SourceCode": "FROM php:7.1-apache",
      "Platform": "",
      "From": {
        "Image": "php:7.1-apache"
      },
      "Commands": [
        {
          "Maintainer": "Richard Kojedzinszky \u003ckrichy@nmdps.net\u003e",
          "Name": "maintainer"
        },
        {
          "Env": [
            {
              "Key": "PHPIPAM_SOURCE",
              "Value": "https://github.com/phpipam/phpipam/archive/"
            },
            {
              "Key": "PHPIPAM_VERSION",
              "Value": "1.3"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "apt-get update \u0026\u0026 \tapt-get install -y curl git libgmp-dev libmcrypt-dev libpng-dev libjpeg-dev libfreetype6-dev \u0026\u0026 \trm -rf /var/lib/apt/lists/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "docker-php-ext-install mysqli pdo_mysql gettext pcntl sockets gmp mcrypt \u0026\u0026 \tdocker-php-ext-configure gd \t\t--enable-gd-native-ttf \t\t--with-freetype-dir=/usr/include/freetype2 \t\t--with-png-dir=/usr/include \t\t--with-jpeg-dir=/usr/include \u0026\u0026 \tdocker-php-ext-install gd \u0026\u0026 \techo \". /etc/environment\" \u003e\u003e /etc/apache2/envvars \u0026\u0026 \ta2enmod rewrite"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "php.ini",
            "/usr/local/etc/php/"
          ]
        },
        {
          "CmdLine": [
            "curl -L ${PHPIPAM_SOURCE}/${PHPIPAM_VERSION}.tar.gz | tar -xzf - -C /var/www/html/ --strip-components=1"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "chown www-data:www-data app/subnets/import-subnet/upload app/admin/import-export/upload"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "sed \t-e \"/db.*host/s/^.*/\\$db['host'] = getenv('MYSQL_ENV_MYSQL_HOST') != '' ? getenv('MYSQL_ENV_MYSQL_HOST') : 'mysql';/\" \t-e \"/db.*user/s/^.*/\\$db['user'] = getenv('MYSQL_ENV_MYSQL_USER') != '' ? getenv('MYSQL_ENV_MYSQL_USER') : 'phpipam';/\" \t-e \"/db.*pass/s/^.*/\\$db['pass'] = getenv('MYSQL_ENV_MYSQL_PASS') != '' ? getenv('MYSQL_ENV_MYSQL_PASS') : 'phpipam';/\" \t-e \"/db.*name/s/^.*/\\$db['name'] = getenv('MYSQL_ENV_MYSQL_NAME') != '' ? getenv('MYSQL_ENV_MYSQL_NAME') : 'phpipam';/\" \t-e \"/db.*port/s/^.*/\\$db['port'] = getenv('MYSQL_ENV_MYSQL_PORT') != '' ? getenv('MYSQL_ENV_MYSQL_PORT') : 3306;/\" \t/var/www/html/config.dist.php \u003e /var/www/html/config.php"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "phpipam-entrypoint",
            "/usr/local/bin/"
          ]
        },
        {
          "CmdLine": [
            "chmod +x /usr/local/bin/phpipam-entrypoint"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "phpipam-entrypoint"
          ],
          "Name": "entrypoint",
          "PrependShell": false
        },
        {
          "CmdLine": [
            "apache2-foreground"
          ],
          "Name": "cmd",
          "PrependShell": false
        },
        {
          "Name": "expose",
          "Ports": [
            "80"
          ]
        }
      ]
    }
  ]
}