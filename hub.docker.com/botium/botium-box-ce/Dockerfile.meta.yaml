MetaArgs: null
Stages:
- BaseName: node:11.10.1-alpine
  Commands:
  - CmdLine:
    - apk update && apk add dos2unix bash
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /app
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - /app
  - CmdLine:
    - find . -type f -print0 | xargs -0 dos2unix
    Name: run
    PrependShell: true
  - Env:
    - Key: PHANTOMJS_VERSION
      Value: 2.1.1
    Name: env
  - CmdLine:
    - apk --no-cache add curl curl-dev g++ make python alsa-lib-dev krb5 krb5-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -Ls "https://github.com/dustinblackman/phantomized/releases/download/${PHANTOMJS_VERSION}/dockerized-phantomjs.tar.gz"
      | tar xz -C / && curl -k -Ls https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-${PHANTOMJS_VERSION}-linux-x86_64.tar.bz2
      | tar -jxvf - -C ./ && cp phantomjs-${PHANTOMJS_VERSION}-linux-x86_64/bin/phantomjs
      /usr/local/bin/phantomjs && rm -fR phantomjs-${PHANTOMJS_VERSION}-linux-x86_64
    Name: run
    PrependShell: true
  - CmdLine:
    - npm set unsafe-perm true && BUILD_ONLY=true npm install --no-optional --production
    Name: run
    PrependShell: true
  - CmdLine:
    - apk del curl g++ make python
    Name: run
    PrependShell: true
  - Key: BOTIUMBOX_QUEUE_REDISURL
    Name: arg
    Value: redis://redisuser:redispassword@redishost:redisport
  - Key: PRISMA_ENDPOINT
    Name: arg
    Value: https://my-prisma-endpoint:my-prisma-port/demo/dev
  - Key: PRISMA_MANAGEMENT_API_SECRET
    Name: arg
    Value: ""
  - Key: PRISMA_SECRET
    Name: arg
    Value: myprismasecret123
  - Key: JWT_SECRET
    Name: arg
    Value: myjwtsecret123
  - Env:
    - Key: BOTIUMBOX_QUEUE_REDISURL
      Value: $BOTIUMBOX_QUEUE_REDISURL
    Name: env
  - Env:
    - Key: PRISMA_ENDPOINT
      Value: $PRISMA_ENDPOINT
    Name: env
  - Env:
    - Key: PRISMA_MANAGEMENT_API_SECRET
      Value: $PRISMA_MANAGEMENT_API_SECRET
    Name: env
  - Env:
    - Key: PRISMA_SECRET
      Value: $PRISMA_SECRET
    Name: env
  - Env:
    - Key: JWT_SECRET
      Value: $JWT_SECRET
    Name: env
  - Name: volume
    Volumes:
    - /app/server/testsets
  - Name: volume
    Volumes:
    - /app/server/botiumwork
  - Name: volume
    Volumes:
    - /app/server/resources
  - Name: volume
    Volumes:
    - /app/agent/botiumwork
  - Name: volume
    Volumes:
    - /app/agent/resources
  - Name: expose
    Ports:
    - "4000"
  - CmdLine:
    - ./wait-for-it.sh -s -t 300 prisma:4466 -- npm start
    Name: cmd
    PrependShell: true
  From:
    Image: node:11.10.1-alpine
  Name: ""
  Platform: ""
  SourceCode: FROM node:11.10.1-alpine
