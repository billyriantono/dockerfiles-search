MetaArgs: null
Stages:
- BaseName: redmine
  Commands:
  - Maintainer: Jose M. Fernandez-Alba <jm.fernandezalba@commonms.com>
    Name: maintainer
  - Name: expose
    Ports:
    - "22"
  - Env:
    - Key: REDMINE_ROOT
      Value: /usr/src/redmine
    Name: env
  - CmdLine:
    - "apt-get update && apt-get install -y \tsudo \tpkg-config \topenssh-server \tbuild-essential
      \tlibssh2-1 \tlibssh2-1-dev \tcmake \tlibgpg-error-dev \t&& rm -rf /var/lib/apt/lists/*"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - redmine_sudoers
    - /etc/sudoers.d/redmine
  - CmdLine:
    - "mkhomedir_helper redmine \t&& usermod -a -G staff redmine"
    Name: run
    PrependShell: true
  - CmdLine:
    - "chown redmine:redmine -R $REDMINE_ROOT \t&& chmod 775 -R /usr/local/bundle
      \t&& chmod 440 /etc/sudoers.d/redmine"
    Name: run
    PrependShell: true
  - Name: workdir
    Path: $REDMINE_ROOT/plugins
  - CmdLine:
    - "gosu redmine git clone https://github.com/jbox-web/redmine_bootstrap_kit.git
      \t&& cd redmine_bootstrap_kit \t&& git checkout 0.2.4"
    Name: run
    PrependShell: true
  - CmdLine:
    - "gosu redmine git clone https://github.com/jbox-web/redmine_git_hosting.git
      \t&& cd redmine_git_hosting \t&& git checkout 1.2.1"
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd -m git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /home/git
  - CmdLine:
    - "gosu git git clone git://github.com/sitaramc/gitolite \t&& gosu git mkdir bin
      \t&& gosu git mkdir repositories"
    Name: run
    PrependShell: true
  - CmdLine:
    - sudo -HEu git gitolite/install -to /home/git/bin
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /home/git/repositories
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint_gitolite.sh
    - /sbin/
  - CmdLine:
    - chmod 755 /sbin/entrypoint_gitolite.sh
    Name: run
    PrependShell: true
  - Name: workdir
    Path: $REDMINE_ROOT
  - CmdLine:
    - /sbin/entrypoint_gitolite.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - rails
    - server
    - -b
    - 0.0.0.0
    Name: cmd
    PrependShell: false
  From:
    Image: redmine
  Name: ""
  Platform: ""
  SourceCode: FROM redmine
