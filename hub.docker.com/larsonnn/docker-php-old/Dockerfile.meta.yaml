MetaArgs: null
Stages:
- BaseName: debian:jessie
  Commands:
  - Maintainer: ATINO GmbH, info@atino.de
    Name: maintainer
  - CmdLine:
    - apt-get update && apt-get install -y  vim cron unzip apache2  libmagickwand-dev
      libmagickcore-dev  apache2-dev build-essential libxml2-dev libssl-dev snmp libpcre3-dev
      libjpeg-dev libpng-dev  libmysqlclient-dev libgd-dev libgmp-dev libmhash-dev
      libmcrypt-dev libwebp-dev libc-client2007e-dev libkrb5-dev  libxslt-dev libsnmp-dev
      libzip-dev libtidy-dev libcurl4-openssl-dev libicu-dev autoconf
    Name: run
    PrependShell: true
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - Env:
    - Key: PHP_VERSION
      Value: '"php-5.6.21"'
    Name: env
  - Env:
    - Key: IMAGICK_VERSION
      Value: '"imagick-3.4.1"'
    Name: env
  - Env:
    - Key: APACHE_LOG_DIR
      Value: '"/var/log/apache/"'
    Name: env
  - Env:
    - Key: APACHE_RUN_USER
      Value: '"www-data"'
    Name: env
  - Env:
    - Key: APACHE_RUN_GROUP
      Value: '"www-data"'
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - $PHP_VERSION.tar.gz
    - /tmp
  - CmdLine:
    - ln -s /usr/include/ldap.h /usr/lib/x86_64-linux-gnu/ldap.h
    Name: run
    PrependShell: true
  - CmdLine:
    - tar xf /tmp/$PHP_VERSION.tar.gz -C /tmp
    Name: run
    PrependShell: true
  - CmdLine:
    - /tmp/$PHP_VERSION/configure --with-apxs2=/usr/bin/apxs2 --with-mysqli --with-kerberos
      --with-libxml-dir     --with-openssl --with-pcre-regex --with-zlib --enable-bcmath
      --enable-calendar --with-curl --enable-exif     --with-pcre-dir --enable-ftp
      --with-openssl-dir --with-gd --with-webp-dir --with-jpeg-dir --with-png-dir     --with-xpm-dir
      --with-freetype-dir --enable-gd-native-ttf --enable-gd-jis-conv --with-gettext
      --with-mhash     --with-iconv --with-imap --with-imap-ssl --enable-intl --with-icu-dir=/usr
      --enable-mbstring --with-mcrypt     --with-pdo-mysql --with-snmp --with-openssl-dir
      --enable-soap --enable-sockets --enable-zip --with-zlib-dir     --with-libzip
      --with-ldap=/usr/lib/x86_64-linux-gnu --with-tidy
    Name: run
    PrependShell: true
  - CmdLine:
    - make && make install
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - $IMAGICK_VERSION.tgz
    - /tmp
  - CmdLine:
    - tar xf /tmp/$IMAGICK_VERSION.tgz -C /tmp
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /tmp/$IMAGICK_VERSION/ && phpize
    Name: run
    PrependShell: true
  - CmdLine:
    - /tmp/$IMAGICK_VERSION/configure --with-imagick=/usr/local
    Name: run
    PrependShell: true
  - CmdLine:
    - make && make install
    Name: run
    PrependShell: true
  - CmdLine:
    - cp /tmp/$PHP_VERSION/php.ini-production /usr/local/lib/php.ini && ln -s /usr/local/lib/php.ini
      /etc
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "date.timezone = Europe/Berlin" >> /etc/php.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "extension=imagick.so" >> /etc/php.ini
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - default-ssl.conf
    - /etc/apache2/sites-available/default-ssl.conf
  - CmdLine:
    - a2dismod mpm_event
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod mpm_prefork ssl rewrite headers
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "<FilesMatch \.php$>" >>  /etc/apache2/mods-available/php5.load &&     echo
      "SetHandler application/x-httpd-php" >>  /etc/apache2/mods-available/php5.load
      &&     echo "</FilesMatch>" >>  /etc/apache2/mods-available/php5.load
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "ServerName localhost" >> /etc/apache2/apache2.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /etc/apache2/ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - a2dissite 000-default
    Name: run
    PrependShell: true
  - CmdLine:
    - a2ensite default-ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "Listen 443" /etc/apache2/ports.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -R /tmp/*
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "443"
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - /entrypoint.sh
  - CmdLine:
    - /entrypoint.sh
    Name: cmd
    PrependShell: false
  From:
    Image: debian:jessie
  Name: ""
  Platform: ""
  SourceCode: FROM debian:jessie
