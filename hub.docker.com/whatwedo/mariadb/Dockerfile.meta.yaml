MetaArgs: null
Stages:
- BaseName: whatwedo/base:latest
  Commands:
  - CmdLine:
    - apt-get update -y
    Name: run
    PrependShell: true
  - Env:
    - Key: INNODB_BUFFER_POOL_SIZE
      Value: 128M
    Name: env
  - CmdLine:
    - "apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xcbcb082a1bb943db\r
      && add-apt-repository 'deb http://ams2.mirrors.digitalocean.com/mariadb/repo/10.1/ubuntu
      trusty main'\r && apt-get update\r && apt-get install -y mariadb-server\r &&
      sed -i 's/^\\(bind-address\\s.*\\)/# \\1/' /etc/mysql/my.cnf && sed -i 's/log_bin/#log_bin/g'
      /etc/mysql/my.cnf && sed -i 's/expire_logs_days/#expire_logs_days/g' /etc/mysql/my.cnf
      && sed -i 's/max_binlog_size/#max_binlog_size/g' /etc/mysql/my.cnf && sed -i
      's/#innodb_log_file_size.*/innodb_log_file_size\\=256M/g' /etc/mysql/my.cnf"
    Name: run
    PrependShell: true
  - CmdLine:
    - "echo \"mkdir -p /var/lib/mysql\" >> /bin/firstboot\r && echo \"chown -R mysql:mysql
      /var/lib/mysql\" >> /bin/firstboot\r && echo \"mysql_install_db --user=mysql
      --datadir=/var/lib/mysql --rpm\" >> /bin/firstboot\r && echo \"mysqld_safe &
      mysqladmin --silent --wait=30 ping || exit 1\" >> /bin/firstboot\r && echo 'echo
      \"DELETE FROM mysql.user;\" >> /root/mysql-first-time.sql' >> /bin/firstboot\r
      && echo 'echo \"CREATE USER \\\"root\\\"@\\\"%\\\" IDENTIFIED BY \\\"${MYSQL_ROOT_PASSWORD}\\\"
      ;\" >> /root/mysql-first-time.sql' >> /bin/firstboot\r && echo 'echo \"GRANT
      ALL PRIVILEGES ON *.* TO \\\"root\\\"@\\\"%\\\" WITH GRANT OPTION;\" >> /root/mysql-first-time.sql'
      >> /bin/firstboot\r && echo 'echo \"FLUSH PRIVILEGES;\" >> /root/mysql-first-time.sql'
      >> /bin/firstboot\r && echo 'echo \"DROP DATABASE IF EXISTS test;\" >> /root/mysql-first-time.sql'
      >> /bin/firstboot\r && echo 'if [ ! -z \"${MYSQL_DATABASE}\" ]; then echo \"CREATE
      DATABASE IF NOT EXISTS ${MYSQL_DATABASE};\" >> /root/mysql-first-time.sql; fi'
      >> /bin/firstboot\r && echo 'mysql < /root/mysql-first-time.sql' >> /bin/firstboot\r
      && echo 'rm /root/mysql-first-time.sql' >> /bin/firstboot\r && echo 'mysqladmin
      shutdown -uroot -p${MYSQL_ROOT_PASSWORD}' >> /bin/firstboot\r && echo 'if [
      ! -z \"${INNODB_BUFFER_POOL_SIZE}\" ]; then sed -i \"s/innodb_buffer_pool_size.*/innodb_buffer_pool_size
      = $INNODB_BUFFER_POOL_SIZE/g\" /etc/mysql/my.cnf; fi' >> /bin/everyboot"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/supervisord/mariadb.conf
    - /etc/supervisor/conf.d/mariadb.conf
  - CmdLine:
    - apt-get autoremove -y && apt-get clean -y && rm -rf /var/lib/apt/lists/* /tmp/*
      /var/tmp/*
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /var/lib/mysql
  - Name: expose
    Ports:
    - "3306"
  - Labels:
    - Key: ch.whatwedo.image.base
      Value: '"whatwedo/mariadb"'
    Name: label
  From:
    Image: whatwedo/base:latest
  Name: ""
  Platform: ""
  SourceCode: FROM whatwedo/base:latest
