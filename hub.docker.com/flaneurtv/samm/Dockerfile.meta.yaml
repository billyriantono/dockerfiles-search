MetaArgs: null
Stages:
- As: builder
  BaseName: golang:1.11
  Commands:
  - Env:
    - Key: TARGET_ADAPTER_NAME
      Value: samm
    Name: env
  - Env:
    - Key: TARGET_ADAPTER_PATH
      Value: /usr/local/bin/$TARGET_ADAPTER_NAME
    Name: env
  - Env:
    - Key: TARGET_BRIDGE_NAME
      Value: sammbridge
    Name: env
  - Env:
    - Key: TARGET_BRIDGE_PATH
      Value: /usr/local/bin/$TARGET_BRIDGE_NAME
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - src
    - /mqtt-adapter/src
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - examples/.
    - /srv/.
  - Name: workdir
    Path: /mqtt-adapter/src
  - CmdLine:
    - go test -cover ./...
    Name: run
    PrependShell: true
  - CmdLine:
    - GOOS=linux GOARCH=amd64 go build -ldflags "-linkmode external -extldflags -static"
      -o $TARGET_ADAPTER_PATH -a ./cmd/adapter
    Name: run
    PrependShell: true
  - CmdLine:
    - GOOS=linux GOARCH=amd64 go build -ldflags "-linkmode external -extldflags -static"
      -o $TARGET_BRIDGE_PATH -a ./cmd/bridge
    Name: run
    PrependShell: true
  From:
    Image: golang:1.11
  Name: builder
  Platform: ""
  SourceCode: FROM golang:1.11 as builder
- BaseName: alpine:3.8
  Commands:
  - Env:
    - Key: SERVICE_NAME
      Value: test-echo
    Name: env
  - Env:
    - Key: SERVICE_PROCESSOR
      Value: /srv/processor
    Name: env
  - Env:
    - Key: NAMESPACE_PUBLISHER
      Value: default
    Name: env
  - Env:
    - Key: NAMESPACE_LISTENER
      Value: default
    Name: env
  - Env:
    - Key: SUBSCRIPTIONS
      Value: /srv/subscriptions.txt
    Name: env
  - CmdLine:
    - apk add --no-cache bash jq gettext util-linux coreutils
    Name: run
    PrependShell: true
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/local/bin/samm
    - /usr/local/bin/samm
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/local/bin/sammbridge
    - /usr/local/bin/sammbridge
  - Name: workdir
    Path: /srv/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - examples/test-echo/.
    - /srv/.
  - CmdLine:
    - samm
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:3.8
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:3.8
