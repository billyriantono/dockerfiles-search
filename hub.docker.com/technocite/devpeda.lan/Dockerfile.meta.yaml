MetaArgs: null
Stages:
- BaseName: debian:stable
  Commands:
  - CmdLine:
    - echo "postfix postfix/mailname string dev.pedagogique.lan" | debconf-set-selections
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "postfix postfix/main_mailer_type string 'Internet Site'" | debconf-set-selections
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "mysql-server mysql-server/root_password password tttttt" | debconf-set-selections
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "mysql-server mysql-server/root_password_again password tttttt" | debconf-set-selections
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y update && apt-get install -y apt-utils apache2 debconf-utils expect
      php php-mysql mariadb-server nano postfix samba
    Name: run
    PrependShell: true
  - CmdLine:
    - service apache2 start
    Name: run
    PrependShell: true
  - CmdLine:
    - service mysql start
    Name: run
    PrependShell: true
  - CmdLine:
    - mysqld &         service apache2 start;         sleep 5;         sleep 10;         mysqladmin
      -u root shutdown
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "/etc/init.d/apache2 restart" >> /etc/bash.bashrc
    Name: run
    PrependShell: true
  - CmdLine:
    - postconf -e relayhost=[smtp.technocite.be]
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./etc/aliases
    - /etc/aliases
  - CmdLine:
    - newaliases
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./etc/apache2/sites-available/dev.pedagogique.lan.conf
    - /etc/apache2/sites-available/dev.pedagogique.lan.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./etc/apache2/sites-available/virtu.conf
    - /etc/apache2/sites-available/virtu.conf
  - CmdLine:
    - a2ensite dev.peda*
    Name: run
    PrependShell: true
  - CmdLine:
    - a2ensite virtu
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /var/log/apache2/virtu
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod rewrite vhost_alias
    Name: run
    PrependShell: true
  - CmdLine:
    - a2dissite 000-default
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /var/www/www
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./var/www/www
    - /var/www/www/
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./var/www/index.php
    - /var/www/index.php
  - CmdLine:
    - chown -R www-data:www-data /var/www
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./etc/samba/smb.conf
    - /etc/samba/smb.conf
  - CmdLine:
    - service smbd restart
    Name: run
    PrependShell: true
  - CmdLine:
    - service nmbd restart
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "service smbd restart" >> /etc/bash.bashrc
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "service nmbd restart" >> /etc/bash.bashrc
    Name: run
    PrependShell: true
  From:
    Image: debian:stable
  Name: ""
  Platform: ""
  SourceCode: FROM debian:stable
