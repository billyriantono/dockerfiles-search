MetaArgs: null
Stages:
- BaseName: ausvet/shinypy
  Commands:
  - Env:
    - Key: APPLICATION_LOGS_TO_STDOUT
      Value: "true"
    Name: env
  - Env:
    - Key: LOCAL_DATA_PATH
      Value: '"/srv/data"'
    Name: env
  - Env:
    - Key: R_DATA_FOLDER
      Value: '"/RData"'
    Name: env
  - Env:
    - Key: default_remote_path
      Value: '"/Shared/Divisions/AnimalHealth/FVG/Global/Fishvet_Dashboard/Scotland/dashboard_files"'
    Name: env
  - Env:
    - Key: default_domain
      Value: '"bmk.egnyte.com"'
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./src/installpackages.r
    - /srv/installpackages.r
  - CmdLine:
    - Rscript /srv/installpackages.r
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y nginx
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./proxy.nginx
    - /etc/nginx/sites-available/default
  - CmdLine:
    - ln -sf /dev/stdout /var/log/nginx/access.log     && ln -sf /dev/stderr /var/log/nginx/error.log
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./Pipfile
    - /srv/Pipfile
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./Pipfile.lock
    - /srv/Pipfile.lock
  - Name: workdir
    Path: /srv
  - CmdLine:
    - pipenv install
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./sync
    - /srv/sync
  - CmdLine:
    - mkdir $LOCAL_DATA_PATH
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod -R 777 $LOCAL_DATA_PATH
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - $LOCAL_DATA_PATH
  - CmdLine:
    - rm -R /srv/shiny-server/*
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - src/.
    - /srv/shiny-server/
  - CmdLine:
    - chown -R shiny:shiny /srv/shiny-server
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./docker_entrypoint.sh
    - /srv/docker_entrypoint.sh
  - CmdLine:
    - chmod +x /srv/docker_entrypoint.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /srv/docker_entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /usr/bin/shiny-server.sh
    Name: cmd
    PrependShell: false
  From:
    Image: ausvet/shinypy
  Name: ""
  Platform: ""
  SourceCode: FROM ausvet/shinypy
