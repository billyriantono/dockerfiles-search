MetaArgs: null
Stages:
- BaseName: leadware/oracle-java8:latest
  Commands:
  - Maintainer: Jean-Jacques ETUNÃˆ NGI<jetune@leadware.net>
    Name: maintainer
  - Key: JIRA_VERSION
    Name: arg
    Value: 7.6.1
  - Key: JIRA_INSTALL
    Name: arg
    Value: /opt/atlassian/jira
  - Key: JIRA_HOME
    Name: arg
    Value: /var/atlassian/jira
  - Key: LW_CUSTOM_DATA_HOME
    Name: arg
    Value: /var/leadware/jira
  - Key: JIRA_USER
    Name: arg
    Value: '"jira"'
  - Key: JIRA_GROUP
    Name: arg
    Value: '"jira"'
  - Key: MYSQL_VERSION
    Name: arg
    Value: 5.1.45
  - Key: POSTGRES_JDBC_DRIVER_VERSION
    Name: arg
    Value: 42.1.4
  - Chown: ""
    Name: add
    SourcesAndDest:
    - entrypoint.sh
    - /leadware-entrypoint.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - dbconfig-mysql.xml
    - /dbconfig-mysql.xml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - dbconfig-postgres.xml
    - /dbconfig-postgres.xml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - server.xml
    - /server.xml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - secured-server.xml
    - /secured-server.xml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - secured-web.xml
    - /secured-web.xml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - setenv.sh
    - /setenv.sh
  - CmdLine:
    - "apt-get update -y && \tapt-get install -y curl && \tmkdir -p ${LW_CUSTOM_DATA_HOME}
      ${JIRA_INSTALL} \"${JIRA_HOME}\" \"${JIRA_HOME}/caches/indexes\" \"$LW_CUSTOM_DATA_HOME/ssl\"
      && \tmv /dbconfig-postgres.xml /dbconfig-mysql.xml /server.xml /secured-server.xml
      /secured-web.xml  $LW_CUSTOM_DATA_HOME && \tcurl -Ls \"https://product-downloads.atlassian.com/software/jira/downloads/atlassian-jira-software-${JIRA_VERSION}.tar.gz\"
      | tar -xz --directory \"${JIRA_INSTALL}\" --strip-components=1 --no-same-owner
      && \techo -e \"\\njira.home=$JIRA_HOME\" >> \"${JIRA_INSTALL}/atlassian-jira/WEB-INF/classes/jira-application.properties\"
      && \tcurl -Ls http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-${MYSQL_VERSION}.tar.gz
      | tar  xz --directory \"${JIRA_INSTALL}/lib\" --strip-components=1 --no-same-owner
      \"mysql-connector-java-${MYSQL_VERSION}/mysql-connector-java-${MYSQL_VERSION}-bin.jar\"
      && \trm -Rf mysql-connector-java-${MYSQL_VERSION}.tar.gz && \twget -O ${JIRA_INSTALL}/lib/postgresql-${POSTGRES_JDBC_DRIVER_VERSION}.jar
      https://jdbc.postgresql.org/download/postgresql-${POSTGRES_JDBC_DRIVER_VERSION}.jar
      && \tmv /setenv.sh  $JIRA_INSTALL/bin && \tgroupadd ${JIRA_GROUP} && \tuseradd
      --create-home --comment \"Account for running JIRA Software\" -g ${JIRA_GROUP}
      --shell /bin/bash ${JIRA_USER} && \tchown -R ${JIRA_USER} ${JIRA_INSTALL} &&
      \tchmod -R u=rwx,go-rwx ${JIRA_INSTALL} && \tchown -R ${JIRA_USER} ${JIRA_HOME}
      && \tchmod -R u=rwx,go-rwx ${JIRA_HOME} && \tchmod 755 /leadware-entrypoint.sh"
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "443"
    - "80"
    - "8080"
    - "8443"
  - Env:
    - Key: JIRA_INSTALL
      Value: $JIRA_INSTALL
    Name: env
  - Env:
    - Key: LW_CUSTOM_DATA_HOME
      Value: $LW_CUSTOM_DATA_HOME
    Name: env
  - Env:
    - Key: LW_CUSTOM_DATA_SSL_HOME
      Value: $LW_CUSTOM_DATA_HOME/ssl
    Name: env
  - Env:
    - Key: JIRA_CONF_DIR
      Value: $JIRA_INSTALL/conf
    Name: env
  - Env:
    - Key: JIRA_HOME
      Value: $JIRA_HOME
    Name: env
  - Name: workdir
    Path: $JIRA_HOME
  - Name: volume
    Volumes:
    - /var/atlassian/jira
    - /opt/atlassian/jira/logs
    - /var/leadware/jira/ssl
  - CmdLine:
    - /leadware-entrypoint.sh
    Name: cmd
    PrependShell: false
  From:
    Image: leadware/oracle-java8:latest
  Name: ""
  Platform: ""
  SourceCode: FROM leadware/oracle-java8:latest
