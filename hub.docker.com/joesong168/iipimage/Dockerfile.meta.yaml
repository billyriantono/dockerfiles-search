MetaArgs: null
Stages:
- BaseName: httpd:latest
  Commands:
  - Env:
    - Key: OPENJPG_VERSION
      Value: 2.3.0
    Name: env
  - Env:
    - Key: IIP_VERSION
      Value: "1.1"
    Name: env
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y wget build-essential autoconf cmake libtool gawk gawk g++
      libjpeg62-turbo libjpeg62-turbo-dev libtiff-dev libmemcached-dev memcached pkg-config
      libapache2-mod-fcgid
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/www/images
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/local/apache2/htdocs/ /var/www/html
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /etc/httpd
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /usr/local/apache2/conf.d
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/local/apache2/conf /etc/httpd/conf
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/local/apache2/conf.d /etc/httpd/conf.d
    Name: run
    PrependShell: true
  - CmdLine:
    - cat /etc/apache2/mods-available/fcgid.load >> /etc/httpd/conf/httpd.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "Include conf.d/*" >> /etc/httpd/conf/httpd.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - iip.conf
    - /etc/httpd/conf.d
  - CmdLine:
    - mkdir /usr/local/apache2/fcgi-bin
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R daemon /var/lib/apache2
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/local/src
  - CmdLine:
    - wget -c https://github.com/uclouvain/openjpeg/archive/v$OPENJPG_VERSION.tar.gz
      -O openjpeg-$OPENJPG_VERSION.tar.gz      && tar -zxvf openjpeg-$OPENJPG_VERSION.tar.gz      &&
      cd openjpeg-$OPENJPG_VERSION      && mkdir -v build      && cd build      &&
      cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr ..      && make      &&
      make install
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/local/src
  - CmdLine:
    - wget 'https://github.com/ruven/iipsrv/archive/iipsrv-1.1.tar.gz'
    Name: run
    PrependShell: true
  - CmdLine:
    - tar zxvf iipsrv-1.1.tar.gz
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/local/src/iipsrv-iipsrv-1.1
  - CmdLine:
    - export USE_OPENJPEG=1
    Name: run
    PrependShell: true
  - CmdLine:
    - ./autogen.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - ./configure
    Name: run
    PrependShell: true
  - CmdLine:
    - make && make check && make install
    Name: run
    PrependShell: true
  - CmdLine:
    - cp src/iipsrv.fcgi /usr/local/apache2/fcgi-bin
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - images/*
    - /var/www/images/
  From:
    Image: httpd:latest
  Name: ""
  Platform: ""
  SourceCode: FROM httpd:latest
