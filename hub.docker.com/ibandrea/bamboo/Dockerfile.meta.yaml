MetaArgs: null
Stages:
- BaseName: ibandrea/jdk-oracle:8u121
  Commands:
  - Maintainer: Andrea Lorenzetti <andrea@ibuildings.it>
    Name: maintainer
  - Env:
    - Key: BAMBOO_VERSION
      Value: 5.15.2
    Name: env
  - Env:
    - Key: MYSQL_CONNECTOR_JAVA_VERSION
      Value: 5.1.40
    Name: env
  - Env:
    - Key: BAMBOO_HOME
      Value: /var/local/atlassian/bamboo
    Name: env
  - Env:
    - Key: BAMBOO_INSTALL
      Value: /usr/local/atlassian/bamboo
    Name: env
  - Env:
    - Key: BAMBOO_USER
      Value: bamboo
    Name: env
  - Env:
    - Key: BAMBOO_INSTALLER
      Value: atlassian-bamboo-$BAMBOO_VERSION.tar.gz
    Name: env
  - CmdLine:
    - "deps=\" \tlibtcnative-1 libapr1 libaprutil1 \txmlstarlet \twget \t\" \tset
      -x &&     export DEBIAN_FRONTEND=noninteractive && \tapt-get update && \tapt-get
      upgrade -y $deps --no-install-recommends && \t\tuseradd --create-home --shell
      /bin/bash $BAMBOO_USER && \t\tcd /tmp && \twget --no-check-certificate http://www.atlassian.com/software/bamboo/downloads/binary/$BAMBOO_INSTALLER
      && \tmkdir -p $BAMBOO_INSTALL && \ttar zxf $BAMBOO_INSTALLER --strip=1 -C $BAMBOO_INSTALL
      && \tmkdir -p $BAMBOO_HOME && \techo -e \"\\nbamboo.home=$BAMBOO_HOME\" >> \"$BAMBOO_INSTALL/atlassian-bamboo/WEB-INF/classes/bamboo-init.properties\"
      && \t\twget --no-check-certificate http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-$MYSQL_CONNECTOR_JAVA_VERSION.tar.gz
      && \ttar xzf mysql-connector-java-$MYSQL_CONNECTOR_JAVA_VERSION.tar.gz -C /tmp
      && \tcp /tmp/mysql-connector-java-$MYSQL_CONNECTOR_JAVA_VERSION/mysql-connector-java-$MYSQL_CONNECTOR_JAVA_VERSION-bin.jar
      $BAMBOO_INSTALL/lib/ && \t\tchown -R $BAMBOO_USER:$BAMBOO_USER $BAMBOO_HOME
      && \tchown -R $BAMBOO_USER:$BAMBOO_USER $BAMBOO_INSTALL && \t\tapt-get clean
      && \trm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*"
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /var/local/atlassian/bamboo
  - Name: expose
    Ports:
    - "8085"
  - Name: expose
    Ports:
    - "54663"
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker-entrypoint.sh
    - /docker-entrypoint.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - start-bamboo.sh
    - /start-bamboo.sh
  - CmdLine:
    - /docker-entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /start-bamboo.sh
    Name: cmd
    PrependShell: false
  From:
    Image: ibandrea/jdk-oracle:8u121
  Name: ""
  Platform: ""
  SourceCode: FROM ibandrea/jdk-oracle:8u121
