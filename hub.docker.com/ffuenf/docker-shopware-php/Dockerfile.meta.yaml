MetaArgs: null
Stages:
- BaseName: php:7.3-apache
  Commands:
  - Maintainer: Achim Rosenhagen <a.rosenhagen@ffuenf.de>
    Name: maintainer
  - CmdLine:
    - apt-get update -qq && apt-get install -y -qq     build-essential     libicu-dev     libfreetype6-dev     libjpeg62-turbo-dev     libwebp-dev     libxpm-dev     libpng-dev     libcurl4-openssl-dev     software-properties-common     curl     git     libzip-dev     libzip4     zip     unzip     inotify-tools     apt-utils     msmtp     libxml2-dev     libxslt1-dev     zlib1g-dev     git     default-mysql-client     sshpass     gnupg     nano     sudo     vim     rsync     jpegoptim     optipng
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/
      --with-webp-dir=/usr/include/     && docker-php-ext-install gd     && docker-php-ext-install
      opcache     && docker-php-ext-install zip     && docker-php-ext-install intl     &&
      docker-php-ext-install pdo_mysql     && docker-php-ext-install soap     && docker-php-ext-install
      bcmath     && docker-php-ext-install sockets     && docker-php-ext-install calendar     &&
      docker-php-ext-configure calendar
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install apcu
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "extension=apcu.so" > /usr/local/etc/php/conf.d/apcu.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install redis     && docker-php-ext-enable redis
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update && apt-get install -y -qq     git libmagick++-dev     --no-install-recommends
      && rm -r /var/lib/apt/lists/* &&     git clone https://github.com/mkoppanen/imagick.git
      &&     cd imagick && phpize && ./configure &&     make && make install &&     docker-php-ext-enable
      imagick &&     cd ../ && rm -rf imagick
    Name: run
    PrependShell: true
  - CmdLine:
    - 'echo "account mailcatcher\nhost localhost\nport 1025\nauto_from on\naccount
      default: mailcatcher" > /etc/msmtprc'
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - server-apache2-vhosts.conf
    - /etc/apache2/sites-enabled/000-default.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - server-apache2-run-as.conf
    - /etc/apache2/conf-available
  - CmdLine:
    - ln -s /etc/apache2/conf-available/server-apache2-run-as.conf /etc/apache2/conf-enabled
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - php-config.ini
    - /usr/local/etc/php/conf.d/php-config.ini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - timezone.ini
    - /usr/local/etc/php/conf.d/timezone.ini
  - CmdLine:
    - a2enmod rewrite
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod headers
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod expires
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod negotiation
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod autoindex
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod deflate
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod alias
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - wait.sh
    - /tmp/wait.sh
  - CmdLine:
    - chmod +x /tmp/wait.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - run-container.sh
    - /run-container.sh
  - CmdLine:
    - chmod +x /run-container.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    Name: run
    PrependShell: true
  - CmdLine:
    - php composer-setup.php --install-dir=/usr/local/bin/ --filename=composer
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "unlink('composer-setup.php');"
    Name: run
    PrependShell: true
  - CmdLine:
    - /run-container.sh
    Name: cmd
    PrependShell: true
  From:
    Image: php:7.3-apache
  Name: ""
  Platform: ""
  SourceCode: FROM php:7.3-apache
