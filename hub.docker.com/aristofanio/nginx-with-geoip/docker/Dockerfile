#===+====1====+====2====+====3====+====4====+====5====+====6====+====7====+====8====+====9====+====0
# nginx環境構築
#===+====1====+====2====+====3====+====4====+====5====+====6====+====7====+====8====+====9====+====0
FROM nginx:1.17-alpine

#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
# 設定ファイルの配置
#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
COPY nginx.conf /etc/nginx/nginx.conf

#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
# 動作用の環境調整
#
# ・インストール済みパッケージ最新化
# ・ライブラリインストール
# ・www-data ユーザの作成
# ・アプリケーションルートの作成
#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
RUN set -xe \
    # ユーザの作成
    && adduser -u 82 -D -S -G www-data www-data \
    # タイムゾーン設定
    && apk add --update-cache --no-cache tzdata \
    && cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime \
    && echo "Asia/Tokyo" > /etc/timezone \
    && apk del --no-network tzdata

#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
# 停止時のシグナルをSIGTERMとする
#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
STOPSIGNAL SIGTERM

#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
# TCP/80 ポートを外部公開
#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
EXPOSE 80

#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
# nginxの実行
#---+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8----+----9----+----0
CMD ["nginx", "-g", "daemon off;"]
