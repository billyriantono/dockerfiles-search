MetaArgs: null
Stages:
- BaseName: ubuntu:xenial
  Commands:
  - Maintainer: Andrey Antukh <niwi@niwi.nz>
    Name: maintainer
  - CmdLine:
    - apt-get update &&     apt-get install -yq locales ca-certificates wget &&     rm
      -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "en_US.UTF-8 UTF-8" > /etc/locale.gen
    Name: run
    PrependShell: true
  - CmdLine:
    - locale-gen && update-locale LANG=en_US.UTF-8 LC_ALL=C.UTF-8
    Name: run
    PrependShell: true
  - Env:
    - Key: LANG
      Value: en_US.UTF-8
    Name: env
  - Env:
    - Key: LC_ALL
      Value: C.UTF-8
    Name: env
  - CmdLine:
    - echo "deb http://apt.postgresql.org/pub/repos/apt/ xenial-pgdg main" >> /etc/apt/sources.list
    Name: run
    PrependShell: true
  - CmdLine:
    - wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key
      add -
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update -yq &&      apt-get install -yq bash git tmux vim openjdk-8-jdk
      rlwrap build-essential                         postgresql-9.6 postgresql-contrib-9.6
      imagemagick webp                         sudo
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /etc/resolvconf/resolv.conf.d
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "nameserver 8.8.8.8" > /etc/resolvconf/resolv.conf.d/tail
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd -m -g users -s /bin/bash uxbox
    Name: run
    PrependShell: true
  - CmdLine:
    - passwd uxbox -d
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "uxbox ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/pg_hba.conf
    - /etc/postgresql/9.6/main/pg_hba.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/bashrc
    - /root/.bashrc
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/vimrc
    - /root/.vimrc
  - CmdLine:
    - /etc/init.d/postgresql start     && createuser -U postgres -sl uxbox     &&
      createdb -U uxbox uxbox     && createdb -U uxbox test     && /etc/init.d/postgresql
      stop
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update -yq &&     apt-get install -yq libbz2-dev liblzma-dev zlib1g-dev
      libfftw3-dev                         libfreetype6-dev libfontconfig1-dev libxt-dev                         libexif-dev
      libjpeg-dev libpng-dev libtiff-dev                         libwmf-dev libpango1.0-dev
      librsvg2-bin librsvg2-dev                         libxml2-dev libwebp-dev webp
      autoconf
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://github.com/ImageMagick/ImageMagick.git imagemagick &&     cd
      imagemagick &&     git checkout -f 7.0.5-0 &&     ./configure --prefix=/opt/img
      &&     make -j2 &&     make install &&     cd .. &&     rm -rf ./imagemagick
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "3449"
  - Name: expose
    Ports:
    - "6060"
  - Name: expose
    Ports:
    - "9090"
  - Name: user
    User: uxbox
  - Name: workdir
    Path: /home/uxbox
  - CmdLine:
    - git clone https://github.com/creationix/nvm.git .nvm
    Name: run
    PrependShell: true
  - CmdLine:
    - bash -c "source .nvm/nvm.sh && nvm install v7.7.1"
    Name: run
    PrependShell: true
  - CmdLine:
    - bash -c "source .nvm/nvm.sh && nvm alias default v7.7.1"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/lein
    - /home/uxbox/.local/bin/lein
  - CmdLine:
    - bash -c "/home/uxbox/.local/bin/lein version"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/bashrc
    - /home/uxbox/.bashrc
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/vimrc
    - /home/uxbox/.vimrc
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/start.sh
    - /home/uxbox/.start.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/tmux.conf
    - /home/uxbox/.tmux.conf
  - CmdLine:
    - /home/uxbox/.start.sh
    Name: cmd
    PrependShell: true
  From:
    Image: ubuntu:xenial
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:xenial
