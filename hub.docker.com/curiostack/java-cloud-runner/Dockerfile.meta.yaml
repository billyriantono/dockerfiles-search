MetaArgs: null
Stages:
- As: jre
  BaseName: azul/zulu-openjdk-debian:13
  Commands:
  - CmdLine:
    - apt-get -y update && apt-get -y install binutils
    Name: run
    PrependShell: true
  - CmdLine:
    - cd / && jlink --no-header-files --no-man-pages --compress=2 --strip-debug     --add-modules
      java.base     --add-modules java.desktop     --add-modules java.instrument     --add-modules
      java.logging     --add-modules java.management     --add-modules java.management.rmi     --add-modules
      java.naming     --add-modules java.sql     --add-modules java.sql.rowset     --add-modules
      jdk.crypto.ec     --add-modules jdk.naming.dns     --add-modules jdk.unsupported     --output
      jre
    Name: run
    PrependShell: true
  From:
    Image: azul/zulu-openjdk-debian:13
  Name: jre
  Platform: ""
  SourceCode: FROM azul/zulu-openjdk-debian:13 AS jre
- As: debian
  BaseName: debian:stretch-backports
  Commands:
  - CmdLine:
    - apt-get -y update && apt-get -y install ca-certificates-java
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://storage.googleapis.com/cloud-profiler/java/latest/profiler_java_agent.tar.gz
    - /tmp/gcloud/profiler_java_agent.tar.gz
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://github.com/GoogleCloudPlatform/cloud-debug-java/releases/download/v2.21/cdbg_java_agent_service_account.tar.gz
    - /tmp/gcloud/cdbg_java_agent_service_account.tar.gz
  - CmdLine:
    - mkdir /opt/cprof &&   tar -xzf /tmp/gcloud/profiler_java_agent.tar.gz -C /opt/cprof
      &&   mkdir /opt/cdbg &&   tar -xzf /tmp/gcloud/cdbg_java_agent_service_account.tar.gz
      -C /opt/cdbg &&   keytool -importkeystore -srckeystore /etc/ssl/certs/java/cacerts
      -destkeystore /etc/ssl/certs/java/cacerts.jks -deststoretype JKS -srcstorepass
      changeit -deststorepass changeit -noprompt &&   mv /etc/ssl/certs/java/cacerts.jks
      /etc/ssl/certs/java/cacerts &&   /var/lib/dpkg/info/ca-certificates-java.postinst
      configure
    Name: run
    PrependShell: true
  From:
    Image: debian:stretch-backports
  Name: debian
  Platform: ""
  SourceCode: FROM debian:stretch-backports AS debian
- BaseName: gcr.io/distroless/cc:debug
  Commands:
  - Chown: ""
    From: debian
    Name: copy
    SourcesAndDest:
    - /etc/ssl/certs/java/
    - /etc/ssl/certs/java/
  - Chown: ""
    From: debian
    Name: copy
    SourcesAndDest:
    - /lib/x86_64-linux-gnu/libz.so.1.2.8
    - /lib/x86_64-linux-gnu/libz.so.1.2.8
  - CmdLine:
    - /busybox/sh
    - -c
    - ln -s /lib/x86_64-linux-gnu/libz.so.1.2.8 /lib/x86_64-linux-gnu/libz.so.1
    Name: run
    PrependShell: false
  - Chown: ""
    From: jre
    Name: copy
    SourcesAndDest:
    - /jre
    - /usr/lib/jvm/java-13-zulu-amd64-slim
  - CmdLine:
    - /busybox/sh
    - -c
    - ln -s /usr/lib/jvm/java-13-zulu-amd64-slim/bin/java /usr/bin/java
    Name: run
    PrependShell: false
  - Chown: ""
    From: debian
    Name: copy
    SourcesAndDest:
    - /opt/cprof
    - /opt/cprof
  - Chown: ""
    From: debian
    Name: copy
    SourcesAndDest:
    - /opt/cdbg
    - /opt/cdbg
  - CmdLine:
    - /usr/bin/java
    - -jar
    Name: entrypoint
    PrependShell: false
  From:
    Image: gcr.io/distroless/cc:debug
  Name: ""
  Platform: ""
  SourceCode: FROM gcr.io/distroless/cc:debug
