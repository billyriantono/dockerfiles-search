MetaArgs: null
Stages:
- BaseName: alpine:3.9
  Commands:
  - Key: VER
    Name: arg
    Value: master
  - CmdLine:
    - apk add --update nginx s6 php7-fpm php7-cli php7-curl php7-gd php7-json php7-dom
      php7-pcntl php7-posix php7-intl php7-session php7-opcache   php7-pgsql php7-mysqli
      php7-mcrypt php7-pdo php7-pdo_pgsql php7-pdo_mysql php7-mbstring php7-fileinfo
      ca-certificates &&   rm -rf /var/cache/apk/*
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ttrss.nginx.conf
    - /etc/nginx/nginx.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://github.com/dasmurphy/tinytinyrss-fever-plugin/archive/master.tar.gz
    - /var/www/plugins/
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://github.com/levito/tt-rss-feedly-theme/archive/master.tar.gz
    - /var/www/themes/
  - Name: workdir
    Path: /var/www
  - CmdLine:
    - apk add --update --virtual build-dependencies curl tar     && curl -SL https://git.tt-rss.org/git/tt-rss/archive/${VER}.tar.gz
      | tar xzC /var/www --strip-components 1     && tar xzvpf /var/www/plugins/master.tar.gz
      --strip-components=1 -C /var/www/plugins/ tinytinyrss-fever-plugin-master/fever
      && rm /var/www/plugins/master.tar.gz     && tar xzvpf /var/www/themes/master.tar.gz
      --strip-components=1 -C /var/www/themes/ tt-rss-feedly-theme-master/feedly tt-rss-feedly-theme-master/feedly.css
      && rm /var/www/themes/master.tar.gz     && apk del build-dependencies     &&
      rm -rf /var/cache/apk/*     && cp config.php-dist config.php     && chown nobody:nginx
      -R /var/www
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - Env:
    - Key: SELF_URL_PATH
      Value: http://localhost
    Name: env
  - Env:
    - Key: DB_NAME
      Value: ttrss
    Name: env
  - Env:
    - Key: DB_USER
      Value: ttrss
    Name: env
  - Env:
    - Key: DB_PASS
      Value: ttrss
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - configure-db.php
    - /configure-db.php
  - Chown: ""
    Name: add
    SourcesAndDest:
    - s6/
    - /etc/s6/
  - CmdLine:
    - php7 /configure-db.php && exec s6-svscan /etc/s6/
    Name: cmd
    PrependShell: true
  From:
    Image: alpine:3.9
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:3.9
