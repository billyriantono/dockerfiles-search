MetaArgs: null
Stages:
- BaseName: debian:jessie
  Commands:
  - Maintainer: Smart Pension <dev@smartpension.co.uk>
    Name: maintainer
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - Env:
    - Key: DEBIAN_BASE_PACKAGES
      Value: build-essential autoconf locales ca-certificates locales apt-utils       libyaml-dev  libxml2-dev
        libssl-dev libreadline-dev zlib1g zlib1g-dev       libevent-dev libsqlite3-dev
        libxslt1-dev libxml2-dev libfontconfig1-dev libnss3-dev libgconf2-dev       wget
        vim git netcat sudo curl zip       libmysqlclient-dev mysql-client wkhtmltopdf
        imagemagick file       gnupg apt-transport-https ca-certificates software-properties-common       groff
        python-dev python-pip       qt5-default libqt5webkit5-dev gstreamer1.0-plugins-base
        gstreamer1.0-tools gstreamer1.0-x xvfb
    Name: env
  - CmdLine:
    - echo 'deb http://httpredir.debian.org/debian jessie-backports main contrib non-free'
      >> /etc/apt/sources.list
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update && apt-get upgrade --assume-yes && apt-get dist-upgrade --assume-yes
      &&     (apt-get install --assume-yes $DEBIAN_BASE_PACKAGES || apt-get update
      --fix-missing) &&     (apt-get install --assume-yes $DEBIAN_BASE_PACKAGES ||
      echo "no need to install") &&    apt-get autoremove && apt-get autoclean &&
      apt-get clean
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "en_GB.UTF-8 UTF-8\nen_US.UTF-8 UTF-8" > /etc/locale.gen && locale-gen
      && dpkg-reconfigure -f noninteractive locales &&     echo "LANG=en_GB.UTF-8"
      > /etc/default/locale &&     echo "Europe/London" > /etc/timezone && dpkg-reconfigure
      -f noninteractive tzdata
    Name: run
    PrependShell: true
  - Env:
    - Key: LANG
      Value: en_GB.UTF-8
    Name: env
  - CmdLine:
    - curl -fsSL https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add
      -     && add-apt-repository "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/
      stable main"     && apt-get -y -qq update     && apt-get install --assume-yes
      google-chrome-stable
    Name: run
    PrependShell: true
  - Env:
    - Key: CHROMEDRIVER_VERSION
      Value: "2.29"
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - http://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip
    - /usr/local/bin/
  - CmdLine:
    - cd /usr/local/bin/     && unzip chromedriver_linux64.zip     && rm chromedriver_linux64.zip     &&
      cd -
    Name: run
    PrependShell: true
  - Env:
    - Key: NONROOTUSER
      Value: containeruser
    Name: env
  - Env:
    - Key: NONROOTHOME
      Value: /home/$NONROOTUSER
    Name: env
  - CmdLine:
    - adduser --disabled-password --gecos --create-home --home $NONROOTHOME --shell
      /bin/bash $NONROOTUSER
    Name: run
    PrependShell: true
  - CmdLine:
    - 'echo "root ALL=(ALL:ALL) ALL \n $NONROOTUSER ALL=(ALL) NOPASSWD: ALL"  >> /tmp/sudoers.new'
    Name: run
    PrependShell: true
  - CmdLine:
    - sudo EDITOR="cp /tmp/sudoers.new" visudo
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -     &&
      apt-key fingerprint 0EBFCD88     && add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/debian
      $(lsb_release -cs) stable"     && apt-get -y -qq update     && apt-get -y -qq
      install docker-ce
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install awscli
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install diff_cover
    Name: run
    PrependShell: true
  - Env:
    - Key: RUBYINSTALL_VERSION
      Value: 0.6.1
    Name: env
  - CmdLine:
    - wget -O ruby-install-$RUBYINSTALL_VERSION.tar.gz https://github.com/postmodern/ruby-install/archive/v$RUBYINSTALL_VERSION.tar.gz
      &&    tar -xzvf ruby-install-$RUBYINSTALL_VERSION.tar.gz &&    rm ruby-install-$RUBYINSTALL_VERSION.tar.gz
      &&    cd ruby-install-$RUBYINSTALL_VERSION/ &&    make install &&    cd /
    Name: run
    PrependShell: true
  - Env:
    - Key: NVM_VERSION
      Value: 0.33.1
    Name: env
  - Env:
    - Key: NVM_DIR
      Value: /usr/local/nvm
    Name: env
  - CmdLine:
    - wget -O nvm-$NVM_VERSION.tar.gz https://github.com/creationix/nvm/archive/v$NVM_VERSION.tar.gz
      &&    tar -xzvf nvm-$NVM_VERSION.tar.gz &&    rm nvm-$NVM_VERSION.tar.gz &&    cp
      -a ./nvm-$NVM_VERSION /opt/nvm &&    mkdir -m 777 /usr/local/nvm &&    mkdir
      -m 777 /usr/local/node
    Name: run
    PrependShell: true
  - Name: user
    User: $NONROOTUSER
  - Env:
    - Key: NODE_VERSION
      Value: 6.10.0
    Name: env
  - CmdLine:
    - bash -c 'source /opt/nvm/nvm.sh     && nvm install $NODE_VERSION     && nvm
      alias default $NODE_VERSION     && nvm use default '
    Name: run
    PrependShell: true
  - Env:
    - Key: PATH
      Value: $NVM_DIR/versions/node/v$NODE_VERSION/bin:$PATH
    Name: env
  - CmdLine:
    - npm install yarn --global
    Name: run
    PrependShell: true
  - Env:
    - Key: RUBYVERSION
      Value: 2.3.4
    Name: env
  - CmdLine:
    - ruby-install ruby $RUBYVERSION     && rm -rf $NONROOTHOME/src/ruby-$RUBYVERSION
    Name: run
    PrependShell: true
  - Env:
    - Key: RUBYBINPATH
      Value: $NONROOTHOME/.rubies/ruby-$RUBYVERSION/bin
    Name: env
  - Env:
    - Key: PATH
      Value: $RUBYBINPATH:$PATH
    Name: env
  - CmdLine:
    - 'echo ''gem: --no-rdoc --no-ri'' > $NONROOTHOME/.gemrc     && gem update --system     &&
      gem install bundler'
    Name: run
    PrependShell: true
  From:
    Image: debian:jessie
  Name: ""
  Platform: ""
  SourceCode: FROM debian:jessie
