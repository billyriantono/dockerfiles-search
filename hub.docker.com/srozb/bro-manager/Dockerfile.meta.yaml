MetaArgs: null
Stages:
- BaseName: phusion/baseimage:0.9.18
  Commands:
  - Maintainer: Slawomir Rozbicki <docker@rozbicki.eu>
    Name: maintainer
  - Env:
    - Key: PROG
      Value: bro
    Name: env
  - Env:
    - Key: PF_PROG
      Value: PF_RING
    Name: env
  - Env:
    - Key: EXT
      Value: tar.gz
    Name: env
  - Env:
    - Key: BRO_VERS
      Value: 2.4.1
    Name: env
  - Env:
    - Key: PREFIX
      Value: /opt/bro
    Name: env
  - Env:
    - Key: PF_PREFIX
      Value: /opt/PF_RING
    Name: env
  - Env:
    - Key: CAF_PREFIX
      Value: /opt/caf
    Name: env
  - Env:
    - Key: PATH
      Value: /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:$PREFIX/bin
    Name: env
  - Env:
    - Key: STOR_PATH
      Value: /data/bro
    Name: env
  - CmdLine:
    - apt-get update -y && apt-get install --no-install-recommends -y google-perftools
      libtcmalloc-minimal4 libgoogle-perftools4 geoip-bin geoip-database rsync ssmtp
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install --no-install-recommends -y libgoogle-perftools-dev libgeoip-dev
      cmake gcc g++ bison flex python-dev swig make libssl-dev git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src
  - CmdLine:
    - git clone https://github.com/ntop/PF_RING.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src/$PF_PROG/userland/lib
  - CmdLine:
    - ./configure && make
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src/$PF_PROG/userland/libpcap
  - CmdLine:
    - ./configure --prefix=$PF_PREFIX && make && make install
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src
  - CmdLine:
    - git clone https://github.com/actor-framework/actor-framework.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src/actor-framework
  - CmdLine:
    - ./configure --prefix=$CAF_PREFIX && make && make install
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src
  - CmdLine:
    - curl --insecure -O https://www.bro.org/downloads/release/$PROG-$BRO_VERS.$EXT
      && tar -xzf $PROG-$BRO_VERS.$EXT
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src/$PROG-$BRO_VERS
  - CmdLine:
    - ./configure --prefix=$PREFIX --with-pcap=$PF_PREFIX --with-libcaf=$CAF_PREFIX
      && make && make install && make install-aux
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - ./common/getgeo.sh
    - /usr/local/bin/getgeo.sh
  - CmdLine:
    - /usr/local/bin/getgeo.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p ${STOR_PATH}/logs ${STOR_PATH}/spool && sed -i 's/^LogDir = \/opt\/bro/LogDir
      = \/data\/bro/g' ${PREFIX}/etc/broctl.cfg&& sed -i 's/^SpoolDir = \/opt\/bro/SpoolDir
      = \/data\/bro/g' ${PREFIX}/etc/broctl.cfg
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "0-59/5 * * * * root /opt/bro/bin/broctl cron 1> /dev/null" > /etc/crontab
      && sed -i 's/^exit 0/\/opt\/bro\/bin\/broctl deploy | logger -t broctl\n\nexit
      0/g' /etc/rc.local
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get clean
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt/bro
  - CmdLine:
    - /sbin/my_init
    Name: cmd
    PrependShell: false
  From:
    Image: phusion/baseimage:0.9.18
  Name: ""
  Platform: ""
  SourceCode: FROM phusion/baseimage:0.9.18
