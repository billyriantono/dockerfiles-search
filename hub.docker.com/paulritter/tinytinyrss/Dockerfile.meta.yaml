MetaArgs: null
Stages:
- BaseName: php:apache-stretch
  Commands:
  - CmdLine:
    - a2enmod headers     && sed -i "s/ServerSignature On/ServerSignature Off/" /etc/apache2/conf-available/security.conf     &&
      sed -i "s/ServerTokens OS/ServerTokens Prod/" /etc/apache2/conf-available/security.conf     &&
      sed -i "s/#Header set X/Header set X/" /etc/apache2/conf-available/security.conf     &&
      sed -i "s/Options Indexes FollowSymLinks/Options -Indexes/" /etc/apache2/apache2.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - "apt-get update && apt-get install -y \t\tlibapache2-mod-auth-mellon \t\tliblasso3
      \t\tlibxmlsec1 \t\tlibxmlsec1-openssl \t\tlibxslt1.1 \t\tlibicu-dev \t\tlibpng-dev
      \t\tlibpq-dev \t\tssmtp \t--no-install-recommends && rm -r /var/lib/apt/lists/*"
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-install opcache intl gd pgsql pdo pdo_pgsql
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-enable opcache intl gd pgsql pdo pdo_pgsql
    Name: run
    PrependShell: true
  - CmdLine:
    - "a2enmod auth_mellon \t&& a2enmod ldap \t&& a2enmod authnz_ldap"
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "sendmail_path=sendmail -t" > /usr/local/etc/php/conf.d/php-sendmail.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /etc/apache2/site-config     && mkdir -p /etc/apache2/saml
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/opcache.ini
    - /usr/local/etc/php/conf.d/opcache.ini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/mellon.conf
    - /etc/apache2/site-config/mellon.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/ldap.conf
    - /etc/apache2/site-config/ldap.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/000-default.conf
    - /etc/apache2/sites-available/000-default.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/mellon_create_metadata.sh
    - /opt/mellon_create_metadata.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/firstrun.sh
    - /opt/firstrun.sh
  - CmdLine:
    - chmod +x /opt/mellon_create_metadata.sh     && chmod +x /opt/firstrun.sh
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html
  - CmdLine:
    - "curl -o ttrss.tar.gz https://git.tt-rss.org/fox/tt-rss/archive/19.8.tar.gz
      \t&& tar --strip-components=1 -xzf ttrss.tar.gz \t&& rm -f ttrss.tar.gz \t&&
      chown -R www-data:www-data /var/www/html"
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /etc/apache2/site-config
  - Name: volume
    Volumes:
    - /etc/apache2/saml
  - Name: volume
    Volumes:
    - /etc/ssmtp
  From:
    Image: php:apache-stretch
  Name: ""
  Platform: ""
  SourceCode: FROM php:apache-stretch
