MetaArgs: null
Stages:
- As: builder
  BaseName: node:boron-alpine
  Commands:
  - CmdLine:
    - apk add -U build-base python
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/src/app
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - /usr/src/app
  - CmdLine:
    - yarn &&     yarn build &&     yarn install --production --ignore-scripts --prefer-offline
    Name: run
    PrependShell: true
  From:
    Image: node:boron-alpine
  Name: builder
  Platform: ""
  SourceCode: FROM node:boron-alpine as builder
- BaseName: node:boron-alpine
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Bernd Klaus <me@berndklaus.at>"'
    Name: label
  - Name: workdir
    Path: /usr/src/app
  - Env:
    - Key: KUBE_VERSION
      Value: '"v1.16.2"'
    Name: env
  - Env:
    - Key: VELERO_VERSION
      Value: '"1.1.0"'
    Name: env
  - Env:
    - Key: HELM_VERSION
      Value: '"2.15.1"'
    Name: env
  - Env:
    - Key: NODE_ENV
      Value: production
    Name: env
  - Env:
    - Key: DOCTL_VERSION
      Value: '"1.33.0"'
    Name: env
  - CmdLine:
    - apk add -U openssh-client sshpass curl git nano wget openrc
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "3000"
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/src/app/dist
    - /usr/src/app/dist
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/src/app/node_modules
    - /usr/src/app/node_modules
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - package.json
    - /usr/src/app
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - index.js
    - /usr/src/app
  - CmdLine:
    - mkdir ~/.ssh  && ssh-keyscan -H wetty-ssh >> ~/.ssh/known_hosts  && adduser
      bernd -D --home /home/bernd
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://storage.googleapis.com/kubernetes-release/release/${KUBE_VERSION}/bin/linux/amd64/kubectl
    - /usr/local/bin/kubectl
  - CmdLine:
    - chmod +x /usr/local/bin/kubectl  && wget https://github.com/vmware-tanzu/velero/releases/download/v${VELERO_VERSION}/velero-v${VELERO_VERSION}-linux-amd64.tar.gz  &&
      tar -xvf velero-v${VELERO_VERSION}-linux-amd64.tar.gz -C /usr/local/bin  &&
      chmod +x /usr/local/bin/velero-v${VELERO_VERSION}-linux-amd64/velero  && mv
      /usr/local/bin/velero-v${VELERO_VERSION}-linux-amd64/velero /usr/local/bin/
      && rm /usr/local/bin/velero-v${VELERO_VERSION}-linux-amd64 -rf  && wget https://get.helm.sh/helm-v${HELM_VERSION}-linux-amd64.tar.gz  &&
      tar -xvf helm-v${HELM_VERSION}-linux-amd64.tar.gz -C /usr/local/bin  && chmod
      +x /usr/local/bin/linux-amd64/helm  && mv /usr/local/bin/linux-amd64/helm /usr/local/bin/
      && rm /usr/local/bin/linux-amd64 -rf  && wget https://github.com/digitalocean/doctl/releases/download/v${DOCTL_VERSION}/doctl-${DOCTL_VERSION}-linux-amd64.tar.gz  &&
      tar -xvf doctl-${DOCTL_VERSION}-linux-amd64.tar.gz -C /usr/local/bin  && chmod
      +x /usr/local/bin/doctl
    Name: run
    PrependShell: true
  - CmdLine:
    - node
    - .
    Name: entrypoint
    PrependShell: false
  From:
    Image: node:boron-alpine
  Name: ""
  Platform: ""
  SourceCode: FROM node:boron-alpine
