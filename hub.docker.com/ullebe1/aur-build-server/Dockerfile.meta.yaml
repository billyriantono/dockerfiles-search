MetaArgs: null
Stages:
- BaseName: archimg/base-devel
  Commands:
  - Name: user
    User: root
  - CmdLine:
    - pacman -Syu --noconfirm --noprogressbar --quiet git jq pacutils pacman aria2
      devtools expac parallel repose vifm
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd --create-home build
    Name: run
    PrependShell: true
  - CmdLine:
    - usermod -g wheel build
    Name: run
    PrependShell: true
  - Name: user
    User: build
  - Name: workdir
    Path: /home/build
  - CmdLine:
    - mkdir -p /home/build/.gnupg/
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "keyserver-options auto-key-retrieve" >> /home/build/.gnupg/gpg.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://aur.archlinux.org/aurutils.git
    Name: run
    PrependShell: true
  - Name: workdir
    Path: aurutils
  - CmdLine:
    - makepkg
    Name: run
    PrependShell: true
  - Name: user
    User: root
  - CmdLine:
    - pacman -U *.pkg.tar.xz --noconfirm
    Name: run
    PrependShell: true
  - Name: stopsignal
    Signal: SIGRTMIN+3
  - Env:
    - Key: container
      Value: docker
    Name: env
  - CmdLine:
    - echo "[multilib]" >> /etc/pacman.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "Include = /etc/pacman.d/mirrorlist" >> /etc/pacman.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "Include = /etc/pacman.d/ulrepo" >> /etc/pacman.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - 'echo "%wheel ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers'
    Name: run
    PrependShell: true
  - CmdLine:
    - 'echo "build ALL = NOPASSWD: /usr/sbin/pacsync" >> /etc/sudoers'
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ulrepo
    - /etc/pacman.d/ulrepo
  - CmdLine:
    - install -d /var/cache/pacman/ulrepo
    Name: run
    PrependShell: true
  - CmdLine:
    - chown build /var/cache/pacman/ulrepo
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ulrepo-build.service
    - /etc/systemd/system/ulrepo-build.service
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ulrepo-build.timer
    - /etc/systemd/system/ulrepo-build.timer
  - CmdLine:
    - systemctl enable ulrepo-build.timer
    Name: run
    PrependShell: true
  - Name: user
    User: root
  - CmdLine:
    - init
    Name: cmd
    PrependShell: false
  From:
    Image: archimg/base-devel
  Name: ""
  Platform: ""
  SourceCode: FROM archimg/base-devel
