MetaArgs: null
Stages:
- BaseName: ubuntu:16.04
  Commands:
  - Maintainer: Alexey Astafev "efsneiron@gmail.com"
    Name: maintainer
  - Env:
    - Key: GOSU_VERSION
      Value: "1.9"
    Name: env
  - CmdLine:
    - set -x     && apt-get update && apt-get install -y --no-install-recommends ca-certificates
      wget && rm -rf /var/lib/apt/lists/*     && dpkgArch="$(dpkg --print-architecture
      | awk -F- '{ print $NF }')"     && wget -O /usr/local/bin/gosu "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch"     &&
      wget -O /usr/local/bin/gosu.asc "https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc"     &&
      export GNUPGHOME="$(mktemp -d)"     && gpg --keyserver ha.pool.sks-keyservers.net
      --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4     && gpg --batch --verify
      /usr/local/bin/gosu.asc /usr/local/bin/gosu     && rm -r "$GNUPGHOME" /usr/local/bin/gosu.asc     &&
      chmod +x /usr/local/bin/gosu     && gosu nobody true     && apt-get purge -y
      --auto-remove ca-certificates wget
    Name: run
    PrependShell: true
  - Env:
    - Key: PHP_DEPS
      Value: php7.1-cli php7.1-curl php7.1-fpm php7.1-mysql php7.1-gd php7.1-mcrypt
        php7.1-intl php7.1-xml php7.1-zip php7.1-mbstring php7.1-sqlite3
    Name: env
  - Env:
    - Key: INI_CONF
      Value: /etc/php/7.1
    Name: env
  - Env:
    - Key: NOTVISIBLE
      Value: '"in users profile"'
    Name: env
  - CmdLine:
    - apt-get update    && apt-get install -y software-properties-common locales    &&
      locale-gen en_US.utf8    && export LANG=en_US.utf8    && add-apt-repository
      ppa:ondrej/php -y    && apt-get update    && apt-get install -y $PHP_DEPS openssh-server
      supervisor cifs-utils nfs-common curl git    && rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /var/run/sshd
    Name: run
    PrependShell: true
  - CmdLine:
    - echo 'root:screencast' | chpasswd
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed 's@session\s*required\s*pam_loginuid.so@session optional pam_loginuid.so@g'
      -i /etc/pam.d/sshd
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "export VISIBLE=now" >> /etc/profile
    Name: run
    PrependShell: true
  - CmdLine:
    - rm $INI_CONF/fpm/php.ini && ln -s $INI_CONF/cli/php.ini $INI_CONF/fpm/php.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i "s/;date.timezone =.*/date.timezone = Europe\/Moscow/" $INI_CONF/cli/php.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i "s/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/" $INI_CONF/cli/php.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /run/php
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
    Name: run
    PrependShell: true
  - CmdLine:
    - php composer-setup.php --install-dir=/usr/local/bin
    Name: run
    PrependShell: true
  - CmdLine:
    - mv /usr/local/bin/composer.phar /usr/local/bin/composer
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "unlink('composer-setup.php');"
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://phar.phpunit.de/phpunit.phar
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod +x phpunit.phar
    Name: run
    PrependShell: true
  - CmdLine:
    - mv phpunit.phar /usr/local/bin/phpunit
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LsS https://symfony.com/installer -o /usr/local/bin/symfony
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod a+x /usr/local/bin/symfony
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - /usr/local/bin/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - www.conf
    - $INI_CONF/fpm/pool.d/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - CmdLine:
    - chmod +x /usr/local/bin/entrypoint.sh
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
    - "9000"
  - CmdLine:
    - /usr/local/bin/entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /bin/bash
    Name: cmd
    PrependShell: false
  From:
    Image: ubuntu:16.04
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:16.04
