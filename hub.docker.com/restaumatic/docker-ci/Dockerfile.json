{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "base",
      "BaseName": "circleci/ruby:2.3.4-node",
      "SourceCode": "FROM circleci/ruby:2.3.4-node as base",
      "Platform": "",
      "As": "base",
      "From": {
        "Image": "circleci/ruby:2.3.4-node"
      },
      "Commands": [
        {
          "CmdLine": [
            "cd /tmp     \u0026\u0026 wget https://nodejs.org/dist/v8.11.4/node-v8.11.4-linux-x64.tar.xz     \u0026\u0026 tar xf node-v8.11.4-linux-x64.tar.xz     \u0026\u0026 sudo cp -r node-v8.11.4-linux-x64 /usr/local/nodejs-8     \u0026\u0026 rm node-v8.11.4-linux-x64.tar.xz"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir ~/tmp_npm_install     \u0026\u0026 cd ~/tmp_npm_install     \u0026\u0026 npm -q install npm@6.5.0     \u0026\u0026 sudo ln -sf `pwd`/node_modules/.bin/npm /usr/local/bin"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "echo \"PATH=$PATH\"     \u0026\u0026 which node     \u0026\u0026 node --version     \u0026\u0026 npm --version"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "sudo npm install -g bower"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://s3.eu-central-1.amazonaws.com/restaumatic-devops/geos/libgeos-3.6.2_3.6.2-1_amd64.deb",
            "libgeos-3.6.2_3.6.2-1_amd64.deb"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://s3.eu-central-1.amazonaws.com/restaumatic-devops/geos/libgeos-c1v5_3.6.2-1_amd64.deb",
            "libgeos-c1v5_3.6.2-1_amd64.deb"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://s3.eu-central-1.amazonaws.com/restaumatic-devops/geos/libgeos-dev_3.6.2-1_amd64.deb",
            "libgeos-dev_3.6.2-1_amd64.deb"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://s3.eu-central-1.amazonaws.com/restaumatic-devops/phonenumber/libphonenumber-dev_7.1.0-5~bpo9%2B1_amd64.deb",
            "libphonenumber-dev_7.1.0-5~bpo9%2B1_amd64.deb"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://s3.eu-central-1.amazonaws.com/restaumatic-devops/phonenumber/libgeocoding7_7.1.0-5~bpo9%2B1_amd64.deb",
            "libgeocoding7_7.1.0-5~bpo9%2B1_amd64.deb"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://s3.eu-central-1.amazonaws.com/restaumatic-devops/phonenumber/libphonenumber7_7.1.0-5~bpo9%2B1_amd64.deb",
            "libphonenumber7_7.1.0-5~bpo9%2B1_amd64.deb"
          ]
        },
        {
          "CmdLine": [
            "echo \"deb http://deb.debian.org/debian jessie main\\ndeb http://security.debian.org/debian-security jessie/updates main\\ndeb http://apt.postgresql.org/pub/repos/apt/ jessie-pgdg main\" | sudo tee /etc/apt/sources.list     \u0026\u0026 wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -     \u0026\u0026 curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash     \u0026\u0026 sudo apt-get -y update     \u0026\u0026 sudo apt-get -y install                        build-essential                        libproj-dev                        imagemagick                        wget                        libpq-dev postgresql-client-9.6                        libicu-dev                        python3                        python python-dev unzip iptables                        g++ gcc libc6-dev libffi-dev libgmp-dev make xz-utils zlib1g-dev git gnupg netbase                        cmake openjdk-7-jdk protobuf-compiler                        git-lfs                        upx                        python-yaml    \u0026\u0026 sudo dpkg -i libgeos-c1v5_3.6.2-1_amd64.deb libgeos-3.6.2_3.6.2-1_amd64.deb libgeos-dev_3.6.2-1_amd64.deb    \u0026\u0026 (sudo dpkg -i libphonenumber7_7.1.0-5~bpo9%2B1_amd64.deb libgeocoding7_7.1.0-5~bpo9%2B1_amd64.deb libphonenumber-dev_7.1.0-5~bpo9%2B1_amd64.deb || sudo apt-get --fix-broken install)    \u0026\u0026 sudo apt-get clean \u0026\u0026 sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://github.com/commercialhaskell/stack/releases/download/v2.1.3/stack-2.1.3-linux-x86_64-static.tar.gz",
            "stack.tar.gz"
          ]
        },
        {
          "CmdLine": [
            "cd /usr/local/bin    \u0026\u0026 sudo tar -zxv --wildcards --strip-components 1 -f /stack.tar.gz \"*/stack\""
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    },
    {
      "Name": "",
      "BaseName": "base",
      "SourceCode": "FROM base",
      "Platform": "",
      "From": {
        "Stage": {
          "Named": "base",
          "Index": 0
        }
      },
      "Commands": [
        {
          "CmdLine": [
            "echo \"Installing vcr-proxy 2 for prerecorded API tests\"   \u0026\u0026 cd ~/   \u0026\u0026 git clone https://github.com/restaumatic/vcr-proxy.git   \u0026\u0026 cd vcr-proxy   \u0026\u0026 stack install   \u0026\u0026 sudo cp ~/.local/bin/vcr-proxy /usr/local/bin/   \u0026\u0026 sudo chmod +x /usr/local/bin   \u0026\u0026 vcr-proxy --help"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    },
    {
      "Name": "",
      "BaseName": "base",
      "SourceCode": "FROM base",
      "Platform": "",
      "From": {
        "Stage": {
          "Named": "base",
          "Index": 0
        }
      },
      "Commands": [
        {
          "Chown": "",
          "From": "1",
          "Name": "copy",
          "SourcesAndDest": [
            "/usr/local/bin/vcr-proxy",
            "/usr/local/bin/vcr-proxy"
          ]
        },
        {
          "CmdLine": [
            "echo \"Installing Google Chrome for browser tests\"    \u0026\u0026 sudo apt-get -y update    \u0026\u0026 sudo apt-get -y install xvfb chromium chromedriver \t\tgconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 \t\tlibglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 \t\tlibxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget    \u0026\u0026 sudo ln -sf /usr/lib/chromium/chromedriver /usr/local/bin    \u0026\u0026 chromium --version    \u0026\u0026 chromedriver --version    \u0026\u0026 sudo apt-get clean \u0026\u0026 sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "sudo wget https://s3.eu-central-1.amazonaws.com/restaumatic-devops/psc-package/psc-package-b1eb7a5e8dda09a926f7a0bfa5295e76700a76a8 -O /usr/local/bin/psc-package   \u0026\u0026 sudo chmod +x /usr/local/bin/psc-package   \u0026\u0026 psc-package --version"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "sudo wget \"https://s3.amazonaws.com/aws-cli/awscli-bundle.zip\" -O \"/tmp/awscli-bundle.zip\"     \u0026\u0026 sudo unzip /tmp/awscli-bundle.zip -d /tmp     \u0026\u0026 sudo /tmp/awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws     \u0026\u0026 sudo rm -rf /tmp/awscli-bundle.zip /tmp/awscli-bundle"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    }
  ]
}