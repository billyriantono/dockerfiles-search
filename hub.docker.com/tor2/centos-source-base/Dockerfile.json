{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "centos:7",
      "SourceCode": "FROM centos:7",
      "Platform": "",
      "From": {
        "Image": "centos:7"
      },
      "Commands": [
        {
          "Maintainer": "Kolla Project (https://launchpad.net/kolla)",
          "Name": "maintainer"
        },
        {
          "CmdLine": [
            "groupadd --force --gid 42401 ansible     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42401 --gid 42401 ansible     \u0026\u0026 groupadd --force --gid 42402 aodh     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42402 --gid 42402 aodh     \u0026\u0026 groupadd --force --gid 42403 barbican     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42403 --gid 42403 barbican     \u0026\u0026 groupadd --force --gid 42404 bifrost     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42404 --gid 42404 bifrost     \u0026\u0026 groupadd --force --gid 42405 ceilometer     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42405 --gid 42405 ceilometer     \u0026\u0026 groupadd --force --gid 64045 ceph     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 64045 --gid 64045 ceph     \u0026\u0026 groupadd --force --gid 42406 chrony     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42406 --gid 42406 chrony     \u0026\u0026 groupadd --force --gid 42407 cinder     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42407 --gid 42407 cinder     \u0026\u0026 groupadd --force --gid 42408 cloudkitty     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42408 --gid 42408 cloudkitty     \u0026\u0026 groupadd --force --gid 42409 collectd     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42409 --gid 42409 collectd     \u0026\u0026 groupadd --force --gid 42410 congress     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42410 --gid 42410 congress     \u0026\u0026 groupadd --force --gid 42411 designate     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42411 --gid 42411 designate     \u0026\u0026 groupadd --force --gid 42412 elasticsearch     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42412 --gid 42412 elasticsearch     \u0026\u0026 groupadd --force --gid 42413 etcd     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42413 --gid 42413 etcd     \u0026\u0026 groupadd --force --gid 42414 freezer     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42414 --gid 42414 freezer     \u0026\u0026 groupadd --force --gid 42415 glance     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42415 --gid 42415 glance     \u0026\u0026 groupadd --force --gid 42416 gnocchi     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42416 --gid 42416 gnocchi     \u0026\u0026 groupadd --force --gid 42417 grafana     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42417 --gid 42417 grafana     \u0026\u0026 groupadd --force --gid 42454 haproxy     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42454 --gid 42454 haproxy     \u0026\u0026 groupadd --force --gid 42418 heat     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42418 --gid 42418 heat     \u0026\u0026 groupadd --force --gid 42419 heka     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42419 --gid 42419 heka     \u0026\u0026 groupadd --force --gid 42420 horizon     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42420 --gid 42420 horizon     \u0026\u0026 groupadd --force --gid 42421 influxdb     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42421 --gid 42421 influxdb     \u0026\u0026 groupadd --force --gid 42422 ironic     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42422 --gid 42422 ironic     \u0026\u0026 groupadd --force --gid 42423 kafka     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42423 --gid 42423 kafka     \u0026\u0026 groupadd --force --gid 42458 karbor     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42458 --gid 42458 karbor     \u0026\u0026 groupadd --force --gid 42425 keystone     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42425 --gid 42425 keystone     \u0026\u0026 groupadd --force --gid 42426 kibana     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42426 --gid 42426 kibana     \u0026\u0026 groupadd --force --gid 42400 kolla     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42400 --gid 42400 kolla     \u0026\u0026 groupadd --force --gid 42428 magnum     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42428 --gid 42428 magnum     \u0026\u0026 groupadd --force --gid 42429 manila     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42429 --gid 42429 manila     \u0026\u0026 groupadd --force --gid 42457 memcached     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42457 --gid 42457 memcached     \u0026\u0026 groupadd --force --gid 42430 mistral     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42430 --gid 42430 mistral     \u0026\u0026 groupadd --force --gid 42431 monasca     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42431 --gid 42431 monasca     \u0026\u0026 groupadd --force --gid 65534 mongodb     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42432 --gid 65534 mongodb     \u0026\u0026 groupadd --force --gid 42433 murano     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42433 --gid 42433 murano     \u0026\u0026 groupadd --force --gid 42434 mysql     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42434 --gid 42434 mysql     \u0026\u0026 groupadd --force --gid 42435 neutron     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42435 --gid 42435 neutron     \u0026\u0026 groupadd --force --gid 42436 nova     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42436 --gid 42436 nova     \u0026\u0026 groupadd --force --gid 42437 octavia     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42437 --gid 42437 octavia     \u0026\u0026 groupadd --force --gid 42438 panko     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42438 --gid 42438 panko     \u0026\u0026 groupadd --force --gid 42427 qemu     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42427 --gid 42427 qemu     \u0026\u0026 groupadd --force --gid 42439 rabbitmq     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42439 --gid 42439 rabbitmq     \u0026\u0026 groupadd --force --gid 42440 rally     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42440 --gid 42440 rally     \u0026\u0026 groupadd --force --gid 42460 redis     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42460 --gid 42460 redis     \u0026\u0026 groupadd --force --gid 42441 sahara     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42441 --gid 42441 sahara     \u0026\u0026 groupadd --force --gid 42442 searchlight     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42442 --gid 42442 searchlight     \u0026\u0026 groupadd --force --gid 42443 senlin     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42443 --gid 42443 senlin     \u0026\u0026 groupadd --force --gid 42444 solum     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42444 --gid 42444 solum     \u0026\u0026 groupadd --force --gid 42445 swift     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42445 --gid 42445 swift     \u0026\u0026 groupadd --force --gid 42446 tacker     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42446 --gid 42446 tacker     \u0026\u0026 groupadd --force --gid 42447 td-agent     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42447 --gid 42447 td-agent     \u0026\u0026 groupadd --force --gid 42448 telegraf     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42448 --gid 42448 telegraf     \u0026\u0026 groupadd --force --gid 42449 trove     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42449 --gid 42449 trove     \u0026\u0026 groupadd --force --gid 42459 vitrage     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42459 --gid 42459 vitrage     \u0026\u0026 groupadd --force --gid 42450 vmtp     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42450 --gid 42450 vmtp     \u0026\u0026 groupadd --force --gid 42451 watcher     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42451 --gid 42451 watcher     \u0026\u0026 groupadd --force --gid 42452 zaqar     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42452 --gid 42452 zaqar     \u0026\u0026 groupadd --force --gid 42453 zookeeper     \u0026\u0026 useradd -M --shell /usr/sbin/nologin --uid 42453 --gid 42453 zookeeper"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Labels": [
            {
              "Key": "kolla_version",
              "Value": "\"4.0.0\""
            }
          ],
          "Name": "label"
        },
        {
          "Env": [
            {
              "Key": "KOLLA_BASE_DISTRO",
              "Value": "centos"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "KOLLA_INSTALL_TYPE",
              "Value": "source"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "KOLLA_INSTALL_METATYPE",
              "Value": "mixed"
            }
          ],
          "Name": "env"
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "kolla_bashrc",
            "/tmp/"
          ]
        },
        {
          "CmdLine": [
            "cat /tmp/kolla_bashrc \u003e\u003e /etc/skel/.bashrc     \u0026\u0026 cat /tmp/kolla_bashrc \u003e\u003e /root/.bashrc"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "PS1",
              "Value": "\"$(tput bold)($(printenv KOLLA_SERVICE_NAME))$(tput sgr0)[$(id -un)@$(hostname -s) $(pwd)]$ \""
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "CURRENT_DISTRO_RELEASE=$(awk '{match($0, /[0-9]+/,version)}END{print version[0]}' /etc/system-release);     if [  $CURRENT_DISTRO_RELEASE != \"7\" ]; then         echo \"Only supported 7 release on centos\"; false;     fi     \u0026\u0026 cat /tmp/kolla_bashrc \u003e\u003e /etc/bashrc     \u0026\u0026 sed -i 's|^\\(override_install_langs=.*\\)|# \\1|' /etc/yum.conf"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "elasticsearch.repo",
            "/etc/yum.repos.d/elasticsearch.repo"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "grafana.repo",
            "/etc/yum.repos.d/grafana.repo"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "influxdb.repo",
            "/etc/yum.repos.d/influxdb.repo"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "kibana.yum.repo",
            "/etc/yum.repos.d/kibana.yum.repo"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "MariaDB.repo",
            "/etc/yum.repos.d/MariaDB.repo"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "td.repo",
            "/etc/yum.repos.d/td.repo"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "zookeeper.repo",
            "/etc/yum.repos.d/zookeeper.repo"
          ]
        },
        {
          "CmdLine": [
            "yum -y install http://repo.percona.com/release/7/RPMS/x86_64/percona-release-0.1-4.noarch.rpm \u0026\u0026 yum clean all"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "rpm --import http://yum.mariadb.org/RPM-GPG-KEY-MariaDB     \u0026\u0026 rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-Percona      \u0026\u0026 rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch     \u0026\u0026 rpm --import https://repos.influxdata.com/influxdb.key     \u0026\u0026 rpm --import https://packagecloud.io/gpg.key     \u0026\u0026 rpm --import https://grafanarel.s3.amazonaws.com/RPM-GPG-KEY-grafana     \u0026\u0026 rpm --import https://packages.treasuredata.com/GPG-KEY-td-agent"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "yum -y install epel-release  yum-plugin-priorities centos-release-ceph-jewel centos-release-openstack-ocata centos-release-qemu-ev \u0026\u0026 yum clean all"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Storage     \u0026\u0026 rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-SIG-Virtualization     \u0026\u0026 yum clean all"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "yum -y install curl sudo tar which lvm2 scsi-target-utils iproute iscsi-initiator-utils \u0026\u0026 yum clean all"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "set_configs.py",
            "/usr/local/bin/kolla_set_configs"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "start.sh",
            "/usr/local/bin/kolla_start"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "sudoers",
            "/etc/sudoers"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "curlrc",
            "/root/.curlrc"
          ]
        },
        {
          "CmdLine": [
            "curl -sSL https://github.com/Yelp/dumb-init/releases/download/v1.1.3/dumb-init_1.1.3_amd64 -o /usr/local/bin/dumb-init     \u0026\u0026 chmod +x /usr/local/bin/dumb-init"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "touch /usr/local/bin/kolla_extend_start     \u0026\u0026 chmod 755 /usr/local/bin/kolla_start /usr/local/bin/kolla_extend_start /usr/local/bin/kolla_set_configs     \u0026\u0026 chmod 440 /etc/sudoers     \u0026\u0026 mkdir -p /var/log/kolla     \u0026\u0026 chown :kolla /var/log/kolla     \u0026\u0026 chmod 2775 /var/log/kolla     \u0026\u0026 rm -f /tmp/kolla_bashrc"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "kolla_start"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}