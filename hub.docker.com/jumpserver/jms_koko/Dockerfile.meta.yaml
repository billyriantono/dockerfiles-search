MetaArgs: null
Stages:
- As: stage-build
  BaseName: golang:1.12-alpine
  Commands:
  - Labels:
    - Key: stage
      Value: stage-build
    Name: label
  - Name: workdir
    Path: /opt/koko
  - Key: GOPROXY
    Name: arg
    Value: null
  - Env:
    - Key: GOPROXY
      Value: $GOPROXY
    Name: env
  - Env:
    - Key: GO111MODULE
      Value: "on"
    Name: env
  - CmdLine:
    - sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories   &&
      apk update   && apk add git
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - go.mod
    - go.sum
    - ./
  - CmdLine:
    - go mod download
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - .
  - CmdLine:
    - cd cmd && go build -ldflags "-X 'main.Buildstamp=`date -u '+%Y-%m-%d %I:%M:%S%p'`'
      -X 'main.Githash=`git rev-parse HEAD`' -X 'main.Goversion=`go version`'" -x
      -o koko koko.go
    Name: run
    PrependShell: true
  From:
    Image: golang:1.12-alpine
  Name: stage-build
  Platform: ""
  SourceCode: FROM golang:1.12-alpine as stage-build
- BaseName: alpine
  Commands:
  - Name: workdir
    Path: /opt/koko/
  - Chown: ""
    From: stage-build
    Name: copy
    SourcesAndDest:
    - /opt/koko/cmd/koko
    - .
  - Chown: ""
    From: stage-build
    Name: copy
    SourcesAndDest:
    - /opt/koko/cmd/locale/
    - locale
  - Chown: ""
    From: stage-build
    Name: copy
    SourcesAndDest:
    - /opt/koko/cmd/static/
    - static
  - Chown: ""
    From: stage-build
    Name: copy
    SourcesAndDest:
    - /opt/koko/cmd/templates/
    - templates
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - cmd/config_example.yml
    - .
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - .
  - CmdLine:
    - chmod 755 ./entrypoint.sh   && sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'
      /etc/apk/repositories   && apk update   && apk add -U tzdata   && apk add curl   &&
      apk add mysql-client   && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime   &&
      echo "Asia/Shanghai" > /etc/timezone   && apk del tzdata   && rm -rf /var/cache/apk/*
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "2222"
    - "5000"
  - CmdLine:
    - ./entrypoint.sh
    Name: cmd
    PrependShell: false
  From:
    Image: alpine
  Name: ""
  Platform: ""
  SourceCode: FROM alpine
