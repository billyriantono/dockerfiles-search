{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "stilesb/stack:latest",
      "SourceCode": "FROM stilesb/stack:latest",
      "Platform": "",
      "From": {
        "Image": "stilesb/stack:latest"
      },
      "Commands": [
        {
          "Name": "user",
          "User": "root"
        },
        {
          "CmdLine": [
            "apt-get install -y libglib2.0-dev libcairo2-dev libcogl-pango-dev gtk2.0     libwebkit-dev libtinfo-dev dh-autoreconf libncurses5-dev python-software-properties"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "curl -sL https://deb.nodesource.com/setup_7.x | bash"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apt-get install -y nodejs"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "npm -g install closurecompiler"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir -p /opt/web/api/.stack-work /opt/web/client/.stack-work     /opt/web/server/.stack-work /home/robot/.stack /home/robot/.local/bin \u0026\u0026     chown robot -R /opt/web /home/robot"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "user",
          "User": "robot"
        },
        {
          "Env": [
            {
              "Key": "PATH",
              "Value": "/home/robot/.local/bin:$PATH"
            }
          ],
          "Name": "env"
        },
        {
          "Name": "workdir",
          "Path": "/opt/web/api"
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "api/stack.yaml",
            "api/api.cabal",
            "./"
          ]
        },
        {
          "CmdLine": [
            "stack setup"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "stack install --dependencies-only"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "workdir",
          "Path": "/opt/web/server"
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "server/stack.yaml",
            "server/server.cabal",
            "./"
          ]
        },
        {
          "CmdLine": [
            "stack setup"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "stack install --dependencies-only"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "workdir",
          "Path": "/opt/web/client"
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "client/config/stack-base.yaml",
            "stack.yaml"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "client/config/stack-ghcjs-base.yaml",
            "stack-ghcjs.yaml"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "client/config/client-base.cabal",
            "client.cabal"
          ]
        },
        {
          "CmdLine": [
            "stack --stack-yaml=stack-ghcjs.yaml setup"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "stack setup"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "stack install --dependencies-only"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "PATH",
              "Value": "$PATH:/home/robot/.stack/programs/x86_64-linux"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "ln -s /home/robot/.stack/programs/x86_64-linux/ghc-8.0.1/bin/ghc /home/robot/.local/bin/ghc"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "stack install hsc2hs happy"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "stack --stack-yaml=stack-ghcjs.yaml install --dependencies-only"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "workdir",
          "Path": "/opt/web"
        },
        {
          "CmdLine": [
            "tail",
            "-f",
            "/dev/null"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}