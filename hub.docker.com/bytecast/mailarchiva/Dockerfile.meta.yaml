MetaArgs: null
Stages:
- BaseName: phusion/baseimage:0.9.22
  Commands:
  - Env:
    - Key: MAILARCHIVA_BASE_URL
      Value: https://mailarchiva.com/download?id=1020
    Name: env
  - Env:
    - Key: MAILARCHIVA_INSTALL_DIR
      Value: /opt
    Name: env
  - Env:
    - Key: MAILARCHIVA_HEAP_SIZE
      Value: 2048m
    Name: env
  - CmdLine:
    - /sbin/my_init
    Name: cmd
    PrependShell: false
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y expect wget iproute
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -q -O - $MAILARCHIVA_BASE_URL | tar xzf - -C $MAILARCHIVA_INSTALL_DIR
    Name: run
    PrependShell: true
  - CmdLine:
    - mv $MAILARCHIVA_INSTALL_DIR/mailarchiva* $MAILARCHIVA_INSTALL_DIR/mailarchiva
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - expect-install
    - $MAILARCHIVA_INSTALL_DIR/mailarchiva/expect-install
  - CmdLine:
    - cd $MAILARCHIVA_INSTALL_DIR/mailarchiva && expect expect-install
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /etc/my_init.d
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - run-mailarchiva.sh
    - /etc/my_init.d
  - CmdLine:
    - chmod +x /etc/my_init.d/run-mailarchiva.sh
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "8090"
  - Name: expose
    Ports:
    - "8091"
  - Name: expose
    Ports:
    - "8092"
  - CmdLine:
    - apt-get remove -yf expect wget && apt-get autoremove -y
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get autoclean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /usr/share/locale/* /usr/share/man/* /usr/share/doc/*
    Name: run
    PrependShell: true
  From:
    Image: phusion/baseimage:0.9.22
  Name: ""
  Platform: ""
  SourceCode: FROM phusion/baseimage:0.9.22
