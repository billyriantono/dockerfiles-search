MetaArgs: null
Stages:
- BaseName: debian:latest
  Commands:
  - Maintainer: veto@myridia.com
    Name: maintainer
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get remove --purge exim4 -y
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y   apache2   php7.0   libapache2-mod-php7.0   php7.0-json   php7.0-xml   php7.0-xmlrpc   php7.0-cgi    php7.0-mbstring   php7.0-gd   php7.0-curl   php7.0-zip   php-redis   curl   emacs25-nox   apt-utils   php7.0-mcrypt   php7.0-curl   php7.0-redis   postgresql-client   postgresql-contrib   pgadmin3   libdbd-pg-perl   texlive   php7.0-pgsql   ssmtp   supervisor   git
    Name: run
    PrependShell: true
  - CmdLine:
    - rm /var/www/html -Rf
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://github.com/Tekki/sql-ledger.git /var/www/html
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "<?php phpinfo() ?>" > /var/www/html/index.php ; mkdir -p /var/lock/apache2
      /var/run/apache2 /var/run/sshd /var/log/supervisor ; a2enmod rewrite cgi ;sed
      -i -e '/memory_limit =/ s/= .*/= 2056M/' /etc/php/7.0/apache2/php.ini ; sed
      -i -e '/post_max_size =/ s/= .*/= 800M/' /etc/php/7.0/apache2/php.ini ; sed
      -i -e '/max_file_uploads =/ s/= .*/= 200/' /etc/php/7.0/apache2/php.ini ; sed
      -i -e '/upload_max_filesize =/ s/= .*/= 800M/' /etc/php/7.0/apache2/php.ini
      ; sed -i -e '/display_errors =/ s/= .*/= ON/' /etc/php/7.0/apache2/php.ini ;
      sed -i -e '/short_open_tag =/ s/= .*/= ON/' /etc/php/7.0/apache2/php.ini ; sed
      -i -e '/short_open_tag =/ s/= .*/= ON/' /etc/php/7.0/cli/php.ini ; sed -i -e
      '/AllowOverride / s/ .*/ All/' /etc/apache2/apache2.conf ;
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - sqlledger.conf
    - /etc/apache2/sites-enabled/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - sql-ledger.conf
    - /var/www/html
  - CmdLine:
    - usermod -c "Accounting" www-data
    Name: run
    PrependShell: true
  - CmdLine:
    - usermod -c "Accounting" root
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - /usr/bin/supervisord
    Name: cmd
    PrependShell: false
  From:
    Image: debian:latest
  Name: ""
  Platform: ""
  SourceCode: FROM debian:latest
