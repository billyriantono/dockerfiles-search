MetaArgs: null
Stages:
- BaseName: centos:latest
  Commands:
  - Maintainer: Lu Yun <livecn@163.com>
    Name: maintainer
  - CmdLine:
    - yum install -y wget
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /tmp && rpm -Uvh http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-2.noarch.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y nginx
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "daemon off;" >> /etc/nginx/nginx.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - yum makecache
    Name: run
    PrependShell: true
  - CmdLine:
    - yum
    - -y
    - install
    - php
    - php-fpm
    - php-mysql
    - php-gd
    - libjpeg*
    - php-imap
    - php-ldap
    - php-odbc
    - php-pear
    - php-xml
    - php-xmlrpc
    - php-mbstring
    - php-mcrypt
    - php-bcmath
    - php-mhash
    - libmcrypt
    Name: run
    PrependShell: false
  - CmdLine:
    - echo "<?php phpinfo(); ?>" > /usr/share/nginx/html/info.php && chown -R nginx:nginx
      /usr/share/nginx/html/info.php
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install phpmyadmin
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/share/phpMyAdmin /usr/share/nginx/html
    Name: run
    PrependShell: true
  - CmdLine:
    - '[ -e /var/lib/php/session ] || mkdir /var/lib/php/session && chmod -R 0777
      /var/lib/php/session'
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - nginx.conf
    - /etc/nginx/conf.d/default.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - php.ini
    - /etc/php.ini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - init.sh
    - /init.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config.inc.php
    - /etc/phpMyAdmin/config.inc.php
  - CmdLine:
    - chmod -R 0755 /etc/phpMyAdmin/config.inc.php
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /etc/nginx/sites-enabled
    - /etc/nginx/certs
    - /etc/nginx/conf.d
    - /var/log/nginx
    - /usr/share/nginx/html
  - Name: workdir
    Path: /usr/share/nginx/html
  - CmdLine:
    - chmod a+x /init.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /init.sh
    Name: cmd
    PrependShell: false
  - Name: expose
    Ports:
    - "80"
  - Name: expose
    Ports:
    - "443"
  From:
    Image: centos:latest
  Name: ""
  Platform: ""
  SourceCode: FROM centos:latest
