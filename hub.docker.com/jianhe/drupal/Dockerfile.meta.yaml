MetaArgs: null
Stages:
- BaseName: jianhe/php
  Commands:
  - CmdLine:
    - apt-get install -y   git   unzip   wget
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/60-drupal.cnf
    - /etc/mysql/conf.d/60-drupal.cnf
  - CmdLine:
    - rm -rf /var/www/html
    Name: run
    PrependShell: true
  - Env:
    - Key: DRUPAL_VERSION
      Value: "20190904"
    Name: env
  - CmdLine:
    - git clone -b 8.7.x https://git.drupal.org/project/drupal.git /var/www/html
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html
  - Env:
    - Key: COMPOSER_PROCESS_TIMEOUT
      Value: "1200"
    Name: env
  - CmdLine:
    - composer install
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-03-23/2648288-string-formatter-30.patch
      &&   patch -p1 < 2648288-string-formatter-30.patch &&   rm 2648288-string-formatter-30.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2654322-translation-import-2.patch
      &&   patch -p1 < 2654322-translation-import-2.patch &&   rm 2654322-translation-import-2.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2018-05-14/2794481-60.patch &&   patch
      -p1 < 2794481-60.patch &&   rm 2794481-60.patch
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/datetimerange.patch
    - datetimerange.patch
  - CmdLine:
    - patch -p1 < datetimerange.patch &&   rm datetimerange.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-03-24/2821352-entity-reference-auto-create-12.patch
      &&   patch -p1 < 2821352-entity-reference-auto-create-12.patch &&   rm 2821352-entity-reference-auto-create-12.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2855068-8_0.patch &&   patch -p1 <
      2855068-8_0.patch &&   rm 2855068-8_0.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-03-24/2940015-seven-theme-10.patch
      &&   patch -p1 < 2940015-seven-theme-10.patch &&   rm 2940015-seven-theme-10.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2018-11-08/2974156-editor-typeerror-9.patch
      &&   patch -p1 < 2974156-editor-typeerror-9.patch &&   rm 2974156-editor-typeerror-9.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-02-26/3015152-tps-5.patch &&   patch
      -p1 < 3015152-tps-5.patch &&   rm 3015152-tps-5.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-02-28/3028979.29.patch &&   patch
      -p1 < 3028979.29.patch &&   rm 3028979.29.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - "wget https://www.drupal.org/files/issues/2019-02-17/config-entity-label-translation-3030949-16.patch
      &&   patch -p1 < config-entity-label-translation-3030949-16.patch && \trm config-entity-label-translation-3030949-16.patch"
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-03-18/3040979-updateConfigTranslations-2.patch
      &&   patch -p1 < 3040979-updateConfigTranslations-2.patch &&   rm 3040979-updateConfigTranslations-2.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-03-22/3042392-entity-reference-label-wrong-language-2.patch
      &&   patch -p1 < 3042392-entity-reference-label-wrong-language-2.patch &&   rm
      3042392-entity-reference-label-wrong-language-2.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-03-25/3043057-views-EntityOperations-language-5.patch
      &&   patch -p1 < 3043057-views-EntityOperations-language-5.patch &&   rm 3043057-views-EntityOperations-language-5.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-05-04/3052608-2.drupal.DateTimeComputed-tries-to-compute-from-an-empty-value.patch
      &&   patch -p1 < 3052608-2.drupal.DateTimeComputed-tries-to-compute-from-an-empty-value.patch
      &&   rm 3052608-2.drupal.DateTimeComputed-tries-to-compute-from-an-empty-value.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2019-05-30/3058090-update-configuration-translation-2.patch
      &&   patch -p1 < 3058090-update-configuration-translation-2.patch &&   rm 3058090-update-configuration-translation-2.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require   drupal/r4032login   drupal/address   drupal/ajax_links_api   drupal/block_style_plugins:dev-2.x   drupal/conditional_fields   drupal/custom_formatters   drupal/easy_breadcrumb   drupal/entity_browser   drupal/facets   drupal/features   drupal/field_delimiter   drupal/field_formatter_class   drupal/field_group   drupal/inline_entity_form   drupal/pinyin   drupal/reference_table_formatter   drupal/rules   drupal/search_api_solr   drupal/select2   drupal/token   drupal/token_filter   drupal/views_entity_form_field   drupal/webform
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/ajax_links_api &&   wget https://www.drupal.org/files/issues/2019-03-21/3015840-schema-2.patch
      &&   patch -p1 < 3015840-schema-2.patch &&   rm 3015840-schema-2.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require drupal/charts
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir libraries -p &&   wget https://github.com/d3/d3/archive/v3.5.17.zip &&   unzip
      v3.5.17.zip &&   mv d3-3.5.17 libraries/d3 &&   wget https://github.com/c3js/c3/archive/v0.4.18.zip
      &&   unzip v0.4.18.zip &&   mv c3-0.4.18 libraries/c3
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require drupal/entity_print   mikehaertl/phpwkhtmltopdf
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/entity_print &&   wget https://www.drupal.org/files/issues/2018-05-03/entity_print-dompdf-2969184.patch
      &&   patch -p1 < entity_print-dompdf-2969184.patch &&   rm entity_print-dompdf-2969184.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://git.drupal.org/project/field_widget_class.git -b 8.x-1.x /var/www/html/modules/contrib/field_widget_class
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://www.drupal.org/files/issues/2872162-field-widget-hook-3.patch &&   patch
      -p1 < 2872162-field-widget-hook-3.patch &&   rm 2872162-field-widget-hook-3.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/reference_table_formatter &&   wget https://www.drupal.org/files/issues/2866712-call-to-a-member-function-on-null-4.patch
      &&   patch -p1 < 2866712-call-to-a-member-function-on-null-4.patch &&   rm 2866712-call-to-a-member-function-on-null-4.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require drush/drush
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/www/html/sites/default/files &&   chmod a+rw /var/www/html/sites/default
      -R &&   cp /var/www/html/sites/default/default.settings.php /var/www/html/sites/default/settings.php
      &&   cp /var/www/html/sites/default/default.services.yml /var/www/html/sites/default/services.yml
      &&   chmod a+rw /var/www/html/sites/default/settings.php &&   chmod a+rw /var/www/html/sites/default/services.yml
      &&   chown -R www-data:www-data /var/www/html/
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/www/private &&   chown -R www-data:www-data /var/www/private
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require drupal/console
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require   drupal/csv_serialization   drupal/migrate_plus   drupal/migrate_source_csv:^2.2   drupal/migrate_source_xls   drupal/migrate_tools   drupal/xls_serialization
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/migrate_plus &&   wget https://www.drupal.org/files/issues/2018-05-25/2975266-values-2.patch
      &&   patch -p1 < 2975266-values-2.patch &&   rm 2975266-values-2.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/migrate_source_xls &&   wget https://www.drupal.org/files/issues/2019-03-23/2954462-sheet-name-3.patch
      &&   patch -p1 < 2954462-sheet-name-3.patch &&   rm 2954462-sheet-name-3.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/migrate_source_xls &&   wget https://www.drupal.org/files/issues/2019-03-23/2954477-constants-3.patch
      &&   patch -p1 < 2954477-constants-3.patch &&   rm 2954477-constants-3.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require   drupal/page_manager   drupal/panels   drupal/panelizer
    Name: run
    PrependShell: true
  - CmdLine:
    - cd modules/contrib/panels &&   wget https://www.drupal.org/files/issues/2849867-custom_attributes_in_panels_blocks-11.patch
      &&   patch -p1 < 2849867-custom_attributes_in_panels_blocks-11.patch &&   rm
      2849867-custom_attributes_in_panels_blocks-11.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require   drupal/restui
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require webonyx/graphql-php &&   git clone https://github.com/drupal-graphql/graphql.git
      /var/www/html/modules/contrib/graphql
    Name: run
    PrependShell: true
  - CmdLine:
    - composer require   drupal/memcache
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/settings.memcache.php
    - sites/default/settings.memcache.php
  - CmdLine:
    - composer require   drupal/purge   drupal/varnish_purge
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - files/install-drupal.sh
    - install-drupal.sh
  - CmdLine:
    - chmod +x install-drupal.sh
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
    - "3306"
    - "443"
    - "80"
  - CmdLine:
    - exec supervisord -n
    Name: cmd
    PrependShell: true
  From:
    Image: jianhe/php
  Name: ""
  Platform: ""
  SourceCode: FROM jianhe/php
