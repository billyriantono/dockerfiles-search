MetaArgs: null
Stages:
- BaseName: centos:7
  Commands:
  - CmdLine:
    - yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm                    https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y ImageMagick                    httpd                    php72w
      php72w-cli php72w-common php72w-devel php72w-embedded php72w-fpm php72w-gd php72w-mbstring
      php72w-mysqlnd php72w-opcache php72w-pdo php72w-xml                    curl
      bzip2 zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel
      tk-devel gcc make libffi-devel &&     yum clean all -y
    Name: run
    PrependShell: true
  - Env:
    - Key: PYTHON_VERSION
      Value: 3.7.4
    Name: env
  - CmdLine:
    - "curl -fSL \"https://www.python.org/ftp/python/${PYTHON_VERSION}/Python-${PYTHON_VERSION}.tgz\"
      -o Python.tgz \t&& tar -xz -f Python.tgz \t&& cd Python-${PYTHON_VERSION} \t&&
      ./configure \t&& make \t&& make install"
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/www/data     && chown -R apache:apache /var/www/data     && chown
      -R apache:apache /var/www/html
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html
  - Env:
    - Key: MEDIAWIKI_MAJOR_VERSION
      Value: "1.32"
    Name: env
  - Env:
    - Key: MEDIAWIKI_VERSION
      Value: 1.32.3
    Name: env
  - CmdLine:
    - "curl -fSL \"https://releases.wikimedia.org/mediawiki/${MEDIAWIKI_MAJOR_VERSION}/mediawiki-${MEDIAWIKI_VERSION}.tar.gz\"
      -o mediawiki.tar.gz \t&& tar -xz --strip-components=1 -f mediawiki.tar.gz \t&&
      rm mediawiki.tar.gz \t&& chown -R apache:apache extensions skins cache images"
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -fSL "https://wiki.openstreetmap.org/osm_logo_wiki.png" -o resources/assets/wiki.png
    Name: run
    PrependShell: true
  - Env:
    - Key: MATH_VERSION
      Value: REL1_32-b976708
    Name: env
  - CmdLine:
    - "curl -fSL \"https://extdist.wmflabs.org/dist/extensions/Math-${MATH_VERSION}.tar.gz\"
      -o Math.tar.gz \t&& tar -xz -f Math.tar.gz -C extensions \t&& rm Math.tar.gz
      \t&& chown -R apache:apache extensions skins cache images"
    Name: run
    PrependShell: true
  - Env:
    - Key: LANGUAGE_VERSION
      Value: "2019.04"
    Name: env
  - CmdLine:
    - "curl -fSL \"https://translatewiki.net/mleb/MediaWikiLanguageExtensionBundle-${LANGUAGE_VERSION}.tar.bz2\"
      -o MediaWikiLanguageExtensionBundle.tar.bz2 \t&& tar -xj -f MediaWikiLanguageExtensionBundle.tar.bz2
      \t&& rm MediaWikiLanguageExtensionBundle.tar.bz2 \t&& chown -R apache:apache
      extensions skins cache images"
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - LocalSettings.php
    - LocalSettings.php
  - CmdLine:
    - echo "ServerName 0.0.0.0:80" >> /etc/httpd/conf/httpd.conf
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - /usr/sbin/httpd
    - -DFOREGROUND
    Name: entrypoint
    PrependShell: false
  From:
    Image: centos:7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:7
