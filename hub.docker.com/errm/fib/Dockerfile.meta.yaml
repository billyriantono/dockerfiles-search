MetaArgs: null
Stages:
- As: build
  BaseName: alpine:3.9
  Commands:
  - Env:
    - Key: BUNDLE_SILENCE_ROOT_WARNING
      Value: "1"
    Name: env
  - Name: workdir
    Path: /app
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - Gemfile
    - Gemfile.lock
    - ./
  - CmdLine:
    - apk add --no-cache ruby ruby-dev ruby-bundler ruby-json build-base  && bundle
      install --frozen -j4 -r3 --no-cache --without development  && apk del --no-cache
      ruby-bundler  && rm -rf /usr/lib/ruby/gems/*/cache
    Name: run
    PrependShell: true
  From:
    Image: alpine:3.9
  Name: build
  Platform: ""
  SourceCode: FROM alpine:3.9 as build
- As: prod
  BaseName: alpine:3.9
  Commands:
  - Chown: ""
    From: build
    Name: copy
    SourcesAndDest:
    - /usr/lib/ruby/gems
    - /usr/lib/ruby/gems
  - CmdLine:
    - 'apk add --no-cache ruby ruby-json ruby-etc apache2-utils  && ruby -e "Gem::Specification.map.each
      do |spec|       Gem::Installer.for_spec(         spec,         wrappers: true,         force:
      true,         install_dir: spec.base_dir,         build_args: spec.build_args,       ).generate_bin     end"'
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /app
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - .
  - Env:
    - Key: PORT
      Value: "9292"
    - Key: WEB_CONCURRENCY
      Value: "4"
    - Key: WEB_MAX_THREADS
      Value: "4"
    - Key: RACK_ENV
      Value: production
    Name: env
  - Name: expose
    Ports:
    - $PORT
  - Name: user
    User: nobody
  - Name: stopsignal
    Signal: SIGINT
  - CmdLine:
    - /usr/bin/puma
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:3.9
  Name: prod
  Platform: ""
  SourceCode: FROM alpine:3.9 as prod
