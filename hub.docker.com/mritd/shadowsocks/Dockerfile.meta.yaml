MetaArgs: null
Stages:
- BaseName: alpine:3.9
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"mritd <mritd1234@gmail.com>"'
    Name: label
  - Key: TZ
    Name: arg
    Value: '''Asia/Shanghai'''
  - Env:
    - Key: TZ
      Value: ${TZ}
    Name: env
  - Env:
    - Key: SS_LIBEV_VERSION
      Value: v3.2.4
    Name: env
  - Env:
    - Key: KCP_VERSION
      Value: "20190109"
    Name: env
  - Env:
    - Key: SS_DOWNLOAD_URL
      Value: https://github.com/shadowsocks/shadowsocks-libev.git
    Name: env
  - Env:
    - Key: OBFS_DOWNLOAD_URL
      Value: https://github.com/shadowsocks/simple-obfs.git
    Name: env
  - Env:
    - Key: V2RAY_PLUGIN_DOWNLOAD_URL
      Value: https://github.com/shadowsocks/v2ray-plugin/releases/download/v1.0/v2ray-plugin-linux-amd64-8cea1a3.tar.gz
    Name: env
  - Env:
    - Key: KCP_DOWNLOAD_URL
      Value: https://github.com/xtaci/kcptun/releases/download/v${KCP_VERSION}/kcptun-linux-amd64-${KCP_VERSION}.tar.gz
    Name: env
  - Env:
    - Key: LINUX_HEADERS_DOWNLOAD_URL
      Value: http://dl-cdn.alpinelinux.org/alpine/v3.7/main/x86_64/linux-headers-4.4.6-r2.apk
    Name: env
  - CmdLine:
    - "apk upgrade     && apk add bash tzdata rng-tools     && apk add --virtual .build-deps
      \        autoconf         automake         build-base         curl         c-ares-dev
      \        libev-dev         libtool         libsodium-dev         mbedtls-dev
      \        pcre-dev         tar         git     && curl -sSL ${LINUX_HEADERS_DOWNLOAD_URL}
      > /linux-headers-4.4.6-r2.apk     && apk add --virtual .build-deps-kernel /linux-headers-4.4.6-r2.apk
      \    && git clone ${SS_DOWNLOAD_URL}     && (cd shadowsocks-libev     && git
      checkout tags/${SS_LIBEV_VERSION} -b ${SS_LIBEV_VERSION}     && git submodule
      update --init --recursive     && ./autogen.sh     && ./configure --prefix=/usr
      --disable-documentation     && make install)     && git clone ${OBFS_DOWNLOAD_URL}
      \    && (cd simple-obfs     && git submodule update --init --recursive     &&
      ./autogen.sh     && ./configure --disable-documentation     && make install)
      \    && curl -o v2ray_plugin.tar.gz -sSL ${V2RAY_PLUGIN_DOWNLOAD_URL}     &&
      tar -zxf v2ray_plugin.tar.gz     && mv v2ray-plugin_linux_amd64 /usr/bin/v2ray-plugin
      \    && curl -sSLO ${KCP_DOWNLOAD_URL}     && tar -zxf kcptun-linux-amd64-${KCP_VERSION}.tar.gz
      \    && mv server_linux_amd64 /usr/bin/kcpserver     && mv client_linux_amd64
      /usr/bin/kcpclient     && ln -sf /usr/share/zoneinfo/${TZ} /etc/localtime     &&
      echo ${TZ} > /etc/timezone     && apk del .build-deps .build-deps-kernel \t&&
      apk add --no-cache       $(scanelf --needed --nobanner /usr/bin/ss-* /usr/local/bin/obfs-*
      \      | awk '{ gsub(/,/, \"\\nso:\", $2); print \"so:\" $2 }'       | sort
      -u)     && rm -rf /linux-headers-4.4.6-r2.apk         kcptun-linux-amd64-${KCP_VERSION}.tar.gz
      \        shadowsocks-libev         simple-obfs         v2ray_plugin.tar.gz         /var/cache/apk/*"
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - entrypoint.sh
    - /entrypoint.sh
  - CmdLine:
    - /entrypoint.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: alpine:3.9
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:3.9
