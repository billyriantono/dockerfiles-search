MetaArgs: null
Stages:
- BaseName: nginx:alpine
  Commands:
  - Env:
    - Key: DOCKERIZE_VERSION
      Value: v0.6.1
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - chroma-manager.conf.template
    - /tmp
  - CmdLine:
    - apk update && apk upgrade &&     apk add --no-cache sed openssl      && wget
      https://github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize-alpine-linux-amd64-$DOCKERIZE_VERSION.tar.gz     &&
      tar -C /usr/local/bin -xzvf dockerize-alpine-linux-amd64-$DOCKERIZE_VERSION.tar.gz     &&
      rm dockerize-alpine-linux-amd64-$DOCKERIZE_VERSION.tar.gz     && cat /tmp/chroma-manager.conf.template         |
      sed -E "s/\{\{(.*)}}/\{\{ \.Env\.\1 }}/g"         | sed -E 's/proxy_pass \{\{
      \.Env\.(.*) }}.*;/set $proxy_upstream \{\{ \.Env\.\1 }};\n\        proxy_pass
      $proxy_upstream$uri$is_args$query_string;/g'         | sed -E '/proxy_read_timeout.+;/a\\n    resolver
      127.0.0.11 ipv6=off valid=5s;\n\    resolver_timeout 5s;'         | sed -E '/location
      \/iml-device-aggregator \{/{N;N;N;N;s/$/\n        client_body_buffer_size 1m;\n\        client_max_body_size
      8m;\n/}'         > /etc/nginx/conf.d/iml.template     && rm -rf /tmp/chroma-manager.conf.template     &&
      apk del sed gettext
    Name: run
    PrependShell: true
  - Chown: ""
    From: imlteam/gui
    Name: copy
    SourcesAndDest:
    - /home/node/GUI
    - /usr/lib/iml-manager/iml-gui
  - Chown: ""
    From: imlteam/online-help
    Name: copy
    SourcesAndDest:
    - /root
    - /usr/lib/iml-manager/iml-online-help
  - Chown: ""
    From: imlteam/old-gui
    Name: copy
    SourcesAndDest:
    - /root
    - /usr/lib/node_modules/@iml/old-gui
  - Chown: ""
    From: imlteam/socket-worker
    Name: copy
    SourcesAndDest:
    - /root
    - /usr/lib/node_modules/@iml/socket-worker/targetdir
  - CmdLine:
    - dockerize -template /etc/nginx/conf.d/iml.template:/etc/nginx/conf.d/default.conf
      -stdout /var/log/nginx/access.log -stderr /var/log/nginx/error.log -wait file:///var/lib/chroma/iml-settings.conf
      nginx
    Name: cmd
    PrependShell: true
  From:
    Image: nginx:alpine
  Name: ""
  Platform: ""
  SourceCode: FROM nginx:alpine
