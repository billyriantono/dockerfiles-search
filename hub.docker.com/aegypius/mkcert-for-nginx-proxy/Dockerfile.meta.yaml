MetaArgs: null
Stages:
- As: builder
  BaseName: debian
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Nicolas LAURENT <docker@aegypius.com>"'
    Name: label
  - CmdLine:
    - apt update -qy && apt install -y curl lzma
    Name: run
    PrependShell: true
  - Env:
    - Key: DEBUG
      Value: "false"
    - Key: DOCKER_GEN_VERSION
      Value: 0.7.4
    - Key: MKCERT_VERSION
      Value: 1.4.1
    - Key: SANDBOX_VERSION
      Value: "2.2"
    - Key: DOCKER_HOST
      Value: unix:///var/run/docker.sock
    Name: env
  - Name: workdir
    Path: /usr/local/bin
  - CmdLine:
    - curl -L https://github.com/jwilder/docker-gen/releases/download/${DOCKER_GEN_VERSION}/docker-gen-linux-amd64-${DOCKER_GEN_VERSION}.tar.gz  |
      tar -C . -xz
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -L https://github.com/FiloSottile/mkcert/releases/download/v${MKCERT_VERSION}/mkcert-v${MKCERT_VERSION}-linux-amd64
      -o ./mkcert
    Name: run
    PrependShell: true
  From:
    Image: debian
  Name: builder
  Platform: ""
  SourceCode: FROM debian as builder
- BaseName: debian
  Commands:
  - Env:
    - Key: DEBUG
      Value: "false"
    - Key: DOCKER_HOST
      Value: unix:///var/run/docker.sock
    - Key: CAROOT
      Value: /app/ca
    Name: env
  - Name: volume
    Volumes:
    - /app/certs
    - /app/ca
  - Name: workdir
    Path: /app/certs
  - CmdLine:
    - apt-get update -qqy && apt-get install -qy openssl libnss3-tools ca-certificates
      procps jq curl
    Name: run
    PrependShell: true
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/local/bin/docker-gen
    - /usr/local/bin/docker-gen
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /usr/local/bin/mkcert
    - /usr/local/bin/mkcert
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./app
    - /app
  - CmdLine:
    - chmod +x /usr/local/bin/docker-gen /usr/local/bin/mkcert /app/*
    Name: run
    PrependShell: true
  - CmdLine:
    - /app/entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /app/start.sh
    Name: cmd
    PrependShell: false
  From:
    Image: debian
  Name: ""
  Platform: ""
  SourceCode: FROM debian
