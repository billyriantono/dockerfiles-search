{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "th0liveira/java:1.8.0",
      "SourceCode": "FROM th0liveira/java:1.8.0",
      "Platform": "",
      "From": {
        "Image": "th0liveira/java:1.8.0"
      },
      "Commands": [
        {
          "Env": [
            {
              "Key": "VERSION",
              "Value": "5.6.8"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "DOWNLOAD_URL",
              "Value": "\"https://artifacts.elastic.co/downloads/elasticsearch\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "ES_TARBAL",
              "Value": "\"${DOWNLOAD_URL}/elasticsearch-${VERSION}.tar.gz\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "ES_TARBALL_ASC",
              "Value": "\"${DOWNLOAD_URL}/elasticsearch-${VERSION}.tar.gz.asc\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "EXPECTED_SHA_URL",
              "Value": "\"${DOWNLOAD_URL}/elasticsearch-${VERSION}.tar.gz.sha512\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "ES_TARBALL_SHA",
              "Value": "\"b306b7e09ad14aaf7e20c3dbac1bc1496b9cb4cfb98b6111aaabf955af88f3fa0d77c72153f278bec11356e022f5c339248d185618b47cb140717bbd3fae09cb\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "GPG_KEY",
              "Value": "\"46095ACC8548582C1A2699A9D27D666CD88E42B4\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "ELASTICSEARCH_USER",
              "Value": "\"user\""
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "ELASTICSEARCH_DATA",
              "Value": "\"/mnt/data\""
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "apk add --no-cache -t .build-deps ca-certificates gnupg openssl su-exec wget"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "set -ex \u0026\u0026     cd /tmp \u0026\u0026     echo \"===\u003e Install Elasticsearch...\" \u0026\u0026     wget --progress=bar:force -O elasticsearch.tar.gz \"$ES_TARBAL\" \u0026\u0026     if [ \"$ES_TARBALL_SHA\" ]; then         echo \"$ES_TARBALL_SHA *elasticsearch.tar.gz\" | sha512sum -c -;     fi;     if [ \"$ES_TARBALL_ASC\" ]; then         wget --progress=bar:force -O elasticsearch.tar.gz.asc \"$ES_TARBALL_ASC\";         export GNUPGHOME=\"$(mktemp -d)\";         ( gpg --keyserver ha.pool.sks-keyservers.net --recv-keys \"$GPG_KEY\"             || gpg --keyserver pgp.mit.edu --recv-keys \"$GPG_KEY\"             || gpg --keyserver keyserver.pgp.com --recv-keys \"$GPG_KEY\" );         gpg --batch --verify elasticsearch.tar.gz.asc elasticsearch.tar.gz;         rm -rf \"$GNUPGHOME\" elasticsearch.tar.gz.asc || true;     fi;     tar -xf elasticsearch.tar.gz \u0026\u0026     ls -lah \u0026\u0026     mv elasticsearch-$VERSION /usr/share/elasticsearch \u0026\u0026     echo \"===\u003e Creating Elasticsearch Paths...\" \u0026\u0026     for path in         /usr/share/elasticsearch/data         /usr/share/elasticsearch/logs         /usr/share/elasticsearch/config         /usr/share/elasticsearch/config/scripts         /usr/share/elasticsearch/plugins     ; do         mkdir -p \"$path\";         chown -R ${ELASTICSEARCH_USER}.${ELASTICSEARCH_USER} \"$path\";     done"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "/usr/share/elasticsearch/bin/elasticsearch-plugin install analysis-phonetic"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "/usr/share/elasticsearch/bin/elasticsearch-plugin install analysis-icu"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir -p ${ELASTICSEARCH_DATA}"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "config/elasticsearch.yml",
            "/usr/share/elasticsearch/config/elasticsearch.yml"
          ]
        },
        {
          "CmdLine": [
            "chown -Rf ${ELASTICSEARCH_USER}.${ELASTICSEARCH_USER} ${ELASTICSEARCH_DATA} /usr/share/elasticsearch"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "rm -rf /tmp/* /var/cache/apk/* ;     apk del --purge .build-deps wget"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "workdir",
          "Path": "/mnt"
        },
        {
          "Name": "expose",
          "Ports": [
            "9200"
          ]
        },
        {
          "Name": "expose",
          "Ports": [
            "9300"
          ]
        },
        {
          "Name": "expose",
          "Ports": [
            "80"
          ]
        },
        {
          "CmdLine": [
            "echo -e \"[program:elasticsearch] \\ncommand=/usr/share/elasticsearch/bin/elasticsearch --verbose \\nuser=${ELASTICSEARCH_USER} \\nprocess_name=%(program_name)s_%(process_num)02d \\nnumprocs=1 \\nenvironment=ES_JAVA_OPTS=\\\"-Xms512m -Xmx512m\\\" \\nautostart=true \\nautorestart=false \\nstartsecs=5 \\nredirect_stderr=true \\nstdout_logfile=/dev/stdout \\nstdout_logfile_maxbytes=0 \" \u003e /etc/supervisord/elasticsearch.conf"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    }
  ]
}