MetaArgs: null
Stages:
- BaseName: demontsai/ubuntu64:14.04
  Commands:
  - Maintainer: Demon Tsai demontsai@estinet.com
    Name: maintainer
  - CmdLine:
    - apt-get -qq update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -qqy install vim wget dpkg-dev ssl-cert quilt fakeroot        libcurl4-openssl-dev
      libcap-dev libjson0-dev libjson-c-dev         libreadline-dev libsqlite3-dev
      libtalloc-dev libwbclient-dev         libyubikey-dev libykclient-dev libmemcached-dev
      libhiredis-dev samba-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y build-dep freeradius
    Name: run
    PrependShell: true
  - Env:
    - Key: FREERADIUS_VERSION
      Value: 3.0.11
    Name: env
  - Env:
    - Key: FREERADIUS_URL
      Value: ftp://ftp.freeradius.org/pub/freeradius/freeradius-server-$FREERADIUS_VERSION.tar.gz
    Name: env
  - Env:
    - Key: SQL_CFG
      Value: /etc/freeradius/mods-enabled/sql
    Name: env
  - Name: workdir
    Path: /root
  - CmdLine:
    - wget $FREERADIUS_URL
    Name: run
    PrependShell: true
  - CmdLine:
    - tar xzvf freeradius-server-$FREERADIUS_VERSION.tar.gz
    Name: run
    PrependShell: true
  - Name: workdir
    Path: freeradius-server-$FREERADIUS_VERSION
  - CmdLine:
    - dpkg-buildpackage -b -uc
    Name: run
    PrependShell: true
  - CmdLine:
    - dpkg -i ../*.deb
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /root
  - CmdLine:
    - sed -i 's/FREERADIUS_OPTIONS=.*/FREERADIUS_OPTIONS=\"-f -X -P\"/1' /etc/default/freeradius
    Name: run
    PrependShell: true
  - CmdLine:
    - cp /etc/freeradius/mods-available/sql $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/"rlm_sql_null"/"rlm_sql_mysql"/1' $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/dialect = "sqlite"/dialect = "mysql"/1' $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/.*read_clients = yes/    read_clients = yes/1' $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/.*server = "localhost"/    server = "localhost"/1' $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/.*port = 3306/    port = 3306/1' $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/.*login = "radius"/    login = "radius"/1' $SQL_CFG
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's/.*password = "radpass"/    password = "radpass"/1' $SQL_CFG
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - raddbcfg
    - /usr/sbin/raddbcfg
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - radinit
    - /usr/sbin/radinit
  - CmdLine:
    - echo "radinit && service freeradius start" >> $ENTRYPOINT
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - 1812/udp
    - 1813/udp
  - CmdLine:
    - apt-get clean
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /root/*freeradius*
    Name: run
    PrependShell: true
  - CmdLine:
    - $ENTRYPOINT
    Name: entrypoint
    PrependShell: true
  From:
    Image: demontsai/ubuntu64:14.04
  Name: ""
  Platform: ""
  SourceCode: FROM demontsai/ubuntu64:14.04
