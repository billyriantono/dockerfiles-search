MetaArgs: null
Stages:
- BaseName: hawkular/docker-maven
  Commands:
  - Maintainer: Matt Mahoney <mmahoney@redhat.com> USER root
    Name: maintainer
  - Env:
    - Key: PATH
      Value: .:$PATH RUN echo "root:redhat" | chpasswd
    Name: env
  - CmdLine:
    - yum -y install wget git openssh-server httpd supervisor
    Name: run
    PrependShell: true
  - CmdLine:
    - groupadd hudson
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd -m -g hudson -s /bin/bash hudson
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "hudson:hudson" | chpasswd
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /var/run/sshd
    Name: run
    PrependShell: true
  - CmdLine:
    - ssh-keygen -A
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/#PermitRootLogin yes/PermitRootLogin yes/g' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/UsePAM yes/#UsePAM yes/g' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/#UsePAM no/UsePAM no/g' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/lib
  - CmdLine:
    - wget http://archive.apache.org/dist/ant/binaries/apache-ant-1.9.4-bin.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - tar -xvf apache-ant-1.9.4-bin.tar.gz; rm apache-ant-1.9.4-bin.tar.gz
    Name: run
    PrependShell: true
  - Env:
    - Key: PATH
      Value: /usr/lib/apache-ant-1.9.4/bin:$PATH
    Name: env
  - Env:
    - Key: ANT_HOME
      Value: /usr/lib/apache-ant-1.9.4
    Name: env
  - CmdLine:
    - mkdir -p /var/www/html/hawkular-test-results/debug; chmod -R 777 /var/www/html/hawkular-test-results/debug
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "Hawkular Test Results Directory" > /var/www/html/hawkular-test-results/Hawkular-README.txt
    Name: run
    PrependShell: true
  - CmdLine:
    - printf "\n[supervisord]\nnodaemon=true\n[program:sshd]\ncommand=/bin/bash -c
      /usr/sbin/sshd\n[program:httpd]\ncommand=/bin/bash -c /usr/sbin/httpd\n" >>
      /etc/supervisord.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - printf "\n[program:hawkuklar-test]\ncommand=/bin/bash -x /home/hudson/start.sh\n"
      >> /etc/supervisord.conf
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
    - "80"
  - Name: user
    User: hudson
  - Name: workdir
    Path: /home/hudson
  - Env:
    - Key: PATH
      Value: .:$PATH
    Name: env
  - CmdLine:
    - git clone https://github.com/RedHatQE/hawkular-smoke-test.git
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /home/hudson; git clone https://github.com/apache/jmeter.git; cd jmeter;
      ant download_jars; ant
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://github.com/ahovsepy/hawkular-ui-test.git
    Name: run
    PrependShell: true
  - CmdLine:
    - cd hawkular-ui-test; mvn clean install -DskipTests
    Name: run
    PrependShell: true
  - CmdLine:
    - printf "1=firefox:24.0:Linux" > /home/hudson/hawkular-ui-test/src/test/resources/browserAndOs.properties
    Name: run
    PrependShell: true
  - CmdLine:
    - git clone https://github.com/Hawkular-QE/hawkular-java-client.git
    Name: run
    PrependShell: true
  - CmdLine:
    - cd hawkular-java-client; mvn clean install -DskipTests dependency:go-offline
    Name: run
    PrependShell: true
  - CmdLine:
    - printf ""#!"/bin/bash\nexport HAWKULAR_ENDPOINT=\$IP\necho IP \$IP >> /var/www/html/hawkular-test-results/debug/debug-info.txt\necho
      HAWKULAR_ENDPOINT \$HAWKULAR_ENDPOINT >> /var/www/html/hawkular-test-results/debug/debug-info.txt\ndf
      >> /var/www/html/hawkular-test-results/debug/debug-info.txt\nsleep 2m;\ncd /home/hudson/hawkular-smoke-test/tests;\ntestRunner.sh
      > /var/www/html/hawkular-test-results/script-test-results.txt;\nwget --retry-connrefused  --timeout=10
      -t 50  -w 5 --spider \$IP\ncd /home/hudson/hawkular-ui-test; mvn test -DhawkularUrl=\$IP
      -DauthenticationKey=\$AUTH_KEY > /var/www/html/hawkular-test-results/debug/ui-debug.txt
      2>&1; cp /home/hudson/hawkular-ui-test/target/surefire-reports/testng-results.xml
      /var/www/html/hawkular-test-results/ui-test-results.xml; cp /home/hudson/hawkular-ui-test/target/surefire-reports/emailable-report.html
      /var/www/html/hawkular-test-results/ui-test-results.html\n"#"cd /home/hudson/hawkular-java-client;
      mvn -U test -Pci > /var/www/html/hawkular-test-results/debug/rest-client-debug.txt
      2>&1; cp /home/hudson/hawkular-java-client/target/surefire-reports/testng-results.xml
      /var/www/html/hawkular-test-results/rest-client-results.xml; cp /home/hudson/hawkular-java-client/target/surefire-reports/emailable-report.html
      /var/www/html/hawkular-test-results/rest-client-results.html\n" >> /home/hudson/start.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 766 /home/hudson/start.sh
    Name: run
    PrependShell: true
  - Name: user
    User: root
  - Name: workdir
    Path: /home/hudson
  - CmdLine:
    - /usr/bin/supervisord
    Name: cmd
    PrependShell: false
  From:
    Image: hawkular/docker-maven
  Name: ""
  Platform: ""
  SourceCode: FROM hawkular/docker-maven
