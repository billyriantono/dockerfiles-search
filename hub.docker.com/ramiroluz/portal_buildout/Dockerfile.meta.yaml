MetaArgs: null
Stages:
- BaseName: ubuntu:14.04
  Commands:
  - Chown: ""
    Name: add
    SourcesAndDest:
    - VERSION
    - .
  - CmdLine:
    - useradd --system --shell /bin/bash --comment 'Plone Administrator'   --user-group
      -m --home-dir /opt/plone plone  && mkdir -p /opt/plone /data/filestorage /data/blobstorage  &&
      chown -R plone:plone /opt/plone /data
    Name: run
    PrependShell: true
  - Labels:
    - Key: plone.version
      Value: 4.3.9
    Name: label
  - Labels:
    - Key: os
      Value: '"ubuntu"'
    - Key: os.version
      Value: '"14.04"'
    Name: label
  - CmdLine:
    - buildDeps="curl sudo python-setuptools python-dev build-essential libssl-dev
      libxml2-dev libxslt1-dev libbz2-dev libjpeg62-dev zlib1g-dev python-imaging
      wv poppler-utils git ca-certificates"  && runDeps="libxml2 libxslt1.1 libjpeg62
      rsync"  && apt-get update  && apt-get install -y --no-install-recommends $buildDeps  &&
      chown -R plone:plone /opt/plone /data  && sudo -u plone git clone https://github.com/plonegovbr/portal.buildout.git
      /opt/plone/portal.buildout  && chown -R plone:plone /opt/plone /data  && cd
      /opt/plone/portal.buildout  && apt-get install -y --no-install-recommends $runDeps  &&
      sudo -u plone git checkout tags/1.1.5.2
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - base.cfg
    - /opt/plone/portal.buildout/buildout.d/base.cfg
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - buildout.cfg
    - /opt/plone/portal.buildout/buildout.cfg
  - CmdLine:
    - sudo -u plone python /opt/plone/portal.buildout/bootstrap.py -c /opt/plone/portal.buildout/buildout.cfg  &&
      sudo -u plone python /opt/plone/portal.buildout/bin/buildout -c  /opt/plone/portal.buildout/buildout.cfg  &&
      sed -i 's/^nodaemon = false$/nodaemon = true/' /opt/plone/portal.buildout/parts/supervisor/supervisord.conf
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "8000"
  - Name: user
    User: plone
  - Name: workdir
    Path: /opt/plone/portal.buildout
  - CmdLine:
    - /opt/plone/portal.buildout/bin/supervisord
    Name: entrypoint
    PrependShell: false
  From:
    Image: ubuntu:14.04
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:14.04
