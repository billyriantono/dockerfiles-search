MetaArgs: null
Stages:
- BaseName: ubuntu:latest
  Commands:
  - Maintainer: Michal Kononenko "@MichalKononenko"
    Name: maintainer
  - Env:
    - Key: VERSION
      Value: '"1.0-rc1"'
    Name: env
  - Env:
    - Key: DESCRIPTION
      Value: '"Asynchronous job queue for running services"'
    Name: env
  - Env:
    - Key: SOURCE_REPOSITORY
      Value: '"https://github.com/TopChef/TopChef.git"'
    Name: env
  - Env:
    - Key: HOSTNAME
      Value: '"0.0.0.0"'
    Name: env
  - Env:
    - Key: PORT
      Value: '"80"'
    Name: env
  - Env:
    - Key: THREADS
      Value: '"20"'
    Name: env
  - Env:
    - Key: DEBUG
      Value: '"TRUE"'
    Name: env
  - Env:
    - Key: SERVER_NAME
      Value: '"topchef-docker"'
    Name: env
  - Env:
    - Key: BASE_DIRECTORY
      Value: '"/var/www/topchef"'
    Name: env
  - Env:
    - Key: SCHEMA_DIRECTORY
      Value: '"/var/www/topchef/schemas"'
    Name: env
  - Env:
    - Key: LOGFILE
      Value: '"/var/www/topchef/topchef.log"'
    Name: env
  - Env:
    - Key: DATABASE_URI
      Value: '"sqlite:////var/www/topchef/db.sqlite3"'
    Name: env
  - CmdLine:
    - apt-get clean  && apt-get update --fix-missing  && apt-get -y upgrade
    Name: run
    PrependShell: true
  - CmdLine:
    - echo $SERVER_NAME > /etc/hostname
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y apt-utils     apache2     libapache2-mod-wsgi-py3     python3     python3-pip     wget  &&
      apt-get clean  && apt-get autoremove  && rm -rf /var/lib/apt/lists
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - /opt/source
  - Name: workdir
    Path: /opt/source
  - CmdLine:
    - pip3 install .
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./apache/topchef.conf
    - /etc/apache2/sites-available/topchef.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./apache/topchef.wsgi
    - /var/www/topchef/topchef.wsgi
  - CmdLine:
    - python3 topchef create-db
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/topchef
  - CmdLine:
    - a2dissite 000-default.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - a2ensite topchef.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -r /opt/source
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get remove -y --purge python3-pip  && apt-get clean  && apt-get autoremove
      -y
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://bootstrap.pypa.io/ez_setup.py -O - | python3
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get remove -y --purge wget  && apt-get clean  && apt-get autoremove -y
    Name: run
    PrependShell: true
  - CmdLine:
    - chown root:www-data /var/www/topchef
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 775 /var/www/topchef
    Name: run
    PrependShell: true
  - CmdLine:
    - chown root:www-data /var/www/topchef/db.sqlite3
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 664 /var/www/topchef/db.sqlite3
    Name: run
    PrependShell: true
  - CmdLine:
    - chown root:www-data /var/www/topchef/topchef.log
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 664 /var/www/topchef/topchef.log
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - /usr/sbin/apache2ctl -D FOREGROUND
    Name: entrypoint
    PrependShell: true
  From:
    Image: ubuntu:latest
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:latest
