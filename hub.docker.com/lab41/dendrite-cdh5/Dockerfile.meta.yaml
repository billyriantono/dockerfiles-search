MetaArgs: null
Stages:
- BaseName: lab41/dendrite-java
  Commands:
  - Maintainer: Charlie Lewis <charliel@lab41.org>
    Name: maintainer
  - Chown: ""
    Name: add
    SourcesAndDest:
    - cdh5-repository_1.0_all.deb
    - cdh5-repository_1.0_all.deb
  - CmdLine:
    - dpkg -i cdh5-repository_1.0_all.deb
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -s http://archive.cloudera.com/cdh5/ubuntu/precise/amd64/cdh/archive.key
      | apt-key add -
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "deb [arch=amd64] http://archive.cloudera.com/cdh5/ubuntu/precise/amd64/cdh
      precise-cdh5 contrib\ndeb-src http://archive.cloudera.com/cdh5/ubuntu/precise/amd64/cdh
      precise-cdh5 contrib" > /etc/apt/sources.list.d/cloudera.list
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - "apt-get install -y hadoop-hdfs-datanode                        hadoop-hdfs-namenode
      \                       hadoop-mapreduce                        hadoop-mapreduce-historyserver
      \                       hadoop-yarn-nodemanager                        hadoop-yarn-proxyserver
      \                       hadoop-yarn-resourcemanager                        hbase-master
      \                       hbase-regionserver \t\t       zookeeper                        zookeeper-server"
    Name: run
    PrependShell: true
  - CmdLine:
    - service zookeeper-server init
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - zookeeper.conf
    - /etc/supervisor/conf.d/zookeeper.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hadoop-hdfs-namenode.conf
    - /etc/supervisor/conf.d/hadoop-hdfs-namenode.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hadoop-hdfs-datanode.conf
    - /etc/supervisor/conf.d/hadoop-hdfs-datanode.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hadoop-mapreduce.conf
    - /etc/supervisor/conf.d/hadoop-mapreduce.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hadoop-yarn-nodemanager.conf
    - /etc/supervisor/conf.d/hadoop-yarn-nodemanager.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hadoop-yarn-resourcemanager.conf
    - /etc/supervisor/conf.d/hadoop-yarn-resourcemanager.conf
  - CmdLine:
    - sed -i 's|</configuration>|<property><name>yarn.nodemanager.resource.memory-mb</name><value>8192</value></property></configuration>|'
      /etc/hadoop/conf/yarn-site.xml;     sed -i 's|JAVA_HEAP_MAX=-Xmx1000m|JAVA_HEAP_MAX=-Xmx8192m|'
      /etc/hadoop/conf/yarn-env.sh
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hbase-master.conf
    - /etc/supervisor/conf.d/hbase-master.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - hbase-regionserver.conf
    - /etc/supervisor/conf.d/hbase-regionserver.conf
  - CmdLine:
    - echo 'export JAVA_HOME=/usr/lib/jvm/jdk1.7.0_51' >> /etc/hbase/conf/hbase-env.sh;     sed
      -i 's|<configuration>|<configuration><property><name>hbase.cluster.distributed</name><value>true</value></property><property><name>hbase.rootdir</name><value>hdfs://localhost:54310/hbase</value></property>|'
      /etc/hbase/conf/hbase-site.xml
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i 's|<configuration>|<configuration><property><name>fs.default.name</name><value>hdfs://localhost:54310/</value><description>.</description></property>|'
      /etc/hadoop/conf/core-site.xml
    Name: run
    PrependShell: true
  - CmdLine:
    - su -c "hadoop namenode -format" - hdfs
    Name: run
    PrependShell: true
  - CmdLine:
    - service hadoop-hdfs-namenode start;     service hadoop-hdfs-datanode start;     su
      -c "hadoop fs -mkdir /user" - hdfs;     su -c "hadoop fs -mkdir /user/root"
      - hdfs;     su -c "hadoop fs -mkdir /user/root/dendrite" - hdfs;     su -c "hadoop
      fs -chown -R root:root /user/root" - hdfs;     su -c "hadoop fs -mkdir /tmp"
      - hdfs;     su -c "hadoop fs -mkdir /hbase" - hdfs;     su -c "hadoop fs -chown
      hbase /hbase" - hdfs;     su -c "hadoop fs -chmod -R 777 /tmp" - hdfs;     su
      -c "hadoop fs -mkdir /user/tomcat7" - hdfs;     su -c "hadoop fs -chown -R tomcat7
      /user/tomcat7" - hdfs;     su -c "hadoop fs -chmod -R 777 /user/tomcat7" - hdfs
    Name: run
    PrependShell: true
  From:
    Image: lab41/dendrite-java
  Name: ""
  Platform: ""
  SourceCode: FROM lab41/dendrite-java
