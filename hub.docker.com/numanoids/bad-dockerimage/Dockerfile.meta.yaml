MetaArgs: null
Stages:
- BaseName: centos:centos7.2.1511
  Commands:
  - Maintainer: adrianp@stindustries.net
    Name: maintainer
  - Key: CURL_OPTIONS
    Name: arg
    Value: '""'
  - CmdLine:
    - yum -y install deltarpm && yum -y update
    Name: run
    PrependShell: true
  - CmdLine:
    - touch /var/lib/rpm/* &&     yum -y install bison gnutls-devel gcc libidn-devel
      gcc-c++ bzip2 &&     yum clean all
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.0.1406/os/x86_64/Packages/wget-1.14-10.el7.x86_64.rpm
      &&     yum -y install wget-1.14-10.el7.x86_64.rpm &&     rm *.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://www.mirrorservice.org/sites/ftp.gnu.org/gnu/wget/wget-1.15.tar.gz
      &&     tar zxf wget-1.15.tar.gz &&     cd wget-1.15 &&     ./configure --prefix=/opt/wget
      &&     make &&     make install &&     cd .. &&     rm -rf wget-1.15 &&     rm
      *.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       https://sourceforge.net/projects/p7zip/files/p7zip/9.20.1/p7zip_9.20.1_src_all.tar.bz2
      &&     bzcat p7zip_9.20.1_src_all.tar.bz2 | tar x &&     cd p7zip_9.20.1 &&     cp
      install.sh install.sh.orig &&     cat install.sh.orig | sed -e 's|DEST_HOME=/usr/local|DEST_HOME=/opt/p7zip|g'
      > install.sh &&     make &&     ./install.sh &&     cd - &&     rm -rf p7zip_9.20.1
      &&     rm *.tar.bz2
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       https://ftp.drupal.org/files/projects/drupal-7.42.tar.gz
      &&     tar zxf drupal-7.42.tar.gz &&     mkdir /opt/drupal &&     cd drupal-7.42
      &&     cp -R . /opt/drupal &&     cd - &&     rm -rf drupal-7.42 &&     rm -f
      *.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.69/bin/apache-tomcat-7.0.69.tar.gz
      &&     tar zxf apache-tomcat-7.0.69.tar.gz &&     mkdir /opt/tomcat &&     cd
      apache-tomcat-7.0.69 &&     cp -R . /opt/tomcat &&     cd - &&     rm -rf apache-tomcat-7.0.69
      &&     rm -f *.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.2.1511/updates/x86_64/Packages/java-1.8.0-openjdk-1.8.0.91-0.b14.el7_2.x86_64.rpm
      &&     curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.2.1511/updates/x86_64/Packages/java-1.8.0-openjdk-headless-1.8.0.91-0.b14.el7_2.x86_64.rpm
      &&     touch /var/lib/rpm/* &&     yum -y install java-1.8.0-openjdk-1.8.0.91-0.b14.el7_2.x86_64.rpm
      java-1.8.0-openjdk-headless-1.8.0.91-0.b14.el7_2.x86_64.rpm &&     rm -f *.rpm
      &&     echo "exclude=java-1.8.0-openjdk java-1.8.0-openjdk-headless"  >> /etc/yum.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.0.1406/os/x86_64/Packages/tomcat-7.0.42-4.el7.noarch.rpm
      &&     curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.0.1406/os/x86_64/Packages/tomcat-el-2.2-api-7.0.42-4.el7.noarch.rpm
      &&     curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.0.1406/os/x86_64/Packages/tomcat-jsp-2.2-api-7.0.42-4.el7.noarch.rpm
      &&     curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.0.1406/os/x86_64/Packages/tomcat-lib-7.0.42-4.el7.noarch.rpm
      &&     curl -LO ${CURL_OPTIONS}       http://vault.centos.org/7.0.1406/os/x86_64/Packages/tomcat-servlet-3.0-api-7.0.42-4.el7.noarch.rpm
      &&     touch /var/lib/rpm/* &&     yum -y install yum install tomcat-7.0.42-4.el7.noarch.rpm
      tomcat-lib-7.0.42-4.el7.noarch.rpm tomcat-servlet-3.0-api-7.0.42-4.el7.noarch.rpm
      tomcat-el-2.2-api-7.0.42-4.el7.noarch.rpm tomcat-jsp-2.2-api-7.0.42-4.el7.noarch.rpm
      &&     rm -f *.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}           https://pypi.python.org/packages/8c/2b/e6e2f554368785c7eb68d618fd6457625be1535e807f6abf11c7db710f34/hpack-2.1.1.tar.gz
      &&         tar xvf hpack-2.1.1.tar.gz &&         mkdir /opt/hpack &&         cd
      hpack-2.1.1 &&         cp -R . /opt/hpack &&         cd - &&         rm -rf
      hpack-2.1.1 &&         rm -f *.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.8.0/commons-beanutils-1.8.0-sources.jar
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       http://rubygems.org/downloads/activesupport-4.2.1.gem
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - utils.js
    - /tmp/utils.js
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       https://nodejs.org/dist/v0.10.41/node-v0.10.41-linux-x64.tar.gz
      &&     tar zxf node-v0.10.41-linux-x64.tar.gz &&     mkdir /opt/nodejs &&     cd
      node-v0.10.41-linux-x64 &&     cp -R . /opt/nodejs &&     cd - &&     rm -rf
      node-v0.10.41-linux-x64 &&     rm -rf *.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -LO ${CURL_OPTIONS}       https://ftp.gnu.org/gnu/bash/bash-4.3.tar.gz
      &&     tar zxf bash-4.3.tar.gz &&     mkdir /opt/bash && cd bash-4.3 &&     ./configure
      --prefix=/opt/bash &&     make &&     make install &&     cd .. &&     rm -rf
      bash-4.3 &&     rm -rf *.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - touch /var/lib/rpm/* &&     yum -y install rpm-build redhat-rpm-config rpmdevtools
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - rpmsquirt.sh
    - /rpmsquirt.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - rpmsquirt.dat
    - /
  - CmdLine:
    - /rpmsquirt.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - echo 'Vulnerable image' && /bin/false
    Name: cmd
    PrependShell: true
  - Labels:
    - Key: org.label-schema.name
      Value: '"bad-dockerfile"'
    - Key: org.label-schema.description
      Value: '"Reference Dockerfile containing software with known vulnerabilities."'
    - Key: org.label-schema.url
      Value: '"http://www.stindustries.net/docker/bad-dockerfile/"'
    - Key: org.label-schema.vcs-type
      Value: '"Git"'
    - Key: org.label-schema.vcs-url
      Value: '"https://github.com/ianmiell/bad-dockerfile"'
    - Key: org.label-schema.docker.dockerfile
      Value: '"/Dockerfile"'
    Name: label
  From:
    Image: centos:centos7.2.1511
  Name: ""
  Platform: ""
  SourceCode: FROM centos:centos7.2.1511
