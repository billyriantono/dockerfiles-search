MetaArgs: null
Stages:
- BaseName: frolvlad/alpine-glibc
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Starbix"'
    Name: label
  - Env:
    - Key: UID
      Value: "991"
    - Key: GID
      Value: "991"
    Name: env
  - Env:
    - Key: PORT
      Value: "3000"
    - Key: MOUNT_POINT
      Value: '"/mnt/acd"'
    - Key: TRANSCODER_DECAY_TIME
      Value: "120"
    - Key: PLEX_URL
      Value: '"http://myplex.com:32400"'
    - Key: BASE_URL
      Value: '"https://myplex.com"'
    - Key: REDIS_HOST
      Value: '"127.0.0.1"'
    - Key: REDIS_PORT
      Value: "6379"
    - Key: REDIS_PASSWORD
      Value: '""'
    - Key: REDIS_DB
      Value: "1"
    - Key: VIDEO_CONTENT_TYPE
      Value: '"video/x-matroska"'
    - Key: SUBTITLES_CONTENT_TYPE
      Value: '"text/vtt"'
    - Key: LD_LIBRARY_PATH
      Value: '"/opt/UnicornTranscoder/Resources/"'
    - Key: TRANSCODER_PATH
      Value: '"/opt/UnicornTranscoder/Resources/Plex Transcoder"'
    - Key: FFMPEG_EXTERNAL_LIBS
      Value: '"/opt/UnicornTranscoder/Codecs/"'
    - Key: EAE_ROOT
      Value: '"/opt/UnicornTranscoder/Cache/"'
    - Key: XDG_CACHE_HOME
      Value: '"/opt/UnicornTranscoder/Cache/"'
    - Key: XDG_DATA_HOME
      Value: '"/opt/UnicornTranscoder/Resources/Resources/"'
    - Key: PLEX_RESSOURCES
      Value: '"/opt/UnicornTranscoder/Resources/"'
    Name: env
  - Key: PLEX_VERSION
    Name: arg
    Value: '"1.13.4.5251-2e6e8f841"'
  - Key: CODEC_BUILD
    Name: arg
    Value: '"e944d3a-1309"'
  - Key: DEP
    Name: arg
    Value: '"141"'
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - rootfs
    - /
  - CmdLine:
    - "apk add -U \t\tnpm \t\tgit \t\tsu-exec \t\ts6 \t\tbinutils \t&& mkdir -p /opt
      \t&& cd /opt \t&& git clone https://github.com/UnicornTranscoder/UnicornTranscoder
      \t&& cd UnicornTranscoder \t&& npm install \t&& ./setup_transcode.sh \"https://downloads.plex.tv/plex-media-server/${PLEX_VERSION}/plexmediaserver_${PLEX_VERSION}_amd64.deb\"
      \t&& mkdir -p ${FFMPEG_EXTERNAL_LIBS} \t&& cd ${FFMPEG_EXTERNAL_LIBS} \t&& for
      codec in libhevc_decoder libh264_decoder libdca_decoder libac3_decoder libmp3_decoder
      libaac_decoder libaac_encoder libmpeg4_decoder libmpeg2video_decoder liblibmp3lame_encoder
      liblibx264_encoder; do \t wget https://downloads.plex.tv/codecs/${CODEC_BUILD}/linux-ubuntu-x86_64/${codec}.so;
      done \t&& cd /opt/UnicornTranscoder \t&& wget https://downloads.plex.tv/codecs/${DEP}/linux-ubuntu-x86_64/EasyAudioEncoder-linux-ubuntu-x86_64.zip
      \t&& unzip EasyAudioEncoder-linux-ubuntu-x86_64.zip \t&& mv EasyAudioEncoder/EasyAudioEncoder
      /opt/UnicornTranscoder/Codecs/ \t&& rm -rf EasyAudioEncoder EasyAudioEncoder-linux-ubuntu-x86_64.zip
      \t&& mkdir -p ${EAE_ROOT} \t&& chmod a+x /usr/local/bin/* /etc/s6.d/*/* \t&&
      apk del git \t&& rm -rf /tmp/* /var/cache/apk/*"
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "3000"
  - CmdLine:
    - run.sh
    Name: cmd
    PrependShell: false
  From:
    Image: frolvlad/alpine-glibc
  Name: ""
  Platform: ""
  SourceCode: FROM frolvlad/alpine-glibc
