MetaArgs:
- DefaultValue: latest
  Key: PARENT_VERSION
  ProvidedValue: null
  Value: latest
Stages:
- BaseName: p4lang/pi:${PARENT_VERSION}
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Antonin Bas <antonin@barefootnetworks.com>"'
    Name: label
  - Key: MAKEFLAGS
    Name: arg
    Value: -j2
  - Key: IMAGE_TYPE
    Name: arg
    Value: build
  - Key: CC
    Name: arg
    Value: gcc
  - Key: CXX
    Name: arg
    Value: g++
  - Key: GCOV
    Name: arg
    Value: ""
  - Key: sswitch_grpc
    Name: arg
    Value: "yes"
  - Env:
    - Key: BM_DEPS
      Value: automake             build-essential             clang-3.8             clang-6.0             curl             g++-7             git             lcov             libjudy-dev             libgmp-dev             libpcap-dev             libboost-dev             libboost-program-options-dev             libboost-system-dev             libboost-filesystem-dev             libboost-thread-dev             libtool             pkg-config
    Name: env
  - Env:
    - Key: BM_RUNTIME_DEPS
      Value: libboost-program-options1.58.0                     libboost-system1.58.0                     libboost-filesystem1.58.0                     libboost-thread1.58.0                     libgmp10
        libjudydebian1                     libpcap0.8                     python
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - /behavioral-model/
  - Name: workdir
    Path: /behavioral-model/
  - CmdLine:
    - apt-get update &&     apt-get install -y --no-install-recommends software-properties-common
      &&     add-apt-repository -y ppa:ubuntu-toolchain-r/test &&     apt-get update
      &&     apt-get install -y --no-install-recommends $BM_DEPS $BM_RUNTIME_DEPS
      &&     ./autogen.sh &&     if [ "$GCOV" != "" ]; then ./configure --with-pdfixed
      --with-pi --with-stress-tests --enable-debugger --enable-coverage --enable-Werror;
      fi &&     if [ "$GCOV" = "" ]; then ./configure --with-pdfixed --with-pi --with-stress-tests
      --enable-debugger --enable-Werror; fi &&     make &&     make install-strip
      &&     (test "$sswitch_grpc" = "yes" &&       cd targets/simple_switch_grpc/
      &&       ./autogen.sh &&       ./configure --enable-Werror &&       make &&       make
      install-strip &&       cd -) ||     (test "$sswitch_grpc" = "no") &&     ldconfig
      &&     (test "$IMAGE_TYPE" = "build" &&       apt-get purge -y $BM_DEPS &&       apt-get
      autoremove --purge -y &&       rm -rf /behavioral-model /var/cache/apt/* /var/lib/apt/lists/*
      &&       echo 'Build image ready') ||     (test "$IMAGE_TYPE" = "test" &&       echo
      'Test image ready')
    Name: run
    PrependShell: true
  From:
    Image: p4lang/pi:${PARENT_VERSION}
  Name: ""
  Platform: ""
  SourceCode: FROM p4lang/pi:${PARENT_VERSION}
