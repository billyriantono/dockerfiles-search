{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "alpine:latest",
      "SourceCode": "FROM alpine:latest",
      "Platform": "",
      "From": {
        "Image": "alpine:latest"
      },
      "Commands": [
        {
          "Maintainer": "boredazfcuk",
          "Name": "maintainer"
        },
        {
          "Key": "REQUIREMENTS",
          "Name": "arg",
          "Value": "\"python3 py-pip exiftool coreutils tzdata curl\""
        },
        {
          "Key": "BUILDDEPENDENCIES",
          "Name": "arg",
          "Value": "\"git gcc python3-dev musl-dev libffi-dev openssl-dev\""
        },
        {
          "Key": "PYTHONDEPENDENCIES",
          "Name": "arg",
          "Value": "\"docopt piexif click==6.0 certifi pytz tzlocal six chardet idna urllib3 requests future keyrings.alt==1.0 keyring==8.0 pyicloud-ipd tqdm schema python-dateutil\""
        },
        {
          "Key": "REPO",
          "Name": "arg",
          "Value": "\"ndbroadbent/icloud_photos_downloader\""
        },
        {
          "Env": [
            {
              "Key": "CONFIGDIR",
              "Value": "\"/config\""
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "echo \"$(date '+%d/%m/%Y - %H:%M:%S') | Install build dependencies\" \u0026\u0026    apk add --no-cache --no-progress --virtual=build-deps ${BUILDDEPENDENCIES} \u0026\u0026 echo \"$(date '+%d/%m/%Y - %H:%M:%S') | Install requirements\" \u0026\u0026    apk add --no-progress --no-cache ${REQUIREMENTS} \u0026\u0026 echo \"$(date '+%d/%m/%Y - %H:%M:%S') | Install Python dependencies\" \u0026\u0026    pip3 install --upgrade pip  \u0026\u0026    pip3 install ${PYTHONDEPENDENCIES} \u0026\u0026 echo \"$(date '+%d/%m/%Y - %H:%M:%S') | Install ${REPO}\" \u0026\u0026    TEMP=$(mktemp -d) \u0026\u0026    git clone -b master \"https://github.com/${REPO}.git\" \"${TEMP}\" \u0026\u0026    cd \"${TEMP}\" \u0026\u0026    python3 setup.py install \u0026\u0026 echo \"$(date '+%d/%m/%Y - %H:%M:%S') | Clean up\" \u0026\u0026    rm -r \"${TEMP}\" \u0026\u0026    apk del --no-progress --purge build-deps"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "sync-icloud.sh",
            "/usr/local/bin/sync-icloud.sh"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "healthcheck.sh",
            "/usr/local/bin/healthcheck.sh"
          ]
        },
        {
          "CmdLine": [
            "echo \"$(date '+%d/%m/%Y - %H:%M:%S') | Set permissions on startup script and healthcheck\" \u0026\u0026    chmod +x /usr/local/bin/sync-icloud.sh /usr/local/bin/healthcheck.sh"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Health": {
            "Interval": 60000000000,
            "StartPeriod": 10000000000,
            "Test": [
              "CMD-SHELL",
              "/usr/local/bin/healthcheck.sh"
            ],
            "Timeout": 10000000000
          },
          "Name": "healthcheck"
        },
        {
          "Name": "volume",
          "Volumes": [
            "\"${CONFIGDIR}\""
          ]
        },
        {
          "CmdLine": [
            "/usr/local/bin/sync-icloud.sh"
          ],
          "Name": "cmd",
          "PrependShell": true
        }
      ]
    }
  ]
}