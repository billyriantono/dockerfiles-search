MetaArgs: null
Stages:
- BaseName: php:7.0.11-fpm
  Commands:
  - Maintainer: '"Zak Henry" <zak.henry@gmail.com>'
    Name: maintainer
  - CmdLine:
    - mkdir -p /data
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /data
  - CmdLine:
    - apt-get update &&     apt-get install -y     build-essential     libpq-dev     libmcrypt-dev     libxml2-dev     libyaml-dev     python-pip     python-dev     wget     nginx     libfreetype6     libjpeg62-turbo     libmcrypt4     libpng12-0     libfreetype6-dev     libjpeg-dev     libpng12-dev     --no-install-recommends
      &&     rm -r /var/lib/apt/lists/* &&     apt-get purge -y --auto-remove
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install --upgrade supervisor supervisor-stdout
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr
    Name: run
    PrependShell: true
  - CmdLine:
    - docker-php-ext-install mcrypt gd pdo_pgsql mbstring pdo_mysql sockets opcache
      soap
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install xdebug-beta &&     docker-php-ext-enable xdebug
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /opt/newrelic
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt/newrelic
  - CmdLine:
    - "wget -r -nd --no-parent -Alinux.tar.gz \thttp://download.newrelic.com/php_agent/release/
      >/dev/null 2>&1 \t&& tar -xzf newrelic-php*.tar.gz --strip=1"
    Name: run
    PrependShell: true
  - Env:
    - Key: NR_INSTALL_SILENT
      Value: "true"
    Name: env
  - Env:
    - Key: NR_INSTALL_PHPLIST
      Value: /usr/local/bin/
    Name: env
  - CmdLine:
    - bash newrelic-install install
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /
  - CmdLine:
    - pip install newrelic-plugin-agent
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/log/newrelic
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/run/newrelic
    Name: run
    PrependShell: true
  - CmdLine:
    - mv /usr/local/etc/php/conf.d/newrelic.ini /usr/local/etc/php/conf.d/newrelic.ini.dist
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/memory.ini
    - /opt/etc/memory.ini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/xdebug.ini
    - /opt/etc/xdebug.ini
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/newrelic.ini
    - /opt/etc/newrelic.ini
  - CmdLine:
    - cat /opt/etc/memory.ini >> /usr/local/etc/php/conf.d/memory.ini
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/nginx.conf
    - /etc/nginx/nginx.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/supervisord.conf
    - /etc/supervisor/supervisord.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/supervisord-start.sh
    - /opt/bin/supervisord-start.sh
  - CmdLine:
    - chmod u=rwx /opt/bin/supervisord-start.sh
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/nginx-start.sh
    - /opt/bin/nginx-start.sh
  - CmdLine:
    - chmod u=rwx /opt/bin/nginx-start.sh
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config/php-start.sh
    - /opt/bin/php-start.sh
  - CmdLine:
    - chmod u=rwx /opt/bin/php-start.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /opt/bin/supervisord-start.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: php:7.0.11-fpm
  Name: ""
  Platform: ""
  SourceCode: FROM php:7.0.11-fpm
