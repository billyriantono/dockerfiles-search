{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "alpine/git",
      "SourceCode": "FROM alpine/git",
      "Platform": "",
      "From": {
        "Image": "alpine/git"
      },
      "Commands": [
        {
          "Maintainer": "entitystream",
          "Name": "maintainer"
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "monsterDB/pom.xml",
            "/buildMonster/"
          ]
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "monsterDB/src",
            "/buildMonster/src/"
          ]
        },
        {
          "Name": "workdir",
          "Path": "/buildIdentiza/"
        },
        {
          "CmdLine": [
            "git clone https://github.com/entitystream/identiza"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    },
    {
      "Name": "maven_build",
      "BaseName": "maven:3.5.2-jdk-8-alpine",
      "SourceCode": "FROM maven:3.5.2-jdk-8-alpine AS MAVEN_BUILD",
      "Platform": "",
      "As": "maven_build",
      "From": {
        "Image": "maven:3.5.2-jdk-8-alpine"
      },
      "Commands": [
        {
          "Chown": "",
          "From": "0",
          "Name": "copy",
          "SourcesAndDest": [
            "/buildMonster/",
            "/build/"
          ]
        },
        {
          "Chown": "",
          "From": "0",
          "Name": "copy",
          "SourcesAndDest": [
            "/buildIdentiza/identiza/identiza",
            "/buildIdentiza/"
          ]
        },
        {
          "Name": "workdir",
          "Path": "/buildIdentiza/"
        },
        {
          "CmdLine": [
            "mvn install -P simple-profile"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "workdir",
          "Path": "/build/"
        },
        {
          "CmdLine": [
            "mvn install -P uber-jar-profile -Dmaven.test.skip=true"
          ],
          "Name": "run",
          "PrependShell": true
        }
      ]
    },
    {
      "Name": "",
      "BaseName": "openjdk:8",
      "SourceCode": "FROM openjdk:8",
      "Platform": "",
      "From": {
        "Image": "openjdk:8"
      },
      "Commands": [
        {
          "CmdLine": [
            "mkdir /monsterDB"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir /monsterDB/data"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "MAVEN_BUILD",
          "Name": "copy",
          "SourcesAndDest": [
            "/build/target/monsterDB.jar",
            "/monsterDB"
          ]
        },
        {
          "Name": "volume",
          "Volumes": [
            "/monsterDB"
          ]
        },
        {
          "Env": [
            {
              "Key": "nodeNum",
              "Value": "0"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "replicaSet",
              "Value": "null"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "port",
              "Value": "27018"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "java -jar /monsterDB/monsterDB.jar -s -p ${port} -db /monsterDB/data -n ${nodeNum} -rs ${replicaSet}"
          ],
          "Name": "entrypoint",
          "PrependShell": true
        }
      ]
    }
  ]
}