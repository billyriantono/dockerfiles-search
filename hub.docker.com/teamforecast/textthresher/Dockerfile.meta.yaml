MetaArgs: null
Stages:
- BaseName: python:2.7-slim
  Commands:
  - Env:
    - Key: PYTHONUNBUFFERED
      Value: "1"
    Name: env
  - Env:
    - Key: TERM
      Value: xterm
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /docker/bashrc_to_docker
    - /root/.bashrc
  - Key: DEBIAN_FRONTEND
    Name: arg
    Value: noninteractive
  - CmdLine:
    - apt-get update -q && apt-get install -q -y         gcc         gettext         postgresql-client
      libpq-dev         vim git curl less psmisc
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /home/build
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /docker/thresher_api/requirements.txt
    - .
  - CmdLine:
    - pip install --upgrade pip && pip install -r requirements.txt
    Name: run
    PrependShell: true
  - CmdLine:
    - pip install ipython
    Name: run
    PrependShell: true
  - Key: USER
    Name: arg
    Value: thresher
  - Key: USER_ID
    Name: arg
    Value: "9000"
  - Key: GROUP_ID
    Name: arg
    Value: "9000"
  - Key: HOME
    Name: arg
    Value: /home/thresher
  - CmdLine:
    - groupadd -g ${GROUP_ID} ${USER} &&       useradd --shell /bin/bash --home ${HOME}
      -u ${USER_ID} -g ${GROUP_ID} ${USER}
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /home/download
  - Key: NODE_VERSION
    Name: arg
    Value: v6.10.3
  - Key: NODE_FILE
    Name: arg
    Value: node-${NODE_VERSION}-linux-x64.tar.xz
  - CmdLine:
    - curl -O https://nodejs.org/dist/${NODE_VERSION}/${NODE_FILE}
    Name: run
    PrependShell: true
  - CmdLine:
    - tar -C /usr/local --strip-components 1 -xf ${NODE_FILE}
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www
  - CmdLine:
    - chown ${USER}:${USER} /var/www
    Name: run
    PrependShell: true
  - Env:
    - Key: PYTHONPATH
      Value: /home/thresher
    Name: env
  - Name: workdir
    Path: /home/thresher
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /package.json
    - /home/thresher
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /bower.json
    - /home/thresher
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /.bowerrc
    - /home/thresher
  - CmdLine:
    - chown -R ${USER}:${USER} /home/thresher
    Name: run
    PrependShell: true
  - Env:
    - Key: WEBPACK_BUILD_DIR
      Value: /home/thresher
    Name: env
  - Name: workdir
    Path: /home/thresher
  - CmdLine:
    - npm install -g bower
    Name: run
    PrependShell: true
  - Name: user
    User: ${USER}
  - CmdLine:
    - npm install
    Name: run
    PrependShell: true
  - CmdLine:
    - bower install
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /
    - /home/thresher
  - Name: user
    User: root
  - CmdLine:
    - chown -R ${USER}:${USER} /home/thresher
    Name: run
    PrependShell: true
  - Name: user
    User: ${USER}
  - CmdLine:
    - npm run deploy:quiet
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /docker/bashrc_to_docker
    - ${HOME}/.bashrc
  - Name: expose
    Ports:
    - "5000"
  - CmdLine:
    - gunicorn
    - -b
    - :5000
    - -w
    - "10"
    - --error-logfile
    - '-'
    - --access-logfile
    - '-'
    - --reload
    - thresher_backend.wsgi
    Name: cmd
    PrependShell: false
  From:
    Image: python:2.7-slim
  Name: ""
  Platform: ""
  SourceCode: FROM python:2.7-slim
