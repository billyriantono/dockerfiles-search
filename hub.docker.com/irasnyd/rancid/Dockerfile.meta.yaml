MetaArgs: null
Stages:
- BaseName: centos:7
  Commands:
  - Env:
    - Key: SUPERCRONIC_URL
      Value: https://github.com/aptible/supercronic/releases/download/v0.1.8/supercronic-linux-amd64
    - Key: SUPERCRONIC
      Value: supercronic-linux-amd64
    - Key: SUPERCRONIC_SHA1SUM
      Value: be43e64c45acd6ec4fce5831e03759c89676a0ea
    Name: env
  - CmdLine:
    - curl -fsSLO "$SUPERCRONIC_URL"  && echo "${SUPERCRONIC_SHA1SUM}  ${SUPERCRONIC}"
      | sha1sum -c -  && chmod +x "$SUPERCRONIC"  && mv "$SUPERCRONIC" "/usr/bin/${SUPERCRONIC}"  &&
      ln -s "/usr/bin/${SUPERCRONIC}" /usr/bin/supercronic
    Name: run
    PrependShell: true
  - Env:
    - Key: RANCID_VERSION
      Value: "3.10"
    Name: env
  - CmdLine:
    - yum -y install epel-release         && yum -y install bash curl cvs expect gcc
      git make openssh-clients perl ssmtp subversion telnet         && yum -y clean
      all
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -O ftp://ftp.shrubbery.net/pub/rancid/rancid-${RANCID_VERSION}.tar.gz         &&
      tar xzf rancid-${RANCID_VERSION}.tar.gz         && pushd rancid-${RANCID_VERSION}         &&
      sed -i -e 's@ - courtesy of $mailrcpt@@' bin/control_rancid.in         && sed
      -i -e 's@>$LOGDIR/$GROUP.*$@@' bin/rancid-run.in         && ./configure --prefix=/usr
      --sysconfdir=/etc/rancid --localstatedir=/var/rancid         && make         &&
      make install         && popd         && rm -rf rancid-${RANCID_VERSION} rancid-${RANCID_VERSION}.tar.gz         &&
      groupadd -g 1000 rancid         && useradd -m -u 1000 -g 1000 -s /bin/bash -d
      /var/rancid -c RANCID rancid         && chown -R rancid:rancid /var/rancid         &&
      mkdir -p /var/log/rancid         && chown -R rancid:rancid /var/log/rancid
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -f /etc/rancid/rancid.conf         && ln -s /var/rancid/rancid.conf /etc/rancid/rancid.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -f /etc/ssmtp/ssmtp.conf         && ln -s /var/rancid/ssmtp.conf /etc/ssmtp/ssmtp.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - mv /usr/bin/ssh /usr/bin/ssh.orig
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ssh-wrapper
    - /usr/bin/ssh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker-entrypoint.sh
    - /
  - CmdLine:
    - /docker-entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /bin/bash
    Name: cmd
    PrependShell: false
  - Name: workdir
    Path: /var/rancid
  - Name: user
    User: rancid
  From:
    Image: centos:7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:7
