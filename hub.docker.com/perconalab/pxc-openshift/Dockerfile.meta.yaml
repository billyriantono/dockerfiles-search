MetaArgs: null
Stages:
- BaseName: registry.access.redhat.com/ubi7/ubi-minimal
  Commands:
  - Maintainer: Percona Development <info@percona.com>
    Name: maintainer
  - Labels:
    - Key: name
      Value: '"Percona XtraDB Cluster"'
    - Key: release
      Value: '"5.7"'
    - Key: vendor
      Value: '"Percona"'
    - Key: summary
      Value: '"Percona XtraDB Cluster is an active/active high availability and high
        scalability open source solution for MySQL clustering"'
    - Key: description
      Value: '"Percona XtraDB Cluster is a high availability solution that helps enterprises
        avoid downtime and outages and meet expected customer experience."'
    Name: label
  - CmdLine:
    - "export GNUPGHOME=\"$(mktemp -d)\" \t&& gpg --keyserver ha.pool.sks-keyservers.net
      --recv-keys 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A 6341AB2753D78A78A7C27BB124C6A8A7F4A80EB5
      91E97D7C4A5E96F17F3E888F6A2FAEA2352C64E5 \t&& gpg --export --armor 430BDF5C56E7C94E848EE60C1C4CBDCDCD2EFD2A
      > ${GNUPGHOME}/RPM-GPG-KEY-Percona \t&& gpg --export --armor 6341AB2753D78A78A7C27BB124C6A8A7F4A80EB5
      > ${GNUPGHOME}/RPM-GPG-KEY-CentOS-7 \t&& gpg --export --armor 91E97D7C4A5E96F17F3E888F6A2FAEA2352C64E5
      > ${GNUPGHOME}/RPM-GPG-KEY-EPEL-7 \t&& rpmkeys --import ${GNUPGHOME}/RPM-GPG-KEY-Percona
      ${GNUPGHOME}/RPM-GPG-KEY-CentOS-7 ${GNUPGHOME}/RPM-GPG-KEY-EPEL-7 \t&& curl
      -L -o /tmp/percona-release.rpm https://repo.percona.com/yum/percona-release-latest.noarch.rpm
      \t&& rpmkeys --checksig /tmp/percona-release.rpm \t&& rpm -i /tmp/percona-release.rpm
      \t&& rm -rf \"$GNUPGHOME\" /tmp/percona-release.rpm \t&& rpm --import /etc/pki/rpm-gpg/PERCONA-PACKAGING-KEY"
    Name: run
    PrependShell: true
  - Env:
    - Key: PS_VERSION
      Value: 5.7.25-28.1.el7
    Name: env
  - Env:
    - Key: PXC_VERSION
      Value: 5.7.25-31.35.1.el7
    Name: env
  - CmdLine:
    - "curl -L -o /tmp/numactl-libs.rpm http://mirror.centos.org/centos/7/os/x86_64/Packages/numactl-libs-2.0.9-7.el7.x86_64.rpm
      \t&& curl -L -o /tmp/libev.rpm http://mirror.centos.org/centos/7/extras/x86_64/Packages/libev-4.15-7.el7.x86_64.rpm
      \t&& curl -L -o /tmp/jq.rpm https://download.fedoraproject.org/pub/epel/7/x86_64/Packages/j/jq-1.5-1.el7.x86_64.rpm
      \t&& curl -L -o /tmp/oniguruma.rpm https://download.fedoraproject.org/pub/epel/7/x86_64/Packages/o/oniguruma-5.9.5-3.el7.x86_64.rpm
      \t&& rpmkeys --checksig /tmp/numactl-libs.rpm /tmp/libev.rpm /tmp/jq.rpm /tmp/oniguruma.rpm
      \t&& rpm -i /tmp/numactl-libs.rpm /tmp/libev.rpm /tmp/jq.rpm /tmp/oniguruma.rpm
      \t&& rm -rf /tmp/numactl-libs.rpm /tmp/libev.rpm /tmp/jq.rpm /tmp/oniguruma.rpm"
    Name: run
    PrependShell: true
  - CmdLine:
    - "microdnf update -y \t&& rpm -e --nodeps tzdata \t&& microdnf install Percona-Server-shared-57-${PS_VERSION}
      \t\tjemalloc \t\tsocat \t\topenssl \t\tshadow-utils \t\thostname \t\tcurl \t\ttzdata
      \t&& microdnf clean all"
    Name: run
    PrependShell: true
  - CmdLine:
    - "groupadd -g 1001 mysql \t&& useradd -u 1001 -r -g 1001 -s /sbin/nologin \t\t-c
      \"Default Application User\" mysql"
    Name: run
    PrependShell: true
  - CmdLine:
    - "microdnf install -y \t\tPercona-XtraDB-Cluster-server-57-${PXC_VERSION} \t&&
      microdnf clean all \t&& rm -rf /var/cache/yum /var/lib/mysql"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - LICENSE
    - /licenses/LICENSE.Dockerfile
  - CmdLine:
    - "cp /usr/share/doc/Percona-XtraDB-Cluster-server-57-*/COPYING /licenses/LICENSE.Percona-XtraDB-Cluster
      \t&& cp /usr/share/doc/percona-xtradb-cluster-galera/COPYING /licenses/LICENSE.galera
      \t&& cp /usr/share/doc/percona-xtradb-cluster-galera/LICENSE.* /licenses/"
    Name: run
    PrependShell: true
  - CmdLine:
    - "echo '!include /etc/mysql/node.cnf' > /etc/my.cnf \t&& echo '!includedir /etc/mysql/conf.d/'
      >> /etc/my.cnf"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - dockerdir
    - /
  - CmdLine:
    - "mkdir -p /etc/mysql/conf.d/ /var/log/mysql /var/lib/mysql /docker-entrypoint-initdb.d
      \t&& chown -R 1001:1001 /etc/mysql/ /var/log/mysql /var/lib/mysql /docker-entrypoint-initdb.d
      \t&& chmod -R g=u /etc/mysql/ /var/log/mysql /var/lib/mysql /docker-entrypoint-initdb.d"
    Name: run
    PrependShell: true
  - Name: user
    User: "1001"
  - Name: volume
    Volumes:
    - /var/lib/mysql
    - /var/log/mysql
  - CmdLine:
    - /entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - Name: expose
    Ports:
    - "3306"
    - "4567"
    - "4568"
  - CmdLine:
    - mysqld
    Name: cmd
    PrependShell: false
  From:
    Image: registry.access.redhat.com/ubi7/ubi-minimal
  Name: ""
  Platform: ""
  SourceCode: FROM registry.access.redhat.com/ubi7/ubi-minimal
