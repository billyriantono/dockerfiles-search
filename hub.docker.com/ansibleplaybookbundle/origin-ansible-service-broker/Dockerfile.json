{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "centos:7",
      "SourceCode": "FROM centos:7",
      "Platform": "",
      "From": {
        "Image": "centos:7"
      },
      "Commands": [
        {
          "Maintainer": "Ansible Service Broker Community",
          "Name": "maintainer"
        },
        {
          "CmdLine": [
            "curl https://copr.fedorainfracloud.org/coprs/g/ansible-service-broker/ansible-service-broker-nightly/repo/epel-7/group_ansible-service-broker-ansible-service-broker-nightly-epel-7.repo -o /etc/yum.repos.d/asb.repo"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "USER_NAME",
              "Value": "ansibleservicebroker"
            },
            {
              "Key": "USER_UID",
              "Value": "1001"
            },
            {
              "Key": "BASE_DIR",
              "Value": "/var/lib/ansibleservicebroker"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "HOME",
              "Value": "${BASE_DIR}"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "yum -y update  \u0026\u0026 yum -y install epel-release centos-release-openshift-origin  \u0026\u0026 yum -y install origin-clients ansible-service-broker ansible-service-broker-container-scripts  \u0026\u0026 yum clean all"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir -p ${BASE_DIR} ${BASE_DIR}/etc /var/run/asb-auth  \u0026\u0026 userdel ansibleservicebroker  \u0026\u0026 useradd -u ${USER_UID} -r -g 0 -M -d ${BASE_DIR} -b ${BASE_DIR} -s /sbin/nologin -c \"ansibleservicebroker user\" ${USER_NAME}  \u0026\u0026 chown -R ${USER_NAME}:0 ${BASE_DIR} /var/log/ansible-service-broker /etc/ansible-service-broker /var/run/asb-auth  \u0026\u0026 chmod -R g+rw ${BASE_DIR} /etc/passwd /etc/ansible-service-broker /var/log/ansible-service-broker /var/run/asb-auth"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "user",
          "User": "${USER_UID}"
        },
        {
          "CmdLine": [
            "sed \"s@${USER_NAME}:x:${USER_UID}:@${USER_NAME}:x:\\${USER_ID}:@g\" /etc/passwd \u003e ${BASE_DIR}/etc/passwd.template"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "entrypoint.sh"
          ],
          "Name": "entrypoint",
          "PrependShell": false
        }
      ]
    }
  ]
}