MetaArgs: null
Stages:
- BaseName: centos:latest
  Commands:
  - Labels:
    - Key: name
      Value: '"Flexbox CentOS 7.4 + PHP 7.1 Image"'
    - Key: maintainer
      Value: '"Alex Karshin <https://flexbox.it>"'
    - Key: license
      Value: '"GPLv3"'
    - Key: build-date
      Value: '"20171114"'
    - Key: source
      Value: '"https://bitbucket.org/flexboxIT/centos-php7"'
    Name: label
  - CmdLine:
    - yum clean all; yum -y update --nogpgcheck
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install yum-utils
    Name: run
    PrependShell: true
  - CmdLine:
    - rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm;     rpm
      -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install --nogpgcheck \    epel-release     wget     git     nano     postfix     gcc-c++     make
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install     php71w     php71w-bcmath     php71w-cli     php71w-curl     php71w-devel     php71w-gd     php71w-fpm     php71w-imagick     php71w-intl     php71w-mbstring     php71w-mcrypt     php71w-mysqlnd     php71w-opcache
      --nogpgcheck     php71w-pdo     php71w-xml     php71w-zip
    Name: run
    PrependShell: true
  - CmdLine:
    - curl https://phar.phpunit.de/phpunit.phar -L -o phpunit.phar &&     chmod +x
      phpunit.phar &&     mv phpunit.phar /usr/local/bin/phpunit
    Name: run
    PrependShell: true
  - CmdLine:
    - rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install nginx --nogpgcheck
    Name: run
    PrependShell: true
  - CmdLine:
    - php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" &&     php
      -r "if (hash_file('SHA384', 'composer-setup.php') === '544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061')
      { echo 'Installer verified'; } else { echo 'Installer corrupt. Maybe a new version
      was released and you forgot to update the verification hash?'; unlink('composer-setup.php');
      } echo PHP_EOL;" &&     php composer-setup.php &&     php -r "unlink('composer-setup.php');"
      &&     mv composer.phar /usr/local/bin/composer
    Name: run
    PrependShell: true
  - CmdLine:
    - curl --silent --location https://rpm.nodesource.com/setup_8.x | bash - &&     yum
      -y install nodejs
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://dl.yarnpkg.com/rpm/yarn.repo -O /etc/yum.repos.d/yarn.repo &&     yum
      -y install yarn
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /tmp
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R nginx:nginx /var/lib/php/session && chmod 0777 /var/lib/php/session
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - start.sh
    - /tmp/start.sh
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - php/memory.ini
    - /etc/php.d/01-memory.ini
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - php/datetime.ini
    - /etc/php.d/01-datetime.ini
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - php/session.ini
    - /etc/php.d/01-session.ini
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - php/www.conf
    - /etc/php-fpm.d/www.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - postfix/main.cf
    - /etc/postfix/main.cf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - postfix/main.cf.working
    - /etc/postfix/main.cf.working
  - Name: workdir
    Path: '"/html"'
  - Name: expose
    Ports:
    - "443"
    - "80"
  - CmdLine:
    - usermod -u 1000 nginx
    Name: run
    PrependShell: true
  - CmdLine:
    - groupmod -g 1000 nginx
    Name: run
    PrependShell: true
  - CmdLine:
    - /tmp/start.sh
    Name: cmd
    PrependShell: false
  From:
    Image: centos:latest
  Name: ""
  Platform: ""
  SourceCode: FROM centos:latest
