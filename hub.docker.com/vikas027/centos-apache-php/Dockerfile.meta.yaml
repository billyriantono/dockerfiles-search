MetaArgs: null
Stages:
- BaseName: centos:6.6
  Commands:
  - Maintainer: Vikas Kumar "vikas@reachvikas.com"
    Name: maintainer
  - CmdLine:
    - yum upgrade -y
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y wget tar gcc vim curl unzip telnet lsof
    Name: run
    PrependShell: true
  - Env:
    - Key: TIMEZONE
      Value: Australia/Sydney
    Name: env
  - CmdLine:
    - rm -f /etc/localtime &&     ln -s /usr/share/zoneinfo/${TIMEZONE} /etc/localtime
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm     http://rpms.famillecollet.com/enterprise/remi-release-6.rpm     yum-utils
      wget unzip &&     yum-config-manager --enable remi,remi-php56,remi-php56-debuginfo
    Name: run
    PrependShell: true
  - CmdLine:
    - yum --enablerepo=epel install -y supervisor
    Name: run
    PrependShell: true
  - CmdLine:
    - mv -f /etc/supervisord.conf /etc/supervisord.conf.org
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y rsyslog cronie-noanacron &&     cp -a /etc/pam.d/crond /etc/pam.d/crond.org
      &&     sed -i -e 's/^\(session\s\+required\s\+pam_loginuid\.so\)/#\1/' /etc/pam.d/crond
    Name: run
    PrependShell: true
  - Env:
    - Key: ROOT_PASS
      Value: password
    Name: env
  - CmdLine:
    - yum install -y openssh-server openssh-clients shadow-utils sudo &&     sed -i
      's/UsePAM\syes/UsePAM no/' /etc/ssh/sshd_config &&     ssh-keygen -q -b 1024
      -N '' -t rsa -f /etc/ssh/ssh_host_rsa_key &&     ssh-keygen -q -b 1024 -N ''
      -t dsa -f /etc/ssh/ssh_host_dsa_key &&     ssh-keygen -q -b 521 -N '' -t ecdsa
      -f /etc/ssh/ssh_host_ecdsa_key &&     sed -i -r 's/.?UseDNS\syes/UseDNS no/'
      /etc/ssh/sshd_config &&     sed -i -r 's/.?ChallengeResponseAuthentication.+/ChallengeResponseAuthentication
      no/' /etc/ssh/sshd_config &&     sed -i -r 's/.?PermitRootLogin.+/PermitRootLogin
      yes/' /etc/ssh/sshd_config &&     echo "root:${ROOT_PASS}" | chpasswd &&     echo
      -e '\nDefaults:root   !requiretty' >> /etc/sudoers
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - start_sshd.sh
    - /start_sshd.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - info.php
    - /var/www/html/info.php
  - CmdLine:
    - yum groupinstall "Web Server" "PHP Support" "MySQL Database client" -y
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - start_httpd.sh
    - /start_httpd.sh
  - CmdLine:
    - rm -rf /var/cache/yum/* && yum clean all
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
    - "80"
  - Chown: ""
    Name: add
    SourcesAndDest:
    - supervisord.conf
    - /etc/
  - CmdLine:
    - /usr/bin/supervisord
    Name: cmd
    PrependShell: false
  From:
    Image: centos:6.6
  Name: ""
  Platform: ""
  SourceCode: FROM centos:6.6
