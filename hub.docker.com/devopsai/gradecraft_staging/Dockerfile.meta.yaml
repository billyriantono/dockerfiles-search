MetaArgs: null
Stages:
- BaseName: ruby:2.5.3
  Commands:
  - Maintainer: ai-devops <ai-devops@umich.edu>
    Name: maintainer
  - CmdLine:
    - echo deb http://apt.newrelic.com/debian/ newrelic non-free >> /etc/apt/sources.list.d/newrelic.list
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -O- https://download.newrelic.com/548C16BF.gpg | apt-key add -
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -O - http://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | apt-key add
      -
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "deb http://apt.postgresql.org/pub/repos/apt/ precise-pgdg main" > /etc/apt/sources.list.d/pgdg.list
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get upgrade -y
    Name: run
    PrependShell: true
  - CmdLine:
    - DEBIAN_FRONTEND=noninteractive apt-get install libssl1.0.2 libpq-dev wget git
      nginx vim newrelic-sysmond postgresql-client-9.5 libkrb5-dev nodejs krb5-user
      build-essential libfuse-dev libcurl4-openssl-dev libxml2-dev mime-support automake
      libtool wget tar zip cron -y
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://github.com/s3fs-fuse/s3fs-fuse/archive/v1.79.tar.gz -O /usr/src/v1.79.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - tar xvz -C /usr/src -f /usr/src/v1.79.tar.gz
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /usr/src/s3fs-fuse-1.79 && ./autogen.sh && ./configure --prefix=/usr && make
      && make install
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /s3mnt
    Name: run
    PrependShell: true
  - CmdLine:
    - chgrp -R 1000 /s3mnt
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod -R g+rwx /s3mnt
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd -l -u 1000690000 -s /bin/bash ocstag
    Name: run
    PrependShell: true
  - Env:
    - Key: RAILS_ENV
      Value: staging
    Name: env
  - Env:
    - Key: MANDRILL_PASSWORD
      Value: jL603d5PtE6rem-h25gA7w
    Name: env
  - Env:
    - Key: MANDRILL_USERNAME
      Value: cholma@umich.edu
    Name: env
  - Env:
    - Key: NEW_RELIC_APP_NAME
      Value: gradecraft-staging
    Name: env
  - Env:
    - Key: NEW_RELIC_LICENSE_KEY
      Value: bb3a9789ef8a124ghf410f51286cc55188ed7a2d
    Name: env
  - Env:
    - Key: RACK_ENV
      Value: staging
    Name: env
  - Env:
    - Key: RAILS_ENV
      Value: staging
    Name: env
  - Env:
    - Key: RAILS_SECRET
      Value: 8a1b99effc1c1d848e24cdc7f640e6b72834f204394c256813f987ffecb2cd75c3c3bb5fc5bbc29166344c75d04e470b61dd406c58080ebf14fa534b9d9b2476
    Name: env
  - Env:
    - Key: ROLLBAR_ENV
      Value: staging
    Name: env
  - Env:
    - Key: ROLLBAR_CLIENT_TOKEN
      Value: 8356b5dbb8a84c139197c6a3c3a2ee9d
    Name: env
  - Env:
    - Key: AWS_ACCESS_KEY_ID
      Value: AKIAJMB7SAAYHI7PCA6A
    Name: env
  - Env:
    - Key: AWS_SECRET_ACCESS_KEY
      Value: FiFp8/r8yFsJkw07YK2P+RGQWNrSfuuesZky8JOJ
    Name: env
  - Env:
    - Key: LTI_CONSUMER_KEY
      Value: RJjLK6f9ghxy77J3FcKrtQ
    Name: env
  - Env:
    - Key: LTI_CONSUMER_SECRET
      Value: i_3yxK7HJdrOYI45Tl7Q-AOdZBAbLDFS
    Name: env
  - Env:
    - Key: ROLLBAR_ACCESS_TOKEN
      Value: ff1764fbc83f415a94515d930c570915
    Name: env
  - Env:
    - Key: REDIS_URL
      Value: redis://gcredis-staging:6379
    Name: env
  - Env:
    - Key: PASSPHRASE
      Value: 2746956502e2bf26412d57af257614d8
    Name: env
  - Env:
    - Key: BACKUP_BUCKET
      Value: hogwarts
    Name: env
  - Env:
    - Key: REDIS_HOST_IP
      Value: gcredis-staging
    Name: env
  - Env:
    - Key: REDIS_PORT
      Value: "6379"
    Name: env
  - Env:
    - Key: CONSUMER_SERVICE_URL
      Value: https://gradecraft-staging.ai.umich.edu/saml/consume
    Name: env
  - Env:
    - Key: LOGOUT_SERVICE_URL
      Value: https://gradecraft-staging.ai.umich.edu/saml/logout
    Name: env
  - Env:
    - Key: IDP_ENTITY_ID
      Value: https://shibboleth.umich.edu/idp/shibboleth
    Name: env
  - Env:
    - Key: IDP_SSO_TARGET_URL
      Value: https://shibboleth.umich.edu/idp/profile/SAML2/Redirect/SSO
    Name: env
  - Env:
    - Key: IDP_SLO_TARGET_URL
      Value: https://shibboleth.umich.edu/cgi-bin/logout?http://www.umich.edu/
    Name: env
  - Env:
    - Key: ISSUER
      Value: https://gradecraft-staging.ai.umich.edu/saml/metadata
    Name: env
  - Env:
    - Key: LOGGLY_TOKEN
      Value: dab0a78f-d41a-45da-af99-4d1489b5661a
    Name: env
  - Env:
    - Key: AWSACCESSKEYID
      Value: AKIAJMB7SAAYHI7PCA6A
    Name: env
  - Env:
    - Key: AWSSECRETACCESSKEY
      Value: FiFp8/r8yFsJkw07YK2P+RGQWNrSfuuesZky8JOJ
    Name: env
  - Env:
    - Key: TERM_CHILD
      Value: "1"
    Name: env
  - Env:
    - Key: AWS_S3_BUCKET
      Value: gradecraft-staging
    Name: env
  - Env:
    - Key: AWS_REGION
      Value: us-west-2
    Name: env
  - Env:
    - Key: AWS_S3_REGION
      Value: us-east-1
    Name: env
  - Env:
    - Key: AWS_KMS_KEY_ID
      Value: d5f6e694-b90e-4a5d-97f4-bb7d19ac7e17
    Name: env
  - Env:
    - Key: IDP_CERT
      Value: /gradecraft/gradecraft_saml_idp.pem
    Name: env
  - Env:
    - Key: SAML_PR_KEY
      Value: /gradecraft/gcstagingsha256.key
    Name: env
  - Env:
    - Key: SAML_CERT
      Value: /gradecraft/gcstagingsha256.crt
    Name: env
  - Env:
    - Key: CANVAS_CLIENT_ID
      Value: "17700000000000012"
    Name: env
  - Env:
    - Key: CANVAS_CLIENT_SECRET
      Value: MGmIzWfs01SIpOrqPSxlZvMJsOZTyBOaZZJsOPzDoS4nlfzfQZ95308trKXozT8M
    Name: env
  - Env:
    - Key: CANVAS_BASE_URL
      Value: https://umich.instructure.com
    Name: env
  - Env:
    - Key: GOOGLE_CLIENT_ID
      Value: 981160405042-nd5vcf1u04abmqqnb9egjt3h1lvqpapc.apps.googleusercontent.com
    Name: env
  - Env:
    - Key: GOOGLE_SECRET
      Value: -rGEqrMB3-YvhrRH7NlxQJXU
    Name: env
  - Env:
    - Key: GMAIL_SMTP_USERNAME
      Value: gc.staging@gmail.com
    Name: env
  - Env:
    - Key: GMAIL_SMTP_PASSWORD
      Value: PiagetVygotskyBandura!
    Name: env
  - Env:
    - Key: MAIL_INTERCEPTOR_RECIPIENT
      Value: gc.staging@gmail.com
    Name: env
  - Env:
    - Key: RECAPTCHA_SITE_KEY
      Value: 6LciBk8UAAAAALIoo6dq6pZ8j-rTfd6mgzM4-SMb
    Name: env
  - Env:
    - Key: RECAPTCHA_SECRET_KEY
      Value: 6LciBk8UAAAAAIm48KnXqCDrnVBE9DkFDY2N8TOq
    Name: env
  - CmdLine:
    - mkdir /intermidiate
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /intermidiate/
  - Chown: ""
    Name: add
    SourcesAndDest:
    - gradecraft_saml_idp.pem
    - /intermidiate/gradecraft_saml_idp.pem
  - Chown: ""
    Name: add
    SourcesAndDest:
    - gcstagingsha256.key
    - /intermidiate/gcstagingsha256.key
  - Chown: ""
    Name: add
    SourcesAndDest:
    - gcstagingsha256.crt
    - /intermidiate/gcstagingsha256.crt
  - Chown: ""
    Name: add
    SourcesAndDest:
    - www.gradecraft.com.key
    - /intermidiate/www.gradecraft.com.key
  - Chown: ""
    Name: add
    SourcesAndDest:
    - www.gradecraft.com.crt
    - /intermidiate/www.gradecraft.com.crt
  - Chown: ""
    Name: add
    SourcesAndDest:
    - database.yml
    - /intermidiate/database.yml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - mongoid.yml
    - /intermidiate/mongoid.yml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - puma.rb
    - /intermidiate/puma.rb
  - Chown: ""
    Name: add
    SourcesAndDest:
    - Procfile
    - /intermidiate/Procfile
  - Chown: ""
    Name: add
    SourcesAndDest:
    - cron/crontab
    - /etc/cron.d/trim-cron
  - CmdLine:
    - chmod 0644 /etc/cron.d/trim-cron
    Name: run
    PrependShell: true
  - CmdLine:
    - touch /var/log/cron.log
    Name: run
    PrependShell: true
  - CmdLine:
    - rm /etc/krb5.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /etc/krb5kdc
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - krb5.conf
    - /etc/krb5.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - kdc.conf
    - /etc/krb5kdc/kdc.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - default
    - /etc/nginx/sites-available/default
  - Name: expose
    Ports:
    - "8080"
  - Name: expose
    Ports:
    - "8443"
  From:
    Image: ruby:2.5.3
  Name: ""
  Platform: ""
  SourceCode: FROM ruby:2.5.3
