FROM php:5.6

ENV PATH "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

RUN buildDeps=" \
  apt-file \
  git \
  libaio1 \
  libbz2-dev \
  libcurl4-openssl-dev \
  libc-client2007e-dev \
  libevent-dev \
  libfreetype6-dev \
  libgmp3-dev \
  libgd2-xpm-dev \
  libicu-dev \
  libjpeg62-turbo-dev \
  libkrb5-dev \
  libmcrypt-dev \
  libmemcached-dev \
  libpq5 \
  libpq-dev \
  libpng12-dev \
  libssl-dev \
  libsqlite3-dev \
  libtidy-dev \
  libxml2-dev \
  memcached \
  libodbc1 \
  unixodbc \
  unixodbc-dev \
  unzip \
  libxslt-dev \
  zlib1g-dev \
" \
   && set -x \
   && apt-get update && apt-get install -y $buildDeps --no-install-recommends && rm -rf /var/lib/apt/lists/*

# Fix odbc
RUN set -x \
    && cd /usr/src/php/ext/odbc \
    && phpize \
    && sed -ri 's@^ *test +"\$PHP_.*" *= *"no" *&& *PHP_.*=yes *$@#&@g' configure \
    && ./configure --with-unixODBC=shared,/usr

RUN docker-php-ext-install bcmath
RUN docker-php-ext-install bz2
RUN docker-php-ext-install ctype
RUN docker-php-ext-install curl
RUN docker-php-ext-install exif
RUN docker-php-ext-install fileinfo
RUN docker-php-ext-install ftp
RUN docker-php-ext-install gd
RUN docker-php-ext-install gettext
RUN docker-php-ext-install hash
RUN docker-php-ext-install iconv
RUN docker-php-ext-configure imap --with-kerberos --with-imap-ssl
RUN docker-php-ext-install imap
RUN docker-php-ext-install intl
RUN docker-php-ext-install json
RUN docker-php-ext-install mbstring
RUN docker-php-ext-install mcrypt
RUN curl -L https://pecl.php.net/get/mongodb-1.1.2 >> /usr/src/php/ext/mongodb.tgz \
    && tar -xf /usr/src/php/ext/mongodb.tgz -C /usr/src/php/ext/ \
    && rm /usr/src/php/ext/mongodb.tgz \
    && docker-php-ext-install mongodb-1.1.2
RUN docker-php-ext-install mysql
RUN docker-php-ext-install mysqli
RUN docker-php-ext-install odbc
RUN docker-php-ext-install opcache
RUN docker-php-ext-install pcntl
RUN docker-php-ext-install pdo
RUN docker-php-ext-install pdo_mysql
RUN docker-php-ext-install pdo_pgsql
RUN docker-php-ext-install pdo_sqlite
RUN docker-php-ext-install pgsql
RUN docker-php-ext-install phar
RUN curl -L -o /tmp/redis.tar.gz https://github.com/phpredis/phpredis/archive/2.2.7.tar.gz \
    && tar xfz /tmp/redis.tar.gz \
    && rm -r /tmp/redis.tar.gz \
    && mv phpredis-2.2.7 /usr/src/php/ext/redis \
    && docker-php-ext-install redis
RUN docker-php-ext-install simplexml
RUN docker-php-ext-install soap
RUN docker-php-ext-install sockets
RUN docker-php-ext-install sysvmsg
RUN docker-php-ext-install sysvsem
RUN docker-php-ext-install sysvshm
RUN docker-php-ext-install tidy
RUN docker-php-ext-install tokenizer
RUN curl -L https://pecl.php.net/get/xdebug-2.3.3.tgz >> /usr/src/php/ext/xdebug.tgz \
    && tar -xf /usr/src/php/ext/xdebug.tgz -C /usr/src/php/ext/ \
    && rm /usr/src/php/ext/xdebug.tgz \
    && docker-php-ext-install xdebug-2.3.3
RUN docker-php-ext-install xml
RUN docker-php-ext-install xmlreader
RUN docker-php-ext-install xmlrpc
RUN docker-php-ext-install xmlwriter
RUN docker-php-ext-install xsl
RUN docker-php-ext-install zip

# Configure default values

RUN echo "date.timezone=Europe/Paris\nmemory_limit=4096M" >> /usr/local/etc/php/conf.d/default.ini

# Install composer
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin/

# Install phpcs, phpcbf and phpcdp
RUN curl -L https://squizlabs.github.io/PHP_CodeSniffer/phpcs.phar -o /usr/local/bin/phpcs \
    && chmod 755 /usr/local/bin/phpcs \
    && curl -L https://squizlabs.github.io/PHP_CodeSniffer/phpcbf.phar -o /usr/local/bin/phpcbf \
    && chmod 755 /usr/local/bin/phpcbf \
    && curl -L https://phar.phpunit.de/phpcpd.phar -o /usr/local/bin/phpcdp \
    && chmod 755 /usr/local/bin/phpcdp

# Often php dependencies require npm, bower etc ...
RUN curl -sL https://deb.nodesource.com/setup_5.x | bash -
RUN apt-get install --yes nodejs build-essential
RUN npm install -g bower

##<autogenerated>##
CMD ["php", "-a"]
##</autogenerated>##
