MetaArgs: null
Stages:
- BaseName: centos:centos7
  Commands:
  - Maintainer: Naoaki Obiki
    Name: maintainer
  - CmdLine:
    - "yum install -y epel-release openssh-server openssh-clients rsync wget git sudo
      \tPyYAML python-jinja2 python-httplib2 python-keyczar python-paramiko python-setuptools
      python-pip"
    Name: run
    PrependShell: true
  - CmdLine:
    - echo 'root:root' | chpasswd
    Name: run
    PrependShell: true
  - Key: username
    Name: arg
    Value: '"ansible"'
  - Key: password
    Name: arg
    Value: '"ansible"'
  - CmdLine:
    - useradd -s /bin/bash -d /home/$username $username && echo "$username:$password"
      | chpasswd
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /home/$username/.ssh
    Name: run
    PrependShell: true
  - CmdLine:
    - echo ${username}' ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers.d/$username
    Name: run
    PrependShell: true
  - CmdLine:
    - ssh-keygen -t rsa -N "" -f /etc/ssh/ssh_host_rsa_key
    Name: run
    PrependShell: true
  - CmdLine:
    - cat /etc/ssh/ssh_host_rsa_key.pub > /home/$username/.ssh/authorized_keys
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R $username:$username /home/$username
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri "s/^UsePAM yes/#UsePAM yes/" /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri "s/^#UsePAM no/UsePAM no/" /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/^#PermitRootLogin yes/PermitRootLogin yes/' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/^#PermitEmptyPasswords no/PermitEmptyPasswords yes/' /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri "s/^#PasswordAuthentication yes/PasswordAuthentication yes/" /etc/ssh/sshd_config
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
  - CmdLine:
    - /usr/sbin/sshd
    - -D
    Name: cmd
    PrependShell: false
  From:
    Image: centos:centos7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:centos7
