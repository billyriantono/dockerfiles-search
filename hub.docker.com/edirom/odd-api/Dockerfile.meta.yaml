MetaArgs: null
Stages:
- As: builder
  BaseName: openjdk:8-jdk
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Johannes Kepper"'
    Name: label
  - Env:
    - Key: ODDAPI_BUILD_HOME
      Value: '"/opt/oddapi-build"'
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://deb.nodesource.com/setup_8.x
    - /tmp/nodejs_setup
  - Name: workdir
    Path: ${ODDAPI_BUILD_HOME}
  - CmdLine:
    - apt-get update     && apt-get install -y --force-yes git     && chmod 755 /tmp/nodejs_setup;
      sync     && /tmp/nodejs_setup     && apt-get install -y nodejs     && ln -s
      /usr/bin/nodejs /usr/local/bin/node
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - .
    - .
  - CmdLine:
    - addgroup oddapibuilder     && adduser oddapibuilder --ingroup oddapibuilder
      --disabled-password --system     && chown -R oddapibuilder:oddapibuilder ${ODDAPI_BUILD_HOME}
    Name: run
    PrependShell: true
  - Name: user
    User: oddapibuilder:oddapibuilder
  - CmdLine:
    - npm install     && cp existConfig.tmpl.json existConfig.json     && ./node_modules/.bin/gulp
      dist
    Name: run
    PrependShell: true
  From:
    Image: openjdk:8-jdk
  Name: builder
  Platform: ""
  SourceCode: FROM openjdk:8-jdk as builder
- BaseName: stadlerpeter/existdb
  Commands:
  - Env:
    - Key: EXIST_ENV
      Value: '"production"'
    Name: env
  - Env:
    - Key: EXIST_CONTEXT_PATH
      Value: '"/"'
    Name: env
  - Env:
    - Key: EXIST_DEFAULT_APP_PATH
      Value: '"xmldb:exist:///db/apps/odd-api"'
    Name: env
  - Chown: ""
    From: builder
    Name: copy
    SourcesAndDest:
    - /opt/oddapi-build/dist/*.xar
    - ${EXIST_HOME}/autodeploy/
  From:
    Image: stadlerpeter/existdb
  Name: ""
  Platform: ""
  SourceCode: FROM stadlerpeter/existdb
