MetaArgs: null
Stages:
- BaseName: alpine:3.9
  Commands:
  - CmdLine:
    - apk add --no-cache         bash         gettext         monit         su-exec         supervisor
    Name: run
    PrependShell: true
  - Key: UNISON_VERSION
    Name: arg
    Value: 2.51.2
  - Env:
    - Key: UNISON_VERSION
      Value: $UNISON_VERSION
    Name: env
  - CmdLine:
    - apk add --no-cache build-base curl ocaml       && curl -L https://github.com/bcpierce00/unison/archive/v$UNISON_VERSION.tar.gz
      | tar zxv -C /tmp       && cd /tmp/unison-${UNISON_VERSION}       && sed -i
      -e 's/GLIBC_SUPPORT_INOTIFY 0/GLIBC_SUPPORT_INOTIFY 1/' src/fsmonitor/linux/inotify_stubs.c       &&
      make UISTYLE=text NATIVE=true STATIC=true       && apk del build-base curl ocaml       &&
      cp src/unison src/unison-fsmonitor /usr/local/bin       && rm -rf /var/cache/apk/*       &&
      rm -rf /tmp/unison-${UNISON_VERSION}
    Name: run
    PrependShell: true
  - Key: UNISON_DATA
    Name: arg
    Value: /unison_data
  - Key: HOST_DATA_PATH
    Name: arg
    Value: /host
  - Key: CONTAINER_DATA_PATH
    Name: arg
    Value: /container
  - Env:
    - Key: UNISONLOCALHOSTNAME
      Value: syncer
    - Key: UNISON_DATA
      Value: /unison_data
    - Key: UNISON_DEFAULT_OPTS
      Value: '"-batch -auto"'
    - Key: UNISON_OPTS
      Value: '""'
    - Key: CONTAINER_DATA_PATH
      Value: $CONTAINER_DATA_PATH
    - Key: HOST_DATA_PATH
      Value: $HOST_DATA_PATH
    - Key: SYNC_UID
      Value: "0"
    - Key: SYNC_USER
      Value: syncer
    - Key: MONIT_CHECK_INTERVAL
      Value: "1"
    - Key: MONIT_ENABLED
      Value: "true"
    - Key: MONIT_HIGH_CPU_THRESHOLD
      Value: "60"
    - Key: MONIT_HIGH_CPU_CYCLES
      Value: "5"
    Name: env
  - CmdLine:
    - mkdir -p       /docker-entrypoint.d       /etc/supervisor.conf.d       $UNISON_DATA       $CONTAINER_DATA_PATH       $HOST_DATA_PATH
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker-entrypoint.sh
    - /
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - monitrc.template
    - supervisord.conf
    - /etc/
  - Name: volume
    Volumes:
    - $UNISON_DATA
  - Name: volume
    Volumes:
    - $CONTAINER_DATA_PATH
  - CmdLine:
    - /docker-entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - run
    Name: cmd
    PrependShell: false
  From:
    Image: alpine:3.9
  Name: ""
  Platform: ""
  SourceCode: FROM alpine:3.9
