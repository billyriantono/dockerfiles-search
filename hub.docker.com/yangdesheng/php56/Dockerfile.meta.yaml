MetaArgs: null
Stages:
- BaseName: centos:centos7
  Commands:
  - Maintainer: '"Daniel Yang" <yang@desheng.me>'
    Name: maintainer
  - CmdLine:
    - rpm -Uvh http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
      &&     rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
    Name: run
    PrependShell: true
  - CmdLine:
    - yum update -y &&     yum install -y vim
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install --enablerepo=remi -y         php56-php-cli         php56-php-fpm         php56-php-mysqlnd         php56-php-gd         php56-php-mcrypt         php56-php-mbstring         php56-php-opcache         php56-php-pecl-memcache         php56-php-pecl-memcached         php56-php-pecl-redis
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i "s/;date.timezone =.*/date.timezone = PRC/" /opt/remi/php56/root/etc/php.ini  &&     sed
      -i "s/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/" /opt/remi/php56/root/etc/php.ini  &&     sed
      -i "s/display_errors = Off/display_errors = stderr/" /opt/remi/php56/root/etc/php.ini  &&     sed
      -i "s/upload_max_filesize = 2M/upload_max_filesize = 32M/" /opt/remi/php56/root/etc/php.ini
      &&     sed -i "s/;opcache.enable=0/opcache.enable=0/" /opt/remi/php56/root/etc/php.ini
      &&     sed -i -e "s/;daemonize\s*=\s*yes/daemonize = no/g" /opt/remi/php56/root/etc/php-fpm.d/www.conf
      &&     sed -i '/^listen = /clisten = 9000' /opt/remi/php56/root/etc/php-fpm.d/www.conf
      &&     sed -i '/^listen.allowed_clients/c;listen.allowed_clients =' /opt/remi/php56/root/etc/php-fpm.d/www.conf
      &&     sed -i "/^user = /cuser = root" /opt/remi/php56/root/etc/php-fpm.d/www.conf
      &&     sed -i "/^group = /cgroup = root" /opt/remi/php56/root/etc/php-fpm.d/www.conf
      &&     sed -i '/^;catch_workers_output/ccatch_workers_output = yes' /opt/remi/php56/root/etc/php-fpm.d/www.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "clear_env = no" >> /opt/remi/php56/root/etc/php-fpm.d/www.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /opt/www
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /opt/www
  - Name: expose
    Ports:
    - "9000"
  - CmdLine:
    - /opt/remi/php56/root/usr/sbin/php-fpm
    - -F
    - -R
    Name: cmd
    PrependShell: false
  From:
    Image: centos:centos7
  Name: ""
  Platform: ""
  SourceCode: FROM centos:centos7
