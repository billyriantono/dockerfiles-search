MetaArgs: null
Stages:
- BaseName: python:3
  Commands:
  - Env:
    - Key: VER
      Value: ${VER:-master}
    - Key: REPO
      Value: https://github.com/twhtanghk/pam_oauth2
    - Key: APP
      Value: /usr/src/app
    Name: env
  - Name: workdir
    Path: $APP
  - CmdLine:
    - apt-get update &&     apt-get install -y ssh &&     mkdir /var/run/sshd
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y git sudo libpam0g-dev &&     git clone -b $VER $REPO $APP
      &&     make install &&     sed 's/^\(passwd:.*\)$/\1 oauth2/g' </etc/nsswitch.conf
      >/tmp/nsswitch.conf &&     mv /tmp/nsswitch.conf /etc &&     pip install -r
      python/requirements.txt &&     cp -a pam/pam.d/* /etc/pam.d
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get clean
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
  - CmdLine:
    - ./entrypoint.sh
    Name: cmd
    PrependShell: true
  From:
    Image: python:3
  Name: ""
  Platform: ""
  SourceCode: FROM python:3
