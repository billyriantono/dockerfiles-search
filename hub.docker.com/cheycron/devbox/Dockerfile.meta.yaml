MetaArgs: null
Stages:
- BaseName: ubuntu:disco
  Commands:
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - apt-get update && apt-get install -yq --no-install-recommends     apt-utils     curl     supervisor     cron     git     apache2     libapache2-mod-php7.2     php7.2-cli     php7.2-json     php7.2-curl     php7.2-fpm     php7.2-gd     php7.2-ldap     php7.2-mbstring     php7.2-mysql     php7.2-soap     php7.2-sqlite3     php7.2-xml     php7.2-zip     php7.2-intl     php7.2-opcache     php-imagick     openssl     nano     ffmpeg     graphicsmagick     imagemagick     ghostscript     mysql-client     iputils-ping     locales     sqlite3     ca-certificates     &&
      apt-get clean && rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - locale-gen en_US.UTF-8 es_ES.UTF-8
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin
      --filename=composer
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker/devbox.php.ini
    - /etc/php/7.2/mods-available/
  - CmdLine:
    - phpenmod devbox.php
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod rewrite expires ssl
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "ServerName localhost" | tee /etc/apache2/conf-available/servername.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enconf servername
    Name: run
    PrependShell: true
  - CmdLine:
    - openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout /etc/ssl/private/apache-selfsigned.key
      -subj "/C=AR/ST=Capital Federal/L=Capital Federal/O=Cheycron/OU=Dev/CN=DevBox"
      -out /etc/ssl/certs/apache-selfsigned.crt && openssl dhparam -out /etc/ssl/certs/dhparam.pem
      2048
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker/devbox.virtualserver.conf
    - /etc/apache2/sites-available/
  - CmdLine:
    - a2dissite 000-default && a2ensite devbox.virtualserver.conf
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker/devbox.crontab
    - /etc/cron.d/artisan
  - CmdLine:
    - chmod 0644 /etc/cron.d/artisan && crontab /etc/cron.d/artisan
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "443"
    - "80"
  - Name: workdir
    Path: /var/www/app
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker/supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - CmdLine:
    - /usr/bin/supervisord
    - -c
    - /etc/supervisor/conf.d/supervisord.conf
    Name: cmd
    PrependShell: false
  From:
    Image: ubuntu:disco
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:disco
