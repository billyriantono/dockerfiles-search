MetaArgs: null
Stages:
- BaseName: vanessa/expfactory-builder:base
  Commands:
  - Env:
    - Key: EXPFACTORY_STUDY_ID
      Value: expfactory
    Name: env
  - Env:
    - Key: EXPFACTORY_SERVER
      Value: localhost
    Name: env
  - Env:
    - Key: EXPFACTORY_CONTAINER
      Value: "true"
    Name: env
  - Env:
    - Key: EXPFACTORY_DATA
      Value: /scif/data
    Name: env
  - Env:
    - Key: EXPFACTORY_DATABASE
      Value: filesystem
    Name: env
  - Env:
    - Key: EXPFACTORY_HEADLESS
      Value: "false"
    Name: env
  - Env:
    - Key: EXPFACTORY_BASE
      Value: /scif/apps
    Name: env
  - Chown: ""
    Name: add
    SourcesAndDest:
    - startscript.sh
    - /startscript.sh
  - CmdLine:
    - chmod u+x /startscript.sh
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /opt
  - CmdLine:
    - git clone -b add/variables https://www.github.com/expfactory/expfactory
    Name: run
    PrependShell: true
  - Name: workdir
    Path: expfactory
  - CmdLine:
    - cp script/nginx.gunicorn.conf /etc/nginx/sites-enabled/default &&     cp script/nginx.conf
      /etc/nginx/nginx.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - 'mkdir -p /scif/data # saved data'
    Name: run
    PrependShell: true
  - CmdLine:
    - 'mkdir -p /scif/apps # experiments'
    Name: run
    PrependShell: true
  - CmdLine:
    - 'mkdir -p /scif/logs # gunicorn logs'
    Name: run
    PrependShell: true
  - CmdLine:
    - python3 -m pip install gunicorn
    Name: run
    PrependShell: true
  - CmdLine:
    - cp expfactory/config_dummy.py expfactory/config.py &&     chmod u+x /opt/expfactory/script/generate_key.sh
      &&     /bin/bash /opt/expfactory/script/generate_key.sh /opt/expfactory/expfactory/config.py
    Name: run
    PrependShell: true
  - CmdLine:
    - python3 setup.py install
    Name: run
    PrependShell: true
  - CmdLine:
    - python3 -m pip install pyaml    pymysql psycopg2
    Name: run
    PrependShell: true
  - CmdLine:
    - 'apt-get clean          # tests, mysql,  postgres'
    Name: run
    PrependShell: true
  - Labels:
    - Key: EXPERIMENT_test-parse-url
      Value: /scif/apps/test-parse-url
    Name: label
  - Name: workdir
    Path: /scif/apps
  - CmdLine:
    - expfactory install https://www.github.com/expfactory-experiments/test-parse-url
    Name: run
    PrependShell: true
  - Labels:
    - Key: EXPERIMENT_test-task
      Value: /scif/apps/test-task
    Name: label
  - Name: workdir
    Path: /scif/apps
  - CmdLine:
    - expfactory install https://www.github.com/expfactory-experiments/test-task
    Name: run
    PrependShell: true
  - CmdLine:
    - /bin/bash
    - /startscript.sh
    Name: entrypoint
    PrependShell: false
  - Name: expose
    Ports:
    - "5000"
  - Name: expose
    Ports:
    - "80"
  From:
    Image: vanessa/expfactory-builder:base
  Name: ""
  Platform: ""
  SourceCode: FROM vanessa/expfactory-builder:base
