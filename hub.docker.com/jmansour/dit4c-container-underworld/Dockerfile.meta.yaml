MetaArgs: null
Stages:
- BaseName: dit4c/dit4c-container-ipython
  Commands:
  - Maintainer: t.dettrick@uq.edu.au
    Name: maintainer
  - Env:
    - Key: PETSC_VERSION
      Value: 3.5.3
    Name: env
  - CmdLine:
    - yum install -y   mercurial   libxml2-devel libpng-devel   openmpi-devel hdf5-openmpi-static   hostname
      time   gdal-devel geos-devel proj-devel libxml2-devel libxslt-devel   mesa-libOSMesa-devel
      mesa-libGLU-devel libX11-devel
    Name: run
    PrependShell: true
  - CmdLine:
    - su researcher -c "CPLUS_INCLUDE_PATH=/usr/include/gdal C_INCLUDE_PATH=/usr/include/gdal   /opt/python/bin/pip
      install PIL shapely fiona geopandas basemap cartopy rasterio obspy gdal"
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y udunits2 grib_api &&   su researcher -c "/opt/python/bin/pip
      install biggus pyke cdat-lite==6.0rc2" &&   su researcher -c "/opt/python/bin/pip
      install https://github.com/SciTools/iris/archive/v1.7.4.tar.gz"
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /tmp &&     wget -nv "http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-$PETSC_VERSION.tar.gz"
      &&     tar xzf petsc-lite-$PETSC_VERSION.tar.gz &&     cd petsc-$PETSC_VERSION
      &&     export LD_LIBRARY_PATH=/usr/lib64/openmpi/lib:$LD_LIBRARY_PATH &&     ./configure
      --prefix=/usr/local/petsc --download-fblaslapack --with-mpi-dir=/usr/lib64/openmpi
      --with-pic=1 &&     make all test &&     make install &&     cd /tmp &&     rm
      -r petsc-$PETSC_VERSION
    Name: run
    PrependShell: true
  - CmdLine:
    - hg clone -b newInterface https://bitbucket.org/underworldproject/underworld2
      /opt/underworld
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - /etc
    - /etc
  - CmdLine:
    - cd /opt/underworld/libUnderworld &&     ./configure.py --help &&     export
      PATH=$PATH:/usr/lib64/openmpi/bin &&     export PETSC_ARCH=linux-gnu &&     export
      PETSC_DIR=/usr/local/petsc &&     export LD_LIBRARY_PATH=/usr/lib64/openmpi/lib:$LD_LIBRARY_PATH
      &&     source /opt/python/bin/activate &&     ./configure.py --cxx=/usr/lib64/openmpi/bin/mpicxx
      --cc=/usr/lib64/openmpi/bin/mpicc --mpi-lib-dir=/usr/lib64/openmpi/lib --mpi-inc-dir=/usr/include/openmpi-x86_64
      &&     ./scons.py &&     (rm /opt/underworld/libUnderworld/build/bin/LavaVu
      || true)
    Name: run
    PrependShell: true
  From:
    Image: dit4c/dit4c-container-ipython
  Name: ""
  Platform: ""
  SourceCode: FROM dit4c/dit4c-container-ipython
