MetaArgs: null
Stages:
- BaseName: nginx:latest
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"it@feki.de"'
    - Key: version
      Value: '"0.3.0"'
    Name: label
  - Env:
    - Key: FUSIONDIRECTORY_VERSION
      Value: 1.3-1
    Name: env
  - CmdLine:
    - "apt-get update && \tapt-get install -y gnupg \tca-certificates && \tset -e;
      \texport GNUPGHOME=\"/tmp/gnupg_home\" && \tmkdir -p \"$GNUPGHOME\" && \tchmod
      700 \"$GNUPGHOME\" && \trm -f /etc/apt/sources.list.d/* && \techo \"disable-ipv6\"
      >> \"$GNUPGHOME/dirmngr.conf\" && \tfound=''; \tfor server in \t\tha.pool.sks-keyservers.net
      \t\thkp://keyserver.ubuntu.com:80 \t\thkp://p80.pool.sks-keyservers.net:80 \t\tpgp.mit.edu
      \t\tkeys.gnupg.net \t; do \t\techo \"  trying $server\"; \t\tapt-key adv --keyserver
      \"$server\" --keyserver-options timeout=10 --receive-keys D744D55EACDA69FF &&
      found=yes && break; \t\tapt-key adv --keyserver \"$server\" --keyserver-options
      timeout=10 --receive-keys D744D55EACDA69FF && found=yes && break; \tdone; \ttest
      -z \"$found\" && echo >&2 \"error: failed to fetch $key from several disparate
      servers -- network issues?\" && exit 1; \texit 0"
    Name: run
    PrependShell: true
  - CmdLine:
    - "(echo \"deb http://repos.fusiondirectory.org/fusiondirectory-current/debian-stretch
      stretch main\"; \techo \"deb http://repos.fusiondirectory.org/fusiondirectory-extra/debian-stretch
      stretch main\") \t> /etc/apt/sources.list.d/fusiondirectory-stretch.list &&
      \tapt-get update && \tDEBIAN_FRONTEND=noninteractive apt-get install -y \targonaut-server
      \tfusiondirectory=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-argonaut=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-plugin-autofs=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-certificates=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-plugin-gpg=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-ldapdump=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-plugin-ldapmanager=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-mail=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-plugin-postfix=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-ssh=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-plugin-sudo=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-systems=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-plugin-weblink=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-plugin-webservice=${FUSIONDIRECTORY_VERSION}
      \tfusiondirectory-smarty3-acl-render=${FUSIONDIRECTORY_VERSION} \tfusiondirectory-webservice-shell=${FUSIONDIRECTORY_VERSION}
      \tphp-mdb2 \tphp-mbstring \tphp-fpm && \trm -rf /var/lib/apt/lists/*"
    Name: run
    PrependShell: true
  - CmdLine:
    - "export TARGET=/etc/php/7.3/fpm/php.ini && \tsed -i -e \"s:^;\\(opcache.enable\\)
      *=.*$:\\1=1:\" ${TARGET} && \tsed -i -e \"s:^;\\(opcache.enable_cli\\) *=.*$:\\1=0:\"
      ${TARGET} && \tsed -i -e \"s:^;\\(opcache.memory_consumption\\) *=.*$:\\1=1024:\"
      ${TARGET} && \tsed -i -e \"s:^;\\(opcache.max_accelerated_files\\) *=.*$:\\1=65407:\"
      ${TARGET} && \tsed -i -e \"s:^;\\(opcache.validate_timestamps\\) *=.*$:\\1=0:\"
      ${TARGET} && \tsed -i -e \"s:^;\\(opcache.revalidate_path\\) *=.*$:\\1=1:\"
      ${TARGET} && \tsed -i -e \"s:^;\\(opcache.error_log\\) *=.*$:\\1=/dev/null:\"
      ${TARGET} && \tsed -i -e \"s:^;\\(opcache.log_verbosity_level\\) *=.*$:\\1=1:\"
      ${TARGET} && \tunset TARGET"
    Name: run
    PrependShell: true
  - CmdLine:
    - "export TARGET=/etc/php/7.3/fpm/pool.d/www.conf && \tsed -i -e \"s:^\\(listen
      *= *\\).*$:\\1/run/php7.3-fpm.sock:\" ${TARGET} && \tsed -i -e \"s:^\\(user
      *= *\\).*$:\\1nginx:\" ${TARGET} && \tunset TARGET"
    Name: run
    PrependShell: true
  - CmdLine:
    - "export TARGET=/etc/nginx/nginx.conf && \tsed -i -e \"s:^\\(user \\).*;$:\\1
      nginx www-data;:\" ${TARGET} && \tunset TARGET"
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - /sbin/entrypoint.sh
  - CmdLine:
    - chmod 755 /sbin/entrypoint.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - cmd.sh
    - /sbin/cmd.sh
  - CmdLine:
    - chmod 755 /sbin/cmd.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - default.conf
    - /etc/nginx/conf.d/
  - CmdLine:
    - /sbin/entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /sbin/cmd.sh
    Name: cmd
    PrependShell: false
  From:
    Image: nginx:latest
  Name: ""
  Platform: ""
  SourceCode: FROM nginx:latest
