MetaArgs: null
Stages:
- BaseName: solita/ubuntu-systemd
  Commands:
  - Labels:
    - Key: description
      Value: '"kubernetes in docker"'
    Name: label
  - CmdLine:
    - apt-get update && apt-get install -y     apt-transport-https ca-certificates
      curl gnupg-agent software-properties-common
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add - &&     add-apt-repository
      "deb [arch=amd64] https://download.docker.com/linux/ubuntu xenial stable" &&     apt-get
      update && apt-get install -y     docker-ce=5:18.09.9~3-0~ubuntu-xenial docker-ce-cli=5:18.09.9~3-0~ubuntu-xenial
      containerd.io
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -fsSL http://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key
      add - &&     add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/kubernetes/apt
      kubernetes-xenial main" &&     apt-get update && apt-get install -y     kubelet
      kubeadm kubectl
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install -y linux-image-$(uname -r)
    Name: run
    PrependShell: true
  - CmdLine:
    - 'mkdir -p /etc/docker && echo ''{\n    "exec-opts": ["native.cgroupdriver=cgroupfs"],\n    "log-driver":
      "json-file",\n    "log-opts": {\n        "max-size": "100m"\n    },\n    "storage-driver":
      "aufs"\n}\n'' > /etc/docker/daemon.json && mkdir -p /etc/systemd/system/docker.service.d
      && sysctl fs.inotify.max_user_watches=1048576'
    Name: run
    PrependShell: true
  - Env:
    - Key: KUBECONFIG
      Value: /etc/kubernetes/admin.conf
    Name: env
  - Name: expose
    Ports:
    - "10250"
    - "10251"
    - "10252"
    - "6443"
  - Name: volume
    Volumes:
    - /mnt
    - /var/lib/docker
  - CmdLine:
    - /bin/bash
    - -c
    - exec /sbin/init --log-target=journal 3>&1
    Name: cmd
    PrependShell: false
  From:
    Image: solita/ubuntu-systemd
  Name: ""
  Platform: ""
  SourceCode: FROM solita/ubuntu-systemd
