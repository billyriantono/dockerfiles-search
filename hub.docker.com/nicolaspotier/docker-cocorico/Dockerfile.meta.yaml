MetaArgs: null
Stages:
- BaseName: ubuntu:14.04
  Commands:
  - Maintainer: Nicolas Potier <nicolas.potier@acseo-conseil.fr>
    Name: maintainer
  - Env:
    - Key: ENVIRONMENT
      Value: docker
    Name: env
  - Env:
    - Key: MONGO_PHP_VERSION
      Value: 1.5.5
    Name: env
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - apt-get update &&     apt-get -yq install         zip         unzip         vim         curl         wget         git         make         apache2         libapache2-mod-php5         php5         php5-dev         php5-intl         php5-gd         php5-curl         php5-mcrypt         php5-mysql         php-pear         php-apc
      &&     rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i "s/variables_order.*/variables_order = \"EGPCS\"/g" /etc/php5/apache2/php.ini
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin
      --filename=composer
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/www/.composer &&     chown -R www-data:www-data /var/www/.composer
    Name: run
    PrependShell: true
  - CmdLine:
    - pecl install mongo-$MONGO_PHP_VERSION &&     mkdir -p /etc/php5/mods-available
      &&     echo "extension=mongo.so" > /etc/php5/mods-available/mongo.ini &&     ln
      -s /etc/php5/mods-available/mongo.ini /etc/php5/cli/conf.d/mongo.ini &&     ln
      -s /etc/php5/mods-available/mongo.ini /etc/php5/apache2/conf.d/mongo.ini &&     ln
      -s /etc/php5/mods-available/mcrypt.ini /etc/php5/cli/conf.d/mcrypt.ini &&     ln
      -s /etc/php5/mods-available/mcrypt.ini /etc/php5/apache2/conf.d/mcrypt.ini
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./php.ini
    - /usr/local/etc/php/conf.d/php5-cocorico.ini
  - Env:
    - Key: APACHE_CONFDIR
      Value: /etc/apache2
    Name: env
  - Env:
    - Key: APACHE_ENVVARS
      Value: $APACHE_CONFDIR/envvars
    Name: env
  - CmdLine:
    - a2dismod mpm_event &&     a2enmod mpm_prefork &&     a2enmod php5 &&     a2enmod
      rewrite &&     a2enmod headers &&     a2enmod ssl  &&     a2enmod vhost_alias
    Name: run
    PrependShell: true
  - CmdLine:
    - set -ex &&     . "$APACHE_ENVVARS" &&     ln -sfT /dev/stderr "$APACHE_LOG_DIR/error.log"
      &&     ln -sfT /dev/stdout "$APACHE_LOG_DIR/access.log" &&     ln -sfT /dev/stdout
      "$APACHE_LOG_DIR/other_vhosts_access.log"
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -f /etc/apache2/sites-enabled/000-default.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/www/html/app/cache &&     mkdir -p /var/www/html/app/logs &&     chown
      -R www-data:www-data /var/www/html/app/cache &&     chown -R www-data:www-data
      /var/www/html/app/logs
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -qq clean &&     rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /var/www/html
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - apache2-foreground
    - /usr/local/bin/
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - apache2-foreground
    Name: cmd
    PrependShell: false
  From:
    Image: ubuntu:14.04
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:14.04
