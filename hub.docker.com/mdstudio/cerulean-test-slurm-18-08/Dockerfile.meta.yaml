MetaArgs: null
Stages:
- BaseName: mdstudio/cerulean-test-base:latest
  Commands:
  - Name: user
    User: root
  - CmdLine:
    - apt-get update &&     apt-get install -y --no-install-recommends munge libmunge2
      &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod 0700 /etc/munge /var/log/munge && chmod 0711 /var/lib/munge && mkdir /var/run/munge
      && chmod 0755 /var/run/munge && chmod 0400 /etc/munge/munge.key
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R munge:munge /etc/munge /var/lib/munge /var/log/munge /var/run/munge
    Name: run
    PrependShell: true
  - CmdLine:
    - groupadd --system slurm && useradd --system --gid slurm --create-home slurm
    Name: run
    PrependShell: true
  - CmdLine:
    - echo slurm:slurm | chpasswd
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/spool/slurmctld/state
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R slurm:slurm /var/spool/slurmctld
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/local/etc/slurm
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /var/log/slurm
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R slurm:slurm /var/log/slurm
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - slurm.cert
    - /usr/local/etc/slurm/slurm.cert
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - slurm.key
    - /usr/local/etc/slurm/slurm.key
  - CmdLine:
    - chmod 600 /usr/local/etc/slurm/slurm.key
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - install_slurm.sh
    - /usr/local/bin/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - slurm_timeout.diff
    - /usr/local/etc/
  - Name: workdir
    Path: /usr/local
  - CmdLine:
    - apt-get update &&     apt-get --no-install-recommends install -y gcc make libssl-dev
      libmunge-dev tar wget patch &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
    Name: run
    PrependShell: true
  - CmdLine:
    - /bin/bash /usr/local/bin/install_slurm.sh slurm-18-08-4-1.tar.gz
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - slurm.conf
    - /usr/local/etc/slurm/slurm.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - start-services.sh
    - /etc/start-services.sh
  - CmdLine:
    - chmod +x /etc/start-services.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /etc/start-services.sh
    Name: cmd
    PrependShell: true
  From:
    Image: mdstudio/cerulean-test-base:latest
  Name: ""
  Platform: ""
  SourceCode: FROM mdstudio/cerulean-test-base:latest
