{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "debian:jessie",
      "SourceCode": "FROM debian:jessie",
      "Platform": "",
      "From": {
        "Image": "debian:jessie"
      },
      "Commands": [
        {
          "Env": [
            {
              "Key": "DEBIAN_FRONTEND",
              "Value": "noninteractive"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "usermod -m -d /srv/www -s /bin/bash www-data \u0026\u0026     echo \"www-data:www-data\" | chpasswd \u0026\u0026     mkdir /var/run/sshd \u0026\u0026     mkdir -p /srv/www \u0026\u0026     chown -R www-data:www-data /srv/www"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apt-get update \u0026\u0026 apt-get install -y curl  \u0026\u0026     curl -sL https://deb.nodesource.com/setup_5.x | bash - \u0026\u0026     apt-get install -y nodejs \u0026\u0026     npm install -g npm \u0026\u0026     mkdir -p $(npm config get prefix)/{lib/node_modules,bin,share} \u0026\u0026     chown -R www-data:www-data $(npm config get prefix)/{lib/node_modules,bin,share} \u0026\u0026     apt-get -y autoclean \u0026\u0026 apt-get -y autoremove \u0026\u0026 rm -rf /var/lib/apt/lists/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "curl -sSL https://rvm.io/mpapis.asc | gpg --import - \u0026\u0026     curl -sSL https://get.rvm.io | bash -s stable --rails \u0026\u0026     /bin/bash -l -c \"gem install bundler sass compass\" \u0026\u0026     usermod -aG rvm www-data"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "echo \"deb http://packages.dotdeb.org jessie all\" \u003e /etc/apt/sources.list.d/php-7.0.list \u0026\u0026     echo \"deb-src http://packages.dotdeb.org jessie all\" \u003e\u003e /etc/apt/sources.list.d/php-7.0.list \u0026\u0026     apt-get update \u0026\u0026 apt-get install -y wget \u0026\u0026     wget https://www.dotdeb.org/dotdeb.gpg \u0026\u0026     apt-key add dotdeb.gpg \u0026\u0026 rm -f dotdeb.gpg \u0026\u0026     apt-get update \u0026\u0026 apt-get install -y       postgresql-client       mariadb-client       openssh-server       bash-completion       nano       mc       git       wget       php7.0-cli       php7.0-dev       php7.0-xdebug       php7.0-json       php7.0-pgsql       php7.0-sqlite3       php7.0-mcrypt       php7.0-mongodb       php7.0-intl       php7.0-gd       php7.0-mysql       php7.0-redis       php7.0-memcached       php7.0-bz2       php7.0-curl       php7.0-opcache       php7.0-igbinary       php7.0-xml       php7.0-mbstring       php7.0-bcmath       php5-cli       php5-mcrypt       php5-curl       php5-mysql       php5-pgsql       php5-memcached       php5-xdebug       php5-intl       php5-gd       php5-mongo       php5-sqlite       libxml2-dev       libmcrypt-dev       libbz2-dev       libmhash-dev       libmhash2       libxslt1-dev       libmemcached-dev       libgd2-xpm-dev       libcurl4-openssl-dev       libicu-dev       libpq-dev \u0026\u0026     apt-get clean -y \u0026\u0026 apt-get autoclean -y \u0026\u0026     apt-get -y autoremove \u0026\u0026 rm -rf /var/lib/apt/lists/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "curl -L -O https://github.com/phpbrew/phpbrew/raw/master/phpbrew \u0026\u0026     chmod +x phpbrew \u0026\u0026     mv phpbrew /usr/local/bin/phpbrew \u0026\u0026     chown www-data:www-data /usr/local/bin/phpbrew"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "curl -sS https://getcomposer.org/installer | php \u0026\u0026     mv composer.phar /usr/local/bin/composer \u0026\u0026     chown www-data:www-data /usr/local/bin/composer \u0026\u0026     chmod +x /usr/local/bin/composer"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "wget http://files.drush.org/drush.phar \u0026\u0026     php drush.phar core-status \u0026\u0026     chmod +x drush.phar \u0026\u0026     mv drush.phar /usr/local/bin/drush \u0026\u0026     chown www-data:www-data /usr/local/bin/drush"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "echo \"date.timezone = Europe/Minsk\" \u003e\u003e /etc/php/7.0/cli/php.ini"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "echo 'KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1' \u003e\u003e /etc/ssh/sshd_config"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "expose",
          "Ports": [
            "22"
          ]
        },
        {
          "CmdLine": [
            "/usr/sbin/sshd"
          ],
          "Name": "entrypoint",
          "PrependShell": false
        },
        {
          "CmdLine": [
            "-D"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}