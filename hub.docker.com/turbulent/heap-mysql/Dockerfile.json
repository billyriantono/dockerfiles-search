{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "turbulent/heap-base:2.0.3",
      "SourceCode": "FROM turbulent/heap-base:2.0.3",
      "Platform": "",
      "From": {
        "Image": "turbulent/heap-base:2.0.3"
      },
      "Commands": [
        {
          "Maintainer": "Benoit Beausejour \u003cb@turbulent.ca\u003e",
          "Name": "maintainer"
        },
        {
          "Env": [
            {
              "Key": "heap-mysql",
              "Value": "2.1.0"
            }
          ],
          "Name": "env"
        },
        {
          "Env": [
            {
              "Key": "DEBIAN_FRONTEND",
              "Value": "noninteractive"
            }
          ],
          "Name": "env"
        },
        {
          "CmdLine": [
            "apt-get update \u0026\u0026   apt-get -yq install mysql-server pwgen \u0026\u0026   apt-get -yq install percona-xtrabackup \u0026\u0026   apt-get -yq install unzip \u0026\u0026   rm -rf /var/lib/apt/lists/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "rm -rf /var/lib/mysql/*"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "mysqld_charset.cnf",
            "/etc/mysql/conf.d/mysqld_charset.cnf"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "import_sql.sh",
            "/import_sql.sh"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "my.cnf.tmpl",
            "/systpl/"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            ".my.cnf.tmpl",
            "/systpl/"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "make-backup.sh.tmpl",
            "/systpl/"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "https://github.com/innotop/innotop/archive/744710dd39a78a5b25096cd0dcda8ba57a7575b2.zip",
            "/tmp/innotop.zip"
          ]
        },
        {
          "CmdLine": [
            "cd /tmp/ \u0026\u0026 unzip innotop.zip \u0026\u0026 cd innotop-744710dd39a78a5b25096cd0dcda8ba57a7575b2 \u0026\u0026 perl Makefile.PL \u0026\u0026 make install"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            "run.sh",
            "/run.sh"
          ]
        },
        {
          "CmdLine": [
            "chmod 755 /*.sh"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Env": [
            {
              "Key": "VAR_MYSQL_USER",
              "Value": "admin"
            },
            {
              "Key": "VAR_MYSQL_PASS",
              "Value": "\"**Random**\""
            },
            {
              "Key": "VAR_MYSQL_SLOWLOG",
              "Value": "\"true\""
            },
            {
              "Key": "VAR_MYSQL_SLOWLOG_TIME",
              "Value": "\"3\""
            },
            {
              "Key": "VAR_MYSQL_SLOWLOG_INDEXES",
              "Value": "\"0\""
            },
            {
              "Key": "VAR_MYSQL_SERVER_ID",
              "Value": "\"1\""
            },
            {
              "Key": "VAR_MYSQL_BINLOG_SIZE",
              "Value": "\"100M\""
            },
            {
              "Key": "VAR_MYSQL_BINLOG_FORMAT",
              "Value": "\"STATEMENT\""
            },
            {
              "Key": "VAR_MYSQL_EXPIRE_LOGS_DAYS",
              "Value": "\"14\""
            },
            {
              "Key": "VAR_MYSQL_MAX_ALLOWED_PACKET",
              "Value": "\"16M\""
            },
            {
              "Key": "VAR_MYSQL_MAX_CONNECT_ERRORS",
              "Value": "\"100000\""
            },
            {
              "Key": "VAR_MYSQL_MAX_CONNECTIONS",
              "Value": "\"1024\""
            },
            {
              "Key": "VAR_MYSQL_OPEN_FILES_LIMIT",
              "Value": "\"65535\""
            },
            {
              "Key": "VAR_MYSQL_INNODB_BUFFER_POOL_SIZE",
              "Value": "\"100M\""
            },
            {
              "Key": "VAR_MYSQL_INNODB_ADDITIONAL_MEM_POOL_SIZE",
              "Value": "\"10M\""
            },
            {
              "Key": "VAR_MYSQL_INNODB_LOG_FILE_SIZE",
              "Value": "\"25M\""
            },
            {
              "Key": "VAR_MYSQL_INNODB_LOG_BUFFER_SIZE",
              "Value": "\"4M\""
            },
            {
              "Key": "VAR_MYSQL_INNODB_FLUSH_LOG_AT_TRX_COMMIT",
              "Value": "\"2\""
            },
            {
              "Key": "VAR_MYSQL_TRANSACTION_ISOLATION",
              "Value": "\"REPEATABLE-READ\""
            },
            {
              "Key": "VAR_MYSQL_REPLICATION_MASTER",
              "Value": "\"\""
            },
            {
              "Key": "VAR_MYSQL_REPLICATION_SLAVE",
              "Value": "\"\""
            },
            {
              "Key": "VAR_MYSQL_REPLICATION_USER",
              "Value": "\"replication\""
            },
            {
              "Key": "VAR_MYSQL_REPLICATION_PASSWORD",
              "Value": "\"replication\""
            },
            {
              "Key": "VAR_MYSQL_REPLICATION_HOST",
              "Value": "\"\""
            },
            {
              "Key": "VAR_MYSQL_REPLICATION_PORT",
              "Value": "\"3306\""
            },
            {
              "Key": "VAR_MYSQL_BACKUP_DIR",
              "Value": "\"\""
            }
          ],
          "Name": "env"
        },
        {
          "Name": "volume",
          "Volumes": [
            "/vol/logs",
            "/vol/database",
            "/vol/backups"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "replicactl",
            "/replicactl"
          ]
        },
        {
          "Name": "expose",
          "Ports": [
            "3306"
          ]
        },
        {
          "CmdLine": [
            "/run.sh"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}