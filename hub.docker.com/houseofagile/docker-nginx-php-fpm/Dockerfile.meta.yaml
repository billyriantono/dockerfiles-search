MetaArgs: null
Stages:
- BaseName: phusion/baseimage:0.11
  Commands:
  - Maintainer: Meillaud Jean-Christophe (jc@houseofagile.com)
    Name: maintainer
  - CmdLine:
    - apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 4F4EA0AAE5267A6C &&   LC_ALL=en_US.UTF-8
      add-apt-repository -y ppa:ondrej/php &&   apt-get update && apt-get install
      -y software-properties-common &&   apt-get update && apt-get install -y   nginx   software-properties-common   git-core   php7.2   php7.2-fpm   php7.2-mysql   php7.2-imagick   php7.2-imap   php7.2-curl   php7.2-cli   php7.2-gd   php7.2-pgsql   php7.2-sqlite   php7.2-common   php-pear   curl   php7.2-json   php7.2-intl   php7.2-xml   php7.2-mbstring   php7.2-zip   php-apcu   python   g++   make   sudo
      &&   chown www-data -R /usr/share/nginx/ &&   echo "source ~/.bashrc">>/root/.bash_profile
      &&   curl -sSL https://raw.github.com/beaudev/bash-profile/master/install-bash-profile.sh|bash
      &&   apt-get clean && rm -rf /tmp/* /var/tmp/* &&   service php7.2-fpm start
    Name: run
    PrependShell: true
  - CmdLine:
    - useradd -d /home/hoauser -ms /bin/bash -g root -G sudo,www-data -p ${DEPL_USER_PASSWORD:-hoauser}
      hoauser &&     groupadd hoauser &&     usermod -aG hoauser hoauser &&     echo
      "hoauser ALL=(ALL) NOPASSWD:ALL">/etc/sudoers.d/90-cloud-init-users
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - nginx-default.conf
    - /etc/nginx/sites-available/default
  - CmdLine:
    - sed -i 's#%%php_fpm_sock_file%%#/run/php/php7.2-fpm.sock#g' /etc/nginx/sites-available/default
      &&   echo "<?php\nphpinfo();">/var/www/html/index.php
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /etc/service/01_phpfpm /etc/service/02_nginx
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "#!/usr/bin/env bash\nphp-fpm7.2 -F -c /etc/php/7.2/fpm" > /etc/service/01_phpfpm/run
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - build/nginx.sh
    - /etc/service/02_nginx/run
  - CmdLine:
    - chmod +x /etc/service/01_phpfpm/run /etc/service/02_nginx/run
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "80"
  - CmdLine:
    - /sbin/my_init
    Name: cmd
    PrependShell: false
  From:
    Image: phusion/baseimage:0.11
  Name: ""
  Platform: ""
  SourceCode: FROM phusion/baseimage:0.11
