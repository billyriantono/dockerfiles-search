MetaArgs: null
Stages:
- BaseName: ubuntu:latest
  Commands:
  - Maintainer: ZhiQiang Shan <shandyshandy@163.com>
    Name: maintainer
  - Key: JSTORM_VERSION
    Name: arg
    Value: 2.2.1
  - Key: JSTORM_FILE
    Name: arg
    Value: jstorm-${JSTORM_VERSION}.zip
  - Key: JSTORM_URL
    Name: arg
    Value: https://github.com/alibaba/jstorm/releases/download/${JSTORM_VERSION}/${JSTORM_FILE}
  - Key: JSTORM_INSTALL_PATH
    Name: arg
    Value: /opt
  - Env:
    - Key: JSTORM_HOME
      Value: $JSTORM_INSTALL_PATH/jstorm
    Name: env
  - Env:
    - Key: JSTORM_CLUSTER
      Value: $JSTORM_HOME
    Name: env
  - Env:
    - Key: JSTORM_VERSION
      Value: 2.2.1
    Name: env
  - Env:
    - Key: JRE_HOME
      Value: /usr/lib/jvm/java-8-openjdk-amd64/jre
    Name: env
  - Env:
    - Key: JAVA_HOME
      Value: ${JRE_HOME}
    Name: env
  - Env:
    - Key: PATH
      Value: $PATH:$JSTORM_CLUSTER/bin:$JSTORM_HOME/bin
    Name: env
  - Env:
    - Key: TERM
      Value: xterm-color
    Name: env
  - CmdLine:
    - sed 's/archive.ubuntu.com/mirrors.163.com/g' /etc/apt/sources.list > /etc/apt/sources.list.china
    Name: run
    PrependShell: true
  - CmdLine:
    - cp /etc/apt/sources.list /etc/apt/sources.list.ubuntu
    Name: run
    PrependShell: true
  - CmdLine:
    - cp /etc/apt/sources.list.china /etc/apt/sources.list
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s ~/.profile ~/.bash_profile
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update &&     apt-get install -y vim net-tools iputils-ping tcpdump
      iptables nmon curl sudo tomcat8
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update &&     apt-get install -y openjdk-8-jre-headless unzip wget python
      &&     apt-get clean &&     mkdir -p "${JSTORM_INSTALL_PATH}" &&     wget "$JSTORM_URL"
      -O "$JSTORM_INSTALL_PATH/$JSTORM_FILE" &&     unzip "${JSTORM_INSTALL_PATH}/${JSTORM_FILE}"
      -d "${JSTORM_INSTALL_PATH}" &&     mv "${JSTORM_INSTALL_PATH}/jstorm-${JSTORM_VERSION}"
      "${JSTORM_HOME}" &&     mv "${JSTORM_HOME}/conf/storm.yaml" "${JSTORM_HOME}/conf/storm.yaml.template"
      &&     chmod +x "$JSTORM_HOME/bin/jstorm" &&     rm "$JSTORM_INSTALL_PATH/$JSTORM_FILE"
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /var/lib/tomcat8/logs /usr/share/tomcat8/logs
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /var/lib/tomcat8/conf /usr/share/tomcat8/conf
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /var/lib/tomcat8/webapps /usr/share/tomcat8/webapps
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /var/lib/tomcat8/work /usr/share/tomcat8/work
    Name: run
    PrependShell: true
  - CmdLine:
    - rm -rf /var/lib/tomcat8/lib
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/share/tomcat8/lib /var/lib/tomcat8/lib
    Name: run
    PrependShell: true
  - Name: workdir
    Path: $JSTORM_HOME
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - build-data/jstorm.sh
    - /jstorm_entrypoint.sh
  - Chown: ""
    Name: add
    SourcesAndDest:
    - build-data/common.sh
    - /
  - CmdLine:
    - chmod 777 /*.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - /jstorm_entrypoint.sh
    - bash
    Name: entrypoint
    PrependShell: false
  From:
    Image: ubuntu:latest
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:latest
