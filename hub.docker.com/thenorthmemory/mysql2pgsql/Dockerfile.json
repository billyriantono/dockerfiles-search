{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "centos:7",
      "SourceCode": "FROM centos:7",
      "Platform": "",
      "From": {
        "Image": "centos:7"
      },
      "Commands": [
        {
          "Env": [
            {
              "Key": "PATH",
              "Value": "$PATH:/dbsync/bin"
            }
          ],
          "Name": "env"
        },
        {
          "Chown": "",
          "From": "",
          "Name": "copy",
          "SourcesAndDest": [
            ".",
            "/tmp/aliyun/"
          ]
        },
        {
          "CmdLine": [
            "set -ex     \u0026\u0026 {         echo '[mysql57-community]';         echo 'name=mysql57-community';         echo 'baseurl=http://repo.mysql.com/yum/mysql-5.7-community/el/$releasever/$basearch/';         echo 'enabled=1';         echo 'gpgcheck=0';         echo '[pgdg10]';         echo 'name=pgdg10';         echo 'baseurl=https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-$releasever-$basearch';         echo 'enabled=1';         echo 'gpgcheck=0';     } \u003e /etc/yum.repos.d/dbsync_deps.repo     \u0026\u0026 cp -ra /var/log/yum.log /tmp/yum.log.old     \u0026\u0026 yum install mysql-community-client mysql-community-devel postgresql10-devel gcc gcc-c++ make unzip -y     \u0026\u0026 update-alternatives --install /usr/bin/pg_config pgsql-pg_config /usr/pgsql-10/bin/pg_config 300     \u0026\u0026 (         cd /tmp/aliyun/dbsync         \u0026\u0026 make         \u0026\u0026 install -D -d /dbsync/bin /dbsync/lib         \u0026\u0026 install -p -D -m 0755 *2pgsql /dbsync/bin         \u0026\u0026 install -p -D -m 0755 ali_recvlogical.so /dbsync/lib         \u0026\u0026 install -p -D -m 0644 my.cfg ../LICENSE ../README.md /dbsync         \u0026\u0026 ln -sf /usr/share/mysql /dbsync/share     )     \u0026\u0026 update-alternatives --remove pgsql-pg_config /usr/pgsql-10/bin/pg_config     \u0026\u0026 mkdir -p /tmp/extbin     \u0026\u0026 curl -L https://github.com/aliyun/rds_dbsync/files/1555186/mysql2pgsql.bin.el7.20171213.zip -o /tmp/extbin/bin.zip     \u0026\u0026 (cd /tmp/extbin \u0026\u0026 unzip -o bin.zip \u0026\u0026 install -p -D -m 0755 mysql2pgsql.bin*/bin/binlog_* /dbsync/bin)     \u0026\u0026 yum remove -y mysql-community-devel postgresql10-devel unzip gcc gcc-c++ make cpp glibc-devel glibc-headers libicu-devel libstdc++-devel kernel-headers     \u0026\u0026 yum clean all \u0026\u0026 mv /tmp/yum.log.old /var/log/yum.log     \u0026\u0026 rm -rf /tmp/aliyun /tmp/extbin /var/cache/yum/* /etc/yum.repos.d/dbsync_deps.repo     \u0026\u0026 ls -alhR /dbsync \u0026\u0026 ldd /dbsync/bin/* \u0026\u0026 mysql --version \u0026\u0026 psql --version \u0026\u0026 mysql2pgsql -h"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "workdir",
          "Path": "/dbsync"
        },
        {
          "CmdLine": [
            "mysql2pgsql",
            "-h"
          ],
          "Name": "cmd",
          "PrependShell": false
        }
      ]
    }
  ]
}