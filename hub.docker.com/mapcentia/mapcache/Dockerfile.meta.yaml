MetaArgs: null
Stages:
- BaseName: debian:stretch
  Commands:
  - Maintainer: Martin HÃ¸gh<mh@mapcentia.com>
    Name: maintainer
  - CmdLine:
    - export DEBIAN_FRONTEND=noninteractive
    Name: run
    PrependShell: true
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - CmdLine:
    - apt-get -y update  --fix-missing
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y install sudo vim wget curl apache2 libfcgi-dev apache2-dev cmake
      g++ build-essential inotify-hookable     libgdal-dev libgdal-dev libgeos-dev
      libpng-dev libjpeg-dev libcurl4-gnutls-dev libpcre3-dev libpixman-1-dev libsqlite3-dev
      libtiff5-dev git     supervisor libdb5.3 libdb5.3++ libdb5.3++-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - cd ~ &&     git clone http://github.com/mapserver/mapcache.git
    Name: run
    PrependShell: true
  - CmdLine:
    - cd ~ &&     cd mapcache &&    mkdir build &&    cd build &&    cmake -DWITH_BERKELEY_DB=ON
      .. &&    make &&    make install &&    ldconfig
    Name: run
    PrependShell: true
  - CmdLine:
    - sed 's/Listen 80/Listen 5555/' -i /etc/apache2/ports.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - a2enmod headers
    Name: run
    PrependShell: true
  - CmdLine:
    - a2dismod -f mime dir auth_basic authn_core access_compat authn_file authz_host
      authz_user filter deflate authn_file negotiation autoindex reqtimeout setenvif
      status
    Name: run
    PrependShell: true
  - CmdLine:
    - apache2ctl start
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - conf/apache/000-default.conf
    - /etc/apache2/sites-enabled/
  - Chown: ""
    Name: add
    SourcesAndDest:
    - conf/apache/mapcache.conf
    - /etc/apache2/sites-enabled/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - watch_mapcache_changes.sh
    - /watch_mapcache_changes.sh
  - CmdLine:
    - chmod +x /watch_mapcache_changes.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - reload.js
    - /reload.js
  - CmdLine:
    - curl -sL https://deb.nodesource.com/setup_8.x -o nodesource_setup.sh &&    bash
      nodesource_setup.sh &&    apt-get install -y nodejs
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir /mapcache
    Name: run
    PrependShell: true
  - CmdLine:
    - cp /root/mapcache/mapcache.xml /mapcache/
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /var/log
    - /etc/apache2
    - /mapcache
    - /tmp
  - Chown: ""
    Name: add
    SourcesAndDest:
    - conf/apache/run-apache.sh
    - /
  - CmdLine:
    - chmod +x /run-apache.sh
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - conf/supervisor/supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - CmdLine:
    - /usr/bin/supervisord
    - -c
    - /etc/supervisor/conf.d/supervisord.conf
    Name: cmd
    PrependShell: false
  From:
    Image: debian:stretch
  Name: ""
  Platform: ""
  SourceCode: FROM debian:stretch
