{
  "MetaArgs": null,
  "Stages": [
    {
      "Name": "",
      "BaseName": "ivre/base",
      "SourceCode": "FROM ivre/base",
      "Platform": "",
      "From": {
        "Image": "ivre/base"
      },
      "Commands": [
        {
          "Maintainer": "Pierre LALET \u003cpierre.lalet@cea.fr\u003e",
          "Name": "maintainer"
        },
        {
          "CmdLine": [
            "apt-get -qy install nginx spawn-fcgi php-fpm php-gd fcgiwrap uwsgi-plugin-python"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "nginx-default-site",
            "/etc/nginx/sites-available/default"
          ]
        },
        {
          "CmdLine": [
            "echo '\\ndaemon off;' \u003e\u003e /etc/nginx/nginx.conf"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir /var/run/uwsgi"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "http://download.dokuwiki.org/src/dokuwiki/dokuwiki-stable.tgz",
            "./dokuwiki-stable.tgz"
          ]
        },
        {
          "CmdLine": [
            "tar --transform='s#^dokuwiki-\\([^/]*\\)#var/www/dokuwiki#' -zxf ./dokuwiki-stable.tgz \u0026\u0026 rm ./dokuwiki-stable.tgz"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "apt-get -qy install patch \u0026\u0026     patch var/www/dokuwiki/inc/html.php usr/local/share/ivre/dokuwiki/backlinks.patch \u0026\u0026     apt-get -qy --purge autoremove patch"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "ln -s /usr/local/share/ivre/dokuwiki/doc var/www/dokuwiki/data/pages/doc \u0026\u0026     ln -s /usr/local/share/ivre/dokuwiki/media/logo.png var/www/dokuwiki/data/media/wiki/logo.png \u0026\u0026     mkdir var/www/dokuwiki/data/media/doc \u0026\u0026     ln -s /usr/local/share/doc/ivre/screenshots var/www/dokuwiki/data/media/doc/ \u0026\u0026     ln -s /usr/local/share/ivre/dokuwiki/media/doc var/www/dokuwiki/data/media/wiki/doc \u0026\u0026     echo 'WEB_GET_NOTEPAD_PAGES = (\"localdokuwiki\", (\"/var/www/dokuwiki/data/pages\",))' \u003e\u003e /etc/ivre.conf"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "rm var/www/dokuwiki/install.php"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "doku-conf-local.php",
            "var/www/dokuwiki/conf/local.php"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "doku-conf-plugins.local.php",
            "var/www/dokuwiki/conf/plugins.local.php"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "doku-conf-acl.auth.php",
            "var/www/dokuwiki/conf/acl.auth.php"
          ]
        },
        {
          "Chown": "",
          "Name": "add",
          "SourcesAndDest": [
            "doku-conf-users.auth.php",
            "var/www/dokuwiki/conf/users.auth.php"
          ]
        },
        {
          "CmdLine": [
            "chown -Rh www-data:www-data var/www/dokuwiki/data var/www/dokuwiki/conf var/www/dokuwiki/lib/plugins"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "CmdLine": [
            "mkdir /var/www/.neo4j \u0026\u0026 chown www-data:www-data /var/www/.neo4j"
          ],
          "Name": "run",
          "PrependShell": true
        },
        {
          "Name": "expose",
          "Ports": [
            "80"
          ]
        },
        {
          "CmdLine": [
            "service php7.0-fpm start \u0026\u0026     service fcgiwrap start \u0026\u0026     for d in \"\" /local; do if [ -f \"/usr$d/share/ivre/web/wsgi/app.wsgi\" ];       then APP=\"/usr$d/share/ivre/web/wsgi/app.wsgi\"; break; fi; done \u0026\u0026     uwsgi --plugin /usr/lib/uwsgi/plugins/python_plugin.so       --daemonize /var/log/nginx/uwsgi.log       --socket /var/run/uwsgi/sock       --processes 4 --threads 2       --mount /cgi=\"$APP\" --manage-script-name \u0026\u0026     exec /usr/sbin/nginx"
          ],
          "Name": "cmd",
          "PrependShell": true
        }
      ]
    }
  ]
}