MetaArgs: null
Stages:
- BaseName: phusion/baseimage:0.9.16
  Commands:
  - Maintainer: peter@codebuffet.co
    Name: maintainer
  - Name: expose
    Ports:
    - "3001"
    - "6001"
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sL https://deb.nodesource.com/setup | sudo bash -
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get -y install nodejs supervisor imagemagick sendmail build-essential unzip
      wget
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /opt     && wget https://github.com/Countly/countly-server/releases/download/16.06/countly-community-edition-v16.06.zip     &&
      unzip countly-community-edition-v16.06.zip     && rm countly-community-edition-v16.06.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /opt/countly/api     && sudo npm install time
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /opt/countly     && npm install -g grunt-cli --unsafe-perm; npm install
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - config/api.js
    - /opt/countly/api/config.js
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - config/frontend.js
    - /opt/countly/frontend/express/config.js
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - config/javascripts.js
    - /opt/countly/frontend/express/public/javascripts/countly/countly.config.js
  - Chown: ""
    Name: add
    SourcesAndDest:
    - /scripts/countly-api.sh
    - /etc/service/countly-api/run
  - Chown: ""
    Name: add
    SourcesAndDest:
    - /scripts/countly-dashboard.sh
    - /etc/service/countly-dashboard/run
  - CmdLine:
    - "useradd -r -M -U -d /opt/countly -s /bin/false countly && \techo \"countly
      ALL=(ALL) NOPASSWD: /usr/bin/sv restart countly-api countly-dashboard\" > /etc/sudoers.d/countly"
    Name: run
    PrependShell: true
  - CmdLine:
    - cp /opt/countly/plugins/plugins.default.json /opt/countly/plugins/plugins.json
    Name: run
    PrependShell: true
  - CmdLine:
    - bash /opt/countly/bin/scripts/countly.install.plugins.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - cd /opt/countly; grunt dist-all
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  From:
    Image: phusion/baseimage:0.9.16
  Name: ""
  Platform: ""
  SourceCode: FROM phusion/baseimage:0.9.16
