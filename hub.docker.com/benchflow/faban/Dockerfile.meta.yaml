MetaArgs: null
Stages:
- BaseName: benchflow/base-images:dns-java7_dev
  Commands:
  - Maintainer: Vincenzo FERME <info@vincenzoferme.it>
    Name: maintainer
  - Env:
    - Key: RELEASE_VERSION
      Value: v-dev
    Name: env
  - Env:
    - Key: FABAN_VERSION
      Value: dev
    Name: env
  - Env:
    - Key: FABAN_ROOT
      Value: /app/
    Name: env
  - Env:
    - Key: FABAN_HOME
      Value: ${FABAN_ROOT}faban
    Name: env
  - CmdLine:
    - "apk --update add wget procps && \twget -q --no-check-certificate -O /tmp/faban.tar.gz
      https://github.com/benchflow/faban/releases/download/${RELEASE_VERSION}/faban-kit-${FABAN_VERSION}.tar.gz
      && \tmkdir -p ${FABAN_ROOT}/ && \ttar -xzvf /tmp/faban.tar.gz -C ${FABAN_ROOT}/
      && \tapk del --purge wget &&     rm -rf /var/cache/apk/* /tmp/* /var/tmp/* *.gz"
    Name: run
    PrependShell: true
  - CmdLine:
    - "mkdir -p ${FABAN_HOME}/master/webapps/faban && \tcd ${FABAN_HOME}/master/webapps/faban
      && \tJAVA=`readlink -f $(which java) | sed 's|/bin/java$||'` && \t$JAVA/bin/jar
      xf ../faban.war"
    Name: run
    PrependShell: true
  - CmdLine:
    - ln -s /usr/bin/awk /bin/awk
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./bin/startup.sh
    - ${FABAN_HOME}/master/bin/startup.sh
  - CmdLine:
    - chmod +x ${FABAN_HOME}/master/bin/startup.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./bin/catalina.sh
    - ${FABAN_HOME}/master/bin/catalina.sh
  - CmdLine:
    - chmod +x ${FABAN_HOME}/master/bin/catalina.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./config/logging.properties
    - ${FABAN_HOME}/config/logging.properties
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./services/fix_localhost/fix_localhost.sh
    - /fix_localhost.sh
  - CmdLine:
    - chmod +x /fix_localhost.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./services/005-fix-localhost.conf
    - /apps/chaperone.d/005-fix-localhost.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./services/300-faban-harness.conf
    - /apps/chaperone.d/300-faban-harness.conf
  - CmdLine:
    - ln -sf /dev/stdout ${FABAN_HOME}/master/logs/catalina.out
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/master/logs
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/master/conf
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/output
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/benchmarks
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/config
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/logs
  - Name: volume
    Volumes:
    - ${FABAN_HOME}/services
  - Name: expose
    Ports:
    - "9980"
  - Name: expose
    Ports:
    - "9981"
  - Name: expose
    Ports:
    - "9984"
  - Name: expose
    Ports:
    - "9985"
  - Name: expose
    Ports:
    - "9998"
  - Name: expose
    Ports:
    - "9999"
  From:
    Image: benchflow/base-images:dns-java7_dev
  Name: ""
  Platform: ""
  SourceCode: FROM benchflow/base-images:dns-java7_dev
