MetaArgs: null
Stages:
- BaseName: nvidia/cuda:9.2-devel-ubuntu16.04
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Trevor L. McDonell <tmcdonell@cse.unsw.edu.au>"'
    Name: label
  - Key: DEBIAN_FRONTEND
    Name: arg
    Value: noninteractive
  - Key: PREFIX
    Name: arg
    Value: /opt/accelerate-llvm
  - Env:
    - Key: LANG
      Value: C.UTF-8
    Name: env
  - Env:
    - Key: LC_ALL
      Value: C.UTF-8
    Name: env
  - Env:
    - Key: PATH
      Value: /root/.cabal/bin:/root/.local/bin:${PATH}
    Name: env
  - Env:
    - Key: LD_LIBRARY_PATH
      Value: /usr/local/cuda/lib64:/usr/local/cuda/nvvm/lib64:${LD_LIBRARY_PATH}
    Name: env
  - CmdLine:
    - ln -s /usr/local/cuda/lib64/stubs/libcuda.so /usr/local/cuda/lib64/libcuda.so.1
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update  && apt-get install -y software-properties-common
    Name: run
    PrependShell: true
  - CmdLine:
    - add-apt-repository -y ppa:hvr/ghc  && apt-get update  && apt-get install -y
      curl netbase pkg-config wget
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sSL https://get.haskellstack.org/ | sh
    Name: run
    PrependShell: true
  - CmdLine:
    - update-alternatives --install "/usr/bin/ld" "ld" "/usr/bin/ld.gold" 20
    Name: run
    PrependShell: true
  - CmdLine:
    - update-alternatives --install "/usr/bin/ld" "ld" "/usr/bin/ld.bfd" 10
    Name: run
    PrependShell: true
  - CmdLine:
    - wget -O - http://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -  && add-apt-repository
      "deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-5.0 main"  && add-apt-repository
      "deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-6.0 main"  && apt-get
      update  && apt-get install -y llvm-5.0-dev llvm-6.0-dev
    Name: run
    PrependShell: true
  - CmdLine:
    - update-alternatives --install "/usr/bin/llc" "llc" "/usr/bin/llc-5.0" 50
    Name: run
    PrependShell: true
  - CmdLine:
    - update-alternatives --install "/usr/bin/opt" "opt" "/usr/bin/opt-5.0" 50
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-add-repository "deb http://deb.debian.org/debian experimental main"  &&
      apt-get install -y debian-archive-keyring  && apt-get update  && apt-get install
      -y libffi7
    Name: run
    PrependShell: true
  - Name: workdir
    Path: ${PREFIX}
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./README.md
    - ${PREFIX}/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./LICENSE
    - ${PREFIX}/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./stack-8.4.yaml
    - ${PREFIX}/stack.yaml
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./accelerate-llvm/accelerate-llvm.cabal
    - ${PREFIX}/accelerate-llvm/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./accelerate-llvm-native/accelerate-llvm-native.cabal
    - ${PREFIX}/accelerate-llvm-native/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./accelerate-llvm-ptx/accelerate-llvm-ptx.cabal
    - ${PREFIX}/accelerate-llvm-ptx/
  - CmdLine:
    - stack --no-terminal --color never setup
    Name: run
    PrependShell: true
  - CmdLine:
    - stack --no-terminal --color never build --only-snapshot
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./accelerate-llvm
    - ${PREFIX}/accelerate-llvm
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./accelerate-llvm-native
    - ${PREFIX}/accelerate-llvm-native
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./accelerate-llvm-ptx
    - ${PREFIX}/accelerate-llvm-ptx
  - CmdLine:
    - stack --no-terminal --color never build accelerate-llvm
    Name: run
    PrependShell: true
  - CmdLine:
    - stack --no-terminal --color never build accelerate-llvm-native
    Name: run
    PrependShell: true
  - CmdLine:
    - stack --no-terminal --color never build accelerate-llvm-ptx
    Name: run
    PrependShell: true
  - CmdLine:
    - rm /usr/local/cuda/lib64/libcuda.so.1
    Name: run
    PrependShell: true
  - CmdLine:
    - bash
    Name: cmd
    PrependShell: false
  From:
    Image: nvidia/cuda:9.2-devel-ubuntu16.04
  Name: ""
  Platform: ""
  SourceCode: FROM nvidia/cuda:9.2-devel-ubuntu16.04
