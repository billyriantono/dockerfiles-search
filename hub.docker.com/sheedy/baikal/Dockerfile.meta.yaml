MetaArgs: null
Stages:
- BaseName: nginx:latest
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"Sheedy <git@michaelsheedy.com>"'
    Name: label
  - CmdLine:
    - groupadd -g 1001 app &&     useradd -u 1001 -g app -G www-data -m app
    Name: run
    PrependShell: true
  - Env:
    - Key: LC_ALL
      Value: C
    Name: env
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - Env:
    - Key: BAIKAL_VERSION
      Value: 0.5.3
    Name: env
  - CmdLine:
    - apt-get -y update &&             apt-get -y install supervisor php7.3-fpm php7.3-sqlite3
      php-xmlwriter php-dom php-mbstring wget unzip &&             apt-get clean &&             rm
      -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
    Name: run
    PrependShell: true
  - CmdLine:
    - test ! -d /usr/share/nginx/html/baikal &&             wget https://github.com/sabre-io/Baikal/releases/download/${BAIKAL_VERSION}/baikal-${BAIKAL_VERSION}.zip
      &&             unzip baikal-${BAIKAL_VERSION}.zip -d /usr/share/nginx/html &&             chown
      -R www-data:www-data /usr/share/nginx/html/baikal &&             rm baikal-${BAIKAL_VERSION}.zip
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p -m 755             /var/run/supervisor             /var/run/php7.3-fpm             /var/log/supervisor             /var/log/apps             /run/php
    Name: run
    PrependShell: true
  - CmdLine:
    - touch /var/log/supervisor/supervisord.log             && touch /var/run/nginx.pid
    Name: run
    PrependShell: true
  - CmdLine:
    - chown -R app:app               /var/run/supervisor               /var/run/php7.3-fpm               /var/log/supervisor               /var/log/nginx               /var/log/apps               /run/php               /var/cache/nginx               /var/run/nginx.pid             &&
      chmod u=rwx,go=rx,a+s /var/log/apps             && chmod -R g+w /var/cache/nginx             &&
      chmod +x /home             && chmod +x /home/app             && chmod g+s               /var/run/supervisor               /var/run/php7.3-fpm               /var/log/supervisor               /run/php               /var/log/apps               /var/cache/nginx
    Name: run
    PrependShell: true
  - Chown: app:app
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord.conf
    - /etc/supervisor/conf.d/supervisord.conf
  - Chown: app:app
    From: ""
    Name: copy
    SourcesAndDest:
    - nginx.conf
    - /etc/nginx/nginx.conf
  - Chown: app:app
    From: ""
    Name: copy
    SourcesAndDest:
    - php-fpm.conf
    - /etc/php7.3/fpm/php-fpm.conf
  - Name: user
    User: app
  - Name: expose
    Ports:
    - "8080"
  - CmdLine:
    - /usr/bin/supervisord
    Name: entrypoint
    PrependShell: false
  From:
    Image: nginx:latest
  Name: ""
  Platform: ""
  SourceCode: FROM        nginx:latest
