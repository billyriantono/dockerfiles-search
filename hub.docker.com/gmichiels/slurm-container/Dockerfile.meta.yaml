MetaArgs: null
Stages:
- BaseName: centos:7.4.1708
  Commands:
  - Key: SLURM_VERSION
    Name: arg
    Value: 17.11.5
  - Key: SLURM_DOWNLOAD_MD5
    Name: arg
    Value: 21fbe051aee43689dcd7711e47064f89
  - Key: SLURM_DOWNLOAD_URL
    Name: arg
    Value: https://download.schedmd.com/slurm/slurm-"$SLURM_VERSION".tar.bz2
  - Key: SINGULARITY_VERSION
    Name: arg
    Value: 2.4.5
  - CmdLine:
    - yum makecache fast     && yum -y install epel-release     && yum -y install         autoconf         bash-completion         bzip2         bzip2-devel         file         gcc         gcc-c++         gdbm-devel         git         glibc-devel         gmp-devel         libffi-devel         libGL-devel         libX11-devel         make         mariadb-server         mariadb-devel         munge         munge-devel         ncurses-devel         openssl-devel         openssl-libs         perl         pkconfig         psmisc         python-devel         python-pip         python34         python34-devel         python34-pip         readline-devel         sqlite-devel         tcl-devel         tix-devel         tk         tk-devel         supervisor         wget         vim-enhanced         zlib-devel     &&
      yum -y install https://centos7.iuscommunity.org/ius-release.rpm     && yum -y
      install         python35u         python35u-devel         python35u-pip         python36u         python36u-devel         python36u-pip     &&
      yum clean all     && rm -rf /var/cache/yum
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y openssh-server openssh-clients passwd net-tools
    Name: run
    PrependShell: true
  - CmdLine:
    - ssh-keygen -q -N "" -t dsa -f /etc/ssh/ssh_host_dsa_key && ssh-keygen -q -N
      "" -t rsa -f /etc/ssh/ssh_host_rsa_key
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -ri 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config && echo 'root:changeme'
      | chpasswd
    Name: run
    PrependShell: true
  - CmdLine:
    - pip2.7 install Cython nose     && pip3.4 install Cython nose     && pip3.5 install
      Cython nose     && pip3.6 install Cython nose
    Name: run
    PrependShell: true
  - CmdLine:
    - set -x     && wget -O slurm.tar.bz2 "$SLURM_DOWNLOAD_URL"     && echo "$SLURM_DOWNLOAD_MD5"
      slurm.tar.bz2 | md5sum -c -     && mkdir /usr/local/src/slurm     && tar jxf
      slurm.tar.bz2 -C /usr/local/src/slurm --strip-components=1     && rm slurm.tar.bz2     &&
      cd /usr/local/src/slurm     && ./configure --enable-debug --enable-front-end
      --prefix=/usr        --sysconfdir=/etc/slurm --with-mysql_config=/usr/bin        --libdir=/usr/lib64     &&
      make install     && install -D -m644 etc/cgroup.conf.example /etc/slurm/cgroup.conf.example     &&
      install -D -m644 etc/slurm.conf.example /etc/slurm/slurm.conf.example     &&
      install -D -m644 etc/slurm.epilog.clean /etc/slurm/slurm.epilog.clean     &&
      install -D -m644 etc/slurmdbd.conf.example /etc/slurm/slurmdbd.conf.example     &&
      install -D -m644 contribs/slurm_completion_help/slurm_completion.sh /etc/profile.d/slurm_completion.sh     &&
      cd     && rm -rf /usr/local/src/slurm     && groupadd -r slurm      && useradd
      -r -g slurm slurm     && mkdir /etc/sysconfig/slurm         /var/spool/slurmd         /var/run/slurmd         /var/lib/slurmd         /var/log/slurm     &&
      chown slurm:root /var/spool/slurmd         /var/run/slurmd         /var/lib/slurmd         /var/log/slurm     &&
      /sbin/create-munge-key
    Name: run
    PrependShell: true
  - CmdLine:
    - yum -y install squashfs-tools
    Name: run
    PrependShell: true
  - CmdLine:
    - wget https://github.com/singularityware/singularity/releases/download/$SINGULARITY_VERSION/singularity-$SINGULARITY_VERSION.tar.gz
      &&     tar xvf singularity-$SINGULARITY_VERSION.tar.gz &&     cd singularity-$SINGULARITY_VERSION
      &&     ./configure --prefix=/usr/local &&     make &&     make install
    Name: run
    PrependShell: true
  - CmdLine:
    - adduser cytomine &&     echo "cytomine:cytomine" | chpasswd
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - slurm.conf
    - /etc/slurm/slurm.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - slurmdbd.conf
    - /etc/slurm/slurmdbd.conf
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord.conf
    - /etc/
  - Name: volume
    Volumes:
    - /var/lib/mysql
    - /var/lib/slurmd
    - /var/spool/slurmd
    - /var/log/slurm
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - docker-entrypoint.sh
    - /usr/local/bin/docker-entrypoint.sh
  - CmdLine:
    - chmod +x /usr/local/bin/docker-entrypoint.sh
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "22"
    - "80"
  - CmdLine:
    - /usr/local/bin/docker-entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine:
    - /bin/bash
    Name: cmd
    PrependShell: false
  From:
    Image: centos:7.4.1708
  Name: ""
  Platform: ""
  SourceCode: FROM centos:7.4.1708
