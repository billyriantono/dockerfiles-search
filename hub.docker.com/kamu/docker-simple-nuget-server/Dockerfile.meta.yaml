MetaArgs: null
Stages:
- BaseName: nginx:latest
  Commands:
  - Key: AGENT_UID
    Name: arg
    Value: "1000"
  - Key: AGENT_GID
    Name: arg
    Value: "1000"
  - CmdLine:
    - groupadd -g ${AGENT_GID} nginx_docker     && useradd -d /home/docker -u ${AGENT_UID}
      -g nginx_docker nginx_docker     && sed -ie "s/nginx;/nginx_docker;/" /etc/nginx/nginx.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get update &&     apt-get install --no-install-recommends -y  git  php7.0-fpm
      php7.0-sqlite php7.0-xml php7.0-zip apt-utils apt-transport-https ca-certificates
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install --no-install-recommends -y  nano curl mc
    Name: run
    PrependShell: true
  - CmdLine:
    - apt-get install unzip
    Name: run
    PrependShell: true
  - Env:
    - Key: NUGET_PATH
      Value: /app
    Name: env
  - Env:
    - Key: NUGET_HOST
      Value: localhost
    Name: env
  - Env:
    - Key: NUGET_API_KEY
      Value: e46c582041db4cbe86a84b76a374383a
    Name: env
  - Env:
    - Key: NUGET_DEFAULT_HTTP
      Value: http
    Name: env
  - CmdLine:
    - git clone https://github.com/muak/simple-nuget-server.git $NUGET_PATH &&     chown
      nginx_docker:nginx_docker $NUGET_PATH/db $NUGET_PATH/packagefiles &&     chmod
      0770 $NUGET_PATH/db $NUGET_PATH/packagefiles
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - nginx.conf.example
    - /etc/nginx/conf.d/default.conf
  - CmdLine:
    - sed -i -- 's/\/var\/www\/simple-nuget-server/\/app/g' /etc/nginx/conf.d/default.conf  &&     cat
      /etc/nginx/conf.d/default.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i -- 's/.*#gzip  on;/    client_max_body_size 20M;/g' /etc/nginx/nginx.conf
      &&     cat /etc/nginx/nginx.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i -- 's/.*upload_max_filesize.*=.*/upload_max_filesize = 20M/g' /etc/php/7.0/fpm/php.ini
      &&     sed -i -- 's/;cgi.fix_pathinfo=1/cgi.fix_pathinfo=0/g' /etc/php/7.0/fpm/php.ini
      &&     cat /etc/php/7.0/fpm/php.ini | grep upload_max_filesize
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i -- 's/user = .*/user = nginx_docker/g' /etc/php/7.0/fpm/pool.d/www.conf
      &&     sed -i -- 's/group = .*/group = nginx_docker/g' /etc/php/7.0/fpm/pool.d/www.conf
      &&     cat /etc/php/7.0/fpm/pool.d/www.conf
    Name: run
    PrependShell: true
  - CmdLine:
    - sed -i -- 's/;listen.mode = .*/listen.mode = 0660/g' /etc/php/7.0/fpm/pool.d/www.conf
      &&     sed -i -- 's/listen.owner = .*/listen.owner = nginx_docker/g' /etc/php/7.0/fpm/pool.d/www.conf
      &&     sed -i -- 's/listen.group = .*/listen.group = nginx_docker/g' /etc/php/7.0/fpm/pool.d/www.conf
      &&     cat /etc/php/7.0/fpm/pool.d/www.conf | grep listen.
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - init.sh
    - /
  - Name: expose
    Ports:
    - "80"
  - Name: volume
    Volumes:
    - app/db
    - app/packagefiles
  - CmdLine:
    - sh
    - init.sh
    Name: cmd
    PrependShell: false
  From:
    Image: nginx:latest
  Name: ""
  Platform: ""
  SourceCode: FROM nginx:latest
