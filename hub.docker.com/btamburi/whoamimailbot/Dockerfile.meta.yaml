MetaArgs: null
Stages:
- BaseName: debian:latest
  Commands:
  - Labels:
    - Key: author
      Value: '"@mthbernardes"'
    Name: label
  - Labels:
    - Key: collaborator
      Value: '"@btamburi"'
    Name: label
  - Name: workdir
    Path: /opt/mailbot
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - run.sh
    - $WORKDIR
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - mailbot.py
    - $WORKDIR
  - CmdLine:
    - mkdir /data
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "postfix postfix/mailname string mail.example.com" | debconf-set-selections
    Name: run
    PrependShell: true
  - CmdLine:
    - echo "postfix postfix/main_mailer_type string 'Internet Site'" | debconf-set-selections
    Name: run
    PrependShell: true
  - CmdLine:
    - apt update && apt -y upgrade && apt install -y postfix python3 python3-pip &&
      pip3 install telepot
    Name: run
    PrependShell: true
  - CmdLine:
    - chmod +x /opt/mailbot/run.sh
    Name: run
    PrependShell: true
  - CmdLine:
    - postconf -e 'virtual_alias_maps= hash:/data/virtual'
    Name: run
    PrependShell: true
  - CmdLine:
    - /etc/init.d/postfix start
    Name: run
    PrependShell: true
  - Name: expose
    Ports:
    - "25"
  - CmdLine:
    - /opt/mailbot/run.sh
    Name: entrypoint
    PrependShell: false
  From:
    Image: debian:latest
  Name: ""
  Platform: ""
  SourceCode: FROM debian:latest
