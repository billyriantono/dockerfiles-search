MetaArgs: null
Stages:
- BaseName: ruby:2.3.3-alpine
  Commands:
  - Maintainer: Per Christian B. Viken <perchr@northblue.org>
    Name: maintainer
  - CmdLine:
    - addgroup -S batsd && adduser -S -D -s /bin/false -G batsd -g batsd batsd
    Name: run
    PrependShell: true
  - CmdLine:
    - gem update --system && gem install bundler
    Name: run
    PrependShell: true
  - CmdLine:
    - apk add --no-cache --virtual build-dependencies build-base
    Name: run
    PrependShell: true
  - CmdLine:
    - apk update && apk add ca-certificates openssl redis supervisor procmail ssmtp
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /app     && wget -O - https://github.com/PerfectlyNormal/batsd/archive/master.tar.gz     |
      tar -xz -C /app     && chown -R batsd:batsd /app     && cd /app     && find
      batsd-master -name ".*" -mindepth 1 -maxdepth 1 -exec mv {} . \;     && mv batsd-master/*
      . && rmdir batsd-master     && bundle install
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /data/batsd /data/redis   && chown -R batsd:batsd /data/batsd   &&
      chown -R redis:redis /data/batsd   && chmod 700 /data/
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /data
  - Chown: ""
    Name: add
    SourcesAndDest:
    - etc/hourly-truncate
    - /etc/periodic/hourly/batsd-truncate
  - Chown: ""
    Name: add
    SourcesAndDest:
    - etc/daily-truncate
    - /etc/periodic/daily/batsd-truncate
  - CmdLine:
    - chmod +x /etc/periodic/hourly/batsd-truncate /etc/periodic/daily/batsd-truncate
    Name: run
    PrependShell: true
  - Chown: ""
    Name: add
    SourcesAndDest:
    - etc/config.yml
    - /app/config.yml
  - Chown: ""
    Name: add
    SourcesAndDest:
    - etc/redis.conf
    - /etc/redis.conf
  - Chown: ""
    Name: add
    SourcesAndDest:
    - etc/supervisord.conf
    - /etc/supervisord.conf
  - CmdLine:
    - mkdir /var/log/supervisor
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /app
  - Name: expose
    Ports:
    - 8125/udp
    - "8126"
    - "8127"
  - CmdLine:
    - supervisord
    - -c
    - /etc/supervisord.conf
    Name: cmd
    PrependShell: false
  From:
    Image: ruby:2.3.3-alpine
  Name: ""
  Platform: ""
  SourceCode: FROM ruby:2.3.3-alpine
