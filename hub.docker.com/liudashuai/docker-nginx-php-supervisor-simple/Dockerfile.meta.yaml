MetaArgs: null
Stages:
- BaseName: liudashuai/docker-alpine-nginx:latest
  Commands:
  - CmdLine:
    - "echo 'http://mirrors.aliyun.com/alpine/latest-stable/main' > /etc/apk/repositories
      \t&& echo '@community http://mirrors.aliyun.com/alpine/latest-stable/community'
      >> /etc/apk/repositories \t&& echo '@testing http://mirrors.aliyun.com/alpine/edge/testing/'
      >> /etc/apk/repositories"
    Name: run
    PrependShell: true
  - Env:
    - Key: TIMEZONE
      Value: Asia/Shanghai
    Name: env
  - Env:
    - Key: PHP_MEMORY_LIMIT
      Value: 512M
    Name: env
  - Env:
    - Key: MAX_UPLOAD
      Value: 50M
    Name: env
  - Env:
    - Key: PHP_MAX_FILE_UPLOAD
      Value: "200"
    Name: env
  - Env:
    - Key: PHP_MAX_POST
      Value: 100M
    Name: env
  - Env:
    - Key: COMPOSER_ALLOW_SUPERUSER
      Value: "1"
    Name: env
  - CmdLine:
    - "apk update \t&& apk upgrade \t&& apk add \t    curl  \t    tzdata \t    php7@community
      \t    php7-dev@community \t    php7-apcu@community \t    php7-bcmath@community
      \t    php7-xmlwriter@community \t    php7-ctype@community \t    php7-curl@community
      \t    php7-exif@community \t    php7-iconv@community \t    php7-intl@community
      \t    php7-json@community \t    php7-mbstring@community\t    php7-opcache@community
      \t    php7-openssl@community \t    php7-pcntl@community \t    php7-pdo@community
      \t    php7-mysqlnd@community \t    php7-mysqli@community \t    php7-pdo_mysql@community
      \t    php7-pdo_pgsql@community \t    php7-phar@community \t    php7-posix@community
      \t    php7-session@community \t    php7-xml@community \t    php7-simplexml@community
      \t    php7-mcrypt@community \t    php7-xsl@community \t    php7-zip@community
      \t    php7-zlib@community \t    php7-dom@community \t    php7-redis@community\t
      \   php7-tokenizer@community \t    php7-gd@community \t    php7-mongodb@community
      \t    php7-fileinfo@community \t    php7-zmq@community \t    php7-memcached@community
      \t    php7-fpm@community \t    php7-xmlreader@community  \t&& cp /usr/share/zoneinfo/${TIMEZONE}
      /etc/localtime \t&& echo \"${TIMEZONE}\" > /etc/timezone \t&& apk del tzdata
      \ \t&& rm -rf /var/cache/apk/*"
    Name: run
    PrependShell: true
  - CmdLine:
    - apk add --no-cache --repository http://dl-3.alpinelinux.org/alpine/edge/community
      gnu-libiconv
    Name: run
    PrependShell: true
  - Env:
    - Key: LD_PRELOAD
      Value: /usr/lib/preloadable_libiconv.so php
    Name: env
  - CmdLine:
    - rm -rf /var/cache/apk/*
    Name: run
    PrependShell: true
  - CmdLine:
    - "sed -i \"s|;*date.timezone =.*|date.timezone = ${TIMEZONE}|i\" /etc/php7/php.ini
      && \tsed -i \"s|;*memory_limit =.*|memory_limit = ${PHP_MEMORY_LIMIT}|i\" /etc/php7/php.ini
      && \tsed -i \"s|;*upload_max_filesize =.*|upload_max_filesize = ${MAX_UPLOAD}|i\"
      /etc/php7/php.ini && \tsed -i \"s|;*max_file_uploads =.*|max_file_uploads =
      ${PHP_MAX_FILE_UPLOAD}|i\" /etc/php7/php.ini && \tsed -i \"s|;*post_max_size
      =.*|post_max_size = ${PHP_MAX_POST}|i\" /etc/php7/php.ini && \tsed -i \"s|;*cgi.fix_pathinfo=.*|cgi.fix_pathinfo=
      0|i\" /etc/php7/php.ini"
    Name: run
    PrependShell: true
  - CmdLine:
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/bin/
      --filename=composer
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/share/nginx/html/public
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/local/var/log/php7
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/local/var/run
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./php/php-fpm.conf
    - /etc/php7/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./php/www.conf
    - /etc/php7/php-fpm.d/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./php/index.php
    - /usr/share/nginx/html/public
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./nginx/default.conf
    - /etc/nginx/conf.d/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./nginx/ssl.default.conf
    - /etc/nginx/conf.d/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./nginx/nginx.conf
    - /etc/nginx/
  - Name: volume
    Volumes:
    - /usr/share/nginx/html
    - /usr/local/var/log/php7
    - /var/run/
  - Name: expose
    Ports:
    - "9000"
  - CmdLine:
    - "apk add supervisor \t&& rm -rf /var/cache/apk/*"
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /etc/supervisor/conf.d
    - /var/log/supervisor/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./supervisor/conf.d/crond.conf
    - /etc/supervisor/conf.d/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./supervisor/conf.d
    - /etc/supervisor/conf.d
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - ./crontabs/default
    - /var/spool/cron/crontabs/
  - CmdLine:
    - cat /var/spool/cron/crontabs/default >> /var/spool/cron/crontabs/root
    Name: run
    PrependShell: true
  - CmdLine:
    - "mkdir -p /var/log/cron \t&& touch /var/log/cron/cron.log"
    Name: run
    PrependShell: true
  - Name: workdir
    Path: /usr/share/nginx/html
  - CmdLine:
    - supervisord
    - --nodaemon
    - --configuration
    - /etc/supervisor/conf.d/supervisord.conf
    Name: entrypoint
    PrependShell: false
  From:
    Image: liudashuai/docker-alpine-nginx:latest
  Name: ""
  Platform: ""
  SourceCode: FROM liudashuai/docker-alpine-nginx:latest
