MetaArgs: null
Stages:
- BaseName: fayehuang/centos-serf
  Commands:
  - Maintainer: FayeHuang
    Name: maintainer
  - Name: workdir
    Path: /docker_init/cm-agent
  - Env:
    - Key: mysql_password
      Value: changeme
    Name: env
  - CmdLine:
    - yum install -y ntp mysql-connector-java && yum clean all
    Name: run
    PrependShell: true
  - CmdLine:
    - mkdir -p /usr/lib/hive/lib/ && ln -s /usr/share/java/mysql-connector-java.jar
      /usr/lib/hive/lib/mysql-connector-java.jar
    Name: run
    PrependShell: true
  - Env:
    - Key: cm_version
      Value: 5.4.3
    - Key: cdh_version
      Value: 5.4.4
    Name: env
  - CmdLine:
    - wget http://archive.cloudera.com/cdh5/redhat/6/x86_64/cdh/cloudera-cdh5.repo
      && mv cloudera-cdh5.repo /etc/yum.repos.d &&     wget http://archive.cloudera.com/cm5/redhat/6/x86_64/cm/cloudera-manager.repo
      && mv cloudera-manager.repo /etc/yum.repos.d &&     sed -i.bak s/^.*"baseurl".*/"baseurl=http:\/\/archive.cloudera.com\/cdh5\/redhat\/6\/x86_64\/cdh\/$cdh_version\/"/
      /etc/yum.repos.d/cloudera-cdh5.repo &&     sed -i.bak s/^.*"baseurl".*/"baseurl=http:\/\/archive.cloudera.com\/cm5\/redhat\/6\/x86_64\/cm\/$cm_version\/"/
      /etc/yum.repos.d/cloudera-manager.repo
    Name: run
    PrependShell: true
  - CmdLine:
    - yum install -y cloudera-manager-agent cloudera-manager-daemons oracle-j2sdk1.7                    hadoop
      hadoop-httpfs                    zookeeper zookeeper-server                    hbase                    hive
      hive-metastore hive-server2 hive-webhcat-server hive-hcatalog sentry                    impala
      impala-server impala-state-store impala-catalog impala-shell llama llama-master                    oozie
      oozie-client                    hue hue-plugins                    pig                    spark-core
      spark-worker spark-master spark-python spark-history-server                    flume-ng
      flume-ng-agent                    solr-server solr-crunch solr-mapreduce hbase-solr-indexer
      hbase-solr-doc hue-search                    sqoop                    sqoop2-server
      sqoop2-client                    mahout                    && yum clean all
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - agent_init.sh
    - agent_init.sh
  - CmdLine:
    - chmod +x agent_init.sh
    Name: run
    PrependShell: true
  - Env:
    - Key: SERF_HOME
      Value: /docker_init/serf
    Name: env
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - serf_init.sh
    - $SERF_HOME/bin/serf_init.sh
  - CmdLine:
    - chmod +x $SERF_HOME/bin/serf_init.sh
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - supervisord.conf
    - /etc/supervisord.conf
  - Name: expose
    Ports:
    - "19888"
    - "22"
    - "3000"
    - "50070"
    - "8042"
    - "8088"
  - CmdLine:
    - /usr/bin/supervisord
    - -c
    - /etc/supervisord.conf
    Name: cmd
    PrependShell: false
  From:
    Image: fayehuang/centos-serf
  Name: ""
  Platform: ""
  SourceCode: FROM fayehuang/centos-serf
