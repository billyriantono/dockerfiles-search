MetaArgs: null
Stages:
- As: builder
  BaseName: mediawiki:1.31
  Commands:
  - CmdLine:
    - apt-get update && apt-get -y install gawk git rsync sed
    Name: run
    PrependShell: true
  - CmdLine:
    - "for ext in mediawiki-extensions-LdapAuthentication:REL1_31 \t\tmediawiki-extensions-PluggableAuth:5.4
      \t\tmediawiki-extensions-SimpleSAMLphp:4.1; do \t\tcd /tmp && \t\t\textension_name=$(echo
      $ext | awk -F':' '{print $1}') && \t\t\textension_branch=$(echo $ext | awk -F':'
      '{print $2}') && \t\t\tinstall_dirname=$(echo $extension_name | sed 's/^mediawiki-extensions-//')
      && \t\t\tgit clone https://github.com/wikimedia/$extension_name && \t\t\tcd
      $extension_name && \t\t\tgit checkout $extension_branch && \t\t\tcd .. && \t\t\trsync
      -avz --exclude=.git $extension_name /var/www/html/extensions/$install_dirname
      \t; done"
    Name: run
    PrependShell: true
  - CmdLine:
    - "for mod in ldap remoteip; do \t\ta2enmod $mod \t; done"
    Name: run
    PrependShell: true
  From:
    Image: mediawiki:1.31
  Name: builder
  Platform: ""
  SourceCode: FROM mediawiki:1.31 as builder
- As: cleanup
  BaseName: builder
  Commands:
  - CmdLine:
    - "rm -rf /tmp/mediawiki-extensions-* && \tapt-get clean && \trm -rf /var/lib/apt/lists/*"
    Name: run
    PrependShell: true
  From:
    Stage:
      Index: 0
      Named: builder
  Name: cleanup
  Platform: ""
  SourceCode: FROM builder as cleanup
