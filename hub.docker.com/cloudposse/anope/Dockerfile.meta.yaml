MetaArgs: null
Stages:
- BaseName: ubuntu:14.04
  Commands:
  - Maintainer: Erik Osterman "e@osterman.com"
    Name: maintainer
  - Env:
    - Key: ANOPE_VERSION
      Value: 2.0.3
    Name: env
  - Env:
    - Key: ANOPE_GEOIP_DATABASE
      Value: country
    Name: env
  - Env:
    - Key: ANOPE_SMTP_HOST
      Value: 127.0.0.1
    Name: env
  - Env:
    - Key: ANOPE_ADMIN_EMAIL
      Value: ops@localhost
    Name: env
  - Env:
    - Key: ANOPE_NAMESERVERS
      Value: 8.8.8.8 8.8.4.4
    Name: env
  - Env:
    - Key: ANOPE_UPLINK_HOST
      Value: localhost
    Name: env
  - Env:
    - Key: ANOPE_UPLINK_PORT
      Value: "7000"
    Name: env
  - Env:
    - Key: ANOPE_UPLINK_PASSWORD
      Value: secret
    Name: env
  - Env:
    - Key: ANOPE_SERVERINFO_NAME
      Value: anope.localnet
    Name: env
  - Env:
    - Key: ANOPE_SALT
      Value: salt
    Name: env
  - Env:
    - Key: ANOPE_URL
      Value: http://localhost/
    Name: env
  - Env:
    - Key: MYSQL_USER
      Value: irc
    Name: env
  - Env:
    - Key: MYSQL_PASSWORD
      Value: password
    Name: env
  - Env:
    - Key: MYSQL_DATABASE
      Value: anope
    Name: env
  - Env:
    - Key: MYSQL_HOST
      Value: localhost
    Name: env
  - Env:
    - Key: MYSQL_PORT
      Value: "3306"
    Name: env
  - Env:
    - Key: MYSQL_PREFIX
      Value: anope_
    Name: env
  - Env:
    - Key: LC_ALL
      Value: C
    Name: env
  - Env:
    - Key: DEBIAN_FRONTEND
      Value: noninteractive
    Name: env
  - Env:
    - Key: TERM
      Value: xterm
    Name: env
  - Name: workdir
    Path: /usr/src
  - Chown: ""
    Name: add
    SourcesAndDest:
    - config.cache
    - /usr/src/anope-$ANOPE_VERSION-source/config.cache
  - CmdLine:
    - echo 'APT::Install-Recommends "0";' >> /etc/apt/apt.conf.d/01buildconfig &&     echo
      'APT::Get::Assume-Yes "true";' >> /etc/apt/apt.conf.d/01buildconfig &&     echo
      'APT::Get::force-yes "true";' >> /etc/apt/apt.conf.d/01buildconfig  &&     echo
      'APT::Install-Suggests "0";' >> /etc/apt/apt.conf.d/01buildconfig &&     apt-get
      update &&     apt-get upgrade -y &&     apt-get install -y build-essential curl
      libssl-dev ca-certificates cmake libpcre3-dev libmysqlclient-dev mysql-client
      unzip wget gettext &&     groupadd -g 1000 anope &&     useradd -u 1000 -g anope
      -d /anope/ anope &&     curl -s --location https://github.com/anope/anope/releases/download/$ANOPE_VERSION/anope-$ANOPE_VERSION-source.tar.gz
      | tar xz &&     cd anope-$ANOPE_VERSION-source &&     cd modules/ &&     ln
      -s extra/m_mysql.cpp . &&     ln -s extra/m_sql_authentication.cpp . &&     ln
      -s extra/m_sql_log.cpp . &&     ln -s extra/m_sql_oper.cpp . &&     ln -s extra/m_regex_pcre.cpp
      . &&     ln -s extra/stats . &&     cd ../ &&     ./Config -quick &&     cd
      build/ &&     make &&     make install &&     sed -i -r 's/^(geoip_database)=.*/\1=$ANOPE_GEOIP_DATABASE/'
      /anope/bin/geoipupdate.sh &&     sed -i -r 's/^(mysql_host)=.*/\1=$MYSQL_HOST/'
      /anope/bin/geoipupdate.sh &&     sed -i -r 's/^(mysql_user)=.*/\1=$MYSQL_USER/'
      /anope/bin/geoipupdate.sh &&     sed -i -r 's/^(mysql_password)=.*/\1=$MYSQL_PASSWORD/'
      /anope/bin/geoipupdate.sh &&     sed -i -r 's/^(mysql_database)=.*/\1=$MYSQL_DATABASE/'
      /anope/bin/geoipupdate.sh &&     sed -i -r 's/^(prefix)=.*/\1=$MYSQL_PREFIX/'
      /anope/bin/geoipupdate.sh &&     sed -i -r 's/^(die)=.*/\1=no/' /anope/bin/geoipupdate.sh
      &&     sed -i -r 's/\$prefix"geoip_country6\.csv"//' /anope/bin/geoipupdate.sh
      &&     rm -rf /anope/logs &&     mkdir -p /anope/logs &&     rm -rf /anope/confg
      &&     mkdir -p /anope/conf &&     chown -R anope:anope -R /anope/ &&     apt-get
      -y remove build-essential cmake &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
      /tmp/* /var/tmp/* /usr/src/*
    Name: run
    PrependShell: true
  - Name: volume
    Volumes:
    - /anope/log
  - Name: workdir
    Path: /anope
  - Chown: ""
    Name: add
    SourcesAndDest:
    - start
    - /start
  - Chown: ""
    Name: add
    SourcesAndDest:
    - templates/
    - /anope/templates
  - Name: user
    User: anope
  - Name: expose
    Ports:
    - "8080"
  - CmdLine:
    - /start
    Name: entrypoint
    PrependShell: false
  From:
    Image: ubuntu:14.04
  Name: ""
  Platform: ""
  SourceCode: FROM ubuntu:14.04
