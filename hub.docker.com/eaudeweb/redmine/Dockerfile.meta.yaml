MetaArgs: null
Stages:
- BaseName: redmine:4.0.4
  Commands:
  - Labels:
    - Key: maintainer
      Value: '"<informea@eaudeweb.ro>"'
    Name: label
  - Env:
    - Key: REDMINE_PATH
      Value: /usr/src/redmine
    - Key: REDMINE_LOCAL_PATH
      Value: /var/local/redmine
    Name: env
  - CmdLine:
    - apt-get update -q  && apt-get install -y --no-install-recommends cron unzip
      netcat-traditional vim curl python3-pip build-essential python3-dev imagemagick
      && apt-get clean  && rm -rf /var/lib/apt/lists/*  && pip3 install --upgrade
      setuptools  && pip3 install wheel  && pip3 install PyYAML ruamel.yaml
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - plugins/*
    - ${REDMINE_LOCAL_PATH}/plugins/
  - CmdLine:
    - mkdir -p ${REDMINE_LOCAL_PATH}/github  && mkdir -p ${REDMINE_LOCAL_PATH}/scripts  &&
      mkdir -p ${REDMINE_LOCAL_PATH}/backup  && cd ${REDMINE_PATH}/plugins  && git
      clone --branch v3.0.1 https://github.com/koppen/redmine_github_hook.git  &&
      git clone https://github.com/akiko-pusu/redmine_banner.git  && git clone https://github.com/paginagmbh/redmine_silencer.git  &&
      git clone https://github.com/paginagmbh/redmine_lightbox2.git  && git clone
      https://github.com/rgtk/redmine_impersonate.git  && git clone https://github.com/rgtk/redmine_editauthor.git  &&
      git clone https://github.com/GEROMAX/redmine_subtask_list_accordion.git  &&
      git clone https://github.com/laoshancun/redmine_checklists.git  && git clone
      https://github.com/two-pack/redmine_xlsx_format_issue_exporter.git  && unzip
      -d ${REDMINE_PATH}/plugins -o ${REDMINE_LOCAL_PATH}/plugins/redmine_agile-1_4_12-light.zip  &&
      unzip -d ${REDMINE_PATH}/plugins -o ${REDMINE_LOCAL_PATH}/plugins/EasyGanttFree.zip  &&
      unzip -d ${REDMINE_PATH}/plugins -o ${REDMINE_LOCAL_PATH}/plugins/redmine_people-1_4_1-light.zip  &&
      cd ${REDMINE_PATH}  && gem install bundler --pre  && chown -R redmine:redmine
      ${REDMINE_PATH} ${REDMINE_LOCAL_PATH}  && unzip -d ${REDMINE_PATH}/public/themes
      -o ${REDMINE_LOCAL_PATH}/plugins/edw-theme.zip  && unzip -d ${REDMINE_PATH}/public/themes
      -o ${REDMINE_LOCAL_PATH}/plugins/informea-theme.zip
    Name: run
    PrependShell: true
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - entrypoint.sh
    - scripts/receive_imap.sh
    - scripts/update-repositories.sh
    - scripts/update_configuration.py
    - ${REDMINE_LOCAL_PATH}/scripts/
  - Chown: ""
    From: ""
    Name: copy
    SourcesAndDest:
    - crontab
    - ${REDMINE_LOCAL_PATH}/
  - Name: workdir
    Path: $REDMINE_PATH
  - Chown: ""
    Name: add
    SourcesAndDest:
    - https://www.redmine.org/attachments/download/22481/allow_watchers_and_contributers_access_to_issues_4.0.2.patch
    - patches/redmine_3_6_log_time_for_others.patch
    - patches/imap_scan_multiple_folders.patch
    - ${REDMINE_PATH}/
  - CmdLine:
    - patch -p0 < allow_watchers_and_contributers_access_to_issues_4.0.2.patch   &&
      patch -p0 < redmine_3_6_log_time_for_others.patch   && patch -p0 < imap_scan_multiple_folders.patch
    Name: run
    PrependShell: true
  - CmdLine:
    - /var/local/redmine/scripts/entrypoint.sh
    Name: entrypoint
    PrependShell: false
  - CmdLine: []
    Name: cmd
    PrependShell: false
  From:
    Image: redmine:4.0.4
  Name: ""
  Platform: ""
  SourceCode: FROM redmine:4.0.4
